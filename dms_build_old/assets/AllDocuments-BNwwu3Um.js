import{q as Y,r as i,j as e,ac as ie,ad as ce,ae as oe,af as de,ag as me,a9 as u,a1 as ue,ah as Z,aa as _,a6 as h,ai as ee,a4 as G,a5 as se,aj as he,a3 as fe,L,V as pe,W as xe,U as ge,a7 as je,a8 as ye,ak as Q,ab as ve}from"./index-CHqJbmpY.js";import{U as te}from"./upload-Chl__IaK.js";import{S as we,a as Ne,b as Se,c as be,d as B}from"./select-DUfxb4LO.js";const ke=Y("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const De=Y("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);function Fe({open:S,onOpenChange:b,onUploadComplete:d}){const[c,f]=i.useState([]),[m,P]=i.useState(!1),[$,k]=i.useState(!1),[H,U]=i.useState(!1),g=i.useRef(null),M=localStorage.getItem("token")||"",j=s=>{s.preventDefault(),s.stopPropagation(),s.type==="dragenter"||s.type==="dragover"?U(!0):s.type==="dragleave"&&U(!1)},T=s=>{s.preventDefault(),s.stopPropagation(),U(!1),s.dataTransfer.files&&s.dataTransfer.files.length>0&&y(Array.from(s.dataTransfer.files))},z=s=>{s.target.files&&s.target.files.length>0&&y(Array.from(s.target.files))},y=s=>{const l=s.filter(t=>{const o=t.type.startsWith("image/"),v=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(t.type);return o||v});l.length!==s.length&&h.error("Some files were skipped. Only images and documents are allowed."),f(t=>[...t,...l])},R=s=>{f(l=>l.filter((t,o)=>o!==s))},p=async s=>{const l=await s.arrayBuffer(),t=await crypto.subtle.digest("SHA-256",l);return Array.from(new Uint8Array(t)).map(A=>A.toString(16).padStart(2,"0")).join("")},D=async()=>{if(c.length===0){h.error("Please select at least one file");return}P(!0),k(!1);try{let s=0,l=0;if(await Promise.all(c.map(async t=>{var o,v,A;try{const F=await p(t),E=new FormData;E.append("file",t),E.append("tags",t.name.substring(0,7));const C={"x-digest":F,token:"8Ufn6Jio6Obv9V7VXeP7gbzHSyRJcKluQOGorAD58qA1IQKYE0",folderPathId:"1",Authorization:`Bearer ${M}`},w=await ee.post(`${G}/${se.uploadDocument}`,E,{headers:C});((o=w==null?void 0:w.data)==null?void 0:o.status)===!0||(A=(v=w==null?void 0:w.data)==null?void 0:v.data)!=null&&A.ReferenceNo?s++:l++}catch{l++}})),s>0&&l===0)k(!0),h.success(`Successfully uploaded ${s} file(s)!`);else if(s>0&&l>0)h.success(`Uploaded ${s} file(s). ${l} failed.`);else throw new Error("All uploads failed");setTimeout(()=>{f([]),b(!1),k(!1),d==null||d()},1500)}catch(s){h.error(s.message||"Failed to upload files")}finally{P(!1)}},O=s=>{if(s===0)return"0 Bytes";const l=1024,t=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(s)/Math.log(l));return Math.round(s/Math.pow(l,o)*100)/100+" "+t[o]},I=()=>{m||(f([]),k(!1),b(!1))};return e.jsx(ie,{open:S,onOpenChange:I,children:e.jsxs(ce,{className:"sm:max-w-[600px]",children:[e.jsxs(oe,{children:[e.jsx(de,{className:"text-2xl",children:"Upload Documents"}),e.jsx(me,{children:"Upload single or multiple images and documents to your library"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:`relative border-2 border-dashed rounded-lg p-8 text-center transition-all ${H?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-primary/50"}`,onDragEnter:j,onDragLeave:j,onDragOver:j,onDrop:T,children:[e.jsx("input",{ref:g,type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:z,className:"hidden"}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"p-4 bg-primary/10 rounded-full",children:e.jsx(te,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"font-semibold text-lg",children:H?"Drop files here":"Choose files or drag & drop"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Images, PDF, Word documents supported"}),e.jsx(u,{type:"button",variant:"outline",onClick:()=>{var s;return(s=g.current)==null?void 0:s.click()},className:"mt-2",children:"Browse Files"})]})]}),c.length>0&&e.jsxs("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:[e.jsxs("h4",{className:"font-semibold text-sm text-muted-foreground",children:["Selected Files (",c.length,")"]}),c.map((s,l)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg hover:bg-muted transition-colors",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded",children:s.type.startsWith("image/")?e.jsx("img",{src:URL.createObjectURL(s),alt:s.name,className:"h-10 w-10 object-cover rounded"}):e.jsx(ue,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:O(s.size)})]}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",onClick:()=>R(l),disabled:m,children:e.jsx(Z,{className:"h-4 w-4"})})]},l))]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{type:"button",variant:"outline",onClick:I,disabled:m,children:"Cancel"}),e.jsxs(u,{type:"button",onClick:D,disabled:c.length===0||m||$,children:[m&&e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}),$&&e.jsx(ke,{className:"mr-2 h-4 w-4"}),$?"Uploaded!":m?"Uploading...":"Upload"]})]})]})})}const Ce=(S,b=2)=>{if(!+S)return"0 Bytes";const d=1024,c=b<0?0:b,f=["Bytes","KB","MB","GB","TB"],m=Math.floor(Math.log(S)/Math.log(d));return`${parseFloat((S/Math.pow(d,m)).toFixed(c))} ${f[m]}`};function Pe(){var X;const[S,b]=he(),d=S.get("fileType")||"all",[c,f]=i.useState([]),[m,P]=i.useState(!1),[$,k]=i.useState(!1),[H,U]=i.useState(null),[g,M]=i.useState(1),[j]=i.useState(20),[T,z]=i.useState(!0),[y,R]=i.useState(!1),[p,D]=i.useState(new Set),[O,I]=i.useState(!1),s=localStorage.getItem("token")||"",l=`${G}/document/view-all?page=${g}&limit=${j}${d!=="all"?`&fileType=${encodeURIComponent(d)}`:""}`,{data:t,loading:o,error:v,refetch:A}=fe(l,"POST",{page:g,limit:j},s);i.useEffect(()=>{if(t){const a=Array.isArray(t)?t:t.data||[];t.meta?g>=t.meta.totalPages&&z(!1):a.length<j&&z(!1);const r=a.map(n=>{var J;const N=((J=n.original_file_name.split(".").pop())==null?void 0:J.toLowerCase())||"";let x="application/octet-stream";return["jpg","jpeg","png","gif","webp"].includes(N)&&(x="image/"+N),N==="pdf"&&(x="application/pdf"),N==="svg"&&(x="image/svg+xml"),{id:n.unique_id,name:n.original_file_name,size:Ce(parseInt(n.size)),type:(n.file_type||N).toUpperCase(),mimeType:x,url:n.fullPath,created_date:n.created_date}});f(n=>g===1?r:[...n,...r])}v&&h.error("Failed to load documents")},[t,v,g,j]),i.useEffect(()=>{M(1),f([]),z(!0)},[d]);const F=i.useRef(null),E=i.useCallback(a=>{o||(F.current&&F.current.disconnect(),F.current=new IntersectionObserver(r=>{r[0].isIntersecting&&T&&M(n=>n+1)}),a&&F.current.observe(a))},[o,T]),C=()=>{M(1),f([]),z(!0),D(new Set),R(!1),A()},w=()=>{C()},V=a=>{y||(U(a),P(!0))},W=()=>{R(!y),D(new Set)},q=a=>{D(r=>{const n=new Set(r);return n.has(a)?n.delete(a):n.add(a),n})},ae=()=>{D(new Set(c.map(a=>a.id)))},le=()=>{D(new Set)},re=a=>{b(r=>(a==="all"?r.delete("fileType"):r.set("fileType",a),r))},ne=async()=>{if(p.size===0){h.error("No files selected");return}I(!0);let a=0,r=0;try{await Promise.all(Array.from(p).map(async n=>{var N;try{const x=await ee.post(`${G}/${se.softDelete}`,{uniqueId:n},{headers:{Authorization:`Bearer ${s}`}});((N=x==null?void 0:x.data)==null?void 0:N.status)===!0?a++:r++}catch{r++}})),a>0&&(h.success(`Moved ${a} file(s) to trash!`,{icon:"ðŸ—‘ï¸"}),C()),r>0&&h.error(`Failed to delete ${r} file(s)`)}catch{h.error("Bulk delete failed")}finally{I(!1)}},K=a=>{h.success(`Backup started for ${a.name}`,{icon:"â˜ï¸"})};return e.jsxs(L,{fixed:!0,className:"h-full overflow-hidden",children:[e.jsx(L.Header,{className:"relative border-b-0",children:e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(pe,{}),e.jsx(xe,{}),e.jsx(ge,{})]})}),e.jsxs(L.Body,{className:"flex-1 overflow-y-auto md:overflow-y-auto pt-0",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between space-y-2 sticky top-0 bg-secondary/95 backdrop-blur z-20 py-2 border-b",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground mb-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(je,{size:14})," Home"]}),e.jsx(ye,{size:14}),e.jsx("span",{className:"font-semibold text-foreground",children:"All Documents"})]}),e.jsxs("h2",{className:"text-2xl font-bold tracking-tight",children:["All Documents (",((X=t==null?void 0:t.pagination)==null?void 0:X.totalDocuments)||0,")",t!=null&&t.size?e.jsxs("span",{className:"text-lg font-normal text-muted-foreground ml-2",children:["(",t.size.gb," GB / ",t.size.mb," MB)"]}):""]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:y?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[p.size," selected"]}),e.jsx(u,{onClick:ae,variant:"outline",size:"sm",children:"Select All"}),e.jsx(u,{onClick:le,variant:"outline",size:"sm",children:"Deselect All"}),e.jsxs(u,{onClick:ne,variant:"destructive",size:"sm",disabled:p.size===0||O,children:[O?e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}):"Delete ",!O&&`(${p.size})`]}),e.jsx(u,{onClick:W,variant:"ghost",size:"sm",children:e.jsx(Z,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-[120px]",children:e.jsxs(we,{value:d,onValueChange:re,children:[e.jsx(Ne,{className:"h-9",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx(Se,{placeholder:"File Type"})]})}),e.jsxs(be,{children:[e.jsx(B,{value:"all",children:"All Files"}),e.jsx(B,{value:"pdf",children:"PDF"}),e.jsx(B,{value:"jpeg",children:"JPEG"}),e.jsx(B,{value:"png",children:"PNG"}),e.jsx(B,{value:"webp",children:"WEBP"}),e.jsx(B,{value:"docx",children:"DOCX"}),e.jsx(B,{value:"txt",children:"TXT"})]})]})}),e.jsx(u,{onClick:W,variant:"outline",size:"sm",children:"Select"}),e.jsx(u,{onClick:C,variant:"outline",size:"sm",children:"Refresh"}),e.jsxs(u,{onClick:()=>k(!0),size:"sm",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Upload"]})]})})]}),e.jsxs("div",{className:"flex-1 min-h-0",id:"scrollable-content",children:[c.length===0&&o?e.jsx("div",{className:"flex items-center justify-center h-full min-h-[400px]",children:e.jsx(_,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 pb-4",children:[c.map((a,r)=>c.length===r+1?e.jsx("div",{ref:E,children:e.jsx(Q,{file:a,onPreview:V,onBackup:K,onDeleteSuccess:C,selectionMode:y,isSelected:p.has(a.id),onSelect:q})},`${a.id}-${r}`):e.jsx(Q,{file:a,onPreview:V,onBackup:K,onDeleteSuccess:C,selectionMode:y,isSelected:p.has(a.id),onSelect:q},`${a.id}-${r}`)),c.length===0&&!o&&e.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center h-64 text-muted-foreground",children:[e.jsx("h1",{className:"font-thin text-3xl",children:"ðŸ¤” Oops!"}),e.jsxs("p",{className:"text-xl font-thin mt-2",children:["No documents found ",d!=="all"?`matching '${d}'`:"","."]})]})]}),o&&c.length>0&&e.jsx("div",{className:"flex justify-center py-4 w-full",children:e.jsx(_,{className:"h-6 w-6 animate-spin text-primary/60"})}),!T&&c.length>0&&e.jsx("div",{className:"py-4 text-center text-xs text-muted-foreground w-full",children:"End of list"})]}),e.jsx(ve,{open:m,onOpenChange:P,file:H}),e.jsx(Fe,{open:$,onOpenChange:k,onUploadComplete:w})]})]})}export{Pe as default};
