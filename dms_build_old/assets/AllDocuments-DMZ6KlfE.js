import{N as E,r as i,j as e,aw as R,ax as L,ay as K,az as q,aA as G,at as D,al as W,au as I,aq as y,aB as X,ao as H,ap as J,an as Q,T as O,ae as V,af as Y,U as Z,ar as ee,as as se,aC as T,av as te}from"./index-zFowLZvW.js";import{U as _}from"./upload-CWT8FQ28.js";const ae=E("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const le=E("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function re({open:o,onOpenChange:p,onUploadComplete:f}){const[d,h]=i.useState([]),[c,A]=i.useState(!1),[k,m]=i.useState(!1),[S,x]=i.useState(!1),N=i.useRef(null),C=localStorage.getItem("token")||"",B=s=>{s.preventDefault(),s.stopPropagation(),s.type==="dragenter"||s.type==="dragover"?x(!0):s.type==="dragleave"&&x(!1)},u=s=>{s.preventDefault(),s.stopPropagation(),x(!1),s.dataTransfer.files&&s.dataTransfer.files.length>0&&F(Array.from(s.dataTransfer.files))},v=s=>{s.target.files&&s.target.files.length>0&&F(Array.from(s.target.files))},F=s=>{const a=s.filter(l=>{const t=l.type.startsWith("image/"),r=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(l.type);return t||r});a.length!==s.length&&y.error("Some files were skipped. Only images and documents are allowed."),h(l=>[...l,...a])},z=s=>{h(a=>a.filter((l,t)=>t!==s))},w=async s=>{const a=await s.arrayBuffer(),l=await crypto.subtle.digest("SHA-256",a);return Array.from(new Uint8Array(l)).map(n=>n.toString(16).padStart(2,"0")).join("")},M=async()=>{if(d.length===0){y.error("Please select at least one file");return}A(!0),m(!1);try{let s=0,a=0;if(await Promise.all(d.map(async l=>{var t,r,n;try{const g=await w(l),j=new FormData;j.append("file",l),j.append("tags",l.name.substring(0,7));const $={"x-digest":g,token:"8Ufn6Jio6Obv9V7VXeP7gbzHSyRJcKluQOGorAD58qA1IQKYE0",folderPathId:"1",Authorization:`Bearer ${C}`},b=await X.post(`${H}/${J.uploadDocument}`,j,{headers:$});((t=b==null?void 0:b.data)==null?void 0:t.status)===!0||(n=(r=b==null?void 0:b.data)==null?void 0:r.data)!=null&&n.ReferenceNo?s++:a++}catch{a++}})),s>0&&a===0)m(!0),y.success(`Successfully uploaded ${s} file(s)!`);else if(s>0&&a>0)y.success(`Uploaded ${s} file(s). ${a} failed.`);else throw new Error("All uploads failed");setTimeout(()=>{h([]),p(!1),m(!1),f==null||f()},1500)}catch(s){y.error(s.message||"Failed to upload files")}finally{A(!1)}},U=s=>{if(s===0)return"0 Bytes";const a=1024,l=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(s)/Math.log(a));return Math.round(s/Math.pow(a,t)*100)/100+" "+l[t]},P=()=>{c||(h([]),m(!1),p(!1))};return e.jsx(R,{open:o,onOpenChange:P,children:e.jsxs(L,{className:"sm:max-w-[600px]",children:[e.jsxs(K,{children:[e.jsx(q,{className:"text-2xl",children:"Upload Documents"}),e.jsx(G,{children:"Upload single or multiple images and documents to your library"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:`relative border-2 border-dashed rounded-lg p-8 text-center transition-all ${S?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-primary/50"}`,onDragEnter:B,onDragLeave:B,onDragOver:B,onDrop:u,children:[e.jsx("input",{ref:N,type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:v,className:"hidden"}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"p-4 bg-primary/10 rounded-full",children:e.jsx(_,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"font-semibold text-lg",children:S?"Drop files here":"Choose files or drag & drop"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Images, PDF, Word documents supported"}),e.jsx(D,{type:"button",variant:"outline",onClick:()=>{var s;return(s=N.current)==null?void 0:s.click()},className:"mt-2",children:"Browse Files"})]})]}),d.length>0&&e.jsxs("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:[e.jsxs("h4",{className:"font-semibold text-sm text-muted-foreground",children:["Selected Files (",d.length,")"]}),d.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg hover:bg-muted transition-colors",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded",children:s.type.startsWith("image/")?e.jsx("img",{src:URL.createObjectURL(s),alt:s.name,className:"h-10 w-10 object-cover rounded"}):e.jsx(W,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:U(s.size)})]}),e.jsx(D,{type:"button",variant:"ghost",size:"sm",onClick:()=>z(a),disabled:c,children:e.jsx(le,{className:"h-4 w-4"})})]},a))]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(D,{type:"button",variant:"outline",onClick:P,disabled:c,children:"Cancel"}),e.jsxs(D,{type:"button",onClick:M,disabled:d.length===0||c||k,children:[c&&e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),k&&e.jsx(ae,{className:"mr-2 h-4 w-4"}),k?"Uploaded!":c?"Uploading...":"Upload"]})]})]})})}const ne=(o,p=2)=>{if(!+o)return"0 Bytes";const f=1024,d=p<0?0:p,h=["Bytes","KB","MB","GB","TB"],c=Math.floor(Math.log(o)/Math.log(f));return`${parseFloat((o/Math.pow(f,c)).toFixed(d))} ${h[c]}`};function ce(){const[o,p]=i.useState([]),[f,d]=i.useState(!1),[h,c]=i.useState(!1),[A,k]=i.useState(null),[m,S]=i.useState(1),[x]=i.useState(20),[N,C]=i.useState(!0),B=localStorage.getItem("token")||"",{data:u,loading:v,error:F,refetch:z}=Q(`${H}/document/view-all?page=${m}&limit=${x}`,"POST",{page:m,limit:x},B);i.useEffect(()=>{if(u){const t=Array.isArray(u)?u:u.data||[];u.meta?m>=u.meta.totalPages&&C(!1):t.length<x&&C(!1);const r=t.map(n=>{var $;const g=(($=n.original_file_name.split(".").pop())==null?void 0:$.toLowerCase())||"";let j="application/octet-stream";return["jpg","jpeg","png","gif","webp"].includes(g)&&(j="image/"+g),g==="pdf"&&(j="application/pdf"),g==="svg"&&(j="image/svg+xml"),{id:n.unique_id,name:n.original_file_name,size:ne(parseInt(n.size)),type:(n.file_type||g).toUpperCase(),mimeType:j,url:n.fullPath,created_date:n.created_date}});p(n=>m===1?r:[...n,...r])}F&&y.error("Failed to load documents")},[u,F,m,x]);const w=i.useRef(null),M=i.useCallback(t=>{v||(w.current&&w.current.disconnect(),w.current=new IntersectionObserver(r=>{r[0].isIntersecting&&N&&S(n=>n+1)}),t&&w.current.observe(t))},[v,N]),U=()=>{S(1),p([]),C(!0),z()},P=()=>{U()},s=t=>{k(t),d(!0)},a=t=>{y.promise(new Promise(r=>setTimeout(r,1e3)),{loading:"Deleting file...",success:e.jsxs("b",{children:[t.name," deleted!"]}),error:e.jsx("b",{children:"Could not delete."})})},l=t=>{y.success(`Backup started for ${t.name}`,{icon:"â˜ï¸"})};return e.jsxs(O,{children:[e.jsx(O.Header,{sticky:!0,children:e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(V,{}),e.jsx(Y,{}),e.jsx(Z,{})]})}),e.jsxs(O.Body,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between space-y-2",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground mb-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ee,{size:14})," Home"]}),e.jsx(se,{size:14}),e.jsx("span",{className:"font-semibold text-foreground",children:"All Documents"})]}),e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"All Documents"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{onClick:U,variant:"outline",size:"sm",children:"Refresh"}),e.jsxs(D,{onClick:()=>c(!0),children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"Upload"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto min-h-0",id:"scrollable-content",children:[o.length===0&&v?e.jsx("div",{className:"flex items-center justify-center h-full min-h-[400px]",children:e.jsx(I,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 pb-4",children:[o.map((t,r)=>o.length===r+1?e.jsx("div",{ref:M,children:e.jsx(T,{file:t,onPreview:s,onDelete:a,onBackup:l})},`${t.id}-${r}`):e.jsx(T,{file:t,onPreview:s,onDelete:a,onBackup:l},`${t.id}-${r}`)),o.length===0&&!v&&e.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center h-64 text-muted-foreground",children:[e.jsx("h1",{className:"font-thin text-3xl",children:"ðŸ¤”Oops!"}),e.jsx("p",{className:"text-2xl font-thin",children:"No documents found."})]})]}),v&&o.length>0&&e.jsx("div",{className:"flex justify-center py-4 w-full",children:e.jsx(I,{className:"h-6 w-6 animate-spin text-primary/60"})}),!N&&o.length>0&&e.jsx("div",{className:"py-4 text-center text-xs text-muted-foreground w-full",children:"End of list"})]}),e.jsx(te,{open:f,onOpenChange:d,file:A}),e.jsx(re,{open:h,onOpenChange:c,onUploadComplete:P})]})]})}export{ce as default};
