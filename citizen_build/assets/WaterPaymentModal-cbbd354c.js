import{j as e}from"./mui-8e804a04.js";import{u as Y,r as x,f as ue,a as pe}from"./router-87042356.js";import{M as fe}from"./index-4e794517.js";import"./RazorpayPaymentScreen-8e77bb07.js";import{W as H}from"./WaterApiList-be7bc924.js";import{i as ye}from"./success-39308b33.js";import{l as J,c as be,d as q,u as je,A as L,R as re,b as Ne,N as de}from"./index-b08c1470.js";import{a as Ie}from"./axios-97164839.js";import{a as me}from"./index.esm-2e3a7c1f.js";import{a as he}from"./index.esm-e8e486ac.js";import{U as xe}from"./UseRazorpay-62e4000a.js";import{h as ge}from"./useRazorPayForApp-cc3bb799.js";const ve="/assets/pending-daaf9508.png",we=m=>{var A,F,M,W,T,E,G,V,B;const{handlePayment:R}=xe(),C=Y(),[k,u]=x.useState(!1),[t,v]=x.useState(!1),[o,O]=x.useState(""),{notify:z}=x.useContext(J),{api_WaterGetDetailsById:h,header:b,api_rzpWaterOrderId:p,api_generatedreceipt:j}=H(),r=m==null?void 0:m.paymentData;console.log("props paymentData==>>",r);const f=n=>{if(!(n==null||n==""))return JSON.parse(n)},w=be({isInstallment:q().required("Require"),installment:q().when([],{is:()=>s.values.isInstallment=="yes",then:q().required("Select Installment")})}),s=je({enableReinitialize:!0,initialValues:{isInstallment:"no",installment:""},onSubmit:n=>{g(n)},validationSchema:w}),P=n=>{var I,U,$;const c=n.target.name,d=n.target.value;console.log("name",c,"vlue",d),d=="no"&&(console.log("Done.."),s.setFieldValue("installment","")),c=="installment"&&((I=f(d))==null?void 0:I.amount)==Number((U=o==null?void 0:o.calculation)==null?void 0:U.penalty)&&(($=o==null?void 0:o.calculation)==null?void 0:$.paidStatus)!=1&&(s.setFieldValue("installment",""),s.setFieldValue("isInstallment","no"))},_=()=>{m.closeModal()};x.useEffect(()=>{var n,c;((n=o==null?void 0:o.calculation)==null?void 0:n.paidStatus)==1&&((c=o==null?void 0:o.calculation)==null?void 0:c.chargeCatagoryId)==2&&s.setFieldValue("isInstallment","yes")},[o]);const l=()=>{var n;v(!0),console.log("before fetch property details in deactivation"),Ie.post(h,{applicationId:(n=r==null?void 0:r.connectionCharges)==null?void 0:n.applicationId},b).then(function(c){console.log("view water details by id...",c.data.data),O(c.data.data),v(!1)}).catch(function(c){console.log("==2 details by id error...",c),v(!1),z("Something Went Wrong","error")})};x.useEffect(()=>{l()},[r]);const y=async n=>{console.log("generateReceipt",n),console.log(n);let c={applicationId:n==null?void 0:n.applicationId,departmentId:n==null?void 0:n.departmentId,status:"",captured:"1",card_id:"",amount:n==null?void 0:n.amount,payment_method:"upi/netbanking",workflow_id:n==null?void 0:n.workflowId,user_id:n==null?void 0:n.userId,ulb_id:n==null?void 0:n.ulbId,payment_order_id:n==null?void 0:n.razorpay_order_id,payment_id:n==null?void 0:n.razorpay_payment_id,created_at:""};console.log("Receipt",n),L.post(j,c,b).then(d=>{var I;console.log("genereted receipt",d),d.data.status==!0?(console.log("Oder ID Generated ++++dddddddddddddddddddddddd+++++",d.data),C(`/waterConnReceipt/${(I=d==null?void 0:d.data)==null?void 0:I.data}`,{replace:!0})):toast.error(d.data.message,"error")}).catch(d=>{console.log("Error genrating order id",d),toast.error(d.message,"error")})},g=n=>{var I,U,$;let c;n.isInstallment=="yes"&&(c=((I=f(n==null?void 0:n.installment))==null?void 0:I.ids).split(","));const d={id:(U=r==null?void 0:r.connectionCharges)==null?void 0:U.applicationId,applycationType:($=r==null?void 0:r.connectionCharges)==null?void 0:$.type,isInstallment:n.isInstallment,penaltyIds:c};console.log("payment function hit..",d),u(!0),L.post(p,d,b).then(a=>{var Z,K,Q,X,D,ee,ne,te,se,oe,le,ie,ae,ce;console.log("Oder ID Generated",a),u(!1),window.ReactNativeWebView?ge({generatedOrder:(Z=a==null?void 0:a.data)==null?void 0:Z.data,payload:{applicationId:(Q=(K=a==null?void 0:a.data)==null?void 0:K.data)==null?void 0:Q.applicationId,departmentId:(D=(X=a==null?void 0:a.data)==null?void 0:X.data)==null?void 0:D.departmentId,status:"",captured:"1",card_id:"",amount:(ne=(ee=a==null?void 0:a.data)==null?void 0:ee.data)==null?void 0:ne.amount,payment_method:"upi/netbanking",workflow_id:(se=(te=a==null?void 0:a.data)==null?void 0:te.data)==null?void 0:se.workflowId,user_id:(le=(oe=a==null?void 0:a.data)==null?void 0:oe.data)==null?void 0:le.userId,ulb_id:(ae=(ie=a==null?void 0:a.data)==null?void 0:ie.data)==null?void 0:ae.ulbId,created_at:""},api:j,returnUrl:"/citizen/waterConnReceipt",isParam:!1}):R((ce=a==null?void 0:a.data)==null?void 0:ce.data,y)}).catch(a=>{u(!1),console.log("Error generating order id",a),z(a.message,"error")})},i=n=>n==NaN||n==null?0:n;let S=0,N;return s.values.isInstallment=="yes"&&(N=0),s.values.isInstallment=="no"&&(N=Number((A=o==null?void 0:o.calculation)==null?void 0:A.penalty)/10),e.jsx(e.Fragment,{children:e.jsx("form",{onSubmit:s.handleSubmit,onChange:P,children:e.jsxs("div",{className:"bg-white #789fde shadow-2xl border border-red-200 p-5 rounded-md",children:[e.jsx("p",{onClick:_,className:"float-right absolute right-6 top-6 hover:bg-gray-300 bg-gray-200 p-1 cursor-pointer",children:e.jsx(me,{})}),e.jsxs("div",{className:"border-b-2  pl-3 font-semibold border-red-400 flex",children:[e.jsx(he,{size:20,className:"mt-0.5 mr-1"}),"Regularization Payment"]}),e.jsx("p",{className:"text-center text-green-800 font-semibold",children:"Note: 10% rebate on penalty in case the whole penalty is paid"}),e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("img",{src:"https://img.freepik.com/free-vector/hand-holding-phone-with-credit-card-screen-man-making-purchase-shopping-paying-online-using-banking-app-flat-vector-illustration-transaction-e-commerce-concept_74855-26014.jpg?w=1380&t=st=1686898919~exp=1686899519~hmac=4b0ddb44860ec647fa33a1a0416ea0c1cc8167693a13fdba3f09058d099f0e76",alt:"My Image",width:200,height:100})}),e.jsxs("div",{className:"flex items-center px-10",children:[e.jsx("div",{className:"font-semibold text-lg text-gray-500",children:e.jsx("p",{children:"Application No.-"})}),e.jsx("p",{className:"font-semibold text-lg text-gray-500",children:(F=r==null?void 0:r.connectionCharges)==null?void 0:F.applicationNo})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-lg text-green-500",children:e.jsx("p",{children:"Total Amount ₹-"})}),e.jsxs("p",{className:"font-semibold text-lg text-green-500",children:[s.values.isInstallment==="yes"&&Number((M=o==null?void 0:o.calculation)==null?void 0:M.connectionFee)+Number(i((W=f(s.values.installment))==null?void 0:W.amount))-N,s.values.isInstallment==="no"&&Number((T=o==null?void 0:o.calculation)==null?void 0:T.connectionFee)+Number((E=o==null?void 0:o.calculation)==null?void 0:E.penalty)-N]})]}),e.jsxs("div",{className:"grid grid-cols-12 px-4 py-2 text-sm gap-y-2",children:[e.jsx("div",{className:"col-span-12 mt-2 text-gray-800",children:e.jsxs("div",{className:"grid grid-cols-12 text-base rounded",children:[e.jsxs("div",{className:"col-span-6 space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Payment For:"})," ",(G=o==null?void 0:o.calculation)==null?void 0:G.chargeCatagory]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Connection Fee:"})," ₹"," ",(V=o==null?void 0:o.calculation)==null?void 0:V.connectionFee]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Penalty:"})," ₹"," ",(B=o==null?void 0:o.calculation)==null?void 0:B.penalty]})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsxs("p",{className:"font-semibold",children:["Rebate: ₹ ",N]}),e.jsx("div",{className:"flex",children:e.jsxs("div",{children:[e.jsxs("label",{children:[e.jsx("span",{className:"font-semibold",children:"Installment Payment"}),e.jsx("input",{type:"radio",name:"isInstallment",value:"yes",checked:s.values.isInstallment==="yes",onChange:s.handleChange,onBlur:s.handleBlur}),"Yes",e.jsx("input",{type:"radio",name:"isInstallment",value:"no",checked:s.values.isInstallment==="no",onChange:s.handleChange,onBlur:s.handleBlur}),"No"]}),e.jsx("p",{className:"text-red-500 text-xs font-semibold",children:s.touched.isInstallment&&s.errors.isInstallment?s.errors.isInstallment:null})]})}),e.jsxs("div",{className:`${s.values.isInstallment==="no"?"opacity-50":""} flex gap-2 disabled:opacity-60`,children:[e.jsx("p",{className:"font-semibold",children:"Select Installment"}),e.jsxs("select",{onChange:s.handleChange,disabled:s.values.isInstallment==="no",value:s.values.installment,name:"installment",className:"disabled:opacity-60 disabled:border-0 border border-gray-800 rounded shadow text-sm h-6",children:[e.jsx("option",{value:"",children:"Select"}),o&&(o==null?void 0:o.penaltyInstallments.map((n,c)=>(S+=Number(n.balance_amount),e.jsx("option",{value:JSON.stringify({ids:n.ids,amount:S}),children:S},c))))]})]}),e.jsx("p",{className:"text-red-500 text-xs text-center font-semibold",children:s.touched.installment&&s.errors.installment?s.errors.installment:null})]})]})}),e.jsx("div",{className:"col-span-12 mt-2",children:e.jsx("div",{className:"text-center font-light rounded",children:e.jsx("p",{children:"Note: You can pay using Card / UPI / Netbanking / Wallet etc."})})}),e.jsx("div",{className:"col-span-12 mt-2",children:e.jsx("div",{className:"flex justify-center",children:k?e.jsx(re,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"30",visible:!0}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:m.closeModal,className:"mx-3 bg-red-600 hover:bg-red-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm rounded-sm shadow-xl",children:"Cancel"}),e.jsx("button",{type:"submit",className:"mx-3 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm rounded-sm shadow-xl",children:"Pay Now"})]})})})]})]})})})},_e=m=>{var f,w,s,P,_;const{handlePayment:R}=xe(),C=Y(),[k,u]=x.useState(!1);x.useState();const t=m==null?void 0:m.paymentData,{id:v}=ue(),{notify:o}=x.useContext(J),{api_rzpWaterOrderId:O,api_getTranNo:z,header:h,api_generatedreceipt:b}=H(),p=()=>{m.closeModal()},j=async l=>{console.log("generateReceipt",l),console.log(l);let y={applicationId:l==null?void 0:l.applicationId,departmentId:l==null?void 0:l.departmentId,status:"",captured:"1",card_id:"",amount:l==null?void 0:l.amount,payment_method:"upi/netbanking",workflow_id:l==null?void 0:l.workflowId,user_id:l==null?void 0:l.userId,ulb_id:l==null?void 0:l.ulbId,payment_order_id:l==null?void 0:l.razorpay_order_id,payment_id:l==null?void 0:l.razorpay_payment_id,created_at:""};console.log("Receipt",l),L.post(b,y,Ne()).then(g=>{console.log("genereted receipt",g),g.data.status==!0?(console.log("Oder ID Generated ++++dddddddddddddddddddddddd+++++",g.data),C(`/application-payment-history/${v}`,{replace:!0})):de.error(g.data.message,"error")}).catch(g=>{console.log("Error genrating order id",g),de.error(g.message,"error")})},r=()=>{var y,g;u(!0);const l={id:(y=t==null?void 0:t.connectionCharges)==null?void 0:y.applicationId,applycationType:(g=t==null?void 0:t.connectionCharges)==null?void 0:g.type};console.log("Payment Button Clicked..",l),L.post(O,l,h).then(i=>{var S,N,A,F,M,W,T,E,G,V,B,n,c,d;console.log("Oder ID Generated",i),u(!1),window.ReactNativeWebView?ge({generatedOrder:(S=i==null?void 0:i.data)==null?void 0:S.data,payload:{applicationId:(A=(N=i==null?void 0:i.data)==null?void 0:N.data)==null?void 0:A.applicationId,departmentId:(M=(F=i==null?void 0:i.data)==null?void 0:F.data)==null?void 0:M.departmentId,status:"",captured:"1",card_id:"",amount:(T=(W=i==null?void 0:i.data)==null?void 0:W.data)==null?void 0:T.amount,payment_method:"upi/netbanking",workflow_id:(G=(E=i==null?void 0:i.data)==null?void 0:E.data)==null?void 0:G.workflowId,user_id:(B=(V=i==null?void 0:i.data)==null?void 0:V.data)==null?void 0:B.userId,ulb_id:(c=(n=i==null?void 0:i.data)==null?void 0:n.data)==null?void 0:c.ulbId,created_at:""},api:b,returnUrl:"/citizen/waterConnReceipt",isParam:!1}):R((d=i==null?void 0:i.data)==null?void 0:d.data,j)}).catch(i=>{u(!1),console.log("Error genrating order id",i),o(i.message,"error")})};return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("p",{onClick:p,className:"float-right absolute right-12 top-12 hover:bg-gray-300 bg-gray-200 p-1 cursor-pointer",children:[" ",e.jsx(me,{})," "]}),e.jsxs("div",{className:"bg-white shadow-2xl border border-blue-200 md:p-5 md:m-5 rounded-md",children:[e.jsxs("div",{className:" border-b-2 py-1 pl-3 font-semibold border-red-400 flex",children:[e.jsx(he,{size:20,className:"mt-0.5 mr-1"}),"Make Payment"," "]}),e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("img",{src:"https://img.freepik.com/free-vector/hand-holding-phone-with-credit-card-screen-man-making-purchase-shopping-paying-online-using-banking-app-flat-vector-illustration-transaction-e-commerce-concept_74855-26014.jpg?w=1380&t=st=1686898919~exp=1686899519~hmac=4b0ddb44860ec647fa33a1a0416ea0c1cc8167693a13fdba3f09058d099f0e76",alt:"My Image",width:200,height:100})}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-2xl text-gray-500",children:e.jsx("p",{children:"Application No:-"})}),e.jsx("p",{className:"font-semibold text-2xl text-gray-500",children:(f=t==null?void 0:t.connectionCharges)==null?void 0:f.applicationNo})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-2xl text-green-500",children:e.jsx("p",{children:"Amount-Rs:"})}),e.jsx("p",{className:"font-semibold text-2xl text-green-500",children:((w=t==null?void 0:t.connectionCharges)==null?void 0:w.amount)||"N/A"})]}),e.jsx("h1",{className:"text-center font-semibold",children:"Amount Breakup"}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"col-span-3 ",children:[e.jsxs("h1",{children:["Payment For : ",(s=t==null?void 0:t.connectionCharges)==null?void 0:s.charge_category]}),e.jsxs("h1",{children:["Penalty : ₹ ",(P=t==null?void 0:t.connectionCharges)==null?void 0:P.penalty]}),e.jsxs("h1",{children:["Connection Fee : ₹ ",(_=t==null?void 0:t.connectionCharges)==null?void 0:_.conn_fee]})]})}),e.jsx("div",{className:"md:col-span-12 col-span-12 md:mt-5 mt-2",children:e.jsx("div",{className:"text-center font-extralight px-2 rounded",children:e.jsx("p",{children:"Note : You can pay using Card / UPI / Netbanking / Wallet etc."})})}),e.jsx("div",{className:"col-span-12 md:mt-5 mt-2 max-sm:mb-2",children:e.jsx("div",{className:"flex justify-center",children:k?e.jsx(re,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"30",visible:!0}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:p,className:"mx-3 bg-red-600 hover:bg-red-700 transition duration-200 hover:scale-105 font-normal text-white px-6 py-2 text-sm rounded-sm shadow-xl",children:"Cancel"}),e.jsx("button",{onClick:r,className:"mx-3 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-5 py-2 text-sm  rounded-sm shadow-xl",children:"Pay Now"})]})})})]})]})})},Ce={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",background:"transparent",border:"none"}};function Ge(m){var r,f,w;const[R,C]=pe.useState(!1),[k,u]=x.useState(!1),[t,v]=x.useState(),[o,O]=x.useState(),z=Y();x.useContext(J),H();const h=m.paymentData;console.log("paymentData==>",h),x.useEffect(()=>{C(!0)},[]);function b(){}function p(){C(!1),u(!1),v(!1),O(!1),m==null||m.openPaymentModal(!1)}const j=s=>{var _,l,y;s!=null&&s.status&&u(!0),console.log("fetchTransactionDetails",s);const P={orderId:(_=s==null?void 0:s.data)==null?void 0:_.razorpay_order_id,paymentId:(l=s==null?void 0:s.data)==null?void 0:l.razorpay_payment_id,signature:(y=s==null?void 0:s.data)==null?void 0:y.razorpay_signature};console.log("payload",P)};return e.jsx("div",{className:"",children:e.jsxs(fe,{isOpen:R,onAfterOpen:b,onRequestClose:p,style:Ce,contentLabel:"Example Modal",children:[k&&e.jsxs("div",{className:`${t?"bg-green-200":"bg-yellow-50"} shadow-2xl border border-sky-200 md:p-5 md:m-5 rounded-md`,children:[e.jsxs("div",{className:"flex justify-center",children:[t&&e.jsx("img",{src:ye,className:"h-16",alt:"Payment Success",srcset:""}),!t&&e.jsx("img",{src:ve,className:"h-12",alt:"Payment Pending",srcset:""})]}),e.jsxs("div",{className:"py-1 pl-3 font-semibold text-center text-2xl text-gray-800",children:[t?"Payment Completed Successfully":"Payment Under Processing"," "]}),(t==null?void 0:t.transectionNo)&&e.jsxs("p",{className:"text-center",children:[e.jsx("span",{className:"text-base",children:" Payment Transaction No"})," ",e.jsx("span",{className:"font-bold text-blue-700 text-xl",children:t==null?void 0:t.transectionNo})]}),!(t!=null&&t.transectionNo)&&e.jsxs("p",{className:"text-center font-semibold",children:[e.jsx("span",{className:"text-base",children:" Payment Status"})," ",e.jsx("span",{className:" text-blue-500 text-base",children:"Pending"})]}),e.jsx("p",{className:"border-b border-gray-300 mx-10 py-1"}),e.jsxs("div",{className:"grid grid-cols-12 px-8 py-3 leading-8 space-x-8 text-sm",children:[e.jsx("div",{className:"md:col-span-6 col-span-12",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"col-span-6 font-semibold",children:[e.jsx("p",{children:"Application No"}),e.jsx("p",{children:"Transaction Type"})]}),e.jsxs("div",{className:"col-span-6 ml-3",children:[e.jsx("p",{children:((r=h==null?void 0:h.connectionCharges)==null?void 0:r.applicationNo)||"NA"}),e.jsx("p",{children:((f=h==null?void 0:h.connectionCharges)==null?void 0:f.charge_category)||"NA"})]})]})}),e.jsx("div",{className:"md:col-span-6 col-span-12",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"col-span-6 font-semibold",children:[e.jsx("p",{children:"Amount"}),e.jsx("p",{children:"Payment Date"})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsx("p",{children:(t==null?void 0:t.amount)||((w=h==null?void 0:h.connectionCharges)==null?void 0:w.amount)}),e.jsx("p",{children:(t==null?void 0:t.transectionDate)||"Pending"})]})]})}),e.jsx("div",{className:"col-span-12 md:mt-4 mt-10",children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx("button",{onClick:p,className:"mx-2 bg-sky-600 hover:bg-sky-700 transition duration-200 hover:scale-105 font-normal text-white px-6 py-1 text-sm rounded-sm shadow-xl",children:"Dashboard"}),t&&e.jsx("button",{onClick:()=>z(`/waterConnReceipt/${t==null?void 0:t.transectionNo}`),className:"mx-2 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm  rounded-sm shadow-xl",children:"View Receipt"}),!t&&e.jsx("button",{onClick:()=>j(),className:"mx-2 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm  rounded-sm shadow-xl",children:"Check Status"})]})})]})]}),!k&&((m==null?void 0:m.category)=="Regulaization"?e.jsx(we,{closeModal:p,fetchTransactionDetails:j,paymentData:h}):e.jsx(_e,{closeModal:p,fetchTransactionDetails:j,paymentData:h}))]})})}export{Ge as W};
