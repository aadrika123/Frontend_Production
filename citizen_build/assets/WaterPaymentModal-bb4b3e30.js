import{j as e}from"./mui-8e804a04.js";import{u as z,r as x,a as X}from"./router-87042356.js";import{M as D}from"./index-4e794517.js";import{R as ee}from"./RazorpayPaymentScreen-69fbb994.js";import{W}from"./WaterApiList-45f349ed.js";import{i as se}from"./success-39308b33.js";import{l as T,c as ne,d as F,u as te,A as M,R as Z,b as oe,N as J}from"./index-97a1779e.js";import{a as le}from"./axios-97164839.js";import{a as K}from"./index.esm-2e3a7c1f.js";import{a as Q}from"./index.esm-e8e486ac.js";import{U as ie}from"./UseRazorpay-468600ec.js";const re="/assets/pending-daaf9508.png",ae=i=>{var E,G,B,V,L,U,$,q,Y,H;const k=z(),[y,f]=x.useState(!1),[N,s]=x.useState(!1),[n,A]=x.useState(""),{notify:j}=x.useContext(T),{api_WaterGetDetailsById:S,header:d,api_rzpWaterOrderId:C}=W(),r=i==null?void 0:i.paymentData;console.log("props paymentData==>>",r);const g=l=>{if(!(l==null||l==""))return JSON.parse(l)},v=ne({isInstallment:F().required("Require"),installment:F().when([],{is:()=>o.values.isInstallment=="yes",then:F().required("Select Installment")})}),o=te({enableReinitialize:!0,initialValues:{isInstallment:"no",installment:""},onSubmit:l=>{u(l)},validationSchema:v}),I=l=>{var _,R,O;const h=l.target.name,P=l.target.value;console.log("name",h,"vlue",P),P=="no"&&(console.log("Done.."),o.setFieldValue("installment","")),h=="installment"&&((_=g(P))==null?void 0:_.amount)==Number((R=n==null?void 0:n.calculation)==null?void 0:R.penalty)&&((O=n==null?void 0:n.calculation)==null?void 0:O.paidStatus)!=1&&(o.setFieldValue("installment",""),o.setFieldValue("isInstallment","no"))},a=()=>{i.closeModal()};x.useEffect(()=>{var l,h;((l=n==null?void 0:n.calculation)==null?void 0:l.paidStatus)==1&&((h=n==null?void 0:n.calculation)==null?void 0:h.chargeCatagoryId)==2&&o.setFieldValue("isInstallment","yes")},[n]);const w=()=>{var l;s(!0),console.log("before fetch property details in deactivation"),le.post(S,{applicationId:(l=r==null?void 0:r.connectionCharges)==null?void 0:l.applicationId},d).then(function(h){console.log("view water details by id...",h.data.data),A(h.data.data),s(!1)}).catch(function(h){console.log("==2 details by id error...",h),s(!1),j("Something Went Wrong","error")})};x.useEffect(()=>{w()},[r]);const t=l=>{console.log("Payment Status =>",l),(l==null?void 0:l.status)==!0?(j("Regulization Payment successfully","success"),window.location.reload(),i.fetchTransactionDetails(l),i.success(10)):j("Payment Failed","error")},u=l=>{var _,R,O;let h;l.isInstallment=="yes"&&(h=((_=g(l==null?void 0:l.installment))==null?void 0:_.ids).split(","));const P={id:(R=r==null?void 0:r.connectionCharges)==null?void 0:R.applicationId,applycationType:(O=r==null?void 0:r.connectionCharges)==null?void 0:O.type,isInstallment:l.isInstallment,penaltyIds:h};console.log("payment function hit..",P),f(!0),M.post(C,P,d).then(p=>{console.log("Oder ID Generated",p),f(!1),p.data.status==!0?(console.log("done==>>",p),ee(p.data.data,t),i.closeModal(!0),k("/water-dashboard")):j(p.data.message,"error")}).catch(p=>{f(!1),console.log("Error generating order id",p),j(p.message,"error")})},c=l=>l==NaN||l==null?0:l;let m=0,b;return o.values.isInstallment=="yes"&&(b=0),o.values.isInstallment=="no"&&(b=Number((E=n==null?void 0:n.calculation)==null?void 0:E.penalty)/10),e.jsx(e.Fragment,{children:e.jsx("form",{onSubmit:o.handleSubmit,onChange:I,children:e.jsxs("div",{className:"bg-white #789fde shadow-2xl border border-red-200 p-5 rounded-md",children:[e.jsx("p",{onClick:a,className:"float-right absolute right-6 top-6 hover:bg-gray-300 bg-gray-200 p-1 cursor-pointer",children:e.jsx(K,{})}),e.jsxs("div",{className:"border-b-2  pl-3 font-semibold border-red-400 flex",children:[e.jsx(Q,{size:20,className:"mt-0.5 mr-1"}),"Regularization Payment"]}),e.jsx("p",{className:"text-center text-green-800 font-semibold",children:"Note: 10% rebate on penalty in case the whole penalty is paid"}),e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("img",{src:"https://img.freepik.com/free-vector/hand-holding-phone-with-credit-card-screen-man-making-purchase-shopping-paying-online-using-banking-app-flat-vector-illustration-transaction-e-commerce-concept_74855-26014.jpg?w=1380&t=st=1686898919~exp=1686899519~hmac=4b0ddb44860ec647fa33a1a0416ea0c1cc8167693a13fdba3f09058d099f0e76",alt:"My Image",width:200,height:100})}),e.jsxs("div",{className:"flex items-center px-10",children:[e.jsx("div",{className:"font-semibold text-lg text-gray-500",children:e.jsx("p",{children:"Application No.-"})}),e.jsx("p",{className:"font-semibold text-lg text-gray-500",children:(G=r==null?void 0:r.connectionCharges)==null?void 0:G.applicationNo})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-lg text-green-500",children:e.jsx("p",{children:"Total Amount ₹-"})}),e.jsxs("p",{className:"font-semibold text-lg text-green-500",children:[o.values.isInstallment==="yes"&&Number((B=n==null?void 0:n.calculation)==null?void 0:B.connectionFee)+Number(c((V=g(o.values.installment))==null?void 0:V.amount))-b,o.values.isInstallment==="no"&&Number((L=n==null?void 0:n.calculation)==null?void 0:L.connectionFee)+Number((U=n==null?void 0:n.calculation)==null?void 0:U.penalty)-b]})]}),e.jsxs("div",{className:"grid grid-cols-12 px-4 py-2 text-sm gap-y-2",children:[e.jsx("div",{className:"col-span-12 mt-2 text-gray-800",children:e.jsxs("div",{className:"grid grid-cols-12 text-base rounded",children:[e.jsxs("div",{className:"col-span-6 space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Payment For:"})," ",($=n==null?void 0:n.calculation)==null?void 0:$.chargeCatagory]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Connection Fee:"})," ₹"," ",(q=n==null?void 0:n.calculation)==null?void 0:q.connectionFee]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Penalty:"})," ₹"," ",(Y=n==null?void 0:n.calculation)==null?void 0:Y.penalty]})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsxs("p",{className:"font-semibold",children:["Rebate: ₹ ",b]}),e.jsx("div",{className:"flex",children:e.jsxs("div",{children:[e.jsxs("label",{children:[e.jsx("span",{className:"font-semibold",children:"Installment Payment"}),e.jsx("input",{type:"radio",name:"isInstallment",value:"yes",checked:o.values.isInstallment==="yes",onChange:o.handleChange,onBlur:o.handleBlur}),"Yes",e.jsx("input",{type:"radio",name:"isInstallment",value:"no",checked:o.values.isInstallment==="no",onChange:o.handleChange,onBlur:o.handleBlur,disabled:((H=n==null?void 0:n.calculation)==null?void 0:H.paidStatus)===1}),"No"]}),e.jsx("p",{className:"text-red-500 text-xs font-semibold",children:o.touched.isInstallment&&o.errors.isInstallment?o.errors.isInstallment:null})]})}),e.jsxs("div",{className:`${o.values.isInstallment==="no"?"opacity-50":""} flex gap-2 disabled:opacity-60`,children:[e.jsx("p",{className:"font-semibold",children:"Select Installment"}),e.jsxs("select",{onChange:o.handleChange,disabled:o.values.isInstallment==="no",value:o.values.installment,name:"installment",className:"disabled:opacity-60 disabled:border-0 border border-gray-800 rounded shadow text-sm h-6",children:[e.jsx("option",{value:"",children:"Select"}),n&&(n==null?void 0:n.penaltyInstallments.map((l,h)=>(m+=Number(l.balance_amount),e.jsx("option",{value:JSON.stringify({ids:l.ids,amount:m}),children:m},h))))]})]}),e.jsx("p",{className:"text-red-500 text-xs text-center font-semibold",children:o.touched.installment&&o.errors.installment?o.errors.installment:null})]})]})}),e.jsx("div",{className:"col-span-12 mt-2",children:e.jsx("div",{className:"text-center font-light rounded",children:e.jsx("p",{children:"Note: You can pay using Card / UPI / Netbanking / Wallet etc."})})}),e.jsx("div",{className:"col-span-12 mt-2",children:e.jsx("div",{className:"flex justify-center",children:y?e.jsx(Z,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"30",visible:!0}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i.closeModal,className:"mx-3 bg-red-600 hover:bg-red-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm rounded-sm shadow-xl",children:"Cancel"}),e.jsx("button",{type:"submit",className:"mx-3 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm rounded-sm shadow-xl",children:"Pay Now"})]})})})]})]})})})},ce=i=>{var v,o,I,a,w;const{handlePayment:k}=ie(),y=z(),[f,N]=x.useState(!1);x.useState();const s=i==null?void 0:i.paymentData,{notify:n}=x.useContext(T),{api_rzpWaterOrderId:A,api_getTranNo:j,header:S,api_generatedreceipt:d}=W(),C=()=>{i.closeModal()},r=async t=>{console.log("generateReceipt",t),console.log(t);let u={applicationId:t==null?void 0:t.applicationId,departmentId:t==null?void 0:t.departmentId,status:"",captured:"1",card_id:"",amount:t==null?void 0:t.amount,payment_method:"upi/netbanking",workflow_id:t==null?void 0:t.workflowId,user_id:t==null?void 0:t.userId,ulb_id:t==null?void 0:t.ulbId,payment_order_id:t==null?void 0:t.razorpay_order_id,payment_id:t==null?void 0:t.razorpay_payment_id,created_at:""};console.log("Receipt",t),M.post(d,u,oe()).then(c=>{var m;console.log("genereted receipt",c),c.data.status==!0?(console.log("Oder ID Generated ++++dddddddddddddddddddddddd+++++",c.data),y(`/waterConnReceipt/${(m=c==null?void 0:c.data)==null?void 0:m.data}`,{replace:!0})):J.error(c.data.message,"error")}).catch(c=>{console.log("Error genrating order id",c),J.error(c.message,"error")})},g=()=>{var u,c;N(!0);const t={id:(u=s==null?void 0:s.connectionCharges)==null?void 0:u.applicationId,applycationType:(c=s==null?void 0:s.connectionCharges)==null?void 0:c.type};console.log("Payment Button Clicked..",t),M.post(A,t,S).then(m=>{var b;console.log("Oder ID Generated",m),N(!1),m.data.status==!0?(k((b=m==null?void 0:m.data)==null?void 0:b.data,r),i.closeModal(),y("/water-dashboard")):n(m.data.message,"error")}).catch(m=>{N(!1),console.log("Error genrating order id",m),n(m.message,"error")})};return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("p",{onClick:C,className:"float-right absolute right-12 top-12 hover:bg-gray-300 bg-gray-200 p-1 cursor-pointer",children:[" ",e.jsx(K,{})," "]}),e.jsxs("div",{className:"bg-white shadow-2xl border border-blue-200 md:p-5 md:m-5 rounded-md",children:[e.jsxs("div",{className:" border-b-2 py-1 pl-3 font-semibold border-red-400 flex",children:[e.jsx(Q,{size:20,className:"mt-0.5 mr-1"}),"Make Payment"," "]}),e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("img",{src:"https://img.freepik.com/free-vector/hand-holding-phone-with-credit-card-screen-man-making-purchase-shopping-paying-online-using-banking-app-flat-vector-illustration-transaction-e-commerce-concept_74855-26014.jpg?w=1380&t=st=1686898919~exp=1686899519~hmac=4b0ddb44860ec647fa33a1a0416ea0c1cc8167693a13fdba3f09058d099f0e76",alt:"My Image",width:200,height:100})}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-2xl text-gray-500",children:e.jsx("p",{children:"Application No:-"})}),e.jsx("p",{className:"font-semibold text-2xl text-gray-500",children:(v=s==null?void 0:s.connectionCharges)==null?void 0:v.applicationNo})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-2xl text-green-500",children:e.jsx("p",{children:"Amount-Rs:"})}),e.jsx("p",{className:"font-semibold text-2xl text-green-500",children:((o=s==null?void 0:s.connectionCharges)==null?void 0:o.amount)||"N/A"})]}),e.jsx("h1",{className:"text-center font-semibold",children:"Amount Breakup"}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"col-span-3 ",children:[e.jsxs("h1",{children:["Payment For : ",(I=s==null?void 0:s.connectionCharges)==null?void 0:I.charge_category]}),e.jsxs("h1",{children:["Penalty : ₹ ",(a=s==null?void 0:s.connectionCharges)==null?void 0:a.penalty]}),e.jsxs("h1",{children:["Connection Fee : ₹ ",(w=s==null?void 0:s.connectionCharges)==null?void 0:w.conn_fee]})]})}),e.jsx("div",{className:"md:col-span-12 col-span-12 md:mt-5 mt-2",children:e.jsx("div",{className:"text-center font-extralight px-2 rounded",children:e.jsx("p",{children:"Note : You can pay using Card / UPI / Netbanking / Wallet etc."})})}),e.jsx("div",{className:"col-span-12 md:mt-5 mt-2 max-sm:mb-2",children:e.jsx("div",{className:"flex justify-center",children:f?e.jsx(Z,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"30",visible:!0}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:C,className:"mx-3 bg-red-600 hover:bg-red-700 transition duration-200 hover:scale-105 font-normal text-white px-6 py-2 text-sm rounded-sm shadow-xl",children:"Cancel"}),e.jsx("button",{onClick:g,className:"mx-3 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-5 py-2 text-sm  rounded-sm shadow-xl",children:"Pay Now"})]})})})]})]})})},de={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",background:"transparent",border:"none"}};function ve(i){var v,o,I;const[k,y]=X.useState(!1),[f,N]=x.useState(!1),[s,n]=x.useState(),[A,j]=x.useState(),S=z();x.useContext(T),W();const d=i.paymentData;console.log("paymentData==>",d),x.useEffect(()=>{y(!0)},[]);function C(){}function r(){y(!1),N(!1),n(!1),j(!1),i==null||i.openPaymentModal(!1)}const g=a=>{var t,u,c;a!=null&&a.status&&N(!0),console.log("fetchTransactionDetails",a);const w={orderId:(t=a==null?void 0:a.data)==null?void 0:t.razorpay_order_id,paymentId:(u=a==null?void 0:a.data)==null?void 0:u.razorpay_payment_id,signature:(c=a==null?void 0:a.data)==null?void 0:c.razorpay_signature};console.log("payload",w)};return e.jsx("div",{className:"",children:e.jsxs(D,{isOpen:k,onAfterOpen:C,onRequestClose:r,style:de,contentLabel:"Example Modal",children:[f&&e.jsxs("div",{className:`${s?"bg-green-200":"bg-yellow-50"} shadow-2xl border border-sky-200 md:p-5 md:m-5 rounded-md`,children:[e.jsxs("div",{className:"flex justify-center",children:[s&&e.jsx("img",{src:se,className:"h-16",alt:"Payment Success",srcset:""}),!s&&e.jsx("img",{src:re,className:"h-12",alt:"Payment Pending",srcset:""})]}),e.jsxs("div",{className:"py-1 pl-3 font-semibold text-center text-2xl text-gray-800",children:[s?"Payment Completed Successfully":"Payment Under Processing"," "]}),(s==null?void 0:s.transectionNo)&&e.jsxs("p",{className:"text-center",children:[e.jsx("span",{className:"text-base",children:" Payment Transaction No"})," ",e.jsx("span",{className:"font-bold text-blue-700 text-xl",children:s==null?void 0:s.transectionNo})]}),!(s!=null&&s.transectionNo)&&e.jsxs("p",{className:"text-center font-semibold",children:[e.jsx("span",{className:"text-base",children:" Payment Status"})," ",e.jsx("span",{className:" text-blue-500 text-base",children:"Pending"})]}),e.jsx("p",{className:"border-b border-gray-300 mx-10 py-1"}),e.jsxs("div",{className:"grid grid-cols-12 px-8 py-3 leading-8 space-x-8 text-sm",children:[e.jsx("div",{className:"md:col-span-6 col-span-12",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"col-span-6 font-semibold",children:[e.jsx("p",{children:"Application No"}),e.jsx("p",{children:"Transaction Type"})]}),e.jsxs("div",{className:"col-span-6 ml-3",children:[e.jsx("p",{children:((v=d==null?void 0:d.connectionCharges)==null?void 0:v.applicationNo)||"NA"}),e.jsx("p",{children:((o=d==null?void 0:d.connectionCharges)==null?void 0:o.charge_category)||"NA"})]})]})}),e.jsx("div",{className:"md:col-span-6 col-span-12",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"col-span-6 font-semibold",children:[e.jsx("p",{children:"Amount"}),e.jsx("p",{children:"Payment Date"})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsx("p",{children:(s==null?void 0:s.amount)||((I=d==null?void 0:d.connectionCharges)==null?void 0:I.amount)}),e.jsx("p",{children:(s==null?void 0:s.transectionDate)||"Pending"})]})]})}),e.jsx("div",{className:"col-span-12 md:mt-4 mt-10",children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx("button",{onClick:r,className:"mx-2 bg-sky-600 hover:bg-sky-700 transition duration-200 hover:scale-105 font-normal text-white px-6 py-1 text-sm rounded-sm shadow-xl",children:"Dashboard"}),s&&e.jsx("button",{onClick:()=>S(`/waterConnReceipt/${s==null?void 0:s.transectionNo}`),className:"mx-2 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm  rounded-sm shadow-xl",children:"View Receipt"}),!s&&e.jsx("button",{onClick:()=>g(),className:"mx-2 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm  rounded-sm shadow-xl",children:"Check Status"})]})})]})]}),!f&&((i==null?void 0:i.category)=="Regulaization"?e.jsx(ae,{closeModal:r,fetchTransactionDetails:g,paymentData:d}):e.jsx(ce,{closeModal:r,fetchTransactionDetails:g,paymentData:d}))]})})}export{ve as W};
