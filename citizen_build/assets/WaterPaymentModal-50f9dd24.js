import{j as e}from"./mui-376c770d.js";import{r as d,a as K,u as Q}from"./router-87042356.js";import{M as X}from"./index-d22e5223.js";import{R as U}from"./RazorpayPaymentScreen-4b730f01.js";import{W as M}from"./WaterApiList-2ea33484.js";import{i as D}from"./success-39308b33.js";import{k as z,c as ee,d as F,u as se,A as Y,R as J}from"./index-9878fe9f.js";import{a as ne}from"./axios-97164839.js";import{a as H}from"./index.esm-2e3a7c1f.js";import{a as Z}from"./index.esm-e8e486ac.js";const te="/assets/pending-daaf9508.png",le=l=>{var A,T,W,E,G,B,V,L,q,$;const[w,x]=d.useState(!1),[_,u]=d.useState(!1),[s,p]=d.useState(""),{notify:f}=d.useContext(z),{api_WaterGetDetailsById:R,header:I,api_rzpWaterOrderId:i}=M(),o=l==null?void 0:l.paymentData;console.log("props paymentData==>>",o);const h=t=>{if(!(t==null||t==""))return JSON.parse(t)},j=ee({isInstallment:F().required("Require"),installment:F().when([],{is:()=>n.values.isInstallment=="yes",then:F().required("Select Installment")})}),n=se({enableReinitialize:!0,initialValues:{isInstallment:"no",installment:""},onSubmit:t=>{N(t)},validationSchema:j}),y=t=>{var S,k,O;const r=t.target.name,C=t.target.value;console.log("name",r,"vlue",C),C=="no"&&(console.log("Done.."),n.setFieldValue("installment","")),r=="installment"&&((S=h(C))==null?void 0:S.amount)==Number((k=s==null?void 0:s.calculation)==null?void 0:k.penalty)&&((O=s==null?void 0:s.calculation)==null?void 0:O.paidStatus)!=1&&(n.setFieldValue("installment",""),n.setFieldValue("isInstallment","no"))},b=()=>{l.closeModal()};d.useEffect(()=>{var t,r;((t=s==null?void 0:s.calculation)==null?void 0:t.paidStatus)==1&&((r=s==null?void 0:s.calculation)==null?void 0:r.chargeCatagoryId)==2&&n.setFieldValue("isInstallment","yes")},[s]);const a=()=>{var t;u(!0),console.log("before fetch property details in deactivation"),ne.post(R,{applicationId:(t=o==null?void 0:o.connectionCharges)==null?void 0:t.applicationId},I).then(function(r){console.log("view water details by id...",r.data.data),p(r.data.data),u(!1)}).catch(function(r){console.log("==2 details by id error...",r),u(!1),f("Something Went Wrong","error")})};d.useEffect(()=>{a()},[o]);const m=t=>{console.log("Payment Status =>",t),(t==null?void 0:t.status)==!0?(l.fetchTransactionDetails(t),l.success(10),f("Payment Successful","success")):f("Payment Failed","error")},N=t=>{var S,k,O;let r;t.isInstallment=="yes"&&(r=((S=h(t==null?void 0:t.installment))==null?void 0:S.ids).split(","));const C={id:(k=o==null?void 0:o.connectionCharges)==null?void 0:k.applicationId,applycationType:(O=o==null?void 0:o.connectionCharges)==null?void 0:O.type,isInstallment:t.isInstallment,penaltyIds:r};console.log("payment function hit..",C),x(!0),Y.post(i,C,I).then(g=>{console.log("Oder ID Generated",g),x(!1),g.data.status==!0?(console.log("done==>>",g),U(g.data.data,m)):f(g.data.message,"error")}).catch(g=>{x(!1),console.log("Error generating order id",g),f(g.message,"error")})},v=t=>t==NaN||t==null?0:t;let c=0,P;return n.values.isInstallment=="yes"&&(P=0),n.values.isInstallment=="no"&&(P=Number((A=s==null?void 0:s.calculation)==null?void 0:A.penalty)/10),e.jsx(e.Fragment,{children:e.jsx("form",{onSubmit:n.handleSubmit,onChange:y,children:e.jsxs("div",{className:"bg-white #789fde shadow-2xl border border-red-200 p-5 rounded-md",children:[e.jsx("p",{onClick:b,className:"float-right absolute right-6 top-6 hover:bg-gray-300 bg-gray-200 p-1 cursor-pointer",children:e.jsx(H,{})}),e.jsxs("div",{className:"border-b-2  pl-3 font-semibold border-red-400 flex",children:[e.jsx(Z,{size:20,className:"mt-0.5 mr-1"}),"Regularization Payment"]}),e.jsx("p",{className:"text-center text-green-800 font-semibold",children:"Note: 10% rebate on penalty in case the whole penalty is paid"}),e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("img",{src:"https://img.freepik.com/free-vector/hand-holding-phone-with-credit-card-screen-man-making-purchase-shopping-paying-online-using-banking-app-flat-vector-illustration-transaction-e-commerce-concept_74855-26014.jpg?w=1380&t=st=1686898919~exp=1686899519~hmac=4b0ddb44860ec647fa33a1a0416ea0c1cc8167693a13fdba3f09058d099f0e76",alt:"My Image",width:200,height:100})}),e.jsxs("div",{className:"flex items-center px-10",children:[e.jsx("div",{className:"font-semibold text-lg text-gray-500",children:e.jsx("p",{children:"Application No.-"})}),e.jsx("p",{className:"font-semibold text-lg text-gray-500",children:(T=o==null?void 0:o.connectionCharges)==null?void 0:T.applicationNo})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-lg text-green-500",children:e.jsx("p",{children:"Total Amount ₹-"})}),e.jsxs("p",{className:"font-semibold text-lg text-green-500",children:[n.values.isInstallment==="yes"&&Number((W=s==null?void 0:s.calculation)==null?void 0:W.connectionFee)+Number(v((E=h(n.values.installment))==null?void 0:E.amount))-P,n.values.isInstallment==="no"&&Number((G=s==null?void 0:s.calculation)==null?void 0:G.connectionFee)+Number((B=s==null?void 0:s.calculation)==null?void 0:B.penalty)-P]})]}),e.jsxs("div",{className:"grid grid-cols-12 px-4 py-2 text-sm gap-y-2",children:[e.jsx("div",{className:"col-span-12 mt-2 text-gray-800",children:e.jsxs("div",{className:"grid grid-cols-12 text-base rounded",children:[e.jsxs("div",{className:"col-span-6 space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Payment For:"})," ",(V=s==null?void 0:s.calculation)==null?void 0:V.chargeCatagory]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Connection Fee:"})," ₹"," ",(L=s==null?void 0:s.calculation)==null?void 0:L.connectionFee]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Penalty:"})," ₹"," ",(q=s==null?void 0:s.calculation)==null?void 0:q.penalty]})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsxs("p",{className:"font-semibold",children:["Rebate: ₹ ",P]}),e.jsx("div",{className:"flex",children:e.jsxs("div",{children:[e.jsxs("label",{children:[e.jsx("span",{className:"font-semibold",children:"Installment Payment"}),e.jsx("input",{type:"radio",name:"isInstallment",value:"yes",checked:n.values.isInstallment==="yes",onChange:n.handleChange,onBlur:n.handleBlur}),"Yes",e.jsx("input",{type:"radio",name:"isInstallment",value:"no",checked:n.values.isInstallment==="no",onChange:n.handleChange,onBlur:n.handleBlur,disabled:(($=s==null?void 0:s.calculation)==null?void 0:$.paidStatus)===1}),"No"]}),e.jsx("p",{className:"text-red-500 text-xs font-semibold",children:n.touched.isInstallment&&n.errors.isInstallment?n.errors.isInstallment:null})]})}),e.jsxs("div",{className:`${n.values.isInstallment==="no"?"opacity-50":""} flex gap-2 disabled:opacity-60`,children:[e.jsx("p",{className:"font-semibold",children:"Select Installment"}),e.jsxs("select",{onChange:n.handleChange,disabled:n.values.isInstallment==="no",value:n.values.installment,name:"installment",className:"disabled:opacity-60 disabled:border-0 border border-gray-800 rounded shadow text-sm h-6",children:[e.jsx("option",{value:"",children:"Select"}),s&&(s==null?void 0:s.penaltyInstallments.map((t,r)=>(c+=Number(t.balance_amount),e.jsx("option",{value:JSON.stringify({ids:t.ids,amount:c}),children:c},r))))]})]}),e.jsx("p",{className:"text-red-500 text-xs text-center font-semibold",children:n.touched.installment&&n.errors.installment?n.errors.installment:null})]})]})}),e.jsx("div",{className:"col-span-12 mt-2",children:e.jsx("div",{className:"text-center font-light rounded",children:e.jsx("p",{children:"Note: You can pay using Card / UPI / Netbanking / Wallet etc."})})}),e.jsx("div",{className:"col-span-12 mt-2",children:e.jsx("div",{className:"flex justify-center",children:w?e.jsx(J,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"30",visible:!0}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:l.closeModal,className:"mx-3 bg-red-600 hover:bg-red-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm rounded-sm shadow-xl",children:"Cancel"}),e.jsx("button",{type:"submit",className:"mx-3 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm rounded-sm shadow-xl",children:"Pay Now"})]})})})]})]})})})},oe=l=>{var j,n,y,b,a;const[w,x]=d.useState(!1),[_,u]=d.useState(),s=l==null?void 0:l.paymentData,{notify:p}=d.useContext(z),{api_rzpWaterOrderId:f,api_getTranNo:R,header:I}=M(),i=()=>{l.closeModal()},o=m=>{console.log("Payment Status =>",m),m.status==!0&&(p("Payment Done successfully","success"),u({orderId:m.data.razorpay_order_id,paymentId:m.data.razorpay_payment_id}),l.fetchTransactionDetails(m),l==null||l.refechList())},h=()=>{var N,v;x(!0);const m={id:(N=s==null?void 0:s.connectionCharges)==null?void 0:N.applicationId,applycationType:(v=s==null?void 0:s.connectionCharges)==null?void 0:v.type};console.log("Payment Button Clicked..",m),Y.post(f,m,I).then(c=>{console.log("Oder ID Generated",c),x(!1),c.data.status==!0?U(c.data.data,o):p(c.data.message,"error")}).catch(c=>{x(!1),console.log("Error genrating order id",c),p(c.message,"error")})};return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("p",{onClick:i,className:"float-right absolute right-12 top-12 hover:bg-gray-300 bg-gray-200 p-1 cursor-pointer ",children:[" ",e.jsx(H,{})," "]}),e.jsxs("div",{className:"bg-white shadow-2xl border border-blue-200 md:p-5 md:m-5 rounded-md",children:[e.jsxs("div",{className:" border-b-2 py-1 pl-3 font-semibold border-red-400 flex",children:[e.jsx(Z,{size:20,className:"mt-0.5 mr-1"}),"Make Payment "]}),e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("img",{src:"https://img.freepik.com/free-vector/hand-holding-phone-with-credit-card-screen-man-making-purchase-shopping-paying-online-using-banking-app-flat-vector-illustration-transaction-e-commerce-concept_74855-26014.jpg?w=1380&t=st=1686898919~exp=1686899519~hmac=4b0ddb44860ec647fa33a1a0416ea0c1cc8167693a13fdba3f09058d099f0e76",alt:"My Image",width:200,height:100})}),e.jsxs("div",{className:"flex items-center px-28",children:[e.jsx("div",{className:"font-semibold text-2xl text-gray-500",children:e.jsx("p",{children:"Application No.-"})}),e.jsx("p",{className:"font-semibold text-2xl text-gray-500",children:(j=s==null?void 0:s.connectionCharges)==null?void 0:j.applicationNo})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-2xl text-green-500",children:e.jsx("p",{children:"Amount-Rs"})}),e.jsx("p",{className:"font-semibold text-2xl text-green-500",children:((n=s==null?void 0:s.connectionCharges)==null?void 0:n.amount)||"N/A"})]}),e.jsx("h1",{className:"text-center font-semibold",children:"Amount Breakup"}),e.jsxs("div",{className:"grid grid-cols-6 px-24",children:[e.jsxs("div",{className:"col-span-3 ",children:[e.jsxs("h1",{children:["Payment For : ",(y=s==null?void 0:s.connectionCharges)==null?void 0:y.charge_category]}),e.jsxs("h1",{children:["Penalty : ₹ ",(b=s==null?void 0:s.connectionCharges)==null?void 0:b.penalty]})]}),e.jsx("div",{className:"col-span-3",children:e.jsxs("h1",{children:["Connection Fee : ₹ ",(a=s==null?void 0:s.connectionCharges)==null?void 0:a.conn_fee]})})]}),e.jsx("div",{className:"md:col-span-12 col-span-12 md:mt-5 mt-2",children:e.jsx("div",{className:"text-center font-extralight px-2 rounded",children:e.jsx("p",{children:"Note : You can pay using Card / UPI / Netbanking / Wallet etc."})})}),e.jsx("div",{className:"col-span-12 md:mt-5 mt-2",children:e.jsx("div",{className:"flex justify-center",children:w?e.jsx(J,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"30",visible:!0}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i,className:"mx-3 bg-red-600 hover:bg-red-700 transition duration-200 hover:scale-105 font-normal text-white px-6 py-2 text-sm rounded-sm shadow-xl",children:"Cancel"}),e.jsx("button",{onClick:h,className:"mx-3 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-5 py-2 text-sm  rounded-sm shadow-xl",children:"Pay Now"})]})})})]})]})})},ae={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",background:"transparent",border:"none"}};function je(l){var n,y,b;const[w,x]=K.useState(!1),[_,u]=d.useState(!1),[s,p]=d.useState(),[f,R]=d.useState(),I=Q();d.useContext(z),M();const i=l.paymentData;console.log("paymentData==>",i),d.useEffect(()=>{x(!0)},[]);function o(){}function h(){x(!1),u(!1),p(!1),R(!1),l==null||l.openPaymentModal(!1)}const j=a=>{var N,v,c;a!=null&&a.status&&u(!0),console.log("fetchTransactionDetails",a);const m={orderId:(N=a==null?void 0:a.data)==null?void 0:N.razorpay_order_id,paymentId:(v=a==null?void 0:a.data)==null?void 0:v.razorpay_payment_id,signature:(c=a==null?void 0:a.data)==null?void 0:c.razorpay_signature};console.log("payload",m)};return e.jsx("div",{className:"",children:e.jsxs(X,{isOpen:w,onAfterOpen:o,onRequestClose:h,style:ae,contentLabel:"Example Modal",children:[_&&e.jsxs("div",{className:`${s?"bg-green-200":"bg-yellow-50"} shadow-2xl border border-sky-200 md:p-5 md:m-5 rounded-md`,children:[e.jsxs("div",{className:"flex justify-center",children:[s&&e.jsx("img",{src:D,className:"h-16",alt:"Payment Success",srcset:""}),!s&&e.jsx("img",{src:te,className:"h-12",alt:"Payment Pending",srcset:""})]}),e.jsxs("div",{className:"py-1 pl-3 font-semibold text-center text-2xl text-gray-800",children:[s?"Payment Completed Successfully":"Payment Under Processing"," "]}),(s==null?void 0:s.transectionNo)&&e.jsxs("p",{className:"text-center",children:[e.jsx("span",{className:"text-base",children:" Payment Transaction No"})," ",e.jsx("span",{className:"font-bold text-blue-700 text-xl",children:s==null?void 0:s.transectionNo})]}),!(s!=null&&s.transectionNo)&&e.jsxs("p",{className:"text-center font-semibold",children:[e.jsx("span",{className:"text-base",children:" Payment Status"})," ",e.jsx("span",{className:" text-blue-500 text-base",children:"Pending"})]}),e.jsx("p",{className:"border-b border-gray-300 mx-10 py-1"}),e.jsxs("div",{className:"grid grid-cols-12 px-8 py-3 leading-8 space-x-8 text-sm",children:[e.jsx("div",{className:"md:col-span-6 col-span-12",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"col-span-6 font-semibold",children:[e.jsx("p",{children:"Application No"}),e.jsx("p",{children:"Connection Type"})]}),e.jsxs("div",{className:"col-span-6 ml-3",children:[e.jsx("p",{children:(s==null?void 0:s.applicationNo)||((n=i==null?void 0:i.connectionCharges)==null?void 0:n.applicationNo)}),e.jsx("p",{children:(s==null?void 0:s.tranType)||((y=i==null?void 0:i.connectionCharges)==null?void 0:y.charge_category)})]})]})}),e.jsx("div",{className:"md:col-span-6 col-span-12",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"col-span-6 font-semibold",children:[e.jsx("p",{children:"Amount"}),e.jsx("p",{children:"Payment Date"})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsx("p",{children:(s==null?void 0:s.amount)||((b=i==null?void 0:i.connectionCharges)==null?void 0:b.amount)}),e.jsx("p",{children:(s==null?void 0:s.transectionDate)||"Pending"})]})]})}),e.jsx("div",{className:"col-span-12 md:mt-4 mt-10",children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx("button",{onClick:h,className:"mx-2 bg-sky-600 hover:bg-sky-700 transition duration-200 hover:scale-105 font-normal text-white px-6 py-1 text-sm rounded-sm shadow-xl",children:"Dashboard"}),s&&e.jsx("button",{onClick:()=>I(`/waterConnReceipt/${s==null?void 0:s.transectionNo}`),className:"mx-2 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm  rounded-sm shadow-xl",children:"View Receipt"}),!s&&e.jsx("button",{onClick:()=>j(),className:"mx-2 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm  rounded-sm shadow-xl",children:"Check Status"})]})})]})]}),!_&&((l==null?void 0:l.category)=="Regulaization"?e.jsx(le,{closeModal:h,fetchTransactionDetails:j,paymentData:i}):e.jsx(oe,{closeModal:h,fetchTransactionDetails:j,paymentData:i}))]})})}export{je as W};
