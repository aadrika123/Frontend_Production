import{u as ee,H as X,w as C,g as b,b as ae,d as se,o as le,r as f,j as e,F as re,R as M,N as K,V as O,W,Z as _,O as de,J as ne,B as ie,c as te,a as j,P as oe,_ as h,K as Z,x as ce,y as ue,M as pe,z as xe,S as he,I as me,A as ge,G as je}from"./index-D-9IcDeW.js";import{P as fe}from"./index-DNOi358C.js";import{T as be,a as Ne,b as Q,c as u,d as ye,e as p}from"./table-TWFhCp3u.js";import{D as Ie}from"./index-CSPmRVc7.js";import{g as Ue}from"./services-KQnp_8oA.js";import{P as ve}from"./index-DtQi2PXm.js";import{S as we}from"./index-BRkjU1yW.js";import{q as Se}from"./switch-Coinnq0k.js";import"./pagination-DnU5UXLb.js";const Pe=te().shape({fullName:j().required("Full Name is required"),mobile:j().required().min(10).max(10).label("Mobile"),email:j().required("Email is required"),password:j().required("Password is required"),roleId:j().required("Role is required"),ulbId:j(),address:j(),imageUrl:oe().nullable()});function Ae({open:R,setOpen:m,title:F,id:x,edit:o,setEdit:N,refetch:L}){var I,U,v,w,S,P,A;const T=ee({}),y=X({}),{data:t,isFetching:q}=C({api:`${b.getUserById}/${x}`,key:"getUserById",options:{enabled:o}}),{user:l}=ae(),c=se({defaultValues:{fullName:"",mobile:"",email:"",password:"",roleId:"",address:""},resolver:le(Pe)}),r=async s=>{var $,E,a,g;const n=new FormData;(l==null?void 0:l.roleId)===_&&n.append("ulbId",l==null?void 0:l.userUlbId),((l==null?void 0:l.roleId)===W||(l==null?void 0:l.roleId)===O)&&(s==null?void 0:s.roleId)===_&&n.append("ulbId",s==null?void 0:s.ulbId),n.append("fullName",s.fullName),n.append("mobile",s.mobile),n.append("roleId",s.roleId),n.append("address",String(s==null?void 0:s.address)),n.append("imageUrl",s.imageUrl);try{if(o&&s){const d=await y.mutateAsync({api:`${b.updateUser}/${x}`,data:n});($=d.data)!=null&&$.success?h.success((E=d==null?void 0:d.data)==null?void 0:E.message):h.error("User not updated successfully")}else{n.append("email",s.email),n.append("password",s.password);const d=await T.mutateAsync({api:b.createUser,data:n});(a=d.data)!=null&&a.success?h.success((g=d==null?void 0:d.data)==null?void 0:g.message):h.error("User not created successfully"),c.reset({fullName:"",mobile:"",email:"",password:"",roleId:"",address:""})}m(!1),N(!1),L()}catch(d){console.log(d)}};f.useEffect(()=>{o&&t?c.reset({fullName:t.userDetails.fullName,mobile:t.userDetails.mobile,email:t.userDetails.email,password:t.userDetails.password,roleId:t.userDetails.roleId,ulbId:t.userDetails.ulbId,address:t.userDetails.address,imageUrl:t.userDetails.imageUrl}):c.reset({fullName:"",mobile:"",email:"",password:"",roleId:"",address:""})},[o,t]);const B=C({api:`${(I=b)==null?void 0:I.getAllRoleByPermission}?page=1&limit=10000`,key:"getAllRoleByPermission",options:{enabled:!0}}),k=C({api:`${b.getAllUlb}?page=1&limit=1000`,key:"getAllUlb",options:{enabled:!0}});return e.jsx(Ie,{open:R,setOpen:m,title:F,setEdit:N,edit:o,isLoading:q,children:e.jsxs(re,{methods:c,onSubmit:c.handleSubmit(r),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-4",children:[e.jsx("div",{children:e.jsx(M,{name:"fullName",placeholder:"Enter your Full Name ",inputValidation:["CapitalFirstLetter","removeDoubleSpace","string"]})}),e.jsx("div",{children:e.jsx(M,{name:"mobile",placeholder:"Enter your Mobile no.",inputValidation:["mobile","number"]})}),e.jsx("div",{children:e.jsx(M,{name:"email",placeholder:"Enter your Email",inputValidation:["removeSpace"]})}),!o&&e.jsx("div",{children:e.jsx(M,{name:"password",placeholder:"Enter your Password"})}),e.jsx("div",{children:e.jsx(K,{name:"roleId",data:((w=(v=(U=B.data)==null?void 0:U.data)==null?void 0:v.docs)==null?void 0:w.map(s=>({value:s._id,label:s.roleName})))??[],disabled:o})}),((l==null?void 0:l.roleId)===O||(l==null?void 0:l.roleId)===W)&&c.watch("roleId")===_&&e.jsx("div",{children:e.jsx(K,{name:"ulbId",data:((A=(P=(S=k.data)==null?void 0:S.data)==null?void 0:P.docs)==null?void 0:A.map(s=>({value:s._id,label:s.ulbName})))??[],disabled:o})}),e.jsx("div",{children:e.jsx(de,{name:"imageUrl",placeholder:"Upload your Images"})}),e.jsx("div",{children:e.jsx(ne,{name:"address",placeholder:"Enter your Address",inputValidation:["removeDoubleSpace","UppercaseAfterSpace"]})}),e.jsx("div",{})]}),e.jsx("div",{className:"mt-5 justify-center items-center flex",children:e.jsx(ie,{isLoading:c.formState.isSubmitting,type:"submit",className:"h-11 w-full md:w-1/2 rounded-xl",children:"Submit"})})]})})}function $e(){var I,U,v,w,S,P,A,s,n,$,E;const R=X({}),[m,F]=f.useState(1),[x,o]=f.useState(10),[N,L]=f.useState(""),[T,y]=f.useState(!1),[t,q]=f.useState(""),[l,c]=f.useState(!1),r=C({api:`${b.getAllUserMasterList}?page=${m}&limit=${x}&q=${N}`,key:"getAllUserMasterList",value:[m,x],options:{enabled:!0}}),B=a=>{c(!0),y(!0),q(a)},k=async a=>{var g,d,D,H,V,Y,z,G,J;try{const i=await R.mutateAsync({api:`${(g=b)==null?void 0:g.updateUserStatus}/${a}`,data:{id:t}});(d=i==null?void 0:i.data)!=null&&d.success?(r.refetch(),((H=(D=i==null?void 0:i.data)==null?void 0:D.data)==null?void 0:H.status)==1&&h.success((V=i.data)==null?void 0:V.message),((z=(Y=i==null?void 0:i.data)==null?void 0:Y.data)==null?void 0:z.status)==0&&h.error((G=i.data)==null?void 0:G.message)):h.error((J=i.data)==null?void 0:J.message)}catch(i){h.error(Ue(i))}};return e.jsxs("main",{className:"grid items-start",children:[e.jsx(Ae,{open:T,setOpen:y,title:l?"Edit User":"Add User",id:t,edit:l,setEdit:c,refetch:r.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(we,{search:N,setPage:F,setSearch:L,refetch:r.refetch,isFetching:r.isLoading})}),e.jsx("div",{children:e.jsx(Z,{className:"flex items-center gap-2",onClick:()=>y(!0),children:"Add New"})})]}),e.jsxs(ce,{children:[e.jsx(ue,{className:"px-7",children:e.jsxs(pe,{children:["Users List (",(U=(I=r.data)==null?void 0:I.data)==null?void 0:U.totalDocs,")"]})}),e.jsx(xe,{children:r.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(he,{})}):e.jsxs("div",{children:[e.jsxs(be,{className:"",children:[e.jsx(Ne,{children:e.jsxs(Q,{children:[e.jsx(u,{className:"",children:"#"}),e.jsx(u,{className:"",children:"Images"}),e.jsx(u,{className:"",children:"Users Name"}),e.jsx(u,{className:"",children:"Mobile"}),e.jsx(u,{className:"",children:"Email"}),e.jsx(u,{className:"",children:"Role"}),e.jsx(u,{className:"",children:"ULB"}),e.jsx(u,{className:"",children:"Created at"}),e.jsx(u,{className:"",children:"Status"}),e.jsx(u,{children:"Action"})]})}),e.jsx(ye,{children:(S=(w=(v=r==null?void 0:r.data)==null?void 0:v.data)==null?void 0:w.docs)==null?void 0:S.map((a,g)=>{var d,D;return e.jsxs(Q,{children:[e.jsx(p,{children:m*x-x+g+1}),e.jsx(p,{style:{margin:5,width:"50px",height:"50px",backgroundSize:"cover",backgroundPosition:"center",borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center",padding:0},children:e.jsx(me,{src:a==null?void 0:a.fullImgUrl,alt:a==null?void 0:a.imageUrl,className:"h-12 w-12 rounded-full"})}),e.jsx(p,{children:a==null?void 0:a.fullName}),e.jsx(p,{children:a==null?void 0:a.mobile}),e.jsx(p,{children:(D=(d=a==null?void 0:a.email)==null?void 0:d.replace("@","[at]"))==null?void 0:D.replace(".","[dot]")}),e.jsx(p,{children:a==null?void 0:a.role}),e.jsx(p,{children:a==null?void 0:a.ulb}),e.jsx(p,{children:ge(a==null?void 0:a.createdAt).format("DD-MM-YYYY")}),e.jsx(p,{children:e.jsxs(Se,{checked:(a==null?void 0:a.status)==1,onChange:()=>k(a==null?void 0:a._id),className:`${a!=null&&a.status?"bg-primary":"bg-gray-200"} relative inline-flex items-center h-6 rounded-full w-11`,children:[e.jsx("span",{className:"sr-only",children:"Enable notifications"}),e.jsx("span",{className:`${a!=null&&a.status?"translate-x-6":"translate-x-1"} inline-block w-4 h-4 transform bg-white rounded-full`})]})}),e.jsx(p,{children:e.jsx(Z,{className:"bg-primary",onClick:()=>B(a._id),children:"Edit"})})]},a._id)})})]}),e.jsx(je,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(ve,{page:m,perPage:x,totalPage:(A=(P=r==null?void 0:r.data)==null?void 0:P.data)==null?void 0:A.totalDocs,hasNextPage:(n=(s=r==null?void 0:r.data)==null?void 0:s.data)==null?void 0:n.hasNextPage,hasPrevPage:(E=($=r==null?void 0:r.data)==null?void 0:$.data)==null?void 0:E.hasPrevPage,setPage:F,setPerPage:o})})]})})]})]})]})}function Be(){return e.jsx(fe,{title:"Users List",subTitle:"Manage all the Users List here",children:e.jsx("div",{className:"",children:e.jsx($e,{})})})}export{Be as default};
