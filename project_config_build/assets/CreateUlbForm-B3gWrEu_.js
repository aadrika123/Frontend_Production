import{r as e,y as a,j as l,af as t,aD as s,al as i,ai as r,aE as o,A as d,z as n}from"./vendor-Cw0yupI3.js";import{c,a as u,d as m}from"./yup-CjHziZVU.js";import{F as p,R as b,B as x}from"./datetime-picker-eCa_jalC.js";import{d as h}from"./index-iXZY_DvU.js";import{g}from"./services-Bn_cfjy0.js";import{R as v}from"./RHFSelectField-DGFUSNJw.js";import"./input-LWSecp6H.js";import"./switch-BIkVAKvI.js";import"./label-DT6y_ZH-.js";import{u as j,a as f}from"./useCustomQuery-B0IS257H.js";import{D as N}from"./index-DNgxqOXG.js";import{X as y}from"./icons-DfkRqyLz.js";const w=c().shape({id:u().nullable(),ulbName:u().required("Ulb Name is required"),ulbType:u().required("Ulb Type is required"),remarks:u().nullable(),incorporationDate:u().nullable(),code:u().nullable(),shortName:u().required("Short Name is required"),tollFreeNo:u().nullable(),email:u().email("Enter a valid email").required("Email is required"),mobileNo:u().matches(/^\d{10}$/,"Mobile number must be 10 digits").nullable(),stateId:m().typeError("State ID must be a number").required("State ID is required"),districtId:m().typeError("District ID must be a number").required("District ID is required"),associationWith:u().nullable(),latitude:u().nullable(),longitude:u().nullable(),document:u().nullable()});function D({open:c,setOpen:u,title:m,edit:D,setEdit:I,editData:S,refetch:_}){var k,C,U,E;const q=j({}),[L,F]=e.useState(null),T=a({defaultValues:{id:"",ulbName:"",ulbType:"",remarks:"",incorporationDate:"",code:"",shortName:"",tollFreeNo:"",email:"",mobileNo:"",stateId:void 0,districtId:void 0,associationWith:"",latitude:"",longitude:""},resolver:d(w)}),{reset:R,setValue:M,watch:A}=T,W=A("stateId");e.useEffect(()=>{c&&R(D&&S?{id:(null==S?void 0:S.id)||"",ulbName:(null==S?void 0:S.ulb_name)||"",ulbType:(null==S?void 0:S.ulb_type)||"",remarks:(null==S?void 0:S.remarks)||"",incorporationDate:(null==S?void 0:S.incorporation_date)||"",code:(null==S?void 0:S.code)||"",shortName:(null==S?void 0:S.short_name)||"",tollFreeNo:(null==S?void 0:S.toll_free_no)||"",email:(null==S?void 0:S.email)||"",mobileNo:(null==S?void 0:S.mobile_no)||"",stateId:Number(null==S?void 0:S.state_id)||0,districtId:Number(null==S?void 0:S.district_id)||0,associationWith:(null==S?void 0:S.association_with)||"",latitude:(null==S?void 0:S.latitude)||"",longitude:(null==S?void 0:S.longitude)||""}:{id:"",ulbName:"",ulbType:"",remarks:"",incorporationDate:"",code:"",shortName:"",tollFreeNo:"",email:"",mobileNo:"",stateId:void 0,districtId:void 0,associationWith:"",latitude:"",longitude:""})},[c,D,S,R]);const B=f({api:h.getStates,options:{enabled:!0}}),O=(null==(C=null==(k=null==B?void 0:B.data)?void 0:k.data)?void 0:C.map(e=>({value:String(e.id),label:e.name})))||[],P=f({api:h.getDistrictList,config:{stateId:W?Number(W):void 0},value:[W],options:{enabled:!!W}}),V=e.useRef(null);e.useEffect(()=>{null!=V.current&&V.current!==W&&M("districtId",void 0),V.current=W},[W,M]),e.useEffect(()=>{W&&P.refetch()},[W]);const z=(null==(E=null==(U=null==P?void 0:P.data)?void 0:U.data)?void 0:E.map(e=>({value:String(e.district_code),label:e.district_name})))||[],[G,H]=e.useState(""),Q=e.useRef(null);e.useEffect(()=>{(null==S?void 0:S.ulb_logo)&&H(S.ulb_logo)},[S,c]);return l.jsx(N,{open:c,setOpen:u,title:m,setEdit:I,edit:D,children:l.jsx("div",{className:"p-1",children:l.jsx(p,{methods:T,onSubmit:T.handleSubmit(async e=>{var a,l,t,s,i;const r=new FormData;Object.entries(e).forEach(([e,a])=>{r.append(e,a)}),L&&r.append("document",L);try{const e=D?null==(a=h)?void 0:a.api_updateUlb:null==(l=h)?void 0:l.api_PostUlb,o=await q.mutateAsync({api:e,data:r});(null==(t=null==o?void 0:o.data)?void 0:t.status)?(n.success((null==(s=null==o?void 0:o.data)?void 0:s.message)||(D?"ULB Account updated successfully":"ULB Account created successfully")),u(!1),I&&I(!1),_()):n.error((null==(i=null==o?void 0:o.data)?void 0:i.message)||"Something went wrong")}catch(o){n.error(g(o))}}),children:l.jsxs("div",{className:"flex flex-col gap-6",children:[l.jsx("div",{className:"max-h-[60vh] overflow-y-auto px-3",children:l.jsxs("div",{className:"grid grid-cols-1 gap-8 md:grid-cols-2",children:[l.jsxs("div",{className:"space-y-4",children:[l.jsxs("h4",{className:"flex items-center gap-2 border-b pb-2 text-sm font-bold uppercase tracking-wider text-muted-foreground",children:[l.jsx(t,{className:"text-primary"})," Basic Information"]}),l.jsx(b,{label:"Ulb Name",name:"ulbName",placeholder:"e.g. Deoghar Municipal Corporation"}),l.jsx(v,{label:"Ulb Type",name:"ulbType",data:[{label:"Town Panchayat",value:"Town Panchayat"},{label:"Municipal Council",value:"Municipal Council"},{label:"Municipal Corporation",value:"Municipal Corporation"}]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsx(b,{label:"Short Name",name:"shortName",placeholder:"DMC"}),l.jsx(b,{label:"Code",name:"code",placeholder:"e.g. DMC001"})]}),l.jsx("div",{className:"grid grid-cols-2 gap-4"}),l.jsx(b,{label:"Incorporation Date",name:"incorporationDate",type:"date"}),l.jsxs("div",{className:"flex flex-col gap-1 ",children:[l.jsx("label",{className:"text-sm",htmlFor:"document",children:"Upload Logo"}),l.jsx("input",{name:"document",type:"file",className:"rounded-md bg-secondary px-3 py-1.5 text-sm",onChange:e=>{var a;const l=null==(a=e.target.files)?void 0:a[0];if(l){const e=URL.createObjectURL(l);F(l),H(e)}else(null==S?void 0:S.ulb_logo)&&H(S.ulb_logo)},ref:Q})]}),G&&l.jsxs("div",{className:"relative",children:[l.jsx("img",{src:G,alt:"Preview",style:{width:"200px",marginTop:"10px"}}),l.jsx("span",{onClick:()=>{H(""),Q.current&&(Q.current.value="")},className:"absolute right-10 top-0 flex h-6 w-6 cursor-pointer items-center justify-center rounded-full bg-red-300 transition-all ease-in-out hover:bg-red-400",children:l.jsx(y,{className:"p-0.5 text-gray-600"})})]})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("h4",{className:"flex items-center gap-2 border-b pb-2 text-sm font-bold uppercase tracking-wider text-muted-foreground",children:[l.jsx(s,{className:"text-primary"})," Remarks & Info"]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx(b,{label:"Remarks",name:"remarks",placeholder:"Special notes..."}),l.jsx(b,{label:"Association With",name:"associationWith",placeholder:"State Government"})]})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("h4",{className:"flex items-center gap-2 border-b pb-2 text-sm font-bold uppercase tracking-wider text-muted-foreground",children:[l.jsx(i,{className:"text-primary"})," Contact & Web"]}),l.jsx(b,{label:"Email Address",name:"email",placeholder:"contact@deoghar.gov.in"}),l.jsx(b,{label:"Mobile No",name:"mobileNo",placeholder:"9876543210"}),l.jsx(b,{label:"Toll Free No",name:"tollFreeNo",placeholder:"1800123456"})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("h4",{className:"flex items-center gap-2 border-b pb-2 text-sm font-bold uppercase tracking-wider text-muted-foreground",children:[l.jsx(r,{className:"text-primary"})," Regional Information"]}),l.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[l.jsx(v,{label:"State",name:"stateId",data:O}),l.jsx(v,{label:"District",name:"districtId",data:z})]})]}),l.jsxs("div",{className:"space-y-4 md:col-span-2",children:[l.jsxs("h4",{className:"flex items-center gap-2 border-b pb-2 text-sm font-bold uppercase tracking-wider text-muted-foreground",children:[l.jsx(o,{className:"text-primary"})," Location Coordinates"]}),l.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[l.jsx(b,{label:"Latitude",name:"latitude",placeholder:"24.4850"}),l.jsx(b,{label:"Longitude",name:"longitude",placeholder:"86.6950"})]})]})]})}),l.jsx("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:l.jsx(x,{isLoading:T.formState.isSubmitting,type:"submit",className:"h-12 rounded-xl bg-primary px-10 text-sm font-bold text-primary-foreground shadow-lg shadow-primary/25 transition-all hover:bg-primary/95 hover:shadow-xl active:scale-[0.98]",children:D?"Update ULB Account":"Create ULB Account"})})]})})})})}export{D as C};
