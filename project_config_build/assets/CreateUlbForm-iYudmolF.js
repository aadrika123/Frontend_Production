import{r as e,y as a,j as s,an as i,aJ as l,aK as t,ap as r,B as d,z as o}from"./vendor-of9_hwUT.js";import{c as n,a as c,b as u}from"./yup-BW00wNfM.js";import{u as m,b as p,D as b,F as x,R as h,G as g,B as v,s as j,g as N}from"./index-Caq1sqRP.js";import{X as f}from"./icons-C5eWvnai.js";const y=n().shape({id:c().nullable(),ulbName:c().required("Ulb Name is required"),ulbType:c().required("Ulb Type is required"),incorporationDate:c().nullable(),code:c().nullable(),shortName:c().required("Short Name is required"),email:c().email("Enter a valid email").required("Email is required"),mobileNo:c().matches(/^\d{10}$/,"Mobile number must be exactly 10 digits").required("Mobile number is required"),stateId:u().typeError("State ID must be a number").required("State ID is required"),districtId:u().typeError("District ID must be a number").required("District ID is required"),associationWith:c().nullable(),pincode:c().matches(/^\d{6}$/,"Pincode must be exactly 6 digits").required("Pin Code is required"),address:c().required("Address is required"),document:c().nullable()});function q({open:n,setOpen:c,title:u,edit:q,setEdit:D,editData:I,refetch:w}){var _,U;const C=m({}),[L,R]=e.useState(null),S=a({defaultValues:{id:"",ulbName:"",ulbType:"",incorporationDate:"",code:"",shortName:"",email:"",mobileNo:"",stateId:16,districtId:void 0,associationWith:"",pincode:"",address:""},resolver:d(y)}),{reset:E}=S;e.useEffect(()=>{n&&E(q&&I?{id:(null==I?void 0:I.id)||"",ulbName:(null==I?void 0:I.ulb_name)||"",ulbType:(null==I?void 0:I.ulb_type)||"",incorporationDate:(null==I?void 0:I.incorporation_date)||"",code:(null==I?void 0:I.code)||"",shortName:(null==I?void 0:I.short_name)||"",email:(null==I?void 0:I.email)||"",mobileNo:(null==I?void 0:I.mobile_no)||"",stateId:Number(null==I?void 0:I.state_id)||16,districtId:Number(null==I?void 0:I.district_id)||0,associationWith:(null==I?void 0:I.association_with)||"",pincode:(null==I?void 0:I.pin_code)||"",address:(null==I?void 0:I.address)||""}:{id:"",ulbName:"",ulbType:"",incorporationDate:"",code:"",shortName:"",email:"",mobileNo:"",stateId:16,districtId:void 0,associationWith:"",pincode:"",address:""})},[n,q,I,E]);const A=p({api:j.getDistrictList,config:{stateId:16},options:{enabled:!0}}),M=(null==(U=null==(_=null==A?void 0:A.data)?void 0:_.data)?void 0:U.map(e=>({value:String(e.id),label:e.district_name})))||[],[T,B]=e.useState(""),P=e.useRef(null);e.useEffect(()=>{(null==I?void 0:I.ulb_logo)&&B(I.ulb_logo)},[I,n]);return s.jsx(b,{open:n,setOpen:c,title:u,setEdit:D,edit:q,children:s.jsx("div",{className:"p-1",children:s.jsx(x,{methods:S,onSubmit:S.handleSubmit(async e=>{var a,s,i,l,t,r,d;const n=new FormData;Object.entries(e).forEach(([e,a])=>{"document"!==e&&null!=a&&n.append(e,a)});try{const m=q?null==(a=j)?void 0:a.api_updateUlb:null==(s=j)?void 0:s.api_PostUlb,p=await C.mutateAsync({api:m,data:n});if(null==(i=null==p?void 0:p.data)?void 0:i.status){const a=q?e.id:null==(t=null==(l=null==p?void 0:p.data)?void 0:l.data)?void 0:t.id;if(L&&a){const e=new FormData;e.append("ulbId",a),e.append("logo",L);try{await C.mutateAsync({api:j.api_PostUlblogo,data:e})}catch(u){o.error("ULB saved, but logo upload failed")}}o.success((null==(r=null==p?void 0:p.data)?void 0:r.message)||(q?"ULB Account updated successfully":"ULB Account created successfully")),c(!1),D&&D(!1),w()}else o.error((null==(d=null==p?void 0:p.data)?void 0:d.message)||"Something went wrong")}catch(m){o.error(N(m))}}),children:s.jsxs("div",{className:"flex flex-col gap-6",children:[s.jsx("div",{className:"max-h-[60vh] overflow-y-auto px-3",children:s.jsxs("div",{className:"grid grid-cols-1 gap-8 md:grid-cols-2",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h4",{className:"flex items-center gap-2 border-b pb-2 text-sm font-bold uppercase tracking-wider text-muted-foreground",children:[s.jsx(i,{className:"text-primary"})," Basic Information"]}),s.jsx(h,{label:"Ulb Name",name:"ulbName",placeholder:"e.g. Deoghar Municipal Corporation",isRequired:!0}),s.jsx(g,{label:"Ulb Type",name:"ulbType",data:[{label:"Town Panchayat",value:"Town Panchayat"},{label:"Municipal Council",value:"Municipal Council"},{label:"Municipal Corporation",value:"Municipal Corporation"}],isRequired:!0}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(h,{label:"Short Name",name:"shortName",placeholder:"DMC",isRequired:!0}),s.jsx(h,{label:"Code",name:"code",placeholder:"e.g. DMC001"})]}),s.jsx("div",{className:"grid grid-cols-2 gap-4"}),s.jsx(h,{label:"Establishment Date",name:"incorporationDate",type:"date"}),s.jsxs("div",{className:"flex flex-col gap-1 ",children:[s.jsx("label",{className:"text-sm",htmlFor:"document",children:"Upload Logo"}),s.jsx("input",{name:"document",type:"file",className:"rounded-md bg-secondary px-3 py-1.5 text-sm",onChange:e=>{var a;const s=null==(a=e.target.files)?void 0:a[0];if(s){const e=URL.createObjectURL(s);R(s),B(e)}else(null==I?void 0:I.ulb_logo)&&B(I.ulb_logo)},ref:P})]}),null!==T&&s.jsxs("div",{className:"relative",children:[s.jsx("img",{src:T,alt:"No Logo",style:{width:"200px",marginTop:"10px"}}),s.jsx("span",{onClick:()=>{B(""),P.current&&(P.current.value="")},className:"absolute right-10 top-0 flex h-6 w-6 cursor-pointer items-center justify-center rounded-full bg-red-300 transition-all ease-in-out hover:bg-red-400",children:s.jsx(f,{className:"p-0.5 text-gray-600"})})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h4",{className:"flex items-center gap-2 border-b pb-2 text-sm font-bold uppercase tracking-wider text-muted-foreground",children:[s.jsx(l,{className:"text-primary"})," Info"]}),s.jsx("div",{className:"space-y-4",children:s.jsx(h,{label:"Association With",name:"associationWith",placeholder:"State Government"})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h4",{className:"flex items-center gap-2 border-b pb-2 text-sm font-bold uppercase tracking-wider text-muted-foreground",children:[s.jsx(t,{className:"text-primary"})," Contact & Web"]}),s.jsx(h,{label:"Email Address",name:"email",placeholder:"contact@deoghar.gov.in",isRequired:!0}),s.jsx(h,{label:"Mobile No",name:"mobileNo",placeholder:"9876543210",isRequired:!0,maxLength:10,onInput:e=>{e.target.value=e.target.value.replace(/[^0-9]/g,"").slice(0,10)}})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h4",{className:"flex items-center gap-2 border-b pb-2 text-sm font-bold uppercase tracking-wider text-muted-foreground",children:[s.jsx(r,{className:"text-primary"})," Regional Information"]}),s.jsx("div",{className:"grid grid-cols-1 gap-4",children:s.jsx(g,{label:"District",name:"districtId",data:M,isRequired:!0})})]}),s.jsxs("div",{className:"space-y-4 md:col-span-2",children:[s.jsxs("h4",{className:"flex items-center gap-2 border-b pb-2 text-sm font-bold uppercase tracking-wider text-muted-foreground",children:[s.jsx(r,{className:"text-primary"})," Postal Information"]}),s.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[s.jsx("div",{className:"md:col-span-1",children:s.jsx(h,{label:"Pin Code",name:"pincode",placeholder:"e.g. 814112",isRequired:!0,maxLength:6,onInput:e=>{e.target.value=e.target.value.replace(/[^0-9]/g,"").slice(0,6)}})}),s.jsx("div",{className:"md:col-span-2",children:s.jsx(h,{label:"Address",name:"address",placeholder:"Enter full postal address",isRequired:!0})})]})]})]})}),s.jsx("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:s.jsx(v,{isLoading:S.formState.isSubmitting,type:"submit",className:"h-12 rounded-xl bg-primary px-10 text-sm font-bold text-primary-foreground shadow-lg shadow-primary/25 transition-all hover:bg-primary/95 hover:shadow-xl active:scale-[0.98]",children:q?"Update ULB Account":"Create ULB Account"})})]})})})})}export{q as C};
