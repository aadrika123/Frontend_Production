import{r as e,j as s,W as t,V as r,J as a,a9 as n,X as l,z as d,m as i,a2 as o,u as c,a3 as m,aa as u,a7 as x,a6 as g,Y as h}from"./vendor-C4evAtTJ.js";import{C as f,a as p,P as v}from"./card-DibY7PM9.js";import{u as j,a as b}from"./useCustomQuery-DIQhSbRJ.js";import{c as N,b as w,m as y,B as k}from"./index-v9nFTQNd.js";import{g as C}from"./services-Bn_cfjy0.js";import{D as L}from"./index-BHtT1rPY.js";import{S as I}from"./Spinner-DEfisjJx.js";import{S as M}from"./switch-B0HYZtih.js";import"./icons-s1CkBPDV.js";import"./ui-BtaoVrnA.js";import"./query-CtA7BnhH.js";import"./axios-Dos3PyFQ.js";import"./zustand-DzHKdda2.js";function R({open:i,setOpen:o,title:c,menuRoleId:m,moduleId:u,moduleName:x,refetch:g}){var h,f;const[p,v]=e.useState(""),k=j({}),M=b({api:null==(h=y)?void 0:h.getPermitedMenuList,key:`manage-permissions-${m}-${u}`,config:{menuRoleId:m,moduleId:u},options:{enabled:i&&!!m&&!!u}}),R=e.useMemo(()=>{var e,s;const t=(null==(s=null==(e=null==M?void 0:M.data)?void 0:e.data)?void 0:s[x])||[];return p?t.filter(e=>{var s,t;return(null==(s=e.menu_string)?void 0:s.toLowerCase().includes(p.toLowerCase()))||(null==(t=e.route)?void 0:t.toLowerCase().includes(p.toLowerCase()))}):t},[null==(f=null==M?void 0:M.data)?void 0:f.data,x,p]);return s.jsx(L,{open:i,setOpen:o,setEdit:()=>{},title:c||"Manage Menu Permissions",children:s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsxs("div",{className:"relative mb-2 flex items-center",children:[s.jsx(t,{className:"absolute left-3 h-4 w-4 text-muted-foreground"}),s.jsx("input",{type:"text",placeholder:"Search menus or routes...",value:p,onChange:e=>v(e.target.value),className:"h-10 w-full rounded-xl border border-border bg-background pl-10 pr-4 text-sm outline-none transition-all focus:border-primary focus:ring-2 focus:ring-primary/20"})]}),s.jsx("div",{className:"custom-scrollbar max-h-[60vh] overflow-y-auto pr-2",children:M.isLoading?s.jsx("div",{className:"flex h-48 items-center justify-center",children:s.jsx(I,{})}):0===R.length?s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center text-muted-foreground",children:[s.jsx(r,{className:"mb-3 h-12 w-12 opacity-20"}),s.jsx("p",{children:"No menus found matching your search"})]}):s.jsx("div",{className:"space-y-3 pb-4",children:R.map((e,t)=>{var i,o;const c=!e.is_suspended;return s.jsxs(a.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.03*t},className:N("flex items-center justify-between rounded-2xl border p-4 transition-all duration-200",c?"border-green-500/20 bg-green-500/5 hover:bg-green-500/10":"border-border bg-muted/20 hover:bg-muted/30"),children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:N("flex h-10 w-10 items-center justify-center rounded-xl transition-colors",c?"bg-green-500/20 text-green-600":"bg-muted text-muted-foreground"),children:s.jsx(r,{className:"h-5 w-5"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold leading-tight text-foreground",children:e.menu_string}),s.jsx("p",{className:"mt-1 font-mono text-xs text-muted-foreground",children:e.route})]})]}),s.jsx("div",{className:"flex items-center gap-3",children:s.jsx(w,{size:"sm",variant:c?"destructive":"default",onClick:()=>(async(e,s)=>{var t,r,a,n;try{const l={isSuspended:s,menuId:e,menuRoleId:m},i=await k.mutateAsync({api:null==(t=y)?void 0:t.addRemoveMenuPermission,data:l});(null==(r=null==i?void 0:i.data)?void 0:r.status)?(d.success((null==(a=null==i?void 0:i.data)?void 0:a.message)||"Permission updated"),M.refetch(),g&&g()):d.error((null==(n=null==i?void 0:i.data)?void 0:n.message)||"Failed to update")}catch(l){d.error(C(l))}})(e.id,!e.is_suspended),disabled:k.isPending,className:N("h-9 gap-2 rounded-xl px-4 shadow-sm transition-all active:scale-95",c?"border-none bg-red-500 text-white hover:bg-red-600":"border-none bg-primary text-white hover:bg-primary/90"),children:k.isPending&&(null==(o=null==(i=k.variables)?void 0:i.data)?void 0:o.menuId)===e.id?s.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white/30 border-t-white"}):c?s.jsxs(s.Fragment,{children:[s.jsx(n,{className:"h-3 w-3"}),"Remove"]}):s.jsxs(s.Fragment,{children:[s.jsx(l,{className:"h-3 w-3"}),"Add"]})})})]},e.id)})})})]})})}function S(){var n,l,v,w;const L=j({}),S=i(),[_]=o(),P=_.get("role_id"),z=_.get("module_id"),A=_.get("module_name")||"Menu Roles",{role_name:F}=(null==(n=c())?void 0:n.state)||{},[$,E]=e.useState(""),[O,B]=e.useState("all"),[D,T]=e.useState(!1),q=e.useRef(null),J=b({api:null==(l=y)?void 0:l.getPermitedMenuList,key:`permittedMenuList-${P}-${z}`,options:{enabled:!!P&&!!z},config:{menuRoleId:Number(P),moduleId:Number(z)}}),K=j({});e.useEffect(()=>{const e=e=>{var s;!e.altKey||"s"!==e.key&&"S"!==e.key||(e.preventDefault(),e.stopPropagation(),null==(s=q.current)||s.focus())};return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)},[]);const Q=(null==(w=null==(v=null==J?void 0:J.data)?void 0:v.data)?void 0:w[A])||[],V=e=>Number(e.menu_role_id)===Number(P)&&!e.is_suspended,W=Q.filter(e=>{var s;return null==(s=null==e?void 0:e.menu_string)?void 0:s.toLowerCase().includes($.toLowerCase())}),X=W.filter(e=>{const s=V(e);return"active"===O?s:"inactive"!==O||!s}),Y=W.filter(e=>V(e)).length,G=W.filter(e=>!V(e)).length;return s.jsxs("div",{className:"flex flex-col gap-6",children:[s.jsx(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:s.jsxs(f,{className:"overflow-hidden rounded-2xl border bg-card shadow-lg",children:[s.jsx("div",{className:"border-b bg-muted/30 p-4",children:s.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 lg:flex-row lg:items-center",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs(k,{variant:"ghost",size:"sm",onClick:()=>S(-1),className:"flex h-10 items-center gap-2 text-muted-foreground transition-all hover:bg-accent hover:text-foreground",children:[s.jsx(m,{className:"h-4 w-4"}),"Back"]}),s.jsx("div",{className:"mx-1 h-6 w-[1px] bg-border"}),s.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-blue-600/10 text-blue-600",children:s.jsx(r,{className:"h-6 w-6"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-bold text-foreground",children:A}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"text-sm text-muted-foreground",children:["Role:"," ",s.jsx("span",{className:"font-semibold text-blue-600",children:F})]}),s.jsxs("div",{className:"inline-block rounded-full bg-blue-600/10 px-3 py-0.5 text-[10px] font-bold uppercase tracking-wider text-blue-600",children:[Q.length," Menus Found"]})]})]})]}),s.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[s.jsxs("div",{className:"flex items-center gap-2 rounded-xl border bg-muted/30 p-1",children:[s.jsxs(k,{variant:"ghost",size:"sm",onClick:()=>B("all"),className:N("h-8 gap-2 rounded-lg px-3 text-xs font-bold transition-all","all"===O?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[s.jsx(u,{className:"h-3 w-3"}),"All (",W.length,")"]}),s.jsxs(k,{variant:"ghost",size:"sm",onClick:()=>B("active"),className:N("h-8 gap-2 rounded-lg px-3 text-xs font-bold transition-all","active"===O?"bg-green-600 text-white shadow-sm hover:bg-green-600":"text-muted-foreground hover:text-foreground"),children:[s.jsx(x,{className:"h-3 w-3"}),"Active (",Y,")"]}),s.jsxs(k,{variant:"ghost",size:"sm",onClick:()=>B("inactive"),className:N("h-8 gap-2 rounded-lg px-3 text-xs font-bold transition-all","inactive"===O?"bg-muted text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[s.jsx(g,{className:"h-3 w-3"}),"Inactive (",G,")"]})]}),s.jsxs("div",{className:"relative flex items-center",children:[s.jsx(t,{className:"absolute left-3 h-4 w-4 text-muted-foreground"}),s.jsx("input",{ref:q,type:"text",placeholder:"Search menu...",value:$,onChange:e=>E(e.target.value),className:"h-10 w-full rounded-xl border border-border bg-background pl-10 pr-20 text-sm outline-none transition-all focus:border-primary focus:ring-2 focus:ring-primary/20 sm:w-64"}),s.jsx("div",{className:"absolute right-2.5 hidden items-center gap-1 sm:flex",children:s.jsxs("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[s.jsx("span",{className:"text-xs",children:"Alt"}),"S"]})})]})]})]})}),s.jsx(p,{className:"p-6",children:J.isLoading?s.jsx("div",{className:"flex h-64 items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx(I,{}),s.jsx("p",{className:"mt-4 text-xs font-medium text-muted-foreground",children:"Loading menus..."})]})}):s.jsx(s.Fragment,{children:0===X.length?s.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[s.jsx("div",{className:"mb-4 flex h-24 w-24 items-center justify-center rounded-full bg-muted/50",children:s.jsx(r,{className:"h-12 w-12 text-muted-foreground/40"})}),s.jsx("h3",{className:"mb-2 text-xl font-bold text-foreground",children:"No menus found"}),s.jsx("p",{className:"max-w-sm text-sm text-muted-foreground",children:$||"all"!==O?"Try adjusting your filters or search criteria":"No menus available for this role yet."})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"3xl:grid-cols-5 grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 2xl:grid-cols-4",children:s.jsx(h,{mode:"popLayout",children:X.map((e,t)=>{const r=V(e);return s.jsx(a.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2,delay:.02*t},children:s.jsx(f,{className:N("group overflow-hidden rounded-xl border transition-all hover:shadow-md",r?"border-green-500/20 bg-green-500/5":"border-border bg-card hover:border-primary/30"),children:s.jsx(p,{className:"p-4",children:s.jsx("div",{className:"flex flex-col gap-3",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:N("flex h-10 w-10 items-center justify-center rounded-lg transition-all",r?"bg-green-500/20 text-green-600":"bg-muted text-muted-foreground group-hover:bg-primary/10 group-hover:text-primary"),children:r?s.jsx(x,{className:"h-5 w-5"}):s.jsx(g,{className:"h-5 w-5"})}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("h4",{className:"line-clamp-1 text-sm font-bold text-foreground",children:e.menu_string}),s.jsx("p",{className:"truncate font-mono text-[10px] text-muted-foreground",title:e.route,children:e.route??"--"})]})]}),s.jsx(M,{checked:r,onCheckedChange:()=>(async e=>{var s,t,r,a;const n=V(e),l=e.id,i=P;try{const e={isSuspended:n,menuId:l,menuRoleId:i},o=await L.mutateAsync({api:null==(s=y)?void 0:s.addRemoveMenuPermission,data:e});(null==(t=null==o?void 0:o.data)?void 0:t.status)?(d.success((null==(r=null==o?void 0:o.data)?void 0:r.message)||"Role status updated successfully"),J.refetch()):d.error((null==(a=null==o?void 0:o.data)?void 0:a.message)||"Failed to update status")}catch(o){d.error(C(o))}})(e),disabled:K.isPending,className:"data-[state=checked]:bg-green-600"})]})})})})},e.id)})})}),s.jsxs("div",{className:"mt-6 flex flex-col gap-2 rounded-xl border bg-muted/20 px-4 py-3 sm:flex-row sm:items-center sm:justify-between",children:[s.jsxs("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:["Showing: ",X.length," of"," ",W.length," Menus"]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500"}),s.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:["Active: ",Y]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"h-2 w-2 rounded-full bg-muted-foreground"}),s.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:["Inactive: ",G]})]})]})]})]})})})]})}),s.jsx(R,{open:D,setOpen:T,menuRoleId:P,moduleId:z,moduleName:A,title:`Manage Menus for ${F}`,refetch:J.refetch})]})}function _(){return s.jsx(v,{title:"Menu Role List",subTitle:"Control all Menu Role here",children:s.jsx(S,{})})}export{_ as default};
