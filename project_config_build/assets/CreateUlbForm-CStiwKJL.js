import{r as e,y as a,j as s,af as i,aB as l,aC as t,ah as r,A as o,z as d}from"./vendor-C4evAtTJ.js";import{c as n,a as c,d as m}from"./yup-CKFt8x4I.js";import{F as u,R as p,B as b}from"./datetime-picker-AUhkjGMU.js";import{d as x}from"./index-D37-tLuj.js";import{g as h}from"./services-Bn_cfjy0.js";import{R as g}from"./RHFSelectField-q8n_xuy6.js";import"./input-DS7_2XCu.js";import"./switch-BA4E8GzC.js";import"./label-CodFY8pR.js";import{u as v,a as j}from"./useCustomQuery-CL1dp-yG.js";import{D as f}from"./index-CGIotfzu.js";import{X as N}from"./icons-DZJSvCRl.js";const y=n().shape({id:c().nullable(),ulbName:c().required("Ulb Name is required"),ulbType:c().required("Ulb Type is required"),incorporationDate:c().nullable(),code:c().nullable(),shortName:c().required("Short Name is required"),email:c().email("Enter a valid email").required("Email is required"),mobileNo:c().matches(/^\d{10}$/,"Mobile number must be exactly 10 digits").required("Mobile number is required"),stateId:m().typeError("State ID must be a number").required("State ID is required"),districtId:m().typeError("District ID must be a number").required("District ID is required"),associationWith:c().nullable(),pincode:c().matches(/^\d{6}$/,"Pincode must be exactly 6 digits").required("Pin Code is required"),address:c().required("Address is required"),document:c().nullable()});function q({open:n,setOpen:c,title:m,edit:q,setEdit:w,editData:D,refetch:I}){var C,_;const U=v({}),[R,S]=e.useState(null),E=a({defaultValues:{id:"",ulbName:"",ulbType:"",incorporationDate:"",code:"",shortName:"",email:"",mobileNo:"",stateId:16,districtId:void 0,associationWith:"",pincode:"",address:""},resolver:o(y)}),{reset:L}=E;e.useEffect(()=>{n&&L(q&&D?{id:(null==D?void 0:D.id)||"",ulbName:(null==D?void 0:D.ulb_name)||"",ulbType:(null==D?void 0:D.ulb_type)||"",incorporationDate:(null==D?void 0:D.incorporation_date)||"",code:(null==D?void 0:D.code)||"",shortName:(null==D?void 0:D.short_name)||"",email:(null==D?void 0:D.email)||"",mobileNo:(null==D?void 0:D.mobile_no)||"",stateId:Number(null==D?void 0:D.state_id)||16,districtId:Number(null==D?void 0:D.district_id)||0,associationWith:(null==D?void 0:D.association_with)||"",pincode:(null==D?void 0:D.pin_code)||"",address:(null==D?void 0:D.address)||""}:{id:"",ulbName:"",ulbType:"",incorporationDate:"",code:"",shortName:"",email:"",mobileNo:"",stateId:16,districtId:void 0,associationWith:"",pincode:"",address:""})},[n,q,D,L]);const A=j({api:x.getDistrictList,config:{stateId:16},options:{enabled:!0}}),M=(null==(_=null==(C=null==A?void 0:A.data)?void 0:C.data)?void 0:_.map(e=>({value:String(e.id),label:e.district_name})))||[],[T,P]=e.useState(""),B=e.useRef(null);e.useEffect(()=>{(null==D?void 0:D.ulb_logo)&&P(D.ulb_logo)},[D,n]);return s.jsx(f,{open:n,setOpen:c,title:m,setEdit:w,edit:q,children:s.jsx("div",{className:"p-1",children:s.jsx(u,{methods:E,onSubmit:E.handleSubmit(async e=>{var a,s,i,l,t,r,o;const n=new FormData;Object.entries(e).forEach(([e,a])=>{"document"!==e&&null!=a&&n.append(e,a)});try{const u=q?null==(a=x)?void 0:a.api_updateUlb:null==(s=x)?void 0:s.api_PostUlb,p=await U.mutateAsync({api:u,data:n});if(null==(i=null==p?void 0:p.data)?void 0:i.status){const a=q?e.id:null==(t=null==(l=null==p?void 0:p.data)?void 0:l.data)?void 0:t.id;if(R&&a){const e=new FormData;e.append("ulbId",a),e.append("logo",R);try{await U.mutateAsync({api:x.api_PostUlblogo,data:e})}catch(m){d.error("ULB saved, but logo upload failed")}}d.success((null==(r=null==p?void 0:p.data)?void 0:r.message)||(q?"ULB Account updated successfully":"ULB Account created successfully")),c(!1),w&&w(!1),I()}else d.error((null==(o=null==p?void 0:p.data)?void 0:o.message)||"Something went wrong")}catch(u){d.error(h(u))}}),children:s.jsxs("div",{className:"flex flex-col gap-6",children:[s.jsx("div",{className:"max-h-[60vh] overflow-y-auto px-3",children:s.jsxs("div",{className:"grid grid-cols-1 gap-8 md:grid-cols-2",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h4",{className:"flex items-center gap-2 border-b pb-2 text-sm font-bold uppercase tracking-wider text-muted-foreground",children:[s.jsx(i,{className:"text-primary"})," Basic Information"]}),s.jsx(p,{label:"Ulb Name",name:"ulbName",placeholder:"e.g. Deoghar Municipal Corporation",isRequired:!0}),s.jsx(g,{label:"Ulb Type",name:"ulbType",data:[{label:"Town Panchayat",value:"Town Panchayat"},{label:"Municipal Council",value:"Municipal Council"},{label:"Municipal Corporation",value:"Municipal Corporation"}],isRequired:!0}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(p,{label:"Short Name",name:"shortName",placeholder:"DMC",isRequired:!0}),s.jsx(p,{label:"Code",name:"code",placeholder:"e.g. DMC001"})]}),s.jsx("div",{className:"grid grid-cols-2 gap-4"}),s.jsx(p,{label:"Establishment Date",name:"incorporationDate",type:"date"}),s.jsxs("div",{className:"flex flex-col gap-1 ",children:[s.jsx("label",{className:"text-sm",htmlFor:"document",children:"Upload Logo"}),s.jsx("input",{name:"document",type:"file",className:"rounded-md bg-secondary px-3 py-1.5 text-sm",onChange:e=>{var a;const s=null==(a=e.target.files)?void 0:a[0];if(s){const e=URL.createObjectURL(s);S(s),P(e)}else(null==D?void 0:D.ulb_logo)&&P(D.ulb_logo)},ref:B})]}),T&&s.jsxs("div",{className:"relative",children:[s.jsx("img",{src:T,alt:"Preview",style:{width:"200px",marginTop:"10px"}}),s.jsx("span",{onClick:()=>{P(""),B.current&&(B.current.value="")},className:"absolute right-10 top-0 flex h-6 w-6 cursor-pointer items-center justify-center rounded-full bg-red-300 transition-all ease-in-out hover:bg-red-400",children:s.jsx(N,{className:"p-0.5 text-gray-600"})})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h4",{className:"flex items-center gap-2 border-b pb-2 text-sm font-bold uppercase tracking-wider text-muted-foreground",children:[s.jsx(l,{className:"text-primary"})," Info"]}),s.jsx("div",{className:"space-y-4",children:s.jsx(p,{label:"Association With",name:"associationWith",placeholder:"State Government"})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h4",{className:"flex items-center gap-2 border-b pb-2 text-sm font-bold uppercase tracking-wider text-muted-foreground",children:[s.jsx(t,{className:"text-primary"})," Contact & Web"]}),s.jsx(p,{label:"Email Address",name:"email",placeholder:"contact@deoghar.gov.in",isRequired:!0}),s.jsx(p,{label:"Mobile No",name:"mobileNo",placeholder:"9876543210",isRequired:!0,maxLength:10,onInput:e=>{e.target.value=e.target.value.replace(/[^0-9]/g,"").slice(0,10)}})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h4",{className:"flex items-center gap-2 border-b pb-2 text-sm font-bold uppercase tracking-wider text-muted-foreground",children:[s.jsx(r,{className:"text-primary"})," Regional Information"]}),s.jsx("div",{className:"grid grid-cols-1 gap-4",children:s.jsx(g,{label:"District",name:"districtId",data:M,isRequired:!0})})]}),s.jsxs("div",{className:"space-y-4 md:col-span-2",children:[s.jsxs("h4",{className:"flex items-center gap-2 border-b pb-2 text-sm font-bold uppercase tracking-wider text-muted-foreground",children:[s.jsx(r,{className:"text-primary"})," Postal Information"]}),s.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[s.jsx("div",{className:"md:col-span-1",children:s.jsx(p,{label:"Pin Code",name:"pincode",placeholder:"e.g. 814112",isRequired:!0,maxLength:6,onInput:e=>{e.target.value=e.target.value.replace(/[^0-9]/g,"").slice(0,6)}})}),s.jsx("div",{className:"md:col-span-2",children:s.jsx(p,{label:"Address",name:"address",placeholder:"Enter full postal address",isRequired:!0})})]})]})]})}),s.jsx("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:s.jsx(b,{isLoading:E.formState.isSubmitting,type:"submit",className:"h-12 rounded-xl bg-primary px-10 text-sm font-bold text-primary-foreground shadow-lg shadow-primary/25 transition-all hover:bg-primary/95 hover:shadow-xl active:scale-[0.98]",children:q?"Update ULB Account":"Create ULB Account"})})]})})})})}export{q as C};
