import{r as e,j as s,at as t,aa as a,a7 as r,a6 as l,W as d,Y as i,J as n,z as o,m as c,a2 as m,a3 as x,a8 as u}from"./vendor-C4evAtTJ.js";import{C as h,a as g,D as f,e as p,f as v,g as j,P as b}from"./card-BEU1s0mS.js";import{B as N,c as w,m as y}from"./index-MUabuSWX.js";import{S as k}from"./Spinner-RAj0UyRT.js";import{u as S,a as C}from"./useCustomQuery-4wOHHCTZ.js";import{g as I}from"./services-Bn_cfjy0.js";import{S as L}from"./switch-mkfBYI89.js";import{T as M,a as _,b as z,c as A}from"./tabs-DMQnWDt5.js";import"./icons-s1CkBPDV.js";import"./ui-BtaoVrnA.js";import"./query-CtA7BnhH.js";import"./axios-Dos3PyFQ.js";import"./zustand-DzHKdda2.js";function B(c){var m,x,u;const[f,p]=e.useState(""),[v,j]=e.useState("all"),b=e.useRef(null),M=S({}),_=C({api:null==(m=y)?void 0:m.getServicesByUlbModule,key:"getServicesByUlbModule",config:{ulbId:null==c?void 0:c.ulbId,moduleId:null==c?void 0:c.moduleId},options:{enabled:!!(null==c?void 0:c.ulbId)&&!!(null==c?void 0:c.moduleId)}});e.useEffect(()=>{const e=e=>{var s;!e.altKey||"s"!==e.key&&"S"!==e.key||(e.preventDefault(),e.stopPropagation(),null==(s=b.current)||s.focus())};return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)},[]);const z=(null==(u=null==(x=null==_?void 0:_.data)?void 0:x.data)?void 0:u.filter(e=>{var s;return null==(s=e.services)?void 0:s.toLowerCase().includes(f.toLowerCase())}))||[],A=z.filter(e=>"active"===v?!0===e.permission_status:"inactive"!==v||!1===e.permission_status),B=z.filter(e=>e.permission_status).length,P=z.filter(e=>!e.permission_status).length;return s.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[s.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-primary/10 text-primary",children:s.jsx(t,{className:"h-5 w-5"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-bold text-foreground",children:"Service Restrictions"}),s.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-widest text-muted-foreground",children:"Manage access to specific services with quick toggle"})]})]}),s.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[s.jsxs("div",{className:"flex items-center gap-2 rounded-xl border bg-muted/30 p-1",children:[s.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>j("all"),className:w("h-8 gap-2 rounded-lg px-3 text-xs font-bold transition-all","all"===v?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[s.jsx(a,{className:"h-3 w-3"}),"All (",z.length,")"]}),s.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>j("active"),className:w("h-8 gap-2 rounded-lg px-3 text-xs font-bold transition-all","active"===v?"bg-primary text-white shadow-sm hover:bg-primary":"text-muted-foreground hover:text-foreground"),children:[s.jsx(r,{className:"h-3 w-3"}),"Restricted (",B,")"]}),s.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>j("inactive"),className:w("h-8 gap-2 rounded-lg px-3 text-xs font-bold transition-all","inactive"===v?"bg-muted text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[s.jsx(l,{className:"h-3 w-3"}),"Allowed (",P,")"]})]}),s.jsxs("div",{className:"relative flex items-center",children:[s.jsx(d,{className:"absolute left-3 h-4 w-4 text-muted-foreground"}),s.jsx("input",{ref:b,type:"text",placeholder:"Search services...",value:f,onChange:e=>p(e.target.value),className:"h-10 w-full rounded-xl border border-border bg-background pl-10 pr-20 text-sm outline-none transition-all focus:border-primary focus:ring-2 focus:ring-primary/20 sm:w-64"}),s.jsx("div",{className:"absolute right-2.5 hidden items-center gap-1 sm:flex",children:s.jsxs("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[s.jsx("span",{className:"text-xs",children:"Alt"}),"S"]})})]})]})]}),_.isLoading?s.jsx("div",{className:"flex h-64 items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx(k,{}),s.jsx("p",{className:"mt-4 text-xs font-medium text-muted-foreground",children:"Loading services..."})]})}):s.jsx(s.Fragment,{children:0===A.length?s.jsx(h,{className:"overflow-hidden rounded-2xl border bg-card shadow-sm",children:s.jsx(g,{className:"p-12",children:s.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[s.jsx("div",{className:"mb-3 flex h-16 w-16 items-center justify-center rounded-full bg-muted/50",children:s.jsx(t,{className:"h-8 w-8 text-muted-foreground/30"})}),s.jsx("h4",{className:"text-sm font-bold text-foreground",children:"No services found"}),s.jsx("p",{className:"text-[11px] text-muted-foreground",children:f||"all"!==v?"Try adjusting your filters or search criteria":"No services available for this module"})]})})}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 2xl:grid-cols-4",children:s.jsx(i,{mode:"popLayout",children:A.map((e,t)=>{const a=e.permission_status;return s.jsx(n.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2,delay:.02*t},children:s.jsx(h,{className:w("group overflow-hidden rounded-xl border transition-all hover:shadow-md",a?"border-primary/20 bg-primary/5":"border-border bg-card hover:border-primary/30"),children:s.jsx(g,{className:"p-4",children:s.jsx("div",{className:"flex flex-col gap-3",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex gap-3 items-center",children:[s.jsx("div",{className:w("flex h-10 w-10 items-center justify-center rounded-lg transition-all",a?"bg-primary/20 text-primary":"bg-muted text-muted-foreground group-hover:bg-primary/10 group-hover:text-primary"),children:a?s.jsx(r,{className:"h-5 w-5"}):s.jsx(l,{className:"h-5 w-5"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"line-clamp-2 text-sm font-bold text-foreground",children:e.services}),s.jsx("p",{className:"mt-1 font-mono text-[10px] text-muted-foreground",children:e.path||"N/A"})]})]}),s.jsx(L,{checked:a,onCheckedChange:s=>(async(e,s)=>{var t,a,r,l;try{const d={ulbId:null==c?void 0:c.ulbId,moduleId:null==c?void 0:c.moduleId,serviceList:[{permissionStatus:s,serviceId:e}]},i=await M.mutateAsync({api:null==(t=y)?void 0:t.addRemoveServiceByUlbModule,data:d});(null==(a=null==i?void 0:i.data)?void 0:a.status)?(o.success((null==(r=null==i?void 0:i.data)?void 0:r.message)||"Permission updated successfully"),_.refetch()):o.error((null==(l=null==i?void 0:i.data)?void 0:l.message)||"Failed to update permission")}catch(d){o.error(I(d))}})(e.id,s),disabled:M.isPending,className:"data-[state=checked]:bg-primary"})]})})})})},e.id)})})}),s.jsxs("div",{className:"flex flex-col gap-2 rounded-xl border bg-muted/20 px-4 py-3 sm:flex-row sm:items-center sm:justify-between",children:[s.jsxs("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:["Showing: ",A.length," of ",z.length," ","Services"]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"h-2 w-2 rounded-full bg-primary"}),s.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:["Restricted: ",B]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"h-2 w-2 rounded-full bg-muted-foreground"}),s.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:["Allowed: ",P]})]})]})]})]})})]})}function P(){var b,P,E;const R=c(),[U]=m(),F=U.get("ulb_id"),T=U.get("ulb_name"),[D,q]=e.useState(""),[K,V]=e.useState("all"),H=e.useRef(null),[J,O]=e.useState(!1),[Q,W]=e.useState(null),[Y,G]=e.useState(""),X=S({}),Z=C({api:null==(b=y)?void 0:b.getModuleByUlbId,key:"permittedModuleListByUlb",config:{ulbId:F},options:{enabled:!!F}});e.useEffect(()=>{const e=e=>{var s;!e.altKey||"s"!==e.key&&"S"!==e.key||(e.preventDefault(),e.stopPropagation(),null==(s=H.current)||s.focus())};return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)},[]);const $=(null==(E=null==(P=null==Z?void 0:Z.data)?void 0:P.data)?void 0:E.filter(e=>{var s;return null==(s=e.module_name)?void 0:s.toLowerCase().includes(D.toLowerCase())}))||[],ee=$.filter(e=>"active"===K?!!e.is_enabled:"inactive"!==K||!e.is_enabled),se=$.filter(e=>e.is_enabled).length,te=$.filter(e=>!e.is_enabled).length;return s.jsxs("div",{children:[s.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:s.jsxs(h,{className:"overflow-hidden rounded-2xl border bg-card shadow-lg",children:[s.jsx("div",{className:"border-b bg-muted/30 p-4",children:s.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 lg:flex-row lg:items-center",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>R(-1),className:"flex items-center gap-2 text-muted-foreground transition-all hover:bg-accent hover:text-foreground",children:[s.jsx(x,{className:"h-4 w-4"}),"Back"]}),s.jsx("div",{className:"mx-1 h-6 w-[1px] bg-border"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-bold text-foreground",children:"Permitted Modules"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"text-sm text-muted-foreground",children:["ULB:"," ",s.jsx("span",{className:"font-semibold text-emerald-600",children:T})]}),s.jsxs("div",{className:"inline-block rounded-full bg-emerald-600/10 px-3 py-0.5 text-[10px] font-bold uppercase tracking-wider text-emerald-600",children:[$.length," Modules"]})]})]})]}),s.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[s.jsxs("div",{className:"flex items-center gap-2 rounded-xl border bg-muted/30 p-1",children:[s.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>V("all"),className:w("h-8 gap-2 rounded-lg px-3 text-xs font-bold transition-all","all"===K?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[s.jsx(a,{className:"h-3 w-3"}),"All (",$.length,")"]}),s.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>V("active"),className:w("h-8 gap-2 rounded-lg px-3 text-xs font-bold transition-all","active"===K?"bg-emerald-600 text-white shadow-sm hover:bg-emerald-600":"text-muted-foreground hover:text-foreground"),children:[s.jsx(r,{className:"h-3 w-3"}),"Active (",se,")"]}),s.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>V("inactive"),className:w("h-8 gap-2 rounded-lg px-3 text-xs font-bold transition-all","inactive"===K?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[s.jsx(l,{className:"h-3 w-3"}),"Inactive (",te,")"]})]}),s.jsxs("div",{className:"relative flex items-center",children:[s.jsx(d,{className:"absolute left-3 h-4 w-4 text-muted-foreground"}),s.jsx("input",{ref:H,type:"text",placeholder:"Search modules...",value:D,onChange:e=>q(e.target.value),className:"h-10 w-full rounded-xl border border-border bg-background pl-10 pr-20 text-sm outline-none transition-all focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20 sm:w-64"}),s.jsx("div",{className:"absolute right-2.5 hidden items-center gap-1 sm:flex",children:s.jsxs("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[s.jsx("span",{className:"text-xs",children:"Alt"}),"S"]})})]})]})]})}),s.jsx(g,{className:"p-6",children:Z.isLoading?s.jsx("div",{className:"flex h-64 items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx(k,{}),s.jsx("p",{className:"mt-4 text-sm font-medium text-muted-foreground",children:"Loading modules..."})]})}):s.jsx(s.Fragment,{children:0===ee.length?s.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[s.jsx("div",{className:"mb-4 flex h-24 w-24 items-center justify-center rounded-full bg-muted/50",children:s.jsx(t,{className:"h-12 w-12 text-muted-foreground/40"})}),s.jsx("h3",{className:"mb-2 text-xl font-bold text-foreground",children:"No modules found"}),s.jsx("p",{className:"max-w-sm text-sm text-muted-foreground",children:D||"all"!==K?"Try adjusting your filters or search criteria":"No modules available for this ULB yet."})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",children:s.jsx(i,{mode:"popLayout",children:ee.map((e,a)=>{const r=!!e.is_enabled;return s.jsx(n.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2,delay:.01*a},children:s.jsxs(h,{className:w("group relative overflow-hidden rounded-xl border transition-all duration-300 hover:shadow-lg",r?"border-emerald-500/20 bg-emerald-500/5 shadow-emerald-500/5":"border-border bg-card"),children:[s.jsx(g,{className:"p-3",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:w("flex h-12 w-12 shrink-0 items-center justify-center rounded-xl transition-all duration-300",r?"bg-emerald-500/20 text-emerald-600 shadow-inner":"bg-muted text-muted-foreground"),children:s.jsx(t,{className:"h-6 w-6"})}),s.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsx("h4",{className:"truncate text-sm font-bold text-foreground",children:null==e?void 0:e.module_name}),s.jsx(L,{checked:r,onCheckedChange:()=>(async e=>{var s,t,a,r;try{const l={ulbId:Number(F),moduleId:e},d=await X.mutateAsync({api:null==(s=y)?void 0:s.toggleModulePermission,data:l});(null==(t=null==d?void 0:d.data)?void 0:t.status)?(o.success((null==(a=null==d?void 0:d.data)?void 0:a.message)||"Permission updated successfully"),Z.refetch()):o.error((null==(r=null==d?void 0:d.data)?void 0:r.message)||"Failed to update permission")}catch(l){o.error(I(l))}})(e.id),disabled:X.isPending,className:"data-[state=checked]:bg-emerald-600"})]}),s.jsxs("div",{className:"mt-1.5 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:w("h-1.5 w-1.5 rounded-full",r?" bg-emerald-500":"bg-muted-foreground/30")}),s.jsx("div",{className:"flex items-center justify-between gap-2",children:s.jsx("span",{className:"text-xs text-muted-foreground",children:(null==e?void 0:e.url)||"N/A"})})]}),r&&s.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>{return W(s=e),G(s.id),void O(!0);var s},className:"h-4 gap-1.5 px-2 text-[10px] font-bold text-emerald-600 transition-colors hover:bg-emerald-500/10",children:[s.jsx(u,{className:"h-3 w-3"}),"SERVICES"]})]})]})]})}),r&&s.jsx("div",{className:"pointer-events-none absolute -right-2 -top-2 opacity-5 transition-transform duration-500 group-hover:scale-110",children:s.jsx(t,{size:60,className:"text-emerald-600"})})]})},e.id)})})}),s.jsxs("div",{className:"mt-6 flex flex-col gap-2 rounded-xl border border-emerald-500/10 bg-emerald-500/5 px-4 py-3 sm:flex-row sm:items-center sm:justify-between",children:[s.jsxs("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:["Showing: ",ee.length," of"," ",$.length," Modules"]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"h-2 w-2 rounded-full bg-emerald-500"}),s.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:["Active: ",se]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-muted-foreground/30"}),s.jsxs("span",{className:"text-xs font-medium text-muted-foreground transition-all",children:["Inactive: ",te]})]})]})]})]})})})]})}),s.jsx(f,{open:J,onOpenChange:O,children:s.jsxs(p,{className:"mx-auto my-auto flex h-[80%] w-[70%] max-w-none flex-col overflow-hidden rounded-none border-gray-600 p-0 shadow-none duration-0",children:[s.jsx(v,{className:"shrink-0 border-b bg-muted/30 px-8 py-4",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>O(!1),className:"flex h-10 items-center gap-2 text-muted-foreground transition-all hover:bg-accent hover:text-foreground",children:[s.jsx(x,{className:"h-4 w-4"}),"Back"]}),s.jsx("div",{className:"mx-1 h-6 w-[1px] bg-border"}),s.jsx("div",{className:"rounded-xl bg-primary/10 p-3 text-primary ring-1 ring-primary/20",children:s.jsx(t,{size:24})}),s.jsxs("div",{children:[s.jsx(j,{className:"text-2xl font-black tracking-tight text-foreground",children:"Service Management"}),s.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[s.jsxs("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:["ULB: ",s.jsx("span",{className:"text-primary",children:T})]}),s.jsx("div",{className:"h-1 w-1 rounded-full bg-muted-foreground/30"}),s.jsxs("span",{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:["Module:"," ",s.jsx("span",{className:"text-primary",children:null==Q?void 0:Q.module_name})]})]})]})]})}),s.jsx("div",{className:"flex-1 overflow-auto px-8 py-6",children:s.jsxs(M,{defaultValue:"restricted",className:"w-full",children:[s.jsx(_,{className:"mb-6 h-12 rounded-xl bg-muted p-1",children:s.jsx(z,{value:"restricted",className:"rounded-lg px-8 py-2 text-xs font-black uppercase tracking-widest data-[state=active]:bg-background data-[state=active]:text-primary data-[state=active]:shadow-sm",children:"Restricted Services"})}),s.jsx(A,{value:"restricted",className:"mt-0 transition-all",children:s.jsx("div",{className:"overflow-hidden rounded-2xl border bg-card shadow-sm",children:s.jsx(B,{ulbId:F,moduleId:Y,viewService:Q})})})]})})]})})]})}function E(){return s.jsx(b,{title:"Permitted Modules",subTitle:"Manage All Permitted Modules Here.",children:s.jsx(P,{})})}export{E as default};
