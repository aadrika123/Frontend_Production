import{r as e,y as s,j as a,A as t,z as l,m as r,a2 as i,J as d,a3 as n,a1 as o,W as c,X as m,Y as u,ai as x,aF as p,am as h,a7 as b,a6 as f,Z as g}from"./vendor-Cw0yupI3.js";import{C as j,a as v,P as N}from"./card-B8oLHT_S.js";import{T as y,a as w,b as A,c as k,d as S,e as C}from"./table-DRFVuCdF.js";import{u as E,a as L}from"./useCustomQuery-B0IS257H.js";import{m as M,B as P,I as F,c as I}from"./index-iXZY_DvU.js";import{g as q}from"./services-Bn_cfjy0.js";import{S as U}from"./Spinner-CTHd9tm9.js";import{c as D,e as V,a as B}from"./yup-CjHziZVU.js";import{F as R,R as z,B as T}from"./datetime-picker-eCa_jalC.js";import"./select-14hZ19Cx.js";import"./input-LWSecp6H.js";import{R as O}from"./RHFUploadFiled-DWEFWjHv.js";import{S as $}from"./switch-BIkVAKvI.js";import"./label-DT6y_ZH-.js";import{D as H}from"./index-DNgxqOXG.js";import{P as _}from"./index-DFrfgrJh.js";import"./icons-DfkRqyLz.js";import"./ui-Cxd06urH.js";import"./query-Dol-AhSL.js";import"./axios-Dos3PyFQ.js";import"./zustand-DjDQVScW.js";const J=D().shape({name:B().required("Full Name is required"),mobile:B().matches(/^\d{10}$/,"Mobile number must be 10 digits").required("Mobile number is required"),altMobile:B().matches(/^\d{10}$/,"Alternate mobile number must be 10 digits").nullable(),email:B().email("Enter a valid email").required("Email is required"),address:B().required("Address is required"),photo:V().nullable()});function K({open:r,setOpen:i,title:d,edit:n,setEdit:o,adminListFun:c,id:m,ulbId:u,adminListData:x}){const p=E({}),h=e.useRef(null),[b,f]=e.useState(null),g=s({defaultValues:{name:"",mobile:"",altMobile:"",email:"",address:"",photo:null},resolver:t(J)}),{reset:j}=g;e.useEffect(()=>{if(r){if(n&&m){const e=null==x?void 0:x.find(e=>e.id==m);e&&(f(e.documentUrl||null),j({name:e.name||"",mobile:e.mobile||"",altMobile:e.alternateMobile||"",email:e.email||"",address:e.address||"",photo:null}))}else f(null),j({name:"",mobile:"",altMobile:"",email:"",address:"",photo:null});g.setValue("photo",""),h.current&&(h.current.value="")}},[r,n,m,x,j]);return a.jsx(H,{open:r,setOpen:i,title:d,setEdit:o,edit:n,children:a.jsx("div",{className:"p-1",children:a.jsx(R,{methods:g,onSubmit:g.handleSubmit(async e=>{var s,a,t,r,d;try{const x=n?null==(s=M)?void 0:s.updateAdmin:null==(a=M)?void 0:a.createAdmin,h=n&&m?{...e,id:m}:{...e,ulbId:u},b=new FormData;b.append("name",h.name),b.append("mobile",h.mobile),b.append("altMobile",h.altMobile),b.append("email",h.email),b.append("address",h.address);const f=g.watch("photo");if(f)b.append("photo",f);else if(!n)return void l.error("User Image is required");n&&m&&b.append("id",m),b.append("ulbId",u||"");const j=await p.mutateAsync({api:x,data:b});(null==(t=null==j?void 0:j.data)?void 0:t.status)?(l.success(null==(r=null==j?void 0:j.data)?void 0:r.message),i(!1),o(!1),c.refetch()):l.error(null==(d=null==j?void 0:j.data)?void 0:d.message)}catch(x){l.error(q(x))}}),children:a.jsxs("div",{className:"flex flex-col gap-6",children:[a.jsxs("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"relative",children:a.jsx(z,{label:"Full Name",name:"name",inputValidation:["CapitalFirstLetter","removeDoubleSpace"],placeholder:"Enter full name"})}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx(z,{label:"Mobile No",name:"mobile",inputValidation:["mobile","number"],placeholder:"Enter mobile"}),a.jsx(z,{label:"Alt Mobile No",name:"altMobile",inputValidation:["mobile","number"],placeholder:"Enter alternate"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx(z,{label:"Email Address",name:"email",inputValidation:["email"],placeholder:"Enter email"}),a.jsx(z,{label:"Physical Address",name:"address",inputValidation:["CapitalFirstLetter","removeDoubleSpace"],placeholder:"Enter permanent address"})]})]}),a.jsxs("div",{className:"rounded-xl border border-dashed border-primary/20 bg-primary/5 p-4",children:[n&&b&&!g.watch("photo")&&a.jsxs("div",{className:"mb-3 flex flex-col items-center gap-2",children:[a.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-muted-foreground",children:"Current Profile Image"}),a.jsx("img",{src:b,alt:"Current profile",className:"h-20 w-20 rounded-lg border-2 border-primary/20 object-cover shadow-sm"})]}),a.jsx(O,{label:n&&b?"Update Profile Image":"User Profile Image",name:"photo"},r?"open":"closed")]}),a.jsx("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:a.jsx(T,{isLoading:g.formState.isSubmitting,type:"submit",className:"h-11 rounded-xl bg-primary px-8 text-sm font-bold text-primary-foreground shadow-lg shadow-primary/20 transition-all hover:shadow-xl active:scale-95",children:n?"Update Admin Account":"Create Admin Account"})})]})})})})}function Q(){var s,t,N,D,V,B,R,z,T,O,H,J,Q,W,X;const Y=r(),[Z]=i(),G=Z.get("ulb_id"),ee=Z.get("ulb_name"),se=e.useRef(null),[ae,te]=e.useState(1),[le,re]=e.useState(10),ie=E({}),[de,ne]=e.useState(!1),[oe,ce]=e.useState(""),[me,ue]=e.useState(!1),[xe,pe]=e.useState("name"),[he,be]=e.useState(""),[fe,ge]=e.useState("");e.useEffect(()=>{const e=setTimeout(()=>{ge(he)},700);return()=>clearTimeout(e)},[he]),e.useEffect(()=>{const e=e=>{var s;!e.altKey||"s"!==e.key&&"S"!==e.key||(e.preventDefault(),e.stopPropagation(),null==(s=se.current)||s.focus())};return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)},[]);const je=L({api:null==(s=M)?void 0:s.adminList,key:"adminListFun",config:{ulbId:G,page:ae,perPage:le,parameter:fe||"",filterBy:xe||""},value:[ae,le,xe,fe],options:{enabled:!!G}});e.useEffect(()=>{fe?(te(1),je.refetch()):je.refetch()},[fe]);return a.jsxs("div",{className:"",children:[a.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:a.jsxs(j,{className:"overflow-hidden rounded-2xl border bg-card shadow-lg",children:[a.jsx("div",{className:"border-b bg-muted/30 p-4",children:a.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 lg:flex-row lg:items-center",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs(P,{variant:"ghost",size:"sm",onClick:()=>Y(-1),className:"flex h-10 items-center gap-2 text-muted-foreground transition-all hover:bg-accent hover:text-foreground",children:[a.jsx(n,{className:"h-4 w-4"}),"Back"]}),a.jsx("div",{className:"mx-1 h-6 w-[1px] bg-border"}),a.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-amber-500/10 text-amber-500",children:a.jsx(o,{className:"h-6 w-6"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold text-foreground",children:ee||"Admin List"}),a.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-blue-600/10 px-3 py-0.5 text-[10px] font-bold uppercase tracking-wider text-blue-600",children:[(null==(N=null==(t=null==je?void 0:je.data)?void 0:t.data)?void 0:N.total)||0," Registered Admins"]})]})]}),a.jsxs("div",{className:"flex w-full flex-wrap items-center gap-3 lg:w-auto",children:[a.jsxs("div",{className:"relative flex flex-1 items-center md:min-w-[350px]",children:[a.jsx(c,{className:"absolute left-3 h-4 w-4 text-muted-foreground"}),a.jsx("input",{ref:se,type:"text",value:he,onChange:e=>{be(e.target.value)},placeholder:`Search admins by ${xe}...`,className:"h-11 w-full rounded-xl border border-border bg-background pl-10 pr-24 text-sm outline-none transition-all focus:border-primary focus:ring-2 focus:ring-primary/20",maxLength:"mobile"==xe?10:void 0}),a.jsxs("div",{className:"absolute right-2.5 flex items-center gap-1.5",children:[a.jsx("div",{className:"hidden items-center gap-1 sm:flex",children:a.jsxs("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[a.jsx("span",{className:"text-xs",children:"Alt"}),"S"]})}),a.jsx("div",{className:"mx-1 h-4 w-[1px] bg-border"}),a.jsxs("select",{value:xe,onChange:e=>{return s=e.target.value,void pe(s);var s},className:"h-8 cursor-pointer rounded-lg border-none bg-transparent px-2 py-0 text-xs font-semibold outline-none transition-all hover:bg-muted/50 focus:ring-0",children:[a.jsx("option",{value:"name",children:"Name"}),a.jsx("option",{value:"email",children:"Email"}),a.jsx("option",{value:"mobile",children:"Mobile"})]})]})]}),a.jsxs(P,{type:"button",onClick:()=>{ce(""),ue(!1),ne(!0)},className:"flex items-center gap-2 bg-primary shadow-md transition-all hover:bg-primary/90 active:scale-95",children:[a.jsx(m,{className:"h-4 w-4"}),"Create Admin"]})]})]})}),a.jsxs(v,{className:"p-0",children:[je.isLoading?a.jsx("div",{className:"flex h-64 items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(U,{}),a.jsx("p",{className:"mt-4 text-sm font-medium text-muted-foreground",children:"Loading admins..."})]})}):a.jsxs("div",{className:"overflow-x-auto",children:[a.jsxs(y,{children:[a.jsx(w,{children:a.jsxs(A,{className:"border-b-2 hover:bg-transparent",children:[a.jsx(k,{className:"w-20 text-center text-xs font-bold uppercase tracking-wider text-foreground/70",children:"#"}),a.jsx(k,{className:"text-xs font-bold uppercase tracking-wider text-foreground/70",children:"Admin Profile"}),a.jsx(k,{className:"text-xs font-bold uppercase tracking-wider text-foreground/70",children:"Contact Details"}),a.jsx(k,{className:"text-center text-xs font-bold uppercase tracking-wider text-foreground/70",children:"Status"}),a.jsx(k,{className:"text-center text-xs font-bold uppercase tracking-wider text-foreground/70",children:"Actions"})]})}),a.jsx(S,{children:a.jsx(u,{children:null==(B=null==(V=null==(D=null==je?void 0:je.data)?void 0:D.data)?void 0:V.data)?void 0:B.map((e,s)=>a.jsxs(d.tr,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"group/row border-b transition-all hover:bg-muted/40",children:[a.jsx(C,{className:"py-4 text-center",children:a.jsx("div",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full text-xs font-bold text-muted-foreground",children:ae*le-le+s+1})}),a.jsx(C,{className:"py-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"relative",children:[a.jsx(F,{src:e.documentUrl,alt:e.name,className:"h-12 w-12 rounded-xl border-2 border-background object-cover shadow-sm"}),a.jsx("div",{className:I("absolute -right-1 -top-1 h-3.5 w-3.5 rounded-full border-2 border-background",e.suspended?"bg-red-500":"bg-green-500")})]}),a.jsxs("div",{children:[a.jsx("p",{className:I("font-bold leading-tight text-foreground",e.suspended&&"text-muted-foreground line-through opacity-60"),children:null==e?void 0:e.name}),a.jsxs("div",{className:"mt-1 flex items-center gap-1.5",children:[a.jsx(x,{className:"h-2.5 w-2.5 text-muted-foreground"}),a.jsx("p",{className:"max-w-[150px] truncate text-[10px] font-semibold uppercase tracking-widest text-muted-foreground",children:(null==e?void 0:e.address)||"No Address"})]})]})]})}),a.jsx(C,{className:"py-4",children:a.jsxs("div",{className:"flex flex-col gap-1.5",children:[a.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-foreground/80",children:[a.jsx("div",{className:"flex h-5 w-5 items-center justify-center rounded-md bg-blue-600/10 text-blue-600",children:a.jsx(p,{className:"h-2.5 w-2.5"})}),null==e?void 0:e.mobile,(null==e?void 0:e.alternateMobile)&&a.jsxs("span",{className:"text-muted-foreground",children:["/ ",e.alternateMobile]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-medium text-muted-foreground",children:[a.jsx("div",{className:"flex h-5 w-5 items-center justify-center rounded-md bg-emerald-600/10 text-emerald-600",children:a.jsx(h,{className:"h-2.5 w-2.5"})}),null==e?void 0:e.email]})]})}),a.jsx(C,{className:"py-4 text-center",children:a.jsxs("div",{className:"flex flex-col items-center gap-2",children:[a.jsx($,{checked:!(null==e?void 0:e.suspended),onCheckedChange:()=>(async(e,s)=>{var a,t,r,i;try{const d={id:e,isSuspended:s},n=await ie.mutateAsync({api:null==(a=M)?void 0:a.enableDisableUserByModule,data:d});(null==(t=null==n?void 0:n.data)?void 0:t.status)?(l.success((null==(r=null==n?void 0:n.data)?void 0:r.message)||"Permission updated successfully"),je.refetch()):l.error((null==(i=null==n?void 0:n.data)?void 0:i.message)||"Failed to update permission")}catch(d){l.error(q(d))}})(e.id,!e.suspended)}),a.jsx("span",{className:I("inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[9px] font-bold uppercase tracking-tighter",e.suspended?"bg-red-500/10 text-red-500":"bg-green-500/10 text-green-500"),children:e.suspended?a.jsxs(a.Fragment,{children:[a.jsx(f,{className:"h-2 w-2"})," ","Suspended"]}):a.jsxs(a.Fragment,{children:[a.jsx(b,{className:"h-2 w-2"})," ","Active"]})})]})}),a.jsx(C,{className:"py-4",children:a.jsx("div",{className:"flex items-center justify-center gap-2",children:a.jsx(P,{variant:"outline",size:"sm",onClick:()=>{ce(null==e?void 0:e.id),ue(!0),ne(!0)},className:"h-9 w-9 border-amber-600/20 bg-amber-600/10 p-0 text-amber-600 transition-all hover:bg-amber-600 hover:text-white",children:a.jsx(g,{className:"h-4 w-4"})})})})]},null==e?void 0:e.id))})})]}),(null==(z=null==(R=null==je?void 0:je.data)?void 0:R.data)?void 0:z.total)>0&&a.jsx("div",{className:"border-t p-4",children:a.jsx(_,{currentPage:ae,totalItems:(null==(O=null==(T=null==je?void 0:je.data)?void 0:T.data)?void 0:O.total)||0,itemsPerPage:le,onPageChange:e=>te(e),onItemsPerPageChange:e=>{re(e),te(1)}})})]}),!je.isLoading&&0===(null==(Q=null==(J=null==(H=null==je?void 0:je.data)?void 0:H.data)?void 0:J.data)?void 0:Q.length)&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[a.jsx("div",{className:"mb-4 flex h-24 w-24 items-center justify-center rounded-full bg-muted/50",children:a.jsx(o,{className:"h-12 w-12 text-muted-foreground/40"})}),a.jsx("h3",{className:"mb-2 text-xl font-bold text-foreground",children:"No admins found"}),a.jsx("p",{className:"max-w-sm text-sm text-muted-foreground",children:he?"Try adjusting your search criteria":"No admins have been registered in this ULB yet."})]})]})]})}),a.jsx(K,{open:de,setOpen:ne,title:me?"Update Admin Account":"Create Admin Account",id:oe,edit:me,setEdit:ue,ulbId:G,adminListFun:je,adminListData:null==(X=null==(W=null==je?void 0:je.data)?void 0:W.data)?void 0:X.data})]})}function W(){return a.jsx(N,{title:"Manage All Admins Here.",children:a.jsx(Q,{})})}export{W as default};
