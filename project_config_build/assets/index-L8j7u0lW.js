import{r as e,y as s,j as a,A as t,z as l,m as r,a2 as i,J as d,a3 as n,I as o,W as c,X as m,Y as u,ah as x,aD as p,ak as h,aE as b,aF as f,a7 as g,a6 as v,Z as j,a8 as N,a1 as y}from"./vendor-C4evAtTJ.js";import{C as w,a as k,D as E,e as S,f as L,g as U,P as T}from"./card-68wBKmAV.js";import{T as I,a as R,b as P,c as C,d as A,e as M}from"./table-DK_Mvcev.js";import{u as F,a as D}from"./useCustomQuery-CL1dp-yG.js";import{m as B,B as O,c as q,I as _}from"./index-D37-tLuj.js";import{g as W}from"./services-Bn_cfjy0.js";import{S as V}from"./Spinner-C3mtCeb5.js";import{c as z,e as H,a as $}from"./yup-CKFt8x4I.js";import{B as K,F as J,H as Q,J as X}from"./ui-BtaoVrnA.js";import{P as Y,a as Z,b as G}from"./PermittedWorkflowList-DL1186GW.js";import{F as ee,R as se,B as ae}from"./datetime-picker-AUhkjGMU.js";import{R as te}from"./RHFSelectField-q8n_xuy6.js";import"./input-DS7_2XCu.js";import{R as le}from"./RHFUploadFiled-BM-taj2q.js";import{S as re}from"./switch-BA4E8GzC.js";import"./label-CodFY8pR.js";import{D as ie}from"./index-CGIotfzu.js";import{P as de}from"./index-BRLx9BUC.js";import"./icons-DZJSvCRl.js";import"./query-CtA7BnhH.js";import"./axios-Dos3PyFQ.js";import"./zustand-DzHKdda2.js";import"./select-ARkI9mnT.js";const ne=z().shape({userType:$().required("User Type is required"),name:$().required("Full Name is required"),mobile:$().matches(/^\d{10}$/,"Mobile number must be 10 digits").required("Mobile number is required"),altMobile:$().matches(/^\d{10}$/,"Alternate mobile number must be 10 digits").nullable(),email:$().email("Enter a valid email").required("Email is required"),address:$().required("Address is required"),photo:H().nullable()});function oe({open:r,setOpen:i,title:d,edit:n,setEdit:o,adminListFun:c,id:m,ulbId:u,userListByUlbId:x}){var p,h;const b=F({}),f=e.useRef(null),[g,v]=e.useState(null),j=s({defaultValues:{userType:"",name:"",mobile:"",altMobile:"",email:"",address:"",photo:null},resolver:t(ne)}),{reset:N}=j;e.useEffect(()=>{var e,s,a;if(r){if(n&&m){const t=null==(a=null==(s=null==(e=null==x?void 0:x.data)?void 0:e.data)?void 0:s.data)?void 0:a.find(e=>e.id==m);t&&(v(t.documentUrl||null),N({userType:t.user_type||"",name:t.name||"",mobile:t.mobile||"",altMobile:t.alternateMobile||"",email:t.email||"",address:t.address||"",photo:null}))}else v(null),N({userType:"",name:"",mobile:"",altMobile:"",email:"",address:"",photo:null});j.setValue("photo",""),f.current&&(f.current.value="")}},[r,n,m,c,N]);const y=D({api:null==(p=B)?void 0:p.createUserType,key:"createUserTypeList",options:{enabled:!0}});return a.jsx(ie,{open:r,setOpen:i,title:d,setEdit:o,edit:n,children:a.jsx("div",{className:"p-1",children:a.jsx(ee,{methods:j,onSubmit:j.handleSubmit(async e=>{var s,a,t,r,d;try{const c=n?null==(s=B)?void 0:s.updateAdmin:null==(a=B)?void 0:a.createAdmin,p=n&&m?{...e,id:m}:{...e,ulbId:u},h=new FormData;h.append("name",p.name),h.append("mobile",p.mobile),h.append("altMobile",p.altMobile),h.append("email",p.email),h.append("address",p.address),h.append("userType",p.userType);const f=j.watch("photo");if(f)h.append("photo",f);else if(!n)return void l.error("User Image is required");n&&m&&h.append("id",m),h.append("ulbId",u||"");const g=await b.mutateAsync({api:c,data:h});(null==(t=null==g?void 0:g.data)?void 0:t.status)?(l.success(null==(r=null==g?void 0:g.data)?void 0:r.message),i(!1),o(!1),x.refetch()):l.error(null==(d=null==g?void 0:g.data)?void 0:d.message)}catch(c){l.error(W(c))}}),children:a.jsxs("div",{className:"flex flex-col gap-6",children:[a.jsxs("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"relative",children:a.jsx(te,{label:"User Type",name:"userType",data:(null==(h=null==y?void 0:y.data)?void 0:h.data.map(e=>({value:String(e),label:String(e)})))||[]})}),a.jsx("div",{className:"relative",children:a.jsx(se,{label:"Full Name",name:"name",inputValidation:["CapitalFirstLetter","removeDoubleSpace"],placeholder:"Enter full name"})}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx(se,{label:"Mobile No",name:"mobile",inputValidation:["mobile","number"],placeholder:"Enter mobile"}),a.jsx(se,{label:"Alt Mobile No",name:"altMobile",inputValidation:["mobile","number"],placeholder:"Enter alternate"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx(se,{label:"Email Address",name:"email",inputValidation:["email"],placeholder:"Enter email"}),a.jsx(se,{label:"Physical Address",name:"address",inputValidation:["CapitalFirstLetter","removeDoubleSpace"],placeholder:"Enter permanent address"}),a.jsxs("div",{className:"rounded-xl border border-dashed border-primary/20 bg-primary/5 p-4",children:[n&&g&&!j.watch("photo")&&a.jsxs("div",{className:"mb-3 flex flex-col items-center gap-2",children:[a.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-muted-foreground",children:"Current Profile Image"}),a.jsx("img",{src:g,alt:"Current profile",className:"h-20 w-20 rounded-lg border-2 border-primary/20 object-cover shadow-sm"})]}),a.jsx(le,{label:n&&g?"Update Profile Image":"User Profile Image",name:"photo"},r?"open":"closed")]})]})]}),a.jsx("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:a.jsx(ae,{isLoading:j.formState.isSubmitting,type:"submit",className:"h-11 rounded-xl bg-primary px-8 text-sm font-bold text-primary-foreground shadow-lg shadow-primary/20 transition-all hover:shadow-xl active:scale-95",children:n?"Update User Account":"Create User Account"})})]})})})})}function ce(){var s,t,T,z,H,$,ee,se,ae,te,le;const ie=r(),[ne]=i(),ce=ne.get("ulb_id"),me=ne.get("ulb_name"),ue=e.useRef(null),[xe,pe]=e.useState(1),[he,be]=e.useState(10),fe=F({}),[ge,ve]=e.useState(!1),[je,Ne]=e.useState(""),[ye,we]=e.useState(!1),[ke,Ee]=e.useState(!1),[Se,Le]=e.useState(!1),[Ue,Te]=e.useState("name"),[Ie,Re]=e.useState(""),[Pe,Ce]=e.useState("");e.useEffect(()=>{const e=setTimeout(()=>{Ce(Ie)},700);return()=>clearTimeout(e)},[Ie]),e.useEffect(()=>{const e=e=>{var s;!e.altKey||"s"!==e.key&&"S"!==e.key||(e.preventDefault(),e.stopPropagation(),null==(s=ue.current)||s.focus())};return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)},[]);const Ae=D({api:null==(s=B)?void 0:s.userListByULBId,key:"userListByUlbId",config:{ulbId:ce,page:xe,perPage:he,searchQuery:Pe,[Ue]:Pe},value:[xe,he,Ue,Pe],options:{enabled:!0}});e.useEffect(()=>{Pe?(pe(1),Ae.refetch()):Ae.refetch()},[Pe]);return a.jsxs("div",{className:"",children:[a.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:a.jsxs(w,{className:"overflow-hidden rounded-2xl border bg-card shadow-lg",children:[a.jsx("div",{className:"border-b bg-muted/30 p-4",children:a.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 lg:flex-row lg:items-center",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>ie(-1),className:"flex h-10 items-center gap-2 text-muted-foreground transition-all hover:bg-accent hover:text-foreground",children:[a.jsx(n,{className:"h-4 w-4"}),"Back"]}),a.jsx("div",{className:"mx-1 h-6 w-[1px] bg-border"}),a.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-amber-500/10 text-amber-500",children:a.jsx(o,{className:"h-6 w-6"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold text-foreground",children:me}),a.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-blue-600/10 px-3 py-0.5 text-[10px] font-bold uppercase tracking-wider text-blue-600",children:[(null==(T=null==(t=null==Ae?void 0:Ae.data)?void 0:t.data)?void 0:T.total)||0," Registered Users"]})]})]}),a.jsxs("div",{className:"flex w-full flex-wrap items-center gap-3 lg:w-auto",children:[a.jsxs("div",{className:"relative flex flex-1 items-center md:min-w-[350px]",children:[a.jsx(c,{className:"absolute left-3 h-4 w-4 text-muted-foreground"}),a.jsx("input",{ref:ue,type:"text",value:Ie,onChange:e=>{Re(e.target.value)},placeholder:"Search users...",className:"h-11 w-full rounded-xl border border-border bg-background pl-10 pr-24 text-sm outline-none transition-all focus:border-primary focus:ring-2 focus:ring-primary/20",maxLength:"mobile"==Ue?10:void 0}),a.jsxs("div",{className:"absolute right-2.5 flex items-center gap-1.5",children:[a.jsx("div",{className:"hidden items-center gap-1 sm:flex",children:a.jsxs("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[a.jsx("span",{className:"text-xs",children:"Alt"}),"S"]})}),a.jsx("div",{className:"mx-1 h-4 w-[1px] bg-border"}),a.jsxs("select",{value:Ue,onChange:e=>{return s=e.target.value,void Te(s);var s},className:"h-8 cursor-pointer rounded-lg border-none bg-transparent px-2 py-0 text-xs font-semibold outline-none transition-all hover:bg-muted/50 focus:ring-0",children:[a.jsx("option",{value:"name",children:"Name"}),a.jsx("option",{value:"email",children:"Email"}),a.jsx("option",{value:"mobile",children:"Mobile"})]})]})]}),a.jsxs(O,{type:"button",onClick:()=>{Ne(""),we(!1),ve(!0)},className:"flex items-center gap-2 bg-primary shadow-md transition-all hover:bg-primary/90 active:scale-95",children:[a.jsx(m,{className:"h-4 w-4"}),"Create User"]})]})]})}),a.jsxs(k,{className:"p-0",children:[Ae.isLoading?a.jsx("div",{className:"flex h-64 items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(V,{}),a.jsx("p",{className:"mt-4 text-sm font-medium text-muted-foreground",children:"Loading users..."})]})}):a.jsxs("div",{className:"overflow-x-auto",children:[a.jsxs(I,{children:[a.jsx(R,{children:a.jsxs(P,{className:"border-b-2 hover:bg-transparent",children:[a.jsx(C,{className:"w-20 text-center text-xs font-bold uppercase tracking-wider text-foreground/70",children:"#"}),a.jsx(C,{className:"text-xs font-bold uppercase tracking-wider text-foreground/70",children:"User Profile"}),a.jsx(C,{className:"text-xs font-bold uppercase tracking-wider text-foreground/70",children:"Contact Details"}),a.jsx(C,{className:"text-xs font-bold uppercase tracking-wider text-foreground/70",children:"User Type"}),a.jsx(C,{className:"text-center text-xs font-bold uppercase tracking-wider text-foreground/70",children:"Access Status"}),a.jsx(C,{className:"text-center text-xs font-bold uppercase tracking-wider text-foreground/70",children:"Actions"})]})}),a.jsx(A,{children:a.jsx(u,{mode:"popLayout",children:null==($=null==(H=null==(z=null==Ae?void 0:Ae.data)?void 0:z.data)?void 0:H.data)?void 0:$.map((e,s)=>a.jsxs(d.tr,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.98},transition:{duration:.2,delay:.02*s},className:q("group/row border-b transition-all duration-300",e.suspended?"bg-red-500/[0.01] opacity-80 hover:bg-red-500/[0.04]":"bg-emerald-500/[0.01] hover:bg-emerald-500/[0.04]"),children:[a.jsx(M,{className:"py-4 text-center",children:a.jsx("div",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full text-xs font-bold text-muted-foreground",children:xe*he-he+s+1})}),a.jsx(M,{className:"py-4",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"relative shrink-0",children:[a.jsx("div",{className:q("absolute -inset-1 rounded-2xl opacity-0 blur-sm transition-opacity duration-300 group-hover/row:opacity-100",e.suspended?"bg-red-500/20":"bg-emerald-500/20")}),a.jsx(_,{src:e.documentUrl,alt:e.name,className:"relative h-14 w-14 rounded-2xl border-2 border-background object-cover shadow-md ring-1 ring-border"}),a.jsx("div",{className:q("absolute -right-1 -top-1 h-3.5 w-3.5 rounded-full border-2 border-background shadow-sm",e.suspended?"bg-red-500":"bg-emerald-500")})]}),a.jsxs("div",{className:"flex min-w-0 flex-col",children:[a.jsx("p",{className:q("text-[15px] font-black leading-tight tracking-tight text-foreground",e.suspended&&"text-muted-foreground line-through opacity-60"),children:null==e?void 0:e.name}),a.jsxs("div",{className:"mt-1 flex items-center gap-1.5",children:[a.jsx(x,{className:"h-2.5 w-2.5 text-muted-foreground/60"}),a.jsx("p",{className:"max-w-[150px] truncate text-[10px] font-bold uppercase tracking-widest text-muted-foreground/60",children:(null==e?void 0:e.address)||"No Address Recorded"})]})]})]})}),a.jsx(M,{className:"py-4",children:a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs("div",{className:"flex items-center gap-2.5 text-xs font-black text-foreground/80",children:[a.jsx("div",{className:"flex h-6 w-6 shrink-0 items-center justify-center rounded-lg bg-blue-500/10 text-blue-600 shadow-sm",children:a.jsx(p,{className:"h-2.5 w-2.5"})}),null==e?void 0:e.mobile]}),a.jsxs("div",{className:"group/email flex items-center gap-2.5 text-[11px] font-bold text-muted-foreground",children:[a.jsx("div",{className:"flex h-6 w-6 shrink-0 items-center justify-center rounded-lg bg-emerald-500/10 text-emerald-600 shadow-sm",children:a.jsx(h,{className:"h-2.5 w-2.5"})}),a.jsx("span",{className:"truncate",children:null==e?void 0:e.email}),a.jsx("button",{type:"button",onClick:()=>{navigator.clipboard.writeText(null==e?void 0:e.email),l.success("Email copied to clipboard")},className:"opacity-0 transition-all hover:scale-110 hover:text-emerald-600 group-hover/email:opacity-100",title:"Copy Email",children:a.jsx(b,{className:"h-3.5 w-3.5"})})]})]})}),a.jsx(M,{className:"py-4",children:a.jsxs("div",{className:"inline-flex items-center gap-2 rounded-xl border border-violet-500/10 bg-violet-500/5 px-3 py-1.5 text-[10px] font-black uppercase tracking-widest text-violet-600 shadow-sm",children:[a.jsx(f,{className:"h-3.5 w-3.5"}),null==e?void 0:e.user_type]})}),a.jsx(M,{className:"py-4 text-center",children:a.jsxs("div",{className:"flex flex-col items-center gap-2",children:[a.jsx(re,{checked:!(null==e?void 0:e.suspended),onCheckedChange:()=>(async(e,s)=>{var a,t,r,i;try{const d={id:e,isSuspended:s},n=await fe.mutateAsync({api:null==(a=B)?void 0:a.enableDisableUserByModule,data:d});(null==(t=null==n?void 0:n.data)?void 0:t.status)?(l.success((null==(r=null==n?void 0:n.data)?void 0:r.message)||"Permission updated successfully"),Ae.refetch()):l.error((null==(i=null==n?void 0:n.data)?void 0:i.message)||"Failed to update permission")}catch(d){l.error(W(d))}})(e.id,!e.suspended),className:"data-[state=checked]:bg-emerald-600"}),a.jsx("div",{className:q("inline-flex items-center gap-1.5 rounded-full border px-2.5 py-0.5 shadow-sm transition-all duration-300",e.suspended?"border-red-500/20 bg-red-500/10 text-red-500":"border-emerald-500/20 bg-emerald-500/10 text-emerald-600"),children:e.suspended?a.jsxs(a.Fragment,{children:[a.jsx(v,{className:"h-2.5 w-2.5"}),a.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Suspended"})]}):a.jsxs(a.Fragment,{children:[a.jsx(g,{className:"h-2.5 w-2.5 animate-pulse"}),a.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Active"})]})})]})}),a.jsx(M,{className:"py-4",children:a.jsxs("div",{className:"flex items-center justify-center gap-3",children:[a.jsx(O,{variant:"outline",size:"sm",onClick:()=>{Ne(null==e?void 0:e.id),we(!0),ve(!0)},className:"h-10 w-10 border-amber-500/20 bg-amber-500/5 p-0 text-amber-600 transition-all hover:bg-amber-600 hover:text-white hover:shadow-lg hover:shadow-amber-500/20",children:a.jsx(j,{className:"h-4 w-4"})}),a.jsxs(O,{variant:"outline",size:"sm",onClick:()=>{ie(`/project-config/dashboard/ulb-list/user-list/permission?ulb_id=${ce}&ulb_name=${me}`,{state:{item:e}})},className:"flex h-10 items-center gap-2 border-blue-500/20 bg-blue-500/5 px-4 text-blue-600 transition-all hover:bg-blue-600 hover:text-white hover:shadow-lg hover:shadow-blue-500/20",children:[a.jsx(N,{className:"h-4 w-4"}),a.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Permissions"})]})]})})]},null==e?void 0:e.id))})})]}),a.jsx("div",{className:"border-t p-4",children:a.jsx(de,{currentPage:xe,totalItems:(null==(se=null==(ee=null==Ae?void 0:Ae.data)?void 0:ee.data)?void 0:se.total)||0,itemsPerPage:he,onPageChange:e=>pe(e),onItemsPerPageChange:e=>{be(e),pe(1)}})})]}),!Ae.isLoading&&0===(null==(le=null==(te=null==(ae=null==Ae?void 0:Ae.data)?void 0:ae.data)?void 0:te.data)?void 0:le.length)&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[a.jsx("div",{className:"mb-4 flex h-24 w-24 items-center justify-center rounded-full bg-muted/50",children:a.jsx(o,{className:"h-12 w-12 text-muted-foreground/40"})}),a.jsx("h3",{className:"mb-2 text-xl font-bold text-foreground",children:"No users found"}),a.jsx("p",{className:"max-w-sm text-sm text-muted-foreground",children:Ie?"Try adjusting your search criteria":"No users have been registered in this ULB yet."})]})]})]})}),a.jsx(E,{open:Se,onOpenChange:Le,children:a.jsxs(S,{className:"flex h-[90vh] max-h-[90vh] max-w-[1200px] flex-col overflow-hidden border-none p-0 shadow-2xl",children:[a.jsx(L,{className:"border-b bg-muted/30 px-8 py-6",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-blue-600/10 text-blue-600",children:a.jsx(y,{className:"h-6 w-6"})}),a.jsxs("div",{children:[a.jsx(U,{className:"text-2xl font-bold text-foreground",children:"User Access Control"}),a.jsxs("p",{className:"text-sm font-medium text-muted-foreground",children:["Configuring permissions for"," ",a.jsx("span",{className:"font-bold text-blue-600",children:null==ke?void 0:ke.name})]})]})]})}),a.jsx("div",{className:"flex flex-1 flex-col overflow-hidden bg-background p-6",children:a.jsxs(K,{defaultValue:"ROLELIST",className:"flex flex-1 flex-col overflow-hidden",children:[a.jsx("div",{className:"mb-6 flex justify-center",children:a.jsxs(J,{className:"inline-flex h-11 items-center justify-center rounded-xl bg-muted p-1",children:[a.jsx(Q,{className:"inline-flex items-center justify-center whitespace-nowrap rounded-lg px-6 py-2 text-sm font-bold transition-all data-[state=active]:bg-background data-[state=active]:text-primary data-[state=active]:shadow-sm",value:"ROLELIST",children:"Permitted Roles"}),a.jsx(Q,{className:"inline-flex items-center justify-center whitespace-nowrap rounded-lg px-6 py-2 text-sm font-bold transition-all data-[state=active]:bg-background data-[state=active]:text-primary data-[state=active]:shadow-sm",value:"PERMITTED_WARDS",children:"Permitted Wards"}),a.jsx(Q,{className:"inline-flex items-center justify-center whitespace-nowrap rounded-lg px-6 py-2 text-sm font-bold transition-all data-[state=active]:bg-background data-[state=active]:text-primary data-[state=active]:shadow-sm",value:"PERMITTED_WORKFLOW_ROLE",children:"Workflow Roles"})]})}),a.jsxs("div",{className:"custom-scrollbar flex-1 overflow-y-auto pr-2",children:[a.jsx(X,{value:"ROLELIST",className:"m-0 focus-visible:outline-none",children:a.jsx(Y,{selectedULB:ke,id:je})}),a.jsx(X,{value:"PERMITTED_WARDS",className:"m-0 focus-visible:outline-none",children:a.jsx(Z,{selectedULB:ke,id:je})}),a.jsx(X,{value:"PERMITTED_WORKFLOW_ROLE",className:"m-0 focus-visible:outline-none",children:a.jsx(G,{selectedULB:ke,id:je})})]})]})})]})}),a.jsx(oe,{open:ge,setOpen:ve,title:ye?"Update User Account":"Register New User",id:je,edit:ye,setEdit:we,ulbId:ce,userListByUlbId:Ae})]})}function me(){return a.jsx(T,{title:"Manage All Users Here.",children:a.jsx(ce,{})})}z().shape({ulbId:$(),moduleId:$(),complaintRefNo:$()});export{me as default};
