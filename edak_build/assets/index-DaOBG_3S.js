import{J as K,k as Q,d as O,o as X,j as e,F as Z,C as ee,K as ae,B as se,e as re,f as ne,n as Y,i as S,_ as b,r,w as U,a0 as le,a1 as te,a2 as oe,x as ce,y as de,z as ie,A as xe,G as he,O as me,N as v,a3 as ue,M as je}from"./index-X8Jed7md.js";import{P as pe}from"./index-Cy_U-8FL.js";import{T as ge,a as fe,b as E,c as o,d as Ne,e as c}from"./table-ef4MjCgB.js";import{P as be}from"./index-CzxWg9XN.js";import{S as ve}from"./index-B5iYydcl.js";import{g as Se}from"./services-KQnp_8oA.js";import"./badge-RJ0OQ2B2.js";import"./index-D0fJI6gO.js";import"./circle-check-big-DRfU2PMj.js";import"./pagination-1_mcwOxu.js";const we=re().shape({comment:ne()});function ye({currentWorkflowId:n,currentWorkflowName:l}){const m=new URLSearchParams(Y().search).get("complaintId"),u=K({}),j=Q(),d=O({resolver:X(we)});console.log("complaintId=====>",m);const p=async i=>{let g={complaintId:m,workflowId:n,userId:null,comment:i==null?void 0:i.comment};try{const t=await u.mutateAsync({api:S.transferComplaintToUlb,data:g});t.data.success?(b.success(t.data.message),j("/e-dak/dashboard/complaint-workflow")):b.error(t.data.message)}catch(t){b.error(Se(t))}};return e.jsx(Z,{methods:d,onSubmit:d.handleSubmit(p),children:e.jsxs("div",{className:"gap-x-2 gap-y-4 px-10 py-10",children:[e.jsxs("div",{children:[e.jsxs(ee,{className:"text-2xl font-bold",children:["Transfer Complaint to ",e.jsx("span",{className:"text-amber-600",children:l})," Workflow"]}),e.jsx(ae,{className:"mt-6 bg-background w-full rounded-md p-4 h-40 border",name:"comment",placeholder:"Comment"})]}),e.jsx("div",{className:"mt-4",children:e.jsx(se,{isLoading:d.formState.isSubmitting,type:"submit",className:" w-full",children:"Transfer"})})]})})}function ke(n){var C,P,T,I,$,W,A,L,M,R,F;const[l,w]=r.useState(1),[h,m]=r.useState(100),[u,j]=r.useState(""),[d,p]=r.useState(""),[i,g]=r.useState(""),[t,D]=r.useState(!1),x=new URLSearchParams(Y().search),y=Q(),f=x.get("parentId"),V=x.get("levelSerial"),z=x.get("parentName"),k=x.get("complaintId"),G=x.get("complaintRefNo"),N=U({api:`${S.checkWfActions}/${k}`,key:"actionPermission",options:{enabled:!0}}),s=U({api:`${S.getUlbSpecificWorkFlow}?page=${l}&limit=${h}&q=${u}&parentId=${f}&levelSerial=${V}`,key:"getAllWorkFlow",value:[l,h,f],options:{enabled:!0}});return r.useEffect(()=>{n==null||n.settitle(z)},[f]),e.jsx(e.Fragment,{children:e.jsxs(le,{children:[e.jsx(te,{}),e.jsx(oe,{className:"sm:max-w-[425px]",children:e.jsx("div",{className:"py-4",children:t&&e.jsx(ye,{currentWorkflowId:d,currentWorkflowName:i,complaintRefNo:G})})}),e.jsx("main",{className:"grid items-start",children:e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(ve,{search:u,setSearch:j,refetch:s.refetch,isFetching:s.isLoading})}),e.jsx("div",{})]}),e.jsxs(ce,{children:[e.jsx(de,{className:"px-7",children:e.jsxs(ie,{children:["Work Flow Role List (",(P=(C=s.data)==null?void 0:C.data)==null?void 0:P.totalDocs,")"]})}),e.jsx(xe,{children:s.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(he,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(ge,{children:[e.jsx(fe,{children:e.jsxs(E,{children:[e.jsx(o,{className:"",children:"#"}),e.jsx(o,{className:"",children:"Work Flow Name"}),e.jsx(o,{className:"",children:"Ulb Name"}),e.jsx(o,{className:"",children:"Module Name"}),e.jsx(o,{className:"",children:"Level Serial"}),e.jsx(o,{className:"",children:"Created at"}),e.jsx(o,{children:"Action"})]})}),e.jsx(Ne,{children:($=(I=(T=s==null?void 0:s.data)==null?void 0:T.data)==null?void 0:I.docs)==null?void 0:$.map((a,J)=>{var B,H,_,q;return e.jsxs(E,{children:[e.jsx(c,{children:J+1}),e.jsx(c,{children:a==null?void 0:a.workFlowName}),e.jsx(c,{children:(B=a==null?void 0:a.ulb)==null?void 0:B.ulbName}),e.jsx(c,{children:(H=a==null?void 0:a.module)==null?void 0:H.moduleName}),e.jsx(c,{children:a==null?void 0:a.levelSerial}),e.jsx(c,{children:me(a.createdAt).format("DD-MM-YYYY")}),e.jsxs(c,{className:"space-x-2",children:[e.jsx(v,{variant:"secondary",onClick:()=>{y(`/grievance/dashboard/members-details?parentId=${a==null?void 0:a._id}`)},children:"Members"}),((q=(_=N==null?void 0:N.data)==null?void 0:_.permission)==null?void 0:q.canViewChildWorkflow)&&e.jsx(v,{variant:"secondary",className:"md:ml-5",onClick:()=>{y(`/grievance/dashboard/transfer-complaint?parentId=${a==null?void 0:a._id}&levelSerial=${(a==null?void 0:a.levelSerial)+1}&complaintId=${k}&parentName=${a==null?void 0:a.workFlowName}`)},children:"View"}),e.jsx(ue,{onClick:()=>{p(a==null?void 0:a._id),g(a==null?void 0:a.workFlowName),D(!0)},asChild:!0,children:e.jsx(v,{name:"bts",type:"button",className:"mr-4",children:"Transfer"})})]})]},a._id)})})]}),e.jsx(je,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(be,{page:l,perPage:h,totalPage:(A=(W=s==null?void 0:s.data)==null?void 0:W.data)==null?void 0:A.totalDocs,hasNextPage:(M=(L=s==null?void 0:s.data)==null?void 0:L.data)==null?void 0:M.hasNextPage,hasPrevPage:(F=(R=s==null?void 0:s.data)==null?void 0:R.data)==null?void 0:F.hasPrevPage,setPage:w,setPerPage:m})})]})})]})]})})]})})}function Be(){const[n,l]=r.useState("Workflow Master List");return e.jsx(pe,{title:n||"Select Workflow to Transfer",subTitle:"Choose workflow from below list",children:e.jsx("div",{className:"",children:e.jsx(ke,{settitle:l})})})}export{Be as default};
