import{U as Pe,u as Ae,r as l,d as oe,o as ie,w as V,j as e,F as he,x as me,y as ue,z as xe,A as pe,G as je,O as fe,V as Re,M as J,e as ge,f as I,n as be,i as N,_ as j,J as ye,D as $e,P as Fe,B as Ie,N as D,W as We}from"./index-X8Jed7md.js";import{P as Ue}from"./index-Cy_U-8FL.js";import{T as Ne,a as Me,b as O,c as h,d as we,e as m}from"./table-ef4MjCgB.js";import{g as de}from"./services-KQnp_8oA.js";import{P as ke}from"./index-CzxWg9XN.js";import{S as ve}from"./index-B5iYydcl.js";import{D as qe}from"./index-C8Uqq5Jc.js";import{C as Se}from"./index-D0fJI6gO.js";import{q as Ce}from"./switch-BV3074KS.js";import"./badge-RJ0OQ2B2.js";import"./pagination-1_mcwOxu.js";import"./circle-check-big-DRfU2PMj.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=Pe("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),_e=ge().shape({ulbId:I().required("ulb is required"),moduleId:I().required("Module  is required"),workFlowName:I().required("workFlow Name is required"),parentId:I().notRequired(),levelSerial:I().notRequired()});function Be({open:f,setOpen:u,title:R,edit:v,setEdit:W,refetch:M}){var d,r,o,z,G,L,_,B,T,E,Y;const $=Ae({}),[w,S]=l.useState(1),[c,x]=l.useState(10),[F,U]=l.useState("");let g=new URLSearchParams(be().search).get("parentId");const b=oe({resolver:ie(_e)}),n=async()=>{},s=V({api:`${N.getAllUser}?page=${w}&limit=${c}&q=${F}`,key:"getAllUserData",value:[w,c],options:{enabled:!0}}),C=p=>{Se("Are you sure ?","Please confirm",async()=>{var H,Q;const y=await $.mutateAsync({api:N.createWFUserMapping,data:{workflowId:g,userId:p}});(H=y.data)!=null&&H.success?(M(),j.success((Q=y==null?void 0:y.data)==null?void 0:Q.message)):j.error("workflow user not created successfully")}),u(!1)};return e.jsx(qe,{open:f,setOpen:u,title:R,setEdit:W,edit:v,isLoading:s==null?void 0:s.isFetching,children:e.jsx(he,{methods:b,onSubmit:b.handleSubmit(n),children:e.jsx("div",{className:"grid gap-x-2 gap-y-4",children:e.jsxs(me,{children:[e.jsx("div",{className:"mx-5 p-2",children:e.jsx(ve,{search:F,setPage:S,setSearch:U,refetch:s.refetch,isFetching:s.isLoading})}),e.jsx(ue,{className:"px-7",children:e.jsxs(xe,{children:["Workflow Member List (",(r=(d=s.data)==null?void 0:d.data)==null?void 0:r.totalDocs,")"]})}),e.jsx(pe,{children:s.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(je,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(Ne,{children:[e.jsx(Me,{children:e.jsxs(O,{children:[e.jsx(h,{className:"",children:"#"}),e.jsx(h,{className:"",children:"User Name"}),e.jsx(h,{className:"",children:"Role"}),e.jsx(h,{className:"",children:"Created at"}),e.jsx(h,{children:"Action"})]})}),e.jsx(we,{children:(G=(z=(o=s==null?void 0:s.data)==null?void 0:o.data)==null?void 0:z.docs)==null?void 0:G.map((p,y)=>e.jsxs(O,{children:[e.jsx(m,{children:y+1}),e.jsx(m,{children:p.fullName}),e.jsx(m,{children:p.role}),e.jsx(m,{children:fe(p.createdAt).format("DD-MM-YYYY")}),e.jsx(m,{className:"",children:e.jsx(Re,{className:"bg-primary ",onClick:()=>C(p._id),children:"Add Member"})})]},p._id))})]}),e.jsx(J,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(ke,{page:w,perPage:c,totalPage:(_=(L=s==null?void 0:s.data)==null?void 0:L.data)==null?void 0:_.totalDocs,hasNextPage:(T=(B=s==null?void 0:s.data)==null?void 0:B.data)==null?void 0:T.hasNextPage,hasPrevPage:(Y=(E=s==null?void 0:s.data)==null?void 0:E.data)==null?void 0:Y.hasPrevPage,setPage:S,setPerPage:x})})]})})]})})})})}const Te=ge().shape({roleName:I().required("Role Name is required")});function Ee({open:f,setOpen:u,title:R,id:v,wrkId:W,edit:M,setEdit:$,refetch:w}){var P,q,g,b;const S=ye({}),{data:c}=V({api:`${N.getWFUserMappingById}/${W}`,key:"getWFUserMappingById",options:{enabled:M}}),x=oe({defaultValues:{roleName:((P=c==null?void 0:c.data)==null?void 0:P._id)||""},resolver:ie(Te)}),F=async n=>{var s,C;try{const d=await S.mutateAsync({api:`${N.updateWFUserAndMemberMapping}/${v}`,data:{workflowUserMappingId:v,workflowRoleId:n==null?void 0:n.roleName}});(s=d.data)!=null&&s.success?j.success((C=d==null?void 0:d.data)==null?void 0:C.message):j.error("Member Role not updated successfully"),u(!1),$(!1),w()}catch(d){console.log(d)}};l.useEffect(()=>{var n;M?x.reset({roleName:(n=c==null?void 0:c.data)==null?void 0:n._id}):x.reset({roleName:""})},[M,c]);const U=V({api:`${N.getAllWorkFlowRole}?page=1&limit=1000`,key:"getAllWorkFlowRole",options:{enabled:!0}});return e.jsx($e,{open:f,setOpen:u,title:R,setEdit:$,edit:M,children:e.jsx(he,{methods:x,onSubmit:x.handleSubmit(F),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[e.jsx("div",{children:e.jsx(Fe,{name:"roleName",data:((b=(g=(q=U.data)==null?void 0:q.data)==null?void 0:g.docs)==null?void 0:b.map(n=>({value:n._id,label:n.workFlowRoleName})))??[]})}),e.jsx(J,{}),e.jsx("div",{children:e.jsx(Ie,{isLoading:x.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function Ye(f){var L,_,B,T,E,Y,p,y,H,Q,K,X,Z,ee,ae;const[u,R]=l.useState(1),[v,W]=l.useState(10),[M,$]=l.useState(""),[w,S]=l.useState(!1),[c,x]=l.useState(!1),[F,U]=l.useState(""),[P,q]=l.useState(""),[g,b]=l.useState(!1),n=ye({}),d=new URLSearchParams(be().search).get("parentId"),r=V({api:`${N.getAllWFUserMapping}?workflowId=${d}`,key:"getAllWFUserMapping",value:[u,v,d],options:{enabled:!0}}),o=V({api:`${N.checkGeneralActions}`,key:"generalActionPermission",options:{enabled:!0}}),z=async a=>{var A,i,k,se,re,te,le,ce,ne;try{const t=await n.mutateAsync({api:`${(A=N)==null?void 0:A.updateWFUserMappingStatus}/${a}`,data:{id:P}});(i=t==null?void 0:t.data)!=null&&i.success?(r.refetch(),((se=(k=t==null?void 0:t.data)==null?void 0:k.data)==null?void 0:se.status)==1&&j.success((re=t.data)==null?void 0:re.message),((le=(te=t==null?void 0:t.data)==null?void 0:te.data)==null?void 0:le.status)==0&&j.error((ce=t.data)==null?void 0:ce.message)):j.error((ne=t.data)==null?void 0:ne.message)}catch(t){j.error(de(t))}};l.useEffect(()=>{f==null||f.settitle()},[]);const G=a=>{Se("Are you sure ?","Please confirm",async()=>{var A;We.delete(`${(A=N)==null?void 0:A.deleteWFUserMapping}/${a}`).then(i=>{var k;j.success((k=i==null?void 0:i.data)==null?void 0:k.message),r.refetch()}).catch(i=>{j.error(de(i))})})};return e.jsxs("main",{className:"grid items-start",children:[w&&e.jsx(Be,{open:w,setOpen:S,title:g?"Edit Workflow Member":"Add Workflow Member",id:P,edit:g,setEdit:b,refetch:r.refetch}),e.jsx(Ee,{open:c,setOpen:x,title:g?"Edit Workflow Member Role":"Add Workflow Member Role",id:P,wrkId:F,edit:g,setEdit:b,refetch:r.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(ve,{search:M,setPage:R,setSearch:$,refetch:r.refetch,isFetching:r.isLoading})}),((_=(L=o==null?void 0:o.data)==null?void 0:L.permission)==null?void 0:_.canModifyMembers)&&e.jsx("div",{children:e.jsx(D,{className:"flex items-center gap-2",onClick:()=>S(!0),children:"Add New"})})]}),e.jsxs(me,{children:[e.jsx(ue,{className:"px-7",children:e.jsxs(xe,{children:["Workflow Member List (",(T=(B=r.data)==null?void 0:B.data)==null?void 0:T.totalDocs,")"]})}),e.jsx(pe,{children:r.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(je,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(Ne,{children:[e.jsx(Me,{children:e.jsxs(O,{children:[e.jsx(h,{className:"",children:"#"}),e.jsx(h,{className:"",children:"Workflow Member"}),e.jsx(h,{className:"",children:"Role"}),((Y=(E=o==null?void 0:o.data)==null?void 0:E.permission)==null?void 0:Y.canModifyMembers)&&e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"",children:"Created at"}),e.jsx(h,{className:"",children:"Status"}),e.jsx(h,{children:"Action"})]})]})}),e.jsx(we,{children:(H=(y=(p=r==null?void 0:r.data)==null?void 0:p.data)==null?void 0:y.docs)==null?void 0:H.map((a,A)=>{var i,k;return e.jsxs(O,{children:[e.jsxs(m,{children:[A+1," "]}),e.jsx(m,{className:"font-semibold",children:a.UserName}),e.jsx(m,{children:a.workflowRoleName||"N/A"}),((k=(i=o==null?void 0:o.data)==null?void 0:i.permission)==null?void 0:k.canModifyMembers)&&e.jsxs(e.Fragment,{children:[e.jsx(m,{children:fe(a.createdAt).format("DD-MM-YYYY")}),e.jsx(m,{children:e.jsxs(Ce,{checked:(a==null?void 0:a.status)==1,onChange:()=>z(a._id),className:`${a!=null&&a.status?"bg-primary":"bg-gray-200"} relative inline-flex h-6 w-11 items-center rounded-full`,children:[e.jsx("span",{className:"sr-only",children:"Enable notifications"}),e.jsx("span",{className:`${a!=null&&a.status?"translate-x-6":"translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white`})]})}),e.jsxs(m,{className:"space-x-5 ",children:[e.jsx(D,{type:"button",className:"",variant:"secondary",onClick:()=>{q(a._id),U(a==null?void 0:a.workflowRoleId),x(!0),b(!!a.workflowRoleId)},children:a.workflowRoleName?e.jsx("div",{children:" Update Member Role "}):e.jsx("div",{className:"ml-5",children:"Add Member Role"})}),e.jsx(D,{className:"bg-red-500 hover:bg-red-700  pt-2",onClick:()=>G(a._id),children:e.jsx(Le,{size:18})})]})]})]},a._id)})})]}),e.jsx(J,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(ke,{page:u,perPage:v,totalPage:(K=(Q=r==null?void 0:r.data)==null?void 0:Q.data)==null?void 0:K.totalDocs,hasNextPage:(Z=(X=r==null?void 0:r.data)==null?void 0:X.data)==null?void 0:Z.hasNextPage,hasPrevPage:(ae=(ee=r==null?void 0:r.data)==null?void 0:ee.data)==null?void 0:ae.hasPrevPage,setPage:R,setPerPage:W})})]})})]})]})]})}function aa(){const[f,u]=l.useState("Workflow Member List");return e.jsx(Ue,{title:f||"Workflow Member List",subTitle:"Manage all the work Flow List here",children:e.jsx("div",{className:"py-12",children:e.jsx(Ye,{settitle:u})})})}export{aa as default};
