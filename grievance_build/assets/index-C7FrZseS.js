import{u as Z,H as O,w as Q,g as N,d as D,o as aa,r as x,j as a,D as ea,F as sa,R as U,G as X,B as ra,c as na,a as A,_ as i,K as W,x as la,y as ta,M as ca,z as da,S as oa,A as ia}from"./index-D1hQ8xza.js";import{P as ha}from"./index-DFoLzx-l.js";import{T as pa,a as xa,b as J,c,d as ua,e as d}from"./table-D7omZFZF.js";import{g as ja}from"./services-KQnp_8oA.js";import{P as ma}from"./index-i7Oxwmrv.js";import{S as ga}from"./index-fZzzJ7X_.js";import{q as ba}from"./switch-Ccyf7xIE.js";import"./pagination-D_POc1kW.js";const fa=na().shape({ulbName:A().required("Ulb name is required"),email:A(),phonenumber:A(),whatsappnumber:A()});function Na({open:E,setOpen:h,title:y,id:o,edit:p,setEdit:u,refetch:$}){const C=Z({}),j=O({}),{data:l,isFetching:M}=Q({api:`${N.getUlbById}/${o}`,key:"getUlbById",options:{enabled:p}}),t=D({defaultValues:{ulbName:"",email:"",phonenumber:"",whatsappnumber:""},resolver:aa(fa)}),w=async s=>{var P,S,m,g;try{if(p&&s){const n=await j.mutateAsync({api:`${N.updateUlb}/${o}`,data:s});(P=n.data)!=null&&P.success?i.success((S=n==null?void 0:n.data)==null?void 0:S.message):i.error("Ulb not updated successfully")}else{const n=await C.mutateAsync({api:N.createUlb,data:s});(m=n.data)!=null&&m.success?i.success((g=n==null?void 0:n.data)==null?void 0:g.message):i.error("Ulb not created successfully"),t.reset({ulbName:"",email:"",phonenumber:"",whatsappnumber:""})}h(!1),u(!1),$()}catch(n){console.log(n)}};return x.useEffect(()=>{p&&l?t.reset({ulbName:l.data.ulbName,email:l.data.email,phonenumber:l.data.phonenumber,whatsappnumber:l.data.whatsappnumber}):t.reset({ulbName:"",email:"",phonenumber:"",whatsappnumber:""})},[p,l]),a.jsx(ea,{open:E,setOpen:h,title:y,setEdit:u,edit:p,isLoading:M,children:a.jsx(sa,{methods:t,onSubmit:t.handleSubmit(w),children:a.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[a.jsx("div",{children:a.jsx(U,{name:"ulbName",placeholder:"Enter Ulb name"})}),a.jsx("div",{children:a.jsx(U,{name:"phonenumber",placeholder:"Enter Phone no"})}),a.jsx("div",{children:a.jsx(U,{name:"whatsappnumber",placeholder:"Enter whatsApp no"})}),a.jsx("div",{children:a.jsx(U,{name:"email",placeholder:"Enter Email"})}),a.jsx(X,{}),a.jsx("div",{children:a.jsx(ra,{isLoading:t.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function ya(){var m,g,n,F,T,B,k,L,H,_,q,I;const E=O({}),[h,y]=x.useState(1),[o,p]=x.useState(10),[u,$]=x.useState(""),[C,j]=x.useState(!1),[l,M]=x.useState(""),[t,w]=x.useState(!1),s=Q({api:`${(m=N)==null?void 0:m.getAllUlb}?page=${h}&limit=${o}&q=${u}`,key:"getAllUlb",value:[h,o],options:{enabled:!0}}),P=e=>{w(!0),j(!0),M(e)},S=async e=>{var v,b,f,R,Y,z,G,K,V;try{const r=await E.mutateAsync({api:`${(v=N)==null?void 0:v.updateUlbStatus}/${e}`,data:{id:l}});(b=r==null?void 0:r.data)!=null&&b.success?(s.refetch(),((R=(f=r==null?void 0:r.data)==null?void 0:f.data)==null?void 0:R.status)==1&&i.success((Y=r==null?void 0:r.data)==null?void 0:Y.message),((G=(z=r==null?void 0:r.data)==null?void 0:z.data)==null?void 0:G.status)==0&&i.error((K=r==null?void 0:r.data)==null?void 0:K.message)):i.error((V=r==null?void 0:r.data)==null?void 0:V.message)}catch(r){i.error(ja(r))}};return a.jsxs("main",{className:"grid items-start",children:[a.jsx(Na,{open:C,setOpen:j,title:t?"Edit Ulb":"Add Ulb",id:l,edit:t,setEdit:w,refetch:s==null?void 0:s.refetch}),a.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[a.jsxs("div",{className:"flex w-full justify-between gap-2",children:[a.jsx("div",{children:a.jsx(ga,{search:u,setPage:y,setSearch:$,refetch:s.refetch,isFetching:s.isLoading})}),a.jsx("div",{children:a.jsx(W,{className:"flex items-center gap-2",onClick:()=>j(!0),children:"Add New"})})]}),a.jsxs(la,{children:[a.jsx(ta,{className:"px-7",children:a.jsxs(ca,{children:["Ulb List (",(n=(g=s==null?void 0:s.data)==null?void 0:g.data)==null?void 0:n.totalDocs,")"]})}),a.jsx(da,{children:s!=null&&s.isLoading?a.jsx("div",{className:"flex h-32 items-center justify-center",children:a.jsx(oa,{})}):a.jsxs(a.Fragment,{children:[a.jsxs(pa,{children:[a.jsx(xa,{children:a.jsxs(J,{children:[a.jsx(c,{className:"",children:"#"}),a.jsx(c,{className:"",children:"Ulb Name"}),a.jsx(c,{className:"",children:"Mobile No."}),a.jsx(c,{className:"",children:"WhatsApp No."}),a.jsx(c,{className:"",children:"Email"}),a.jsx(c,{className:"",children:"Id"}),a.jsx(c,{className:"",children:"Created at"}),a.jsx(c,{className:"",children:"Status"}),a.jsx(c,{children:"Action"})]})}),a.jsx(ua,{children:(B=(T=(F=s==null?void 0:s.data)==null?void 0:F.data)==null?void 0:T.docs)==null?void 0:B.map((e,v)=>{var b,f;return a.jsxs(J,{children:[a.jsx(d,{children:h*o-o+v+1}),a.jsx(d,{children:e==null?void 0:e.ulbName}),a.jsx(d,{children:e==null?void 0:e.phonenumber}),a.jsx(d,{children:e==null?void 0:e.whatsappnumber}),a.jsx(d,{children:e.email&&((f=(b=e==null?void 0:e.email)==null?void 0:b.replace("@","[at]"))==null?void 0:f.replace(".","[dot]"))}),a.jsx(d,{children:e==null?void 0:e._id}),a.jsx(d,{children:ia(e==null?void 0:e.createdAt).format("DD-MM-YYYY")}),a.jsx(d,{children:a.jsxs(ba,{checked:(e==null?void 0:e.status)==1,onChange:()=>S(e==null?void 0:e._id),className:`${e!=null&&e.status?"bg-primary":"bg-gray-200"} relative inline-flex h-6 w-11 items-center rounded-full`,children:[a.jsx("span",{className:"sr-only",children:"Enable notifications"}),a.jsx("span",{className:`${e!=null&&e.status?"translate-x-6":"translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white`})]})}),a.jsx(d,{children:a.jsx(W,{className:"bg-primary",onClick:()=>P(e==null?void 0:e._id),children:"Edit"})})]},e==null?void 0:e._id)})})]}),a.jsx(X,{className:"mb-2 mt-4"}),a.jsx("div",{className:"flex w-full justify-end",children:a.jsx(ma,{page:h,perPage:o,totalPage:(L=(k=s==null?void 0:s.data)==null?void 0:k.data)==null?void 0:L.totalDocs,hasNextPage:(_=(H=s==null?void 0:s.data)==null?void 0:H.data)==null?void 0:_.hasNextPage,hasPrevPage:(I=(q=s==null?void 0:s.data)==null?void 0:q.data)==null?void 0:I.hasPrevPage,setPage:y,setPerPage:p})})]})})]})]})]})}function Ca(){return a.jsx(ha,{title:"Ulb List",subTitle:"Manage all the ulb here",children:a.jsx("div",{children:a.jsx(ya,{})})})}export{Ca as default};
