import{r as x,j as e,h as B,B as n,Z as De,o as Se,p as Be,q as k,_ as p}from"./index-CGxHb2VT.js";import{c as C,A as ie,g as ce,a as Y,C as O,b as E,e as L}from"./index-BWW_ZQgu.js";import{T as P,L as Ae}from"./textarea-CMyVaUTw.js";import{D as y,b as $,a as w,c as R,d as D}from"./dialog-C1FIceVx.js";import{S as Z,P as _e,a as Te,f as me}from"./PriorityBadge-DKfoMe-D.js";import{a as Me,b as fe,C as Q}from"./circle-x-FKAnvueY.js";import{R as je,a as Oe}from"./rotate-ccw-BZ1Lz-cl.js";import{f as be,R as Ee,H as U,M as K}from"./RotatingLoader-CsdWgd-i.js";import{u as Le,c as $e,b as xe,a as Pe}from"./useCustomQuery-BBRGX89k.js";import"./en-US-8upN5vI8.js";const ue=C("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const Fe=C("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const he=C("CircleDot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]);const pe=C("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);const W=C("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);const Ie=C("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);const ze=C("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function He({activities:a,comments:u,onAddComment:d,onStatusChange:j,userRole:h,currentStatus:g,onRefresh:A}){const[m,b]=x.useState(""),i=x.useRef(null),F=[...a.map(r=>({...r,type:"activity"})),...u.map(r=>({...r,type:"comment"}))].sort((r,N)=>new Date(r.timestamp).getTime()-new Date(N.timestamp).getTime()),_=()=>{if(i.current){const r=i.current.closest(".overflow-y-auto");r&&(r.scrollTop=r.scrollHeight)}};x.useEffect(()=>{_()},[F]);const I=()=>{m.trim()&&(d(m),b(""))},T=r=>{const N=r.action.toLowerCase(),o=r.description.toLowerCase();return N.includes("created")?e.jsx(he,{className:"h-4 w-4 text-green-500"}):o.includes("resolved")||r.newStatus==="Resolved"?e.jsx(Me,{className:"h-4 w-4 text-purple-500"}):o.includes("rejected")||r.newStatus==="Rejected"?e.jsx(fe,{className:"h-4 w-4 text-red-500"}):o.includes("closed")||r.newStatus==="Closed"?e.jsx(W,{className:"h-4 w-4 text-slate-500"}):o.includes("re-open")||r.newStatus==="Re-Open"?e.jsx(je,{className:"h-4 w-4 text-indigo-500"}):e.jsx(he,{className:"h-4 w-4 text-blue-500"})};return e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"scrollbar-thin scrollbar-thumb-muted-foreground/20 mb-4 max-h-[500px] min-h-[300px] flex-1 space-y-3 overflow-y-auto pr-2",children:[F.map((r,N)=>{var o;if(r.type==="comment"){const l=r,f=l.authorRole===h;return e.jsxs("div",{className:B("flex items-end gap-2 duration-300 animate-in fade-in",f?"flex-row-reverse":"flex-row"),style:{animationDelay:`${N*30}ms`},children:[e.jsx(ie,{className:"h-7 w-7 flex-shrink-0 border border-border",children:e.jsx(ce,{className:B("text-[9px] font-bold uppercase",f?"bg-indigo-600 text-white":"bg-slate-600 text-white"),children:(o=l.authorRole)==null?void 0:o.substring(0,2)})}),e.jsxs("div",{className:B("flex max-w-[75%] flex-col",f?"items-end":"items-start"),children:[e.jsx("div",{className:B("rounded-2xl px-3 py-2 shadow-sm",f?"rounded-br-sm bg-indigo-600 text-white":"rounded-bl-sm border border-border bg-muted"),children:e.jsx("p",{className:B("whitespace-pre-wrap break-words text-sm leading-relaxed",f?"text-white":"text-foreground"),children:l.comment})}),e.jsx("span",{className:"mt-1 px-1 text-[10px] text-muted-foreground",children:be(new Date(l.timestamp),{addSuffix:!0})})]})]},l.id)}else{const l=r;return e.jsx("div",{className:"my-2 flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-border bg-muted/50 px-3 py-1.5 text-xs text-muted-foreground",children:[T(l),e.jsx("span",{className:"font-medium",children:l.performedBy}),e.jsx("span",{children:l.description}),l.newStatus&&e.jsx(Z,{status:l.newStatus,className:"scale-75"})]})},l.id)}}),e.jsx("div",{ref:i})]}),["Closed","Rejected","Resolved"].includes(g)?e.jsx("div",{className:"mt-auto flex items-center justify-center rounded-xl border border-dashed border-border bg-muted/20 p-6 shadow-inner",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-center",children:[e.jsx("div",{className:"rounded-full bg-muted p-2 text-muted-foreground",children:e.jsx(W,{className:"h-5 w-5"})}),e.jsxs("p",{className:"text-sm font-medium text-muted-foreground",children:["This bug is"," ",e.jsx("span",{className:"font-bold text-foreground",children:g}),"."]}),e.jsx("p",{className:"text-xs text-muted-foreground/70",children:"Please reopen the issue to continue the conversation."})]})}):e.jsxs("div",{className:"mt-auto flex items-end gap-3 rounded-2xl border border-border bg-muted/30 p-3",children:[e.jsx(ie,{className:"h-8 w-8 flex-shrink-0 border border-border",children:e.jsx(ce,{className:"bg-indigo-600 text-[10px] font-bold uppercase text-white",children:h==null?void 0:h.substring(0,2)})}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx(P,{placeholder:`Message as ${h}...`,value:m,onChange:r=>b(r.target.value),className:"max-h-[120px] min-h-[40px] resize-none overflow-hidden rounded-xl border-border bg-background px-4 py-2.5 pr-12 text-sm focus-visible:ring-1 focus-visible:ring-indigo-500",style:{height:m?"auto":"42px"},onKeyDown:r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),I())}}),e.jsx(n,{size:"icon",onClick:I,disabled:!m.trim(),className:"absolute bottom-1.5 right-1.5 h-7 w-7 rounded-lg bg-indigo-600 text-white shadow-none transition-all hover:bg-indigo-700 disabled:scale-90 disabled:opacity-0",children:e.jsx(Ie,{className:"h-3.5 w-3.5"})})]})]})]})}function Je({}){var ae,re,le,ne,de,oe;const{bugId:a}=De(),u=Se(),[d,j]=x.useState(""),[h,g]=x.useState(!1),[A,m]=x.useState(!1),[b,i]=x.useState(!1),[F,_]=x.useState(!1),[I,T]=x.useState(!1),[r,N]=x.useState(!1),{user:o}=Be(),l=(o==null?void 0:o.roleName)||"",f=(o==null?void 0:o._id)||0,X=Le({}),V=$e({});x.useEffect(()=>{document.documentElement.scrollTop=0,document.body.scrollTop=0},[a]);const z=xe({api:`${k.getBugById}/${a}`,key:`getBugById-${a}`,options:{enabled:!!a}}),G=Pe({api:`${k.getActivityRecord}`,key:`getActivity-${a}`,config:{bugId:a},options:{enabled:!!a}}),H=xe({api:`${k.getBugComments}/${a}/comments`,key:`getBugComments-${a}`,options:{enabled:!!a}}),s=(ae=z.data)==null?void 0:ae.data,v=((re=G.data)==null?void 0:re.data)||[],J=((le=H.data)==null?void 0:le.data)||[];if(z.isLoading)return e.jsx(Y,{children:e.jsx("div",{className:"flex h-[60vh] items-center justify-center",children:e.jsx(Ee,{})})});if(z.error||!s)return e.jsx(Y,{children:e.jsxs("div",{className:"py-20 text-center duration-500 animate-in fade-in slide-in-from-bottom-4",children:[e.jsx("div",{className:"mb-6 inline-flex h-20 w-20 items-center justify-center rounded-full bg-red-50 text-red-600",children:e.jsx(Q,{className:"h-10 w-10"})}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Bug Not Found"}),e.jsx("p",{className:"mx-auto mt-3 max-w-md text-gray-500",children:"The requested bug report could not be found or there was an error fetching it."}),e.jsxs(n,{onClick:()=>u("/bug-tracking/dashboard/bug/list"),className:"mt-8 rounded-full px-8 shadow-lg shadow-indigo-100",variant:"default",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Back to Bug List"]})]})});const M=async(t,c)=>{try{await X.mutateAsync({api:`${k.updateStatus}/${a}/change-status`,data:{status:t,remarks:c||d,user_role:l,user_id:f}}),p.success(`Bug ${t.toLowerCase()} successfully`),z.refetch(),G.refetch(),j(""),g(!1),m(!1),i(!1),_(!1)}catch{p.error("Failed to update status")}},Ne=()=>{if(!d.trim()){p.error("Please provide a resolution summary");return}M("Resolved",d)},ve=()=>{if(!d.trim()){p.error("Please provide a rejection reason");return}M("Rejected",d)},ye=()=>{if(!d.trim()){p.error("Please provide closing remarks");return}M("Closed",d)},we=()=>{if(!d.trim()){p.error("Please provide reopening remarks");return}M("Re-Open",d)},ee=(l==="Developer"||l==="TESTER")&&["Open","Re-Open"].includes(s.status),se=["Open","Rejected","Re-Open"].includes(s.status),te=["Closed","Resolved","Rejected"].includes(s.status),Ce=(l==="Developer"||l==="TESTER")&&["Open","Re-Open"].includes(s.status),ke=async()=>{try{await V.mutateAsync({api:`${k.deleteBug}/${a}`,data:{user_role:l,user_id:f}}),p.success("Bug deleted successfully"),u("/bug-tracking/dashboard/bug/list")}catch{p.error("Failed to delete bug")}},Re=async t=>{try{await X.mutateAsync({api:`${k.addComment}/${a}/comments`,data:{comment:t,user_role:l,user_id:f}}),p.success("Comment added successfully"),H.refetch()}catch{p.error("Failed to add comment")}};return e.jsxs(Y,{children:[e.jsxs("div",{className:"b w-full space-y-8 pb-10 duration-700 animate-in fade-in",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 flex items-center justify-between",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(n,{variant:"outline",onClick:()=>u("/bug-tracking/dashboard/bug/list"),className:"rounded-md border-border bg-card px-4 text-foreground shadow-sm hover:bg-accent",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Back to Bug List"]})})}),e.jsxs("div",{className:"flex items-center justify-between space-y-1 rounded-xl bg-background p-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-foreground",children:s==null?void 0:s.tracking_no}),e.jsx(Z,{status:s==null?void 0:s.status,className:"rounded-full px-3 py-1 text-xs"})]}),e.jsx("p",{className:"text-md font-medium text-muted-foreground",children:s==null?void 0:s.ulb_name})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[Ce&&e.jsxs(n,{variant:"outline",onClick:()=>u(`/bug-tracking/dashboard/bug/create?id=${a}`),className:"border-indigo-200 text-muted-foreground hover:bg-indigo-50 hover:text-indigo-800",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),"Edit Bug"]}),(l==="Developer"||l==="TESTER")&&e.jsxs(n,{variant:"destructive",onClick:()=>T(!0),className:"bg-red-600 text-white shadow-sm hover:bg-red-700",children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),"Delete Bug"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-8 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-8 lg:col-span-2",children:[e.jsxs(O,{className:"overflow-hidden rounded-xl border border-border bg-card shadow-sm",children:[e.jsx(E,{className:"pb-4",children:e.jsx("h3",{className:"text-lg font-bold text-foreground",children:"Bug Details"})}),e.jsxs(L,{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-12 gap-y-10 md:grid-cols-4",children:[e.jsx(S,{label:"Priority",value:e.jsx(Te,{priority:s==null?void 0:s.priority,className:"px-3 py-1"})}),e.jsx(S,{label:"Type",value:e.jsx("span",{className:B("rounded-full px-3 py-1 text-xs font-semibold",(s==null?void 0:s.entry_type)==="Bug"?"bg-destructive text-destructive-foreground":(s==null?void 0:s.entry_type)==="Enhancement"?"bg-indigo-100 text-indigo-700":"bg-muted text-muted-foreground"),children:s==null?void 0:s.entry_type})}),e.jsx(S,{label:"Module",value:(s==null?void 0:s.module_name)||"Not Set"}),e.jsx(S,{label:"Source",value:(s==null?void 0:s.source)||"Not Set"}),e.jsx(S,{label:"Complexity",value:(s==null?void 0:s.complexity)||"Not Set"}),(s==null?void 0:s.user_role)&&e.jsx(S,{label:"User Role",value:(s==null?void 0:s.user_role)||"Not Set"})]}),e.jsxs("div",{className:"space-y-2 pt-4",children:[e.jsx("h4",{className:"text-sm font-semibold uppercase tracking-tight text-muted-foreground",children:"Title"}),e.jsx("p",{className:"text-[17px] font-semibold leading-relaxed text-foreground/90",children:s==null?void 0:s.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold uppercase tracking-tight text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-[15px] italic leading-relaxed text-foreground/90",children:s==null?void 0:s.description})]}),e.jsxs("div",{className:"flex items-center gap-8 border-t border-border pt-6 text-[13px] text-muted-foreground",children:[e.jsxs("span",{children:["Created:"," ",me(new Date(s==null?void 0:s.created_at),"MMMM do, yyyy h:mm a")]}),e.jsxs("span",{className:"ml-auto",children:["Updated:"," ",me(new Date(s==null?void 0:s.updated_at),"MMMM do, yyyy h:mm a")]})]})]})]}),e.jsxs(O,{className:"overflow-hidden rounded-xl border border-border bg-card shadow-sm",children:[e.jsxs(E,{className:"flex flex-row items-center gap-2 pb-4",children:[e.jsx(pe,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("h3",{className:"text-lg font-bold text-foreground",children:["Screenshots (",((ne=s==null?void 0:s.screenshots)==null?void 0:ne.length)||0,")"]})]}),e.jsx(L,{className:"pt-2",children:s!=null&&s.screenshots&&((de=s==null?void 0:s.screenshots)==null?void 0:de.length)>0?e.jsx("div",{className:"grid grid-cols-2 gap-6 md:grid-cols-3",children:(oe=s==null?void 0:s.screenshots)==null?void 0:oe.map((t,c)=>e.jsxs(y,{children:[e.jsx($,{asChild:!0,children:e.jsx("div",{className:"group  relative cursor-pointer overflow-hidden rounded-lg border border-border transition-all hover:border-primary/50",children:e.jsx("img",{src:t,className:"h-48 w-full object-cover",alt:`Attachment ${c+1}`,onError:q=>{q.target.src="https://placehold.co/600x400?text=Image+Not+Found"}})})}),e.jsx(w,{className:"max-w-[90vw] overflow-hidden border-none bg-transparent p-0 shadow-none [&>button]:bg-white [&>button]:text-red-600 [&>button]:opacity-100 [&>button]:hover:bg-gray-100 [&>button]:hover:text-red-700",children:e.jsx("img",{src:t,className:"max-h-[90vh] w-full rounded-lg object-contain",alt:`Attachment Full ${c+1}`})})]},c))}):e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-dashed border-border bg-muted/20 py-12 text-muted-foreground",children:[e.jsx(pe,{className:"mb-2 h-8 w-8 opacity-20"}),e.jsx("p",{children:"No screenshots attached"})]})})]}),e.jsxs(O,{className:"overflow-hidden rounded-xl border border-border bg-card shadow-sm",children:[e.jsx(E,{className:"border-b bg-muted/20 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-foreground",children:[e.jsx(U,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-bold",children:"Activity Timeline"})]}),e.jsxs("span",{className:"rounded-full border bg-muted px-2 py-1 text-xs font-medium text-muted-foreground",children:[v.length," Events"]})]})}),e.jsx(L,{className:"pt-8",children:e.jsx("div",{className:"relative space-y-8",children:v.length>0?e.jsxs(e.Fragment,{children:[v.slice(0,6).map((t,c,q)=>e.jsx(ge,{record:t,isLast:c===q.length-1},t.id)),v.length>6&&e.jsx("div",{className:"pt-2",children:e.jsxs(n,{variant:"ghost",className:"w-full border border-dashed border-indigo-200 text-indigo-600 hover:bg-indigo-50 hover:text-indigo-700",onClick:()=>N(!0),children:["View All Activity (",v.length,")"]})})]}):e.jsx("div",{className:"py-4 pl-2 text-sm italic text-muted-foreground",children:"No activity records found"})})})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs(O,{className:"overflow-hidden rounded-xl border border-border bg-card shadow-sm",children:[e.jsx(E,{className:"pb-4",children:e.jsx("h3",{className:"text-lg font-bold text-foreground",children:"Actions"})}),e.jsx(L,{className:"space-y-4",children:ee||se||te?e.jsxs("div",{className:"space-y-3",children:[ee&&e.jsxs(e.Fragment,{children:[e.jsxs(y,{open:h,onOpenChange:g,children:[e.jsx($,{asChild:!0,children:e.jsx(n,{className:"h-11 w-full rounded-lg bg-indigo-600 text-white hover:bg-indigo-700",variant:"default",children:"Resolve Bug"})}),e.jsxs(w,{className:"rounded-2xl sm:max-w-[425px]",children:[e.jsx(R,{children:e.jsxs(D,{className:"flex items-center gap-2 text-xl",children:[e.jsx(Fe,{className:"h-5 w-5 text-green-500"}),"Resolution Details"]})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"ml-1 text-sm font-medium text-muted-foreground",children:"Resolution Summary"}),e.jsx(P,{placeholder:"What was the root cause and how did you solve it?",value:d,onChange:t=>j(t.target.value),rows:5,className:"resize-none rounded-xl border-border bg-background shadow-sm transition-all focus:border-primary focus:ring-primary/20"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx(n,{variant:"ghost",onClick:()=>g(!1),className:"rounded-full",children:"Cancel"}),e.jsx(n,{onClick:Ne,className:"rounded-full bg-primary px-8 text-primary-foreground shadow-md shadow-primary/10 transition-all hover:bg-primary/90 active:scale-95",children:"Resolve Bug"})]})]})]})]}),e.jsxs(y,{open:A,onOpenChange:m,children:[e.jsx($,{asChild:!0,children:e.jsx(n,{className:"h-11 w-full rounded-lg  border-red-200 text-red-600",variant:"outline",children:"Reject Bug Report"})}),e.jsxs(w,{className:"rounded-2xl sm:max-w-[425px]",children:[e.jsx(R,{children:e.jsxs(D,{className:"flex items-center gap-2 text-xl",children:[e.jsx(fe,{className:"h-5 w-5 text-destructive"}),"Rejection Detail"]})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"ml-1 text-sm font-medium text-muted-foreground",children:"Reason for Rejection"}),e.jsx(P,{placeholder:"Please explain why this report is being rejected...",value:d,onChange:t=>j(t.target.value),rows:5,className:"resize-none rounded-xl border-border bg-background shadow-sm transition-all focus:border-destructive focus:ring-destructive/20"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx(n,{variant:"ghost",onClick:()=>m(!1),className:"rounded-full",children:"Cancel"}),e.jsx(n,{variant:"destructive",onClick:ve,className:"rounded-full px-8 shadow-md shadow-destructive/10 transition-all active:scale-95",children:"Confirm Rejection"})]})]})]})]})]}),se&&e.jsxs(y,{open:b,onOpenChange:i,children:[e.jsx($,{asChild:!0,children:e.jsx(n,{className:"h-11 w-full rounded-lg border-none bg-gray-900 text-white transition-all hover:bg-black",variant:"default",children:"Close Issue"})}),e.jsxs(w,{className:"rounded-2xl sm:max-w-[425px]",children:[e.jsx(R,{children:e.jsxs(D,{className:"flex items-center gap-2 text-xl",children:[e.jsx(W,{className:"h-5 w-5 text-gray-700"}),"Close Bug Report"]})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx("p",{className:"px-1 text-sm text-muted-foreground",children:"Are you sure you want to close this bug? This marks the lifecycle as complete."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"ml-1 text-sm font-medium text-muted-foreground",children:"Closing Remarks"}),e.jsx(P,{placeholder:"Add any final thoughts or closing remarks...",value:d,onChange:t=>j(t.target.value),rows:4,className:"resize-none rounded-xl border-gray-200 shadow-sm transition-all focus:border-gray-900 focus:ring-gray-900/10"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx(n,{variant:"ghost",onClick:()=>i(!1),className:"rounded-full",children:"Cancel"}),e.jsx(n,{onClick:ye,className:"rounded-full bg-gray-900 px-8 text-white  shadow-md transition-all active:scale-95",children:"Yes, Close Bug"})]})]})]})]}),te&&e.jsxs(y,{open:F,onOpenChange:_,children:[e.jsx($,{asChild:!0,children:e.jsx(n,{className:"h-11 w-full rounded-lg border-indigo-200 text-muted-foreground",variant:"outline",children:"Re-Open Bug"})}),e.jsxs(w,{className:"rounded-2xl sm:max-w-[425px]",children:[e.jsx(R,{children:e.jsxs(D,{className:"flex items-center gap-2 text-xl",children:[e.jsx(je,{className:"h-5 w-5 text-primary"}),"Re-Open Bug Report"]})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx("p",{className:"px-1 text-sm text-muted-foreground",children:"Are you sure you want to re-open this bug? This will set the status back to 'Re-Open'."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"ml-1 text-sm font-medium text-muted-foreground",children:"Re-Opening Reason"}),e.jsx(P,{placeholder:"Why is this bug being re-opened?",value:d,onChange:t=>j(t.target.value),rows:4,className:"resize-none rounded-xl border-border bg-background shadow-sm transition-all focus:border-primary focus:ring-primary/20"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx(n,{variant:"ghost",onClick:()=>_(!1),className:"rounded-full",children:"Cancel"}),e.jsx(n,{onClick:we,className:"rounded-full bg-primary px-8 text-primary-foreground shadow-md shadow-primary/10 transition-all hover:bg-primary/90 active:scale-95",children:"Yes, Re-Open"})]})]})]})]}),l!=="Developer"&&e.jsxs(n,{variant:"outline",className:"h-11 w-full rounded-lg border-indigo-200 text-muted-foreground hover:bg-muted",onClick:()=>{var c;const t=document.getElementById("discussion-section");t==null||t.scrollIntoView({behavior:"smooth"}),(c=document.querySelector('textarea[placeholder="Leave a comment..."]'))==null||c.focus()},children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Add Comment to Developer"]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center rounded-lg py-4 text-center",children:e.jsx("p",{className:"text-[15px] text-muted-foreground",children:"No actions available for current status"})})})]}),e.jsxs(O,{id:"discussion-section",className:"overflow-hidden rounded-xl border border-border bg-card shadow-sm",children:[e.jsx(E,{className:"border-b bg-muted/20 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-foreground",children:[e.jsx(K,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-bold",children:"Bug Conversation"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"rounded-full border bg-muted px-2 py-1 text-xs font-medium text-muted-foreground",children:[J.length," Comments"]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>H.refetch(),className:"h-7 w-7",children:e.jsx(Oe,{className:"h-3.5 w-3.5"})})]})]})}),e.jsx(L,{className:"pt-8",children:e.jsx(He,{activities:[],comments:J.map(t=>({id:t.id.toString(),bug_id:t.bug_id.toString(),comment:t.comment,user_name:t.user_name||"",user_role:t.user_role,created_at:t.created_at})).map(t=>({id:t.id,bugId:t.bug_id,comment:t.comment,author:t.user_name,authorRole:t.user_role,timestamp:t.created_at})),onAddComment:Re,onStatusChange:M,userRole:l,currentStatus:s.status,onRefresh:()=>H.refetch()})})]})]})]})]}),e.jsx(y,{open:I,onOpenChange:T,children:e.jsxs(w,{className:"rounded-2xl sm:max-w-[425px]",children:[e.jsx(R,{children:e.jsxs(D,{className:"flex items-center gap-2 text-xl text-destructive",children:[e.jsx(Q,{className:"h-5 w-5"}),"Delete Bug Report"]})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("p",{className:"text-sm leading-relaxed text-foreground/80",children:["Are you sure you want to delete this bug report permanently?",e.jsx("span",{className:"mt-2 block font-medium text-destructive",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(n,{variant:"ghost",onClick:()=>T(!1),className:"rounded-full",children:"Cancel"}),e.jsx(n,{variant:"destructive",onClick:ke,className:"rounded-full px-6 shadow-md shadow-destructive/10",disabled:V.isPending,children:V.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Yes, Delete Bug"})]})]})]})}),e.jsx(y,{open:r,onOpenChange:N,children:e.jsxs(w,{className:"flex max-h-[85vh] max-w-3xl flex-col",children:[e.jsx(R,{children:e.jsxs(D,{className:"flex items-center gap-2 text-xl",children:[e.jsx(U,{className:"h-5 w-5 text-indigo-600"}),"Full Activity History"]})}),e.jsx("div",{className:"-mr-2 flex-1 overflow-y-auto pr-2 pt-4",children:e.jsx("div",{className:"relative space-y-8 pb-4",children:v.map((t,c)=>e.jsx(ge,{record:t,isLast:c===v.length-1},t.id))})})]})})]})}const S=({label:a,value:u})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-[12px] font-semibold uppercase tracking-tight text-muted-foreground",children:a}),e.jsx("div",{className:"text-[15px] font-semibold text-foreground",children:u})]}),ge=({record:a,isLast:u})=>{var g,A,m;const j=(b=>{const i=b.toLowerCase();return i.includes("closed")?"Closed":i.includes("resolved")?"Resolved":i.includes("re-open")||i.includes("reopen")?"Re-Open":i.includes("rejected")?"Rejected":null})(a.message),h=((g=a.data)==null?void 0:g.new_status)||j;return e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full border border-border bg-muted text-[13px] font-bold uppercase text-muted-foreground",children:((A=a.user)==null?void 0:A.split(" ").map(b=>b[0]).join(""))||"SY"}),!u&&e.jsx("div",{className:"w-[1.5px] flex-1 bg-muted/50"})]}),e.jsxs("div",{className:"flex-1 pb-4",children:[e.jsxs("div",{className:"mb-1 flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a.action==="status_changed"?e.jsx(K,{className:"h-3.5 w-3.5 text-primary"}):a.action==="created"?e.jsx(Q,{className:"h-3.5 w-3.5 text-green-500"}):e.jsx(U,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("span",{className:"text-[15px] font-bold text-foreground",children:a.user||"System User"})]}),e.jsx("span",{className:"rounded bg-muted px-2 py-0.5 text-[11px] font-medium text-muted-foreground",children:(a==null?void 0:a.role)||"Developer"}),e.jsx("span",{className:"text-[11px] text-muted-foreground opacity-70",children:be(new Date(a.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:"mb-1 text-[14px] leading-relaxed text-foreground/80",children:a.message}),a.remarks&&e.jsxs("p",{className:"mt-2 border-l-2 border-primary/40 bg-muted/10 py-1 pl-3 text-[14px] font-medium italic text-foreground/90",children:['"',a.remarks,'"']}),h&&e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[((m=a.data)==null?void 0:m.new_status)&&e.jsx("span",{className:"text-[11px] font-bold uppercase tracking-tight text-muted-foreground",children:"New Status:"}),e.jsx(Z,{status:h,className:"px-2 py-0.5 text-[10px]"})]})]})]})};export{Je as default};
