import{r as m,j as e,P as J,h as _,q as X,s as K,o as Q,B as x,_ as P,p as B}from"./index-B9f-aXV3.js";import{b as Y}from"./index.esm-DWOVPPvo.js";import{c as Z,a as ee,C as se,b as te,d as ae,e as re}from"./index-DDQwAWAd.js";import{S as b,a as f,b as N,c as w,d as i,I as ie}from"./select-DNb7lknl.js";import{T as le,L as oe,D as ne,a as ce}from"./dialog-DeksF9S7.js";import{u as de,a as ue,b as me}from"./useCustomQuery-BMEgx2mP.js";import{E as $}from"./eye-CgjAS1Nj.js";import{X as q}from"./x-TBfgy6sq.js";const he=Z("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var pe="Label",A=m.forwardRef((a,c)=>e.jsx(J.label,{...a,ref:c,onMouseDown:l=>{var d;l.target.closest("button, input, select, textarea")||((d=a.onMouseDown)==null||d.call(a,l),!l.defaultPrevented&&l.detail>1&&l.preventDefault())}}));A.displayName=pe;var D=A;const xe=X("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),n=m.forwardRef(({className:a,...c},l)=>e.jsx(D,{ref:l,className:_(xe(),a),...c}));n.displayName=D.displayName;localStorage.getItem("role");const ge=localStorage.getItem("user_id");function Pe({}){var F,U;const[a,c]=m.useState([]),[l,p]=m.useState([]),[d,h]=m.useState(null),[T]=K(),S=T.get("id"),r=!!S,{register:E,handleSubmit:V,setValue:g,watch:j,reset:C,formState:{errors:u}}=Y(),I=Q(),H=localStorage.getItem("token"),L=localStorage.getItem("role"),k=de({}),O=s=>{const t=Array.from(s.target.files||[]),v=t.filter(o=>o.type.startsWith("image/"));if(v.length!==t.length){P.error("Only image files are allowed");return}c(o=>[...o,...v])},z=s=>{c(t=>t.filter((v,o)=>o!==s))},M=ue({api:`${B.getModules}`,key:"getModule",value:[],options:{enabled:!0}}),{data:y,isLoading:ye}=me({api:`${B.getBugById}/${S}`,key:`getBug-${S}`,options:{enabled:r}});m.useEffect(()=>{if(y!=null&&y.data){const s=y.data;C({type:s.entry_type==="Bug"?"Bug":"Enhancement",module:s.module_name,title:s.title,description:s.description,source:s.source,priority:s.priority,complexity:s.complexity}),p(s.screenshots||[])}},[y,C]);const W=async s=>{var R;if(a.length>5){P.error("Maximum 5 screenshots allowed");return}const t=new FormData;t.append("type",s.type),t.append("module",s.module),t.append("title",s.title),t.append("description",s.description),t.append("source",s.source),t.append("priority",s.priority),t.append("user_role",L),t.append("user_id",ge),r||t.append("user_token",H),s.complexity&&t.append("complexity",s.complexity),a.forEach(G=>{t.append("files",G)}),r&&t.append("bugId",S);const v=r?`${B.updateBug}`:`${B.createBug}`,o=await k.mutateAsync({api:v,data:t});o.status===201||o.status===200?(P.success(r?"Bug updated successfully!":"Bug reported successfully!"),I("/bug-tracking/dashboard/bug/list"),C(),c([])):P.error(((R=o==null?void 0:o.data)==null?void 0:R.message)||`Failed to ${r?"update":"report"} bug`)};return e.jsxs(ee,{children:[e.jsxs(se,{children:[e.jsxs(te,{className:"space-y-1 border-b bg-muted/40",children:[e.jsx(ae,{className:"text-2xl font-semibold",children:r?"Update Bug":"Report New Bug"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r?"Modify the details of the reported bug":"Fill out the form below to report a bug or request an enhancement"})]}),e.jsx(re,{className:"pt-6",children:e.jsxs("form",{onSubmit:V(W),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"type",children:"Type *"}),e.jsxs(b,{onValueChange:s=>g("type",s),value:j("type"),children:[e.jsx(f,{children:e.jsx(N,{placeholder:"Select type"})}),e.jsxs(w,{children:[e.jsx(i,{value:"Bug",children:"Bug"}),e.jsx(i,{value:"Enhancement",children:"Enhancement"})]})]}),u.type&&e.jsx("p",{className:"text-sm text-red-500",children:"Type is required"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"module_name",children:"Module *"}),e.jsxs(b,{onValueChange:s=>g("module",s),value:j("module"),children:[e.jsx(f,{children:e.jsx(N,{placeholder:"Select module"})}),e.jsx(w,{children:(U=(F=M==null?void 0:M.data)==null?void 0:F.data)==null?void 0:U.map(s=>e.jsx(i,{value:s.module_name,children:s.module_name},s.id))})]}),u.module&&e.jsx("p",{className:"text-sm text-red-500",children:"Module is required"})]}),L==="Developer"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"priority",children:"Priority *"}),e.jsxs(b,{onValueChange:s=>g("priority",s),value:j("priority"),children:[e.jsx(f,{children:e.jsx(N,{placeholder:"Select priority"})}),e.jsxs(w,{children:[e.jsx(i,{value:"Low",children:"Low"}),e.jsx(i,{value:"Medium",children:"Medium"}),e.jsx(i,{value:"High",children:"High"}),e.jsx(i,{value:"Critical",children:"Critical"})]})]}),u.priority&&e.jsx("p",{className:"text-sm text-red-500",children:"Priority is required"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"source",children:"Source *"}),e.jsxs(b,{onValueChange:s=>g("source",s),value:j("source"),children:[e.jsx(f,{children:e.jsx(N,{placeholder:"Select source"})}),e.jsxs(w,{children:[e.jsx(i,{value:"Web",children:"Web"}),e.jsx(i,{value:"Mobile App",children:"Mobile App"}),e.jsx(i,{value:"API",children:"API"}),e.jsx(i,{value:"Other",children:"Other"})]})]}),u.source&&e.jsx("p",{className:"text-sm text-red-500",children:"Source is required"})]}),L==="Developer"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"complexity",children:"Complexity"}),e.jsxs(b,{onValueChange:s=>g("complexity",s),value:j("complexity"),children:[e.jsx(f,{children:e.jsx(N,{placeholder:"Select complexity"})}),e.jsxs(w,{children:[e.jsx(i,{value:"Low",children:"Low"}),e.jsx(i,{value:"Medium",children:"Medium"}),e.jsx(i,{value:"High",children:"High"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"title",children:"Title *"}),e.jsx(ie,{id:"title",placeholder:"Enter a descriptive title for the bug",...E("title",{required:"Title is required"})}),u.title&&e.jsx("p",{className:"text-sm text-red-500",children:u.title.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"description",children:"Description *"}),e.jsx(le,{id:"description",rows:4,placeholder:"Provide detailed description of the bug or enhancement request",...E("description",{required:"Description is required"})}),u.description&&e.jsx("p",{className:"text-sm text-red-500",children:u.description.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Screenshots"}),e.jsxs("div",{className:"rounded-lg border-2 border-dashed  text-center",children:[e.jsxs("label",{htmlFor:"screenshots",className:"cursor-pointer ",children:[e.jsx(he,{className:"mx-auto h-12 w-12 text-muted-foreground mt-4"}),e.jsxs("span",{className:"block text-sm font-medium p-2",children:["Upload screenshots",e.jsx("p",{className:"text-xs text-muted-foreground",children:"PNG, JPG up to 5MB"})]})]}),e.jsx("input",{id:"screenshots",type:"file",multiple:!0,accept:"image/*",className:"hidden p-6",onChange:O})]}),r&&e.jsx("p",{className:"text-xs font-semibold text-muted-foreground mt-1",children:"Note: Any new screenshots uploaded will be added to the existing collection."})]}),r&&l.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(n,{className:"text-muted-foreground",children:"Existing Screenshots"}),e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4 lg:grid-cols-5",children:l.map((s,t)=>e.jsxs("div",{className:"group relative aspect-video overflow-hidden rounded-xl border-2 border-muted bg-muted shadow-sm transition-all hover:border-indigo-300 hover:shadow-md",children:[e.jsx("img",{src:s,alt:`Existing ${t}`,className:"h-full w-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 opacity-0 backdrop-blur-[2px] transition-all duration-300 group-hover:opacity-100",children:e.jsx(x,{type:"button",size:"icon",variant:"secondary",className:"h-9 w-9 rounded-full shadow-lg transition-transform hover:scale-110",onClick:()=>h(s),children:e.jsx($,{className:"h-4 w-4 text-indigo-600"})})})]},`existing-${t}`))})]}),e.jsxs("div",{className:"space-y-3",children:[a.length>0&&e.jsx(n,{className:"text-muted-foreground",children:"New Screenshots to Upload"}),a.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4 lg:grid-cols-5",children:a.map((s,t)=>e.jsx(je,{file:s,onPreview:h,onRemove:()=>z(t)},`${s.name}-${t}`))})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>{r?I("/bug-tracking/dashboard/bug/list"):(C(),c([]))},children:r?"Cancel":"Reset"}),e.jsx(x,{type:"submit",disabled:k.isPending,className:_("min-w-[160px] rounded-full transition-all duration-300",k.isPending?"bg-indigo-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 "),children:k.isPending?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:r?"Updating...":"Submitting..."})]}):e.jsx("div",{className:"flex items-center justify-center gap-2",children:r?"Update Bug Report":"Submit Bug Report"})})]})]})})]}),e.jsx(ne,{open:!!d,onOpenChange:s=>{s||h(null)},children:e.jsx(ce,{className:"max-w-3xl overflow-hidden rounded-2xl border-none p-0 bg-transparent shadow-none",children:d&&e.jsxs("div",{className:"relative group animate-in zoom-in duration-300",children:[e.jsx("img",{src:d,alt:"Screenshot preview",className:"h-auto max-h-[85vh] w-full rounded-2xl object-contain shadow-2xl"}),e.jsx(x,{variant:"destructive",size:"icon",className:"absolute top-4 right-4 h-10 w-10 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300",onClick:()=>h(null),children:e.jsx(q,{className:"h-5 w-5"})})]})})})]})}function je({file:a,onPreview:c,onRemove:l}){const[p,d]=m.useState("");return m.useEffect(()=>{const h=URL.createObjectURL(a);return d(h),()=>URL.revokeObjectURL(h)},[a]),e.jsxs("div",{className:"group relative aspect-video overflow-hidden rounded-xl border-2 border-muted bg-muted shadow-sm transition-all hover:border-indigo-300 hover:shadow-md",children:[p&&e.jsx("img",{src:p,alt:a.name,className:"h-full w-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center gap-2 bg-black/40 opacity-0 backdrop-blur-[2px] transition-all duration-300 group-hover:opacity-100",children:[e.jsx(x,{type:"button",size:"icon",variant:"secondary",className:"h-9 w-9 rounded-full shadow-lg transition-transform hover:scale-110",onClick:()=>c(p),children:e.jsx($,{className:"h-4 w-4 text-indigo-600"})}),e.jsx(x,{type:"button",size:"icon",variant:"destructive",className:"h-9 w-9 rounded-full shadow-lg transition-transform hover:scale-110",onClick:l,children:e.jsx(q,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/50 px-2 py-1 opacity-0 transition-opacity group-hover:opacity-100",children:e.jsx("p",{className:"truncate text-[10px] font-medium text-white",children:a.name})})]})}export{Pe as default};
