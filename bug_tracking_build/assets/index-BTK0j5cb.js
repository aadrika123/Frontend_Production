import{r as y,p as P,j as e,B as u,o as z}from"./index-B9f-aXV3.js";import{c as M,a as H,C as W,b as J,d as U,e as X}from"./index-DDQwAWAd.js";import{I as G,S as j,a as p,b as v,c as b,d as l}from"./select-DNb7lknl.js";import{a as B}from"./useCustomQuery-BMEgx2mP.js";import{X as K}from"./x-TBfgy6sq.js";import{B as Y}from"./BugTable-DE9O06r3.js";import{S as Z}from"./StatusCountCards-Ch7Qh2QF.js";import{C as ee}from"./rotate-ccw-DP7wUCBQ.js";import"./PriorityBadge-DHyntzwf.js";import"./en-US-8upN5vI8.js";import"./eye-CgjAS1Nj.js";const se=M("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);const ae=M("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);const V=M("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);function le({onSearch:f,onFilter:C,onClearFilters:N}){var r,g;const[c,m]=y.useState(""),[t,i]=y.useState({}),S=s=>{s.preventDefault(),f(c)},n=(s,d)=>{const w={...t,[s]:d==="all"?void 0:d||void 0};i(w),C(w)},k=()=>{m(""),i({}),N()},x=B({api:`${P.getModules}`,key:"getModule",value:[],options:{enabled:!0}}),F=Object.values(t).some(Boolean)||c;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("form",{onSubmit:S,className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(V,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),e.jsx(G,{placeholder:"Search by Bug ID or Title...",value:c,onChange:s=>m(s.target.value),className:"pl-10"})]}),e.jsx(u,{type:"submit",variant:"outline",children:e.jsx(V,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filters:"})]}),e.jsxs(j,{value:t.status===void 0?"all":t.status||"all",onValueChange:s=>n("status",s),children:[e.jsx(p,{className:"w-32",children:e.jsx(v,{placeholder:"Status"})}),e.jsxs(b,{children:[e.jsx(l,{value:"all",children:"All Status"}),e.jsx(l,{value:"Open",children:"Open"}),e.jsx(l,{value:"Resolved",children:"Resolved"}),e.jsx(l,{value:"Rejected",children:"Rejected"}),e.jsx(l,{value:"Closed",children:"Closed"}),e.jsx(l,{value:"Re-Open",children:"Re-Open"})]})]}),e.jsxs(j,{value:t.type===void 0?"all":t.type||"all",onValueChange:s=>n("type",s),children:[e.jsx(p,{className:"w-32",children:e.jsx(v,{placeholder:"Type"})}),e.jsxs(b,{children:[e.jsx(l,{value:"all",children:"All Types"}),e.jsx(l,{value:"Bug",children:"Bug"}),e.jsx(l,{value:"Enhancement",children:"Enhancement"})]})]}),e.jsxs(j,{value:t.module===void 0?"all":t.module||"all",onValueChange:s=>n("module",s),children:[e.jsx(p,{className:"w-40",children:e.jsx(v,{placeholder:"Module"})}),e.jsxs(b,{children:[e.jsx(l,{value:"all",children:"All Modules"}),(g=(r=x==null?void 0:x.data)==null?void 0:r.data)==null?void 0:g.map(s=>e.jsx(l,{value:s.module_name,children:s.module_name},s.id))]})]}),e.jsxs(j,{value:t.priority===void 0?"all":t.priority||"all",onValueChange:s=>n("priority",s),children:[e.jsx(p,{className:"w-32",children:e.jsx(v,{placeholder:"Priority"})}),e.jsxs(b,{children:[e.jsx(l,{value:"all",children:"All Priority"}),e.jsx(l,{value:"Low",children:"Low"}),e.jsx(l,{value:"Medium",children:"Medium"}),e.jsx(l,{value:"High",children:"High"}),e.jsx(l,{value:"Critical",children:"Critical"})]})]}),e.jsxs(j,{value:t.source===void 0?"all":t.source||"all",onValueChange:s=>n("source",s),children:[e.jsx(p,{className:"w-32",children:e.jsx(v,{placeholder:"Source"})}),e.jsxs(b,{children:[e.jsx(l,{value:"all",children:"All Sources"}),e.jsx(l,{value:"Web",children:"Web"}),e.jsx(l,{value:"Mobile App",children:"Mobile App"}),e.jsx(l,{value:"API",children:"API"}),e.jsx(l,{value:"Other",children:"Other"})]})]}),F&&e.jsxs(u,{variant:"outline",size:"sm",onClick:k,children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"Clear All"]})]})]})}function A(){return e.jsx("div",{className:"animate-pulse flex space-x-4 mt-6",children:e.jsxs("div",{className:"flex-1 space-y-4 py-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})]})})}function je(){var L,I,O,_,D;const f=z(),[C,N]=y.useState(""),[c,m]=y.useState({}),[t,i]=y.useState(1),S=10,n=localStorage.getItem("role"),k=localStorage.getItem("user_id"),x=Object.entries(c).filter(([a,h])=>h!==void 0&&h!=="").map(([a,h])=>`${a}=${h}`).join("&"),F=`${P.getAllBugs}?page=${t}&limit=${S}&${x}`,r=B({api:F,key:"getAllBugs",value:[t,C,JSON.stringify(c)],config:{user_role:n,user_id:k},options:{enabled:!!n}}),g=((I=(L=r.data)==null?void 0:L.data)==null?void 0:I.list)||[],s=(_=(O=r.data)==null?void 0:O.data)==null?void 0:_.pagination,d=(s==null?void 0:s.totalPages)||0,w=a=>{N(a),i(1)},E=a=>{m(a),i(1)},T=()=>{N(""),m({}),i(1)},Q=a=>{f(`/bug-tracking/dashboard/bug/details/${a}`)},q=a=>{f(`/bug-tracking/dashboard/bug/create?id=${a.id}`)},R=()=>{r.refetch()},o=(D=B({api:`/${P.getDashboardData}`,key:"getDashboardData",config:{user_role:n},options:{}}).data)==null?void 0:D.data,$=o!=null&&o.summary?{total:o.summary.total,open:o.summary.open,resolved:o.summary.resolved,rejected:o.summary.rejected,closed:o.summary.closed,reopen:o.summary.re_open}:null;return e.jsx(H,{children:e.jsxs(W,{className:"shadow-xl border-none bg-background/60 backdrop-blur-md",children:[e.jsx(J,{className:"border-b bg-muted/30 pb-6",children:e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(U,{className:"text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent",children:"Bug Reports"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage and track all reported bugs and enhancement requests with ease."})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(u,{variant:"outline",size:"sm",onClick:R,disabled:r.isFetching,className:"rounded-full shadow-sm",children:[e.jsx(ae,{className:r.isFetching?"animate-spin h-3.5 w-3.5 mr-2":"h-3.5 w-3.5 mr-2"}),"Refresh"]})})]})}),e.jsx("div",{className:"p-4",children:$&&e.jsx(Z,{stats:$})}),e.jsxs(X,{className:"pt-8 space-y-8",children:[e.jsx(le,{onSearch:w,onFilter:E,onClearFilters:T}),r.error&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg flex items-start gap-3 animate-in fade-in zoom-in duration-300",children:[e.jsx(ee,{className:"h-5 w-5 mt-0.5 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-sm",children:"Error fetching bugs"}),e.jsxs("p",{className:"text-xs opacity-90 mt-1",children:["Something went wrong while loading the bug reports. Please try again later.",e.jsx("button",{onClick:R,className:"ml-2 font-bold underline hover:no-underline",children:"Retry"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center px-1",children:e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:r.isLoading?"Retrieving latest reports...":e.jsxs(e.Fragment,{children:["Showing ",e.jsx("span",{className:"text-foreground font-bold",children:g.length})," of ",e.jsx("span",{className:"text-foreground font-bold",children:(s==null?void 0:s.total)||0})," bugs"]})})}),r.isLoading?e.jsxs("div",{className:"space-y-4",children:[e.jsx(A,{}),e.jsx(A,{}),e.jsx(A,{})]}):e.jsx(Y,{bugs:g,onViewDetails:Q,onEdit:q})]}),!r.isLoading&&!r.error&&d>1&&e.jsxs("div",{className:"flex justify-center gap-2 pt-6",children:[e.jsx(u,{variant:"outline",disabled:t===1||r.isFetching,onClick:()=>i(a=>Math.max(a-1,1)),className:"rounded-lg shadow-sm hover:bg-indigo-50 hover:text-indigo-600 transition-colors",children:"Previous"}),e.jsx("div",{className:"flex gap-1.5",children:Array.from({length:d},(a,h)=>h+1).map(a=>e.jsx(u,{variant:t===a?"default":"outline",className:`w-10 rounded-lg shadow-sm transition-all duration-200 ${t===a?"bg-indigo-600 hover:bg-indigo-700 scale-110":"hover:bg-indigo-50 hover:text-indigo-600"}`,onClick:()=>i(a),disabled:r.isFetching,children:a},a))}),e.jsx(u,{variant:"outline",disabled:t===d||r.isFetching,onClick:()=>i(a=>Math.min(a+1,d)),className:"rounded-lg shadow-sm hover:bg-indigo-50 hover:text-indigo-600 transition-colors",children:"Next"})]})]})]})})}export{je as default};
