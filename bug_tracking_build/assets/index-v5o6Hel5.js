import{X as he,o as ue,r as m,p as pe,j as e,B as t,h as ge,q as B,_ as o}from"./index-CdtImIfY.js";import{c as O,a as I,C as A,b as S,e as M,L as je}from"./index-Cw_QZTVG.js";import{D as h,b,a as u,c as f,d as v,T as L,L as fe}from"./dialog-DoPZyXEX.js";import{S as ae,P as ve,a as Ne,f as K}from"./PriorityBadge-BIciG31y.js";import{u as ye,c as be,b as we,a as Ce}from"./useCustomQuery-BTJMCGvy.js";import{R as ke,H as te,M as Re,f as De}from"./RotatingLoader-CJ4HhDm2.js";import{C as H,a as Be,R as Ae}from"./rotate-ccw-DiuvyOrY.js";import"./en-US-8upN5vI8.js";const Z=O("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const Se=O("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const ee=O("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);const Me=O("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function He({userRole:r="Bug Reporter"}){var Q,U,X,G,J;const{bugId:n}=he(),y=ue(),[l,i]=m.useState(""),[w,p]=m.useState(!1),[C,c]=m.useState(!1),[x,P]=m.useState(!1),[re,_]=m.useState(!1),[le,T]=m.useState(!1),[ne,z]=m.useState(!1),{user:g}=pe(),$=(g==null?void 0:g.roleName)||"",E=(g==null?void 0:g._id)||0,de=ye({}),F=be({}),k=we({api:`${B.getBugById}/${n}`,key:`getBugById-${n}`,options:{enabled:!!n}}),Y=Ce({api:`${B.getActivityRecord}`,key:`getActivity-${n}`,config:{bugId:n},options:{enabled:!!n}}),s=(Q=k.data)==null?void 0:Q.data,j=((U=Y.data)==null?void 0:U.data)||[];if(k.isLoading)return e.jsx(I,{children:e.jsx("div",{className:"flex h-[60vh] items-center justify-center",children:e.jsx(ke,{})})});if(k.error||!s)return e.jsx(I,{children:e.jsxs("div",{className:"py-20 text-center animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsx("div",{className:"inline-flex h-20 w-20 items-center justify-center rounded-full bg-red-50 text-red-600 mb-6",children:e.jsx(H,{className:"h-10 w-10"})}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Bug Not Found"}),e.jsx("p",{className:"mt-3 text-gray-500 max-w-md mx-auto",children:"The requested bug report could not be found or there was an error fetching it."}),e.jsxs(t,{onClick:()=>y("/bug-tracking/dashboard/bug/list"),className:"mt-8 rounded-full px-8 shadow-lg shadow-indigo-100",variant:"default",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Back to Bug List"]})]})});const R=async(a,d)=>{try{await de.mutateAsync({api:`${B.updateStatus}/${n}/change-status`,data:{status:a,remarks:d||l,user_role:$,user_id:E}}),o.success(`Bug ${a.toLowerCase()} successfully`),k.refetch(),Y.refetch(),i(""),p(!1),c(!1),P(!1),_(!1)}catch{o.error("Failed to update status")}},ie=()=>{if(!l.trim()){o.error("Please provide a resolution summary");return}R("Resolved",l)},oe=()=>{if(!l.trim()){o.error("Please provide a rejection reason");return}R("Rejected",l)},ce=()=>{if(!l.trim()){o.error("Please provide closing remarks");return}R("Closed",l)},xe=()=>{if(!l.trim()){o.error("Please provide reopening remarks");return}R("Re-Open",l)},q=$==="Developer"&&["Open","Re-Open"].includes(s.status),V=["Open","Resolved","Rejected","Re-Open"].includes(s.status),W=["Closed","Resolved","Rejected"].includes(s.status),me=async()=>{try{await F.mutateAsync({api:`${B.deleteBug}/${n}`,data:{user_role:$,user_id:E}}),o.success("Bug deleted successfully"),y("/bug-tracking/dashboard/bug/list")}catch{o.error("Failed to delete bug")}};return e.jsxs(I,{children:[e.jsxs("div",{className:"w-full b space-y-8 animate-in fade-in duration-700 pb-10",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(t,{variant:"outline",onClick:()=>y("/bug-tracking/dashboard/bug/list"),className:"bg-card shadow-sm border-border hover:bg-accent text-foreground rounded-md px-4",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Back to Bug List"]})})}),e.jsxs("div",{className:"space-y-1 flex items-center justify-between bg-background p-4 rounded-xl",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 ",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-foreground",children:s.tracking_no}),e.jsx(N,{label:"",value:e.jsx(ae,{status:s==null?void 0:s.status,className:"px-3 py-1 text-xs"})})]}),e.jsx("p",{className:"text-muted-foreground text-lg",children:s.title})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(t,{variant:"outline",onClick:()=>y(`/bug-tracking/dashboard/bug/create?id=${n}`),className:"border-indigo-200 text-muted-foreground hover:bg-indigo-50 hover:text-indigo-800",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Edit Bug"]}),e.jsxs(t,{variant:"destructive",onClick:()=>T(!0),className:"bg-red-600 hover:bg-red-700 text-white shadow-sm",children:[e.jsx(Me,{className:"mr-2 h-4 w-4"}),"Delete Bug"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-8 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-8 lg:col-span-2",children:[e.jsxs(A,{className:"border border-border shadow-sm overflow-hidden bg-card rounded-xl",children:[e.jsx(S,{className:"pb-4",children:e.jsx("h3",{className:"text-lg font-bold text-foreground",children:"Bug Details"})}),e.jsxs(M,{className:"space-y-10",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-y-10 gap-x-12 md:grid-cols-5",children:[e.jsx(N,{label:"Priority",value:e.jsx(Ne,{priority:s==null?void 0:s.priority,className:"px-3 py-1"})}),e.jsx(N,{label:"Type",value:e.jsx("span",{className:ge("px-3 py-1 rounded-full text-xs font-semibold",(s==null?void 0:s.entry_type)==="Bug"?"bg-destructive text-destructive-foreground":(s==null?void 0:s.entry_type)==="Enhancement"?"bg-indigo-100 text-indigo-700":"bg-muted text-muted-foreground"),children:s==null?void 0:s.entry_type})}),e.jsx(N,{label:"Module",value:(s==null?void 0:s.module_name)||"Authentication"}),e.jsx(N,{label:"Source",value:(s==null?void 0:s.source)||"Mobile App"}),e.jsx(N,{label:"Complexity",value:(s==null?void 0:s.complexity)||"Medium"})]}),e.jsxs("div",{className:"space-y-3 pt-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-tight",children:"Description"}),e.jsx("p",{className:"text-foreground/90 leading-relaxed text-[15px]",children:s==null?void 0:s.description})]}),e.jsxs("div",{className:"flex items-center gap-8 pt-6 text-[13px] text-muted-foreground border-t border-border",children:[e.jsxs("span",{children:["Created: ",K(new Date(s==null?void 0:s.created_at),"MMMM do, yyyy h:mm a")]}),e.jsxs("span",{className:"ml-auto",children:["Updated: ",K(new Date(s==null?void 0:s.updated_at),"MMMM do, yyyy h:mm a")]})]})]})]}),e.jsxs(A,{className:"border border-border shadow-sm overflow-hidden bg-card rounded-xl",children:[e.jsxs(S,{className:"pb-4 flex flex-row items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("h3",{className:"text-lg font-bold text-foreground",children:["Screenshots (",((X=s==null?void 0:s.screenshots)==null?void 0:X.length)||0,")"]})]}),e.jsx(M,{className:"pt-2",children:s!=null&&s.screenshots&&((G=s==null?void 0:s.screenshots)==null?void 0:G.length)>0?e.jsx("div",{className:"grid grid-cols-2 gap-6 md:grid-cols-3",children:(J=s==null?void 0:s.screenshots)==null?void 0:J.map((a,d)=>e.jsxs(h,{children:[e.jsx(b,{asChild:!0,children:e.jsx("div",{className:"group relative cursor-pointer overflow-hidden rounded-lg border border-border transition-all hover:border-primary/50",children:e.jsx("img",{src:a,className:"h-48 w-full object-cover",alt:`Attachment ${d+1}`,onError:D=>{D.target.src="https://placehold.co/600x400?text=Image+Not+Found"}})})}),e.jsx(u,{className:"max-w-4xl p-0 border-none bg-transparent shadow-none overflow-hidden",children:e.jsx("img",{src:a,className:"max-h-[85vh] w-full object-contain rounded-lg",alt:`Attachment Full ${d+1}`})})]},d))}):e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-muted-foreground bg-muted/20 rounded-lg border border-dashed border-border",children:[e.jsx(ee,{className:"h-8 w-8 mb-2 opacity-20"}),e.jsx("p",{children:"No screenshots attached"})]})})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs(A,{className:"border border-border shadow-sm overflow-hidden bg-card rounded-xl",children:[e.jsx(S,{className:"pb-4",children:e.jsx("h3",{className:"text-lg font-bold text-foreground",children:"Actions"})}),e.jsx(M,{className:"space-y-4",children:q||V||W?e.jsxs("div",{className:"space-y-3",children:[q&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{open:w,onOpenChange:p,children:[e.jsx(b,{asChild:!0,children:e.jsx(t,{className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg h-11",variant:"default",children:"Resolve Bug"})}),e.jsxs(u,{className:"sm:max-w-[425px] rounded-2xl",children:[e.jsx(f,{children:e.jsxs(v,{className:"text-xl flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5 text-green-500"}),"Resolution Details"]})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground ml-1",children:"Resolution Summary"}),e.jsx(L,{placeholder:"What was the root cause and how did you solve it?",value:l,onChange:a=>i(a.target.value),rows:5,className:"rounded-xl border-border bg-background focus:border-primary focus:ring-primary/20 transition-all resize-none shadow-sm"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx(t,{variant:"ghost",onClick:()=>p(!1),className:"rounded-full",children:"Cancel"}),e.jsx(t,{onClick:ie,className:"bg-primary text-primary-foreground rounded-full px-8 transition-all hover:bg-primary/90 shadow-md shadow-primary/10 active:scale-95",children:"Resolve Bug"})]})]})]})]}),e.jsxs(h,{open:C,onOpenChange:c,children:[e.jsx(b,{asChild:!0,children:e.jsx(t,{className:"w-full border-red-200 text-red-600  rounded-lg h-11",variant:"outline",children:"Reject Report"})}),e.jsxs(u,{className:"sm:max-w-[425px] rounded-2xl",children:[e.jsx(f,{children:e.jsxs(v,{className:"text-xl flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5 text-destructive"}),"Rejection Detail"]})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground ml-1",children:"Reason for Rejection"}),e.jsx(L,{placeholder:"Please explain why this report is being rejected...",value:l,onChange:a=>i(a.target.value),rows:5,className:"rounded-xl border-border bg-background focus:border-destructive focus:ring-destructive/20 transition-all resize-none shadow-sm"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx(t,{variant:"ghost",onClick:()=>c(!1),className:"rounded-full",children:"Cancel"}),e.jsx(t,{variant:"destructive",onClick:oe,className:"rounded-full px-8 transition-all shadow-md shadow-destructive/10 active:scale-95",children:"Confirm Rejection"})]})]})]})]})]}),V&&e.jsxs(h,{open:x,onOpenChange:P,children:[e.jsx(b,{asChild:!0,children:e.jsx(t,{className:"w-full bg-gray-900 border-none transition-all hover:bg-black text-white rounded-lg h-11",variant:"default",children:"Close Issue"})}),e.jsxs(u,{className:"sm:max-w-[425px] rounded-2xl",children:[e.jsx(f,{children:e.jsxs(v,{className:"text-xl flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5 text-gray-700"}),"Close Bug Report"]})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground px-1",children:"Are you sure you want to close this bug? This marks the lifecycle as complete."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground ml-1",children:"Closing Remarks"}),e.jsx(L,{placeholder:"Add any final thoughts or closing remarks...",value:l,onChange:a=>i(a.target.value),rows:4,className:"rounded-xl border-gray-200 focus:border-gray-900 focus:ring-gray-900/10 transition-all resize-none shadow-sm"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx(t,{variant:"ghost",onClick:()=>P(!1),className:"rounded-full",children:"Cancel"}),e.jsx(t,{onClick:ce,className:"bg-gray-900 rounded-full px-8 transition-all  shadow-md active:scale-95 text-white",children:"Yes, Close Bug"})]})]})]})]}),W&&e.jsxs(h,{open:re,onOpenChange:_,children:[e.jsx(b,{asChild:!0,children:e.jsx(t,{className:"w-full border-indigo-200 text-muted-foreground rounded-lg h-11",variant:"outline",children:"Re-Open Bug"})}),e.jsxs(u,{className:"sm:max-w-[425px] rounded-2xl",children:[e.jsx(f,{children:e.jsxs(v,{className:"text-xl flex items-center gap-2",children:[e.jsx(Ae,{className:"h-5 w-5 text-primary"}),"Re-Open Bug Report"]})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground px-1",children:"Are you sure you want to re-open this bug? This will set the status back to 'Re-Open'."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground ml-1",children:"Re-Opening Reason"}),e.jsx(L,{placeholder:"Why is this bug being re-opened?",value:l,onChange:a=>i(a.target.value),rows:4,className:"rounded-xl border-border bg-background focus:border-primary focus:ring-primary/20 transition-all resize-none shadow-sm"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx(t,{variant:"ghost",onClick:()=>_(!1),className:"rounded-full",children:"Cancel"}),e.jsx(t,{onClick:xe,className:"bg-primary text-primary-foreground rounded-full px-8 transition-all hover:bg-primary/90 shadow-md shadow-primary/10 active:scale-95",children:"Yes, Re-Open"})]})]})]})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center py-4 text-center rounded-lg",children:e.jsx("p",{className:"text-[15px] text-muted-foreground",children:"No actions available for current status"})})})]}),e.jsxs(A,{className:"border border-border shadow-sm overflow-hidden bg-card rounded-xl",children:[e.jsx(S,{className:"pb-4 flex flex-row items-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-foreground",children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-5 w-5",children:e.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})}),e.jsx("h3",{className:"text-lg font-bold",children:"Activity Timeline"})]})}),e.jsx(M,{className:"pt-2",children:e.jsx("div",{className:"space-y-8 relative",children:j.length>0?e.jsxs(e.Fragment,{children:[j.slice(0,6).map((a,d,D)=>e.jsx(se,{record:a,isLast:d===D.length-1},a.id)),j.length>6&&e.jsx("div",{className:"pt-2",children:e.jsxs(t,{variant:"ghost",className:"w-full text-indigo-600 hover:text-indigo-700 hover:bg-indigo-50 border border-dashed border-indigo-200",onClick:()=>z(!0),children:["View All Activity (",j.length,")"]})})]}):e.jsx("div",{className:"text-sm text-muted-foreground italic py-4 pl-2",children:"No activity records found"})})})]})]})]})]}),e.jsx(h,{open:le,onOpenChange:T,children:e.jsxs(u,{className:"sm:max-w-[425px] rounded-2xl",children:[e.jsx(f,{children:e.jsxs(v,{className:"text-xl flex items-center gap-2 text-destructive",children:[e.jsx(H,{className:"h-5 w-5"}),"Delete Bug Report"]})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("p",{className:"text-sm text-foreground/80 leading-relaxed",children:["Are you sure you want to delete this bug report permanently?",e.jsx("span",{className:"block mt-2 font-medium text-destructive",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(t,{variant:"ghost",onClick:()=>T(!1),className:"rounded-full",children:"Cancel"}),e.jsx(t,{variant:"destructive",onClick:me,className:"rounded-full px-6 shadow-md shadow-destructive/10",disabled:F.isPending,children:F.isPending?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Yes, Delete Bug"})]})]})]})}),e.jsx(h,{open:ne,onOpenChange:z,children:e.jsxs(u,{className:"max-w-3xl max-h-[85vh] flex flex-col",children:[e.jsx(f,{children:e.jsxs(v,{className:"text-xl flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5 text-indigo-600"}),"Full Activity History"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 -mr-2 pt-4",children:e.jsx("div",{className:"space-y-8 relative pb-4",children:j.map((a,d)=>e.jsx(se,{record:a,isLast:d===j.length-1},a.id))})})]})})]})}const N=({label:r,value:n})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-[12px] font-semibold uppercase tracking-tight text-muted-foreground",children:r}),e.jsx("div",{className:"text-[15px] font-semibold text-foreground",children:n})]}),se=({record:r,isLast:n})=>{var w,p,C;const l=(c=>{const x=c.toLowerCase();return x.includes("closed")?"Closed":x.includes("resolved")?"Resolved":x.includes("re-open")||x.includes("reopen")?"Re-Open":x.includes("rejected")?"Rejected":null})(r.message),i=((w=r.data)==null?void 0:w.new_status)||l;return e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted flex items-center justify-center font-bold text-muted-foreground text-[13px] border border-border shrink-0 uppercase",children:((p=r.user)==null?void 0:p.split(" ").map(c=>c[0]).join(""))||"SY"}),!n&&e.jsx("div",{className:"w-[1.5px] bg-muted/50 flex-1"})]}),e.jsxs("div",{className:"flex-1 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r.action==="status_changed"?e.jsx(Re,{className:"h-3.5 w-3.5 text-primary"}):r.action==="created"?e.jsx(H,{className:"h-3.5 w-3.5 text-green-500"}):e.jsx(te,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("span",{className:"font-bold text-[15px] text-foreground",children:r.user||"System User"})]}),e.jsx("span",{className:"text-[11px] font-medium px-2 py-0.5 bg-muted text-muted-foreground rounded",children:(r==null?void 0:r.role)||"Developer"}),e.jsx("span",{className:"text-[11px] text-muted-foreground opacity-70",children:De(new Date(r.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:"text-[14px] text-foreground/80 leading-relaxed mb-1",children:r.message}),r.remarks&&e.jsxs("p",{className:"text-[14px] text-foreground/90 font-medium italic mt-2 pl-3 border-l-2 border-primary/40 bg-muted/10 py-1",children:['"',r.remarks,'"']}),i&&e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[((C=r.data)==null?void 0:C.new_status)&&e.jsx("span",{className:"text-[11px] text-muted-foreground uppercase font-bold tracking-tight",children:"New Status:"}),e.jsx(ae,{status:i,className:"px-2 py-0.5 text-[10px]"})]})]})]})};export{He as default};
