import{r as f,q as P,j as e,B as x,o as H,p as W}from"./index-CzG2eDNw.js";import{c as M,a as J,C as U,b as X,d as G,e as K}from"./index-Don3RHD6.js";import{I as Y,S as p,a as v,b,c as y,d as l}from"./select-BhEl8iqX.js";import{a as B}from"./useCustomQuery-3HzKznw8.js";import{X as Z}from"./x-CbusAyS8.js";import{B as ee}from"./BugTable-5CbXfTIq.js";import{S as se}from"./StatusCountCards-DHpX3k1_.js";import{C as ae}from"./rotate-ccw-1fiL3SOh.js";import"./PriorityBadge-iPJUgSXy.js";import"./en-US-8upN5vI8.js";import"./eye-CIIXURrI.js";const le=M("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);const te=M("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);const E=M("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);function re({onSearch:N,onFilter:S,onClearFilters:w}){var C,r;const[h,g]=f.useState(""),[t,n]=f.useState({}),k=s=>{s.preventDefault(),N(h)},i=(s,d)=>{const c={...t,[s]:d==="all"?void 0:d||void 0};n(c),S(c)},j=()=>{g(""),n({}),w()},u=B({api:`${P.getModules}`,key:"getModule",value:[],options:{enabled:!0}}),F=Object.values(t).some(Boolean)||h;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("form",{onSubmit:k,className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(E,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),e.jsx(Y,{placeholder:"Search by Bug ID or Title...",value:h,onChange:s=>g(s.target.value),className:"pl-10"})]}),e.jsx(x,{type:"submit",variant:"outline",children:e.jsx(E,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filters:"})]}),e.jsxs(p,{value:t.status===void 0?"all":t.status||"all",onValueChange:s=>i("status",s),children:[e.jsx(v,{className:"w-32",children:e.jsx(b,{placeholder:"Status"})}),e.jsxs(y,{children:[e.jsx(l,{value:"all",children:"All Status"}),e.jsx(l,{value:"Open",children:"Open"}),e.jsx(l,{value:"Resolved",children:"Resolved"}),e.jsx(l,{value:"Rejected",children:"Rejected"}),e.jsx(l,{value:"Closed",children:"Closed"}),e.jsx(l,{value:"Re-Open",children:"Re-Open"})]})]}),e.jsxs(p,{value:t.type===void 0?"all":t.type||"all",onValueChange:s=>i("type",s),children:[e.jsx(v,{className:"w-32",children:e.jsx(b,{placeholder:"Type"})}),e.jsxs(y,{children:[e.jsx(l,{value:"all",children:"All Types"}),e.jsx(l,{value:"Bug",children:"Bug"}),e.jsx(l,{value:"Enhancement",children:"Enhancement"})]})]}),e.jsxs(p,{value:t.module===void 0?"all":t.module||"all",onValueChange:s=>i("module",s),children:[e.jsx(v,{className:"w-40",children:e.jsx(b,{placeholder:"Module"})}),e.jsxs(y,{children:[e.jsx(l,{value:"all",children:"All Modules"}),(r=(C=u==null?void 0:u.data)==null?void 0:C.data)==null?void 0:r.map(s=>e.jsx(l,{value:s.module_name,children:s.module_name},s.id))]})]}),e.jsxs(p,{value:t.priority===void 0?"all":t.priority||"all",onValueChange:s=>i("priority",s),children:[e.jsx(v,{className:"w-32",children:e.jsx(b,{placeholder:"Priority"})}),e.jsxs(y,{children:[e.jsx(l,{value:"all",children:"All Priority"}),e.jsx(l,{value:"Low",children:"Low"}),e.jsx(l,{value:"Medium",children:"Medium"}),e.jsx(l,{value:"High",children:"High"}),e.jsx(l,{value:"Critical",children:"Critical"})]})]}),e.jsxs(p,{value:t.source===void 0?"all":t.source||"all",onValueChange:s=>i("source",s),children:[e.jsx(v,{className:"w-32",children:e.jsx(b,{placeholder:"Source"})}),e.jsxs(y,{children:[e.jsx(l,{value:"all",children:"All Sources"}),e.jsx(l,{value:"Web",children:"Web"}),e.jsx(l,{value:"Mobile App",children:"Mobile App"}),e.jsx(l,{value:"API",children:"API"}),e.jsx(l,{value:"Other",children:"Other"})]})]}),F&&e.jsxs(x,{variant:"outline",size:"sm",onClick:j,children:[e.jsx(Z,{className:"h-4 w-4 mr-1"}),"Clear All"]})]})]})}function A(){return e.jsx("div",{className:"animate-pulse flex space-x-4 mt-6",children:e.jsxs("div",{className:"flex-1 space-y-4 py-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})]})})}function ve(){var L,O,D,V,_;const N=H(),[S,w]=f.useState(""),[h,g]=f.useState({}),[t,n]=f.useState(1),k=10,{user:i}=W(),j=(i==null?void 0:i.roleName)||"",u=Number(i==null?void 0:i._id),F=Object.entries(h).filter(([a,m])=>m!==void 0&&m!=="").map(([a,m])=>`${a}=${m}`).join("&"),C=`${P.getAllBugs}?page=${t}&limit=${k}&${F}`,r=B({api:C,key:"getAllBugs",value:[t,S,JSON.stringify(h)],config:{user_role:j,user_id:u},options:{enabled:!!j}}),s=((O=(L=r.data)==null?void 0:L.data)==null?void 0:O.list)||[],d=(V=(D=r.data)==null?void 0:D.data)==null?void 0:V.pagination,c=(d==null?void 0:d.totalPages)||0,I=a=>{w(a),n(1)},T=a=>{g(a),n(1)},Q=()=>{w(""),g({}),n(1)},q=a=>{N(`/bug-tracking/dashboard/bug/details/${a}`)},z=a=>{N(`/bug-tracking/dashboard/bug/create?id=${a.id}`)},R=()=>{r.refetch()},o=(_=B({api:`${P.getDashboardData}`,key:"getDashboardData",config:{user_role:j,user_id:u},options:{}}).data)==null?void 0:_.data,$=o!=null&&o.summary?{total:o.summary.total,open:o.summary.open,resolved:o.summary.resolved,rejected:o.summary.rejected,closed:o.summary.closed,reopen:o.summary.re_open}:null;return e.jsx(J,{children:e.jsxs(U,{className:"shadow-xl border-none bg-background/60 backdrop-blur-md",children:[e.jsx(X,{className:"border-b bg-muted/30 pb-6",children:e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(G,{className:"text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent",children:"Bug Reports"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage and track all reported bugs and enhancement requests with ease."})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(x,{variant:"outline",size:"sm",onClick:R,disabled:r.isFetching,className:"rounded-full shadow-sm",children:[e.jsx(te,{className:r.isFetching?"animate-spin h-3.5 w-3.5 mr-2":"h-3.5 w-3.5 mr-2"}),"Refresh"]})})]})}),e.jsx("div",{className:"p-4",children:$&&e.jsx(se,{stats:$})}),e.jsxs(K,{className:"pt-8 space-y-8",children:[e.jsx(re,{onSearch:I,onFilter:T,onClearFilters:Q}),r.error&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg flex items-start gap-3 animate-in fade-in zoom-in duration-300",children:[e.jsx(ae,{className:"h-5 w-5 mt-0.5 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-sm",children:"Error fetching bugs"}),e.jsxs("p",{className:"text-xs opacity-90 mt-1",children:["Something went wrong while loading the bug reports. Please try again later.",e.jsx("button",{onClick:R,className:"ml-2 font-bold underline hover:no-underline",children:"Retry"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center px-1",children:e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:r.isLoading?"Retrieving latest reports...":e.jsxs(e.Fragment,{children:["Showing ",e.jsx("span",{className:"text-foreground font-bold",children:s.length})," of ",e.jsx("span",{className:"text-foreground font-bold",children:(d==null?void 0:d.total)||0})," bugs"]})})}),r.isLoading?e.jsxs("div",{className:"space-y-4",children:[e.jsx(A,{}),e.jsx(A,{}),e.jsx(A,{})]}):e.jsx(ee,{bugs:s,onViewDetails:q,onEdit:z})]}),!r.isLoading&&!r.error&&c>1&&e.jsxs("div",{className:"flex justify-center gap-2 pt-6",children:[e.jsx(x,{variant:"outline",disabled:t===1||r.isFetching,onClick:()=>n(a=>Math.max(a-1,1)),className:"rounded-lg shadow-sm hover:bg-indigo-50 hover:text-indigo-600 transition-colors",children:"Previous"}),e.jsx("div",{className:"flex gap-1.5",children:Array.from({length:c},(a,m)=>m+1).map(a=>e.jsx(x,{variant:t===a?"default":"outline",className:`w-10 rounded-lg shadow-sm transition-all duration-200 ${t===a?"bg-indigo-600 hover:bg-indigo-700 scale-110":"hover:bg-indigo-50 hover:text-indigo-600"}`,onClick:()=>n(a),disabled:r.isFetching,children:a},a))}),e.jsx(x,{variant:"outline",disabled:t===c||r.isFetching,onClick:()=>n(a=>Math.min(a+1,c)),className:"rounded-lg shadow-sm hover:bg-indigo-50 hover:text-indigo-600 transition-colors",children:"Next"})]})]})]})})}export{ve as default};
