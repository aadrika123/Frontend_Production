import{E as I,H as P,I as V,J as F,S as L,R as g,K as $,N as U,O as j,c as _,A as z,Q as p,j as u,b as S,P as O,F as k,d as H}from"./index-c417ed65.js";import{u as x}from"./formik.esm-4b198280.js";import{c as M,a as R,f as Q}from"./index.esm-17a0b653.js";import{F as N,T as q,L as C,P as D}from"./LoadingButton-36699544.js";import"./index.esm-795b2a20.js";var J=function(a){I(e,a);function e(n,s){var t;return t=a.call(this)||this,t.client=n,t.setOptions(s),t.bindMethods(),t.updateResult(),t}var i=e.prototype;return i.bindMethods=function(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)},i.setOptions=function(s){this.options=this.client.defaultMutationOptions(s)},i.onUnsubscribe=function(){if(!this.listeners.length){var s;(s=this.currentMutation)==null||s.removeObserver(this)}},i.onMutationUpdate=function(s){this.updateResult();var t={listeners:!0};s.type==="success"?t.onSuccess=!0:s.type==="error"&&(t.onError=!0),this.notify(t)},i.getCurrentResult=function(){return this.currentResult},i.reset=function(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})},i.mutate=function(s,t){return this.mutateOptions=t,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,P({},this.options,{variables:typeof s<"u"?s:this.options.variables})),this.currentMutation.addObserver(this),this.currentMutation.execute()},i.updateResult=function(){var s=this.currentMutation?this.currentMutation.state:V(),t=P({},s,{isLoading:s.status==="loading",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset});this.currentResult=t},i.notify=function(s){var t=this;F.batch(function(){t.mutateOptions&&(s.onSuccess?(t.mutateOptions.onSuccess==null||t.mutateOptions.onSuccess(t.currentResult.data,t.currentResult.variables,t.currentResult.context),t.mutateOptions.onSettled==null||t.mutateOptions.onSettled(t.currentResult.data,null,t.currentResult.variables,t.currentResult.context)):s.onError&&(t.mutateOptions.onError==null||t.mutateOptions.onError(t.currentResult.error,t.currentResult.variables,t.currentResult.context),t.mutateOptions.onSettled==null||t.mutateOptions.onSettled(void 0,t.currentResult.error,t.currentResult.variables,t.currentResult.context))),s.listeners&&t.listeners.forEach(function(m){m(t.currentResult)})})},e}(L);function K(a,e,i){return typeof e=="function"?e.apply(void 0,i):typeof e=="boolean"?e:!!a}function W(a,e,i){var n=g.useRef(!1),s=g.useState(0),t=s[1],m=$(a,e,i),o=U(),r=g.useRef();r.current?r.current.setOptions(m):r.current=new J(o,m);var h=r.current.getCurrentResult();g.useEffect(function(){n.current=!0;var l=r.current.subscribe(F.batchCalls(function(){n.current&&t(function(d){return d+1})}));return function(){n.current=!1,l()}},[]);var c=g.useCallback(function(l,d){r.current.mutate(l,d).catch(j)},[]);if(h.error&&K(void 0,r.current.options.useErrorBoundary,[h.error]))throw h.error;return P({},h,{mutate:c,mutateAsync:h.mutate})}const G=(a,e)=>_.post(a,e,{...z()}),E=({options:a})=>W({mutationFn:({api:e,data:i})=>G(e,i),...a}),X=M({mobile:R().required("Enter mobile number")});function Y({next:a,data:e,setData:i}){const{mutateAsync:n}=E({}),{send_otp:s}=O(),t=x({enableReinitialize:!0,initialValues:{mobile:e.mobile||""},validationSchema:X,onSubmit:async(m,{})=>{var o,r,h;try{const c=await n({api:s,data:{mobile:m.mobile}});(o=c==null?void 0:c.data)!=null&&o.status?(a({...e,mobile:m.mobile}),p.success((r=c==null?void 0:c.data)==null?void 0:r.message)):p.error((h=c==null?void 0:c.data)==null?void 0:h.message)}catch(c){p.error(c==null?void 0:c.message)}}});return u("div",{className:"py-10",children:S(N,{formik:t,children:[S("div",{className:"mb-5",children:[u(q,{label:"Mobile",name:"mobile",type:"text",formik:t,placeholder:"Enter your register mobile no"})," "]}),u(C,{type:t.isSubmitting?"button":"submit",disabled:t.isSubmitting,loading:t.isSubmitting,children:"SEND OTP"})]})})}const Z=a=>{const[e,i]=g.useState(0),[n,s]=g.useState(!1);g.useEffect(()=>{let r;return n?(i(60*a),r=setInterval(()=>{i(h=>h-1)},1e3)):clearInterval(r),()=>clearInterval(r)},[n]),g.useEffect(()=>{e<0&&n&&(s(!1),i(0))},[e,n]);const t=()=>s(r=>!r),m=String(e%60).padStart(2,0);return{minutes:String(Math.floor(e/60)).padStart(2,0),seconds:m,togglerTimer:t,runTimer:n}},B=Z,tt=M().shape({otp:R().required("OTP is required")});function et({next:a,data:e,setData:i,prev:n}){const{minutes:s,seconds:t,togglerTimer:m,runTimer:o}=B(.5),{verify_otp:r}=O(),{mutateAsync:h,isLoading:c}=E({}),l=x({enableReinitialize:!0,initialValues:{mobile:(e==null?void 0:e.mobile)||"",otp:(e==null?void 0:e.otp)||""},validationSchema:tt,onSubmit:async(v,{})=>{var w,y,b,T,A;try{const f=await h({api:r,data:{mobile:v==null?void 0:v.mobile,Otp:v==null?void 0:v.otp}});console.log(f),(w=f==null?void 0:f.data)!=null&&w.status?(a({...e,otp:v.otp,token:(b=(y=f==null?void 0:f.data)==null?void 0:y.data)==null?void 0:b.token}),p.success((T=f==null?void 0:f.data)==null?void 0:T.message)):p.error((A=f==null?void 0:f.data)==null?void 0:A.message)}catch(f){p.error(f==null?void 0:f.message)}}});g.useEffect(()=>(m(),()=>{m()}),[]);const d=async()=>{var v,w,y;try{const b=await h({api:r,data:{mobile:e==null?void 0:e.mobile}});(v=b==null?void 0:b.data)!=null&&v.status?(p.success((w=b==null?void 0:b.data)==null?void 0:w.message),i({...e,otp:""}),l.setFieldValue("otp",""),m()):p.error((y=b==null?void 0:b.data)==null?void 0:y.message)}catch(b){p.error(b==null?void 0:b.message)}};return u("div",{className:"py-2",children:S(N,{formik:l,children:[S("h1",{className:"text-sm mt-8 mb-4",children:["Please enter the 6-digit verification code sent to your phone number",l==null?void 0:l.values.mobile," ",u("span",{className:"text-sm text-blue-700",onClick:()=>n({mobile:l==null?void 0:l.values.mobile,otp:""}),children:"Edit"})]}),u("div",{className:"mb-5",children:u(q,{label:"Verify OTP",name:"otp",type:"text",formik:l})}),u(C,{type:l.isSubmitting?"button":"submit",disabled:l.isSubmitting,loading:l.isSubmitting,className:"mb-5",children:"Verify OTP"}),S("div",{className:"text-center  text-sm",children:["Didn't receive the code?"," ",c?u("small",{className:"text-gray-700 text-sm",children:"Please wait..."}):u(k,{children:o?S("span",{className:"text-gray-700 cursor-pointer",children:["Resend in ",s,":",t]}):u("span",{className:"text-blue-700 cursor-pointer",onClick:d,children:"Resend OTP"})})]})]})})}const st=M().shape({newPassword:R().required("New Password is required"),confirmPassword:R().required("Confirm Password is required").oneOf([Q("newPassword"),null],"Passwords must match")});function nt({next:a,data:e,setData:i,prev:n}){const s=H(),{reset_password:t}=O(),{mutateAsync:m}=E({}),o=x({enableReinitialize:!0,initialValues:{newPassword:"",confirmPassword:""},validationSchema:st,onSubmit:async(r,{})=>{var h,c,l;try{const d=await m({api:t,data:{token:e==null?void 0:e.token,password:r==null?void 0:r.newPassword}});(h=d==null?void 0:d.data)!=null&&h.status?(a(r,!0),p.success((c=d==null?void 0:d.data)==null?void 0:c.message),s("/")):p.error((l=d==null?void 0:d.data)==null?void 0:l.message)}catch(d){p.error(d==null?void 0:d.message)}}});return u("div",{className:"py-10",children:S(N,{formik:o,children:[u("h1",{className:"text-lg mt-5 mb-4 font-semibold",children:"Create New Password"}),u(D,{label:"New Password",name:"newPassword",formik:o}),u(D,{label:"Confirm Password",name:"confirmPassword",formik:o}),u(C,{type:o.isSubmitting?"button":"submit",disabled:o.isSubmitting,loading:o.isSubmitting,children:"RESET PASSWORD"})]})})}function ct(){const[a,e]=g.useState(0),[i,n]=g.useState({mobile:"",otp:"",newPassword:"",confirmPassword:"",token:""}),s=o=>{console.log(o)},t=(o,r=!1)=>{if(n({...i,...o}),r){s(o);return}e(a+1)},m=o=>{n({...i,...o}),e(a-1)};return u(k,{children:u("div",{children:{0:u(Y,{next:t,data:i,setData:n}),1:u(et,{next:t,prev:m,data:i,setData:n}),2:u(nt,{next:t,prev:m,data:i,setData:n})}[a]})})}export{ct as default};
