import{R as _,_ as le,e as Me,r as l,d as qe,u as Be,c as S,A as E,b as s,F as N,j as e,M as te,P as $e}from"./index-ecdac0ad.js";import{u as He}from"./formik.esm-8bbe0021.js";import{u as Ye,I as se,r as O}from"./resizeImage-9bc427cd.js";import{A as Je}from"./ApiHeader2-b363f7b8.js";import{c as Ke,b as G}from"./index.esm-8b2ed50e.js";import{u as ae}from"./useSetTitle-b26589a5.js";/* empty css                */const V="/assets/photo-506bbc5b.png",Qe=_.lazy(()=>le(()=>import("./CommonLoader-49327880.js"),["assets/CommonLoader-49327880.js","assets/index-ecdac0ad.js","assets/index-ad617cf2.css","assets/BeatLoader-ac806c05.js"])),We=_.lazy(()=>le(()=>import("./ForwardScreen-7742fb8e.js"),["assets/ForwardScreen-7742fb8e.js","assets/index-ecdac0ad.js","assets/index-ad617cf2.css","assets/resizeImage-9bc427cd.js","assets/Hourglass-dbf5f692.js","assets/formik.esm-8bbe0021.js"])),ot=()=>{const{notify:I,roleName:w}=_.useContext(Me),{isGeolocationAvailable:Xe,isGeolocationEnabled:Ze,coords:r,getPosition:De}=Ye(),[i,z]=l.useState(),[v,ne]=l.useState(null),M=qe(),[ie,F]=l.useState(""),[ce,re]=l.useState(),[C,q]=l.useState(null),[o,oe]=l.useState(),[de,B]=l.useState(!1),[me,pe]=l.useState(),[L,$]=l.useState(null),[d,ge]=l.useState(),[ue,H]=l.useState(!1),[fe,he]=l.useState(),[U,Y]=l.useState(null),[m,xe]=l.useState(),[be,J]=l.useState(!1),[j,et]=l.useState(0),[tt,Ne]=l.useState(!1),[we,y]=l.useState(!1),[ye,A]=l.useState(""),[K,u]=l.useState(!1),{getTcData:Ie,api_getStaticSafDetails:ve,api_getgbSafDetails:Se,post_safGeoTagging:_e,post_gbSafGeoTagging:Fe}=$e(),{id:x,type:g,isBack:Q}=Be();g=="saf"&&ae("SAF Geo-Tagging"),g=="gbSaf"&&ae("GB SAF Geo-Tagging"),l.useEffect(()=>{setTimeout(()=>{u(!1)},1e4),u(!0),w=="utc"&&Ue(),g=="saf"?Le():Ce()},[w,g,x]);const Ce=()=>{S.post(Se,{applicationId:x},E()).then(t=>{var a;console.log("getting application data => ",t),z((a=t==null?void 0:t.data)==null?void 0:a.data)}).catch(t=>{console.log("getting application data error => ",t)}).finally(()=>u(!1))},Le=()=>{S.post(ve,{applicationId:x},E()).then(t=>{var a;console.log("getting application data => ",t),w=="tc"&&u(!1),z((a=t==null?void 0:t.data)==null?void 0:a.data)}).catch(t=>{console.log("getting application data error => ",t),w=="tc"&&u(!1)})},Ue=()=>{S.post(Ie,{safId:x},E()).then(t=>{var a,n,h,p;((a=t==null?void 0:t.data)==null?void 0:a.status)==!0&&(console.log("getting tc data => ",t),ne((h=(n=t==null?void 0:t.data)==null?void 0:n.data)==null?void 0:h.geoTagging),u(!1)),((p=t==null?void 0:t.data)==null?void 0:p.status)==!1&&(u(!1),M("/search/property"),I("Please try again after sometime !!!","error"))}).catch(t=>{console.log("error getting tc data => ",t),M("/search/property"),I("Something went wrong !!!","error"),u(!1)})},je=Ke({frontImage:G().required("required to upload"),leftImage:G().required("required to upload"),rightImage:G().required("required to upload")}),c=He({initialValues:{frontImage:"",leftImage:"",rightImage:""},onSubmit:t=>{if(console.log("submitting images => ",t),(i==null?void 0:i.payment_status)==0){W();return}else y(!0),A("forward")},validationSchema:je}),W=()=>{u(!0);let t;g=="saf"&&(t=_e),g=="gbSaf"&&(t=Fe);let a=new FormData;a.append("safId",x),a.append("directionType[2]","Front"),de?a.append("imagePath[2]",T(C,"FrontImage.jpg")):a.append("imagePath[2]",ce),a.append("longitude[2]",o==null?void 0:o.longitude),a.append("latitude[2]",o==null?void 0:o.latitude),a.append("directionType[1]","Right"),ue?a.append("imagePath[1]",T(L,"RightImage.jpg")):a.append("imagePath[1]",me),a.append("longitude[1]",d==null?void 0:d.longitude),a.append("latitude[1]",d==null?void 0:d.latitude),a.append("directionType[0]","Left"),be?a.append("imagePath[0]",T(U,"LeftImage.jpg")):a.append("imagePath[0]",fe),a.append("longitude[0]",m==null?void 0:m.longitude),a.append("latitude[0]",m==null?void 0:m.latitude),S.post(t,a,Je()).then(n=>{var h,p,b;((h=n==null?void 0:n.data)==null?void 0:h.status)==!0&&(console.log("success images",n),I("Geo-Tagged Successfully","success"),(i==null?void 0:i.payment_status)==0?window.location.replace(`/property/viewDemand/${x}`):(F("true"),Ne(!0))),((p=n==null?void 0:n.data)==null?void 0:p.status)==!1&&(console.log("error images",n),I((b=n==null?void 0:n.data)==null?void 0:b.message,"error"),alert(n==null?void 0:n.data),F("false"),y(!1))}).catch(n=>{console.log("error images => ",n),I("Server Error","error"),alert(n),F("false"),y(!1)}).finally(()=>u(!1))};function T(t,a){const n=t.split(","),h=n[0].match(/:(.*?);/)[1],p=atob(n[1]);let b=p.length;const ee=new Uint8Array(b);for(;b--;)ee[b]=p.charCodeAt(b);return new File([ee],a,{type:h})}l.useState(null),l.useState(0);const X=l.useRef(null),P=l.useRef(null),[f,Z]=l.useState(null),Ae=()=>{P.current.getContext("2d").drawImage(X.current,0,0);const a=P.current.toDataURL("image/jpg");Z(a),console.log("image data captured => ",a)},R=async t=>{var a,n,h;if(t.target.name=="frontImage"){B(!1);const p=await O((a=t==null?void 0:t.target)==null?void 0:a.files[0]);oe({latitude:r==null?void 0:r.latitude,longitude:r==null?void 0:r.longitude}),re(p),q(URL.createObjectURL(p)),c.setFieldValue("flongitude",o==null?void 0:o.longitude),c.setFieldValue("flatitude",o==null?void 0:o.latitude)}if(t.target.name=="rightImage"){H(!1);const p=await O((n=t==null?void 0:t.target)==null?void 0:n.files[0]);ge({latitude:r==null?void 0:r.latitude,longitude:r==null?void 0:r.longitude}),pe(p),$(URL.createObjectURL(p)),c.setFieldValue("rlongitude",d==null?void 0:d.longitude),c.setFieldValue("rlatitude",d==null?void 0:d.latitude)}if(t.target.name=="leftImage"){J(!1);const p=await O((h=t==null?void 0:t.target)==null?void 0:h.files[0]);xe({latitude:r==null?void 0:r.latitude,longitude:r==null?void 0:r.longitude}),he(p),Y(URL.createObjectURL(p)),c.setFieldValue("llongitude",m==null?void 0:m.longitude),c.setFieldValue("llatitude",m==null?void 0:m.latitude)}},[Te,Pe]=l.useState(!1),[Re,D]=l.useState(!1),ke=t=>{D(!0),Z(t)},k=()=>{Pe(!1),D(!1)},Ee=()=>{},Oe=()=>{},Ge=()=>{const t=document.createElement("a");t.href=f,j==1&&(B(!0),q(f),c.setFieldValue("frontImage",f)),j==2&&(H(!0),$(f),c.setFieldValue("rightImage",f)),j==3&&(J(!0),Y(f),c.setFieldValue("leftImage",f)),t.click(),k()},Ve=()=>{y(!0),A("forward")},ze=()=>{y(!0),A("backward")};return s(N,{children:[K&&e(Qe,{}),e(We,{roleName:w,action:ye,openScreen:we,id:x,navigation:()=>W(),closePopUp:()=>y(!1),canSubmit:ie,type:g}),s("div",{className:"w-full",children:[e("h1",{className:"text-center text-base font-semibold border-b-2 py-2 border-[#838FCE] mx-4",children:"Field Verification Geo-Tagging"}),s("div",{className:"p-4 flex flex-col gap-y-4 rounded-sm",children:[s("div",{className:"w-full items-center justify-center px-4  py-4 shadow-sm flex md:flex-row flex-col flex-wrap gap-2 md:justify-evenly bg-indigo-50",children:[s("span",{className:"grid grid-cols-12 w-full text-sm gap-2 my-1",children:[e("span",{className:"col-span-6",children:"Your Application No.:"})," ",e("span",{className:"font-medium text-sm col-span-6",children:i==null?void 0:i.saf_no})]}),s("span",{className:"grid grid-cols-12 w-full text-sm  gap-2 my-1",children:[e("span",{className:"col-span-6",children:"Application Type:"})," ",e("span",{className:"font-medium text-sm col-span-6",children:i==null?void 0:i.assessment_type})]}),s("span",{className:"grid grid-cols-12 w-full text-sm  gap-1",children:[s("span",{className:"col-span-6",children:[g=="saf"&&"Property",g=="gbSaf"&&"Govt. Building Usage"," Type:"]})," ",s("span",{className:"font-medium text-sm col-span-6",children:[g=="saf"&&(i==null?void 0:i.property_type),g=="gbSaf"&&(i==null?void 0:i.building_type)]})]}),s("span",{className:"grid grid-cols-12 w-full text-sm  gap-2 my-1",children:[e("span",{className:"col-span-6",children:"Apply Date:"})," ",e("span",{className:"font-medium text-sm col-span-6",children:i==null?void 0:i.application_date})]})]}),w=="tc"?e(N,{children:!K&&s("form",{className:"border-1 border-[#838FCE] mb-4 rounded-md border shadow-md p-1",onChange:c.handleChange,onSubmit:c.handleSubmit,children:[e("h1",{className:"text-center rounded-md font-semibold uppercase text-sm py-1",children:"Upload Image"}),(Q=="true"||Q==!0)&&e("span",{className:"text-red-500 text-xs text-center pl-4 font-semibold pt-2",children:"Backwarded for Geo-Tagging"}),s("div",{className:"my-2 mx-1 rounded-md shadow-lg",children:[e("div",{className:"text-white bg-[#838FCE] px-2 py-1.5 text-sm font-semibold rounded-t-md",children:"Front Image"}),e("div",{className:"px-2 py-2",children:s("div",{className:"grid grid-cols-12 text-sm pb-2 px-2",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",children:e("img",{src:C??V,alt:"Front Image",srcset:"",className:"w-32 rounded-md"})}),s("span",{className:"col-span-12 grid grid-cols-12 mb-2",children:[e("span",{className:"col-span-8 text-sm flex items-center",children:"Capture Image :"}),e("span",{className:"col-span-5 text-xs mr-2",children:e("input",{type:"file",onChange:R,name:"frontImage",id:"",accept:"image/*",className:"bg-white px-2 py-1 w-full rounded-sm shadow-sm border-[1px] border-gray-400"})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:o==null?void 0:o.latitude})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:o==null?void 0:o.longitude})})]}),e("span",{className:"col-span-12 mt-2 text-center",children:c.touched.frontImage&&c.errors.frontImage&&e(N,{children:e("span",{className:"text-red-600 text-xs",children:c.errors.frontImage})})})]})})]}),s("div",{className:"my-2 mx-1 rounded-md shadow-lg",children:[e("div",{className:"text-white bg-[#838FCE] px-2 py-1.5 text-sm font-semibold rounded-t-md",children:"Right Image"}),e("div",{className:"px-2 py-2",children:s("div",{className:"grid grid-cols-12 text-sm pb-2 px-4",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",children:e("img",{src:L??V,alt:"Front Image",srcset:"",className:"w-32 rounded-md"})}),s("span",{className:"col-span-12 grid grid-cols-12 mb-2",children:[e("span",{className:"col-span-8 text-sm flex items-center",children:"Capture Image :"}),e("span",{className:"col-span-5 text-xs mr-1",children:e("input",{type:"file",onChange:R,name:"rightImage",id:"",accept:"image/*",className:"bg-white px-2 py-1 w-full rounded-sm shadow-sm border-[1px] border-gray-400"})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:d==null?void 0:d.latitude})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:d==null?void 0:d.longitude})})]}),e("span",{className:"col-span-12 mt-2 text-center",children:c.touched.rightImage&&c.errors.rightImage&&e(N,{children:e("span",{className:"text-red-600 text-xs",children:c.errors.rightImage})})})]})})]}),s("div",{className:"my-2 mx-1 rounded-md shadow-lg",children:[e("div",{className:"text-white bg-[#838FCE] px-2 py-1.5 text-sm font-semibold rounded-t-md",children:"Left Image"}),e("div",{className:"px-2 py-2",children:s("div",{className:"grid grid-cols-12 text-sm pb-2 px-4",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",children:e("img",{src:U??V,alt:"Front Image",srcset:"",className:"w-32 rounded-md"})}),s("span",{className:"col-span-12 grid grid-cols-12 mb-2",children:[e("span",{className:"col-span-8 text-sm flex items-center",children:"Capture Image :"}),e("span",{className:"col-span-5 text-xs mr-1",children:e("input",{type:"file",onChange:R,name:"leftImage",id:"",accept:"image/*",className:"bg-white px-2 py-1 w-full rounded-sm shadow-sm border-[1px] border-gray-300"})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:m==null?void 0:m.latitude})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:m==null?void 0:m.longitude})})]}),e("span",{className:"col-span-12 mt-2 text-center",children:c.touched.leftImage&&c.errors.leftImage&&e(N,{children:e("span",{className:"text-red-600 text-xs",children:c.errors.leftImage})})})]})})]}),e("div",{className:"w-full flex justify-center m-2",children:e("button",{type:"submit",className:"px-4 py-1.5 mr-4 text-sm text-white rounded-md shadow-md bg-green-500 hover:bg-green-600 focus:bg-green-600",children:(i==null?void 0:i.payment_status)==0?"Submit & Pay":"Forward"})})]})}):e(N,{children:e("div",{className:"w-full",children:s("div",{className:"border-2 border-blue-700 bg-blue-50 mb-4",children:[e("h1",{className:"text-center font-semibold bg-blue-700 text-white uppercase text-lg",children:"Images"}),Array.isArray(v)&&(v==null?void 0:v.map((t,a)=>e(_.Fragment,{children:s("div",{className:"bg-indigo-50 border-2 border-indigo-500 my-2 mx-1",children:[s("div",{className:"text-white bg-indigo-500 px-2 font-semibold capitalize",children:[t==null?void 0:t.direction_type," Image"]}),e("div",{className:"px-2 py-2",children:s("div",{className:"grid grid-cols-12 text-sm pb-2 px-2",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",onClick:()=>ke(t==null?void 0:t.doc_path),children:e("img",{src:`${t==null?void 0:t.doc_path}`,alt:t==null?void 0:t.direction_type,srcset:"",className:"w-3 rounded-md2"})}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:t==null?void 0:t.latitude})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:t==null?void 0:t.longitude})})]})]})})]})},a))),s("div",{className:"w-full flex items-center justify-between m-2",children:[e("button",{onClick:()=>ze(),className:"px-4 py-1.5 mr-4 text-sm text-white rounded-sm shadow-md bg-red-500 hover:bg-red-600 focus:bg-red-600",children:"Backward"}),e("button",{onClick:()=>Ve(),className:"px-4 py-1.5 mr-4 text-sm text-white rounded-sm shadow-md bg-green-500 hover:bg-green-600 focus:bg-green-600",children:"Forward"})]})]})})})]})]}),e(te,{isOpen:Te,onAfterOpen:Ee,className:"z-50 h-screen w-screen backdrop-blur-sm flex flex-row justify-center items-center overflow-auto",contentLabel:"Example Modal",children:s("div",{class:" animate__animated animate__zoomIn animate__faster rounded-lg md:ml-24 shadow-lg relative bg-gray-50 px-4 py-4 w-[90vw] mt-10 z-50 border-t-2 border-l-2 border-white overflow-auto",children:[e("div",{className:"absolute top-2 z-10 bg-red-200 hover:bg-red-300 right-2 rounded-full p-2 cursor-pointer",onClick:k,children:e(se,{fontSize:10})}),s("div",{className:"mt-6 w-full",children:[e("video",{ref:X,autoPlay:!0,className:""}),e("canvas",{ref:P,style:{display:"none"}}),e("div",{className:"w-full text-center my-4",children:e("button",{onClick:Ae,className:"text-sm px-4 py-1 bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 text-white rounded-md shadow-md",children:"Capture"})}),f&&s(N,{children:[e("img",{src:f,alt:"Captured Image"}),e("div",{className:"w-full text-center my-4",children:e("button",{onClick:Ge,className:"text-sm px-4 py-1 bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 text-white rounded-md shadow-md",children:"Save"})})]})]})]})}),e(te,{isOpen:Re,onAfterOpen:Oe,className:"z-20 h-screen w-screen backdrop-blur-sm flex flex-row justify-center items-center overflow-auto",contentLabel:"Example Modal",children:s("div",{className:" animate__animated animate__zoomIn animate__faster relative rounded-lg shadow-xl border-2 border-gray-50 px-0",style:{width:"95vw",height:"80vh"},children:[e("div",{className:"absolute top-2 z-40 bg-red-200 hover:bg-red-300 right-2 rounded-full p-2 cursor-pointer",onClick:k,children:e(se,{fontSize:10})}),e("div",{className:"w-full h-[77vh] overflow-auto flex flex-wrap items-center justify-center",children:e("img",{src:f,alt:"",srcset:""})})]})})]})};export{ot as default};
