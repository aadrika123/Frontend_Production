import{r as e,aO as a,j as s,aH as l,al as t}from"./vendor-RyuIgj66.js";import{P as r,D as n,b as i,c as d,e as c,f as o,h as x,i as m,j as h}from"./index-DFF4_m_G.js";import{C as j,a as p,d as u,c as v}from"./card-u7M7FP5y.js";import{c as g,e as f,h as y,B as N}from"./index-ey2GEmQz.js";import{B as b}from"./badge-DbWnzWn2.js";import{T as w,a as _,b as D,c as C,d as L,e as k}from"./table-B_npepsp.js";import{S as A,a as S,b as M,c as F,d as T}from"./select-8PAfYjod.js";import{T as $}from"./textarea-CIMcDPG7.js";import{I as B}from"./input-DlX9dTT0.js";import{L as P}from"./label-BcY3kv5U.js";import{C as z}from"./checkbox-DFFItNXW.js";import{u as O,b as R}from"./useCustomQuery-DTB6aAiD.js";import{al as E,O as H,a5 as q,s as I,a4 as Q,_ as U,F as V,aM as Y,$ as G}from"./icons-CxCh8mm_.js";import"./ui-B3c1eQmf.js";import"./query-BH9sOW2X.js";import"./axios-Dos3PyFQ.js";import"./zustand-C1rkr5lV.js";const J=()=>{var J,K;const{user:W}=g(),X=(null==W?void 0:W._id)?f(String(W._id)):null,Z=(new Date).getFullYear(),[ee,ae]=e.useState(!1),[se,le]=e.useState(""),[te,re]=e.useState(""),[ne,ie]=e.useState(""),[de,ce]=e.useState(""),[oe,xe]=e.useState(!1),me=O({}),{data:he,refetch:je}=R({api:`${y.getLeaveBalances}?emp_id=${X}&year=${Z}`,key:"leaveBalances",options:{enabled:!!(null==W?void 0:W._id)}}),{data:pe,refetch:ue}=R({api:`${y.getLeaveApplications}?emp_id=${X}&year=${Z}`,key:"leaveApplications",options:{enabled:!!(null==W?void 0:W._id)}}),{data:ve}=R({api:y.getLeaveTypesForApplication,key:"leaveTypes",options:{enabled:!0}}),ge=(null==(J=null==he?void 0:he.data)?void 0:J.balances)||[],fe=(null==(K=null==he?void 0:he.data)?void 0:K.summary)||{total_allocated:0,total_taken:0,total_remaining:0},ye=(null==pe?void 0:pe.data)||[],Ne=(null==ve?void 0:ve.data)||[],be=e.useMemo(()=>{if(!te||!ne)return 0;const e=a(new Date(ne),new Date(te))+1;return oe&&1===e?.5:e},[te,ne,oe]),we=()=>{le(""),re(""),ie(""),ce(""),xe(!1)},_e=e=>{switch(e){case 0:return s.jsxs(b,{variant:"outline",className:"border-yellow-200 bg-yellow-50 text-yellow-700",children:[s.jsx(Q,{className:"mr-1 h-3 w-3"})," Pending"]});case 1:return s.jsxs(b,{variant:"outline",className:"border-green-200 bg-green-50 text-green-700",children:[s.jsx(U,{className:"mr-1 h-3 w-3"})," Approved"]});case 2:return s.jsxs(b,{variant:"outline",className:"border-red-200 bg-red-50 text-red-700",children:[s.jsx(G,{className:"mr-1 h-3 w-3"})," Rejected"]});case 3:return s.jsxs(b,{variant:"outline",className:"border-gray-200 bg-gray-50 text-gray-700",children:[s.jsx(Y,{className:"mr-1 h-3 w-3"})," Cancelled"]});default:return s.jsx(b,{variant:"outline",children:"Unknown"})}};return s.jsx(r,{title:"Leave Management",children:s.jsxs("div",{className:"container mx-auto space-y-6 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Leave Management"}),s.jsx("p",{className:"text-muted-foreground",children:"Apply for leaves and track your leave balance"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(N,{variant:"outline",size:"sm",onClick:()=>{je(),ue()},children:[s.jsx(E,{className:"mr-2 h-4 w-4"}),"Refresh"]}),s.jsxs(n,{open:ee,onOpenChange:ae,children:[s.jsx(i,{asChild:!0,children:s.jsxs(N,{children:[s.jsx(H,{className:"mr-2 h-4 w-4"}),"Apply Leave"]})}),s.jsxs(d,{className:"sm:max-w-[500px]",children:[s.jsxs(c,{children:[s.jsx(o,{children:"Apply for Leave"}),s.jsx(x,{children:"Submit a new leave application for approval"})]}),s.jsxs("div",{className:"grid gap-4 py-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(P,{htmlFor:"leaveType",children:"Leave Type *"}),s.jsxs(A,{value:se,onValueChange:le,children:[s.jsx(S,{children:s.jsx(M,{placeholder:"Select leave type"})}),s.jsx(F,{children:Ne.map(e=>s.jsxs(T,{value:e.leave_type_name,children:[e.leave_type_name," (",e.leave_code,")"]},e.id))})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(P,{htmlFor:"startDate",children:"Start Date *"}),s.jsx(B,{id:"startDate",type:"date",value:te,onChange:e=>re(e.target.value)})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(P,{htmlFor:"endDate",children:"End Date *"}),s.jsx(B,{id:"endDate",type:"date",value:ne,min:te,onChange:e=>ie(e.target.value)})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(z,{id:"halfDay",checked:oe,onCheckedChange:e=>xe(e),disabled:be>1}),s.jsx(P,{htmlFor:"halfDay",className:"text-sm",children:"Half day leave (only for single day)"})]}),be>0&&s.jsx("div",{className:"rounded-lg bg-blue-50 p-3",children:s.jsxs("p",{className:"text-sm text-blue-700",children:[s.jsx(q,{className:"mr-1 inline h-4 w-4"}),"Total days: ",s.jsx("strong",{children:be})]})}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(P,{htmlFor:"reason",children:"Reason"}),s.jsx($,{id:"reason",placeholder:"Enter reason for leave...",value:de,onChange:e=>ce(e.target.value),rows:3})]})]}),s.jsxs(m,{children:[s.jsx(h,{asChild:!0,children:s.jsx(N,{variant:"outline",children:"Cancel"})}),s.jsx(N,{onClick:async()=>{var e,a,s,l;if(se&&te&&ne)try{const s=await me.mutateAsync({api:y.applyLeave,data:{emp_id:X,leave_type:se,start_date:te,end_date:ne,reason:de,is_half_day:oe}});(null==(e=null==s?void 0:s.data)?void 0:e.success)?(t.success(s.data.message||"Leave application submitted"),ae(!1),we(),je(),ue()):t.error((null==(a=null==s?void 0:s.data)?void 0:a.message)||"Failed to submit leave application")}catch(r){t.error((null==(l=null==(s=null==r?void 0:r.response)?void 0:s.data)?void 0:l.message)||"Failed to submit leave application")}else t.error("Please fill all required fields")},disabled:me.isPending,children:me.isPending?"Submitting...":"Submit Application"})]})]})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[s.jsxs(j,{children:[s.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(u,{className:"text-sm font-medium",children:"Total Allocated"}),s.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsxs(v,{children:[s.jsx("div",{className:"text-2xl font-bold",children:fe.total_allocated}),s.jsxs("p",{className:"text-xs text-muted-foreground",children:["Days allocated for ",Z]})]})]}),s.jsxs(j,{children:[s.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(u,{className:"text-sm font-medium",children:"Leaves Taken"}),s.jsx(Q,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsxs(v,{children:[s.jsx("div",{className:"text-2xl font-bold text-orange-600",children:fe.total_taken}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Days utilized"})]})]}),s.jsxs(j,{children:[s.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(u,{className:"text-sm font-medium",children:"Balance Remaining"}),s.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsxs(v,{children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:fe.total_remaining}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Days available"})]})]})]}),s.jsxs(j,{children:[s.jsx(p,{children:s.jsxs(u,{className:"flex items-center gap-2",children:[s.jsx(q,{className:"h-5 w-5"}),"Leave Balance by Type"]})}),s.jsx(v,{children:0===ge.length?s.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[s.jsx(V,{className:"mx-auto mb-4 h-12 w-12 opacity-50"}),s.jsx("p",{children:"No leave balances found for this year"})]}):s.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:ge.map((e,a)=>s.jsxs("div",{className:"rounded-lg border bg-gradient-to-r from-gray-50 to-white p-4",children:[s.jsxs("div",{className:"mb-2 flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold",children:e.leave_type_name}),s.jsx("p",{className:"text-xs text-muted-foreground",children:e.leave_code})]}),s.jsxs(b,{variant:"outline",className:"bg-green-50 text-green-700",children:[e.leaves_remaining," left"]})]}),s.jsxs("div",{className:"mt-3 space-y-1 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-muted-foreground",children:"Allocated:"}),s.jsx("span",{children:e.total_allocated})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-muted-foreground",children:"Carried:"}),s.jsx("span",{children:e.carried_forward})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-muted-foreground",children:"Taken:"}),s.jsx("span",{className:"text-orange-600",children:e.leaves_taken})]})]})]},a))})})]}),s.jsxs(j,{children:[s.jsx(p,{children:s.jsx(u,{children:"Leave Applications"})}),s.jsx(v,{children:0===ye.length?s.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[s.jsx(I,{className:"mx-auto mb-4 h-12 w-12 opacity-50"}),s.jsx("p",{children:"No leave applications found"}),s.jsx("p",{className:"text-sm",children:"Apply for a leave to get started"})]}):s.jsxs(w,{children:[s.jsx(_,{children:s.jsxs(D,{children:[s.jsx(C,{children:"Leave Type"}),s.jsx(C,{children:"Start Date"}),s.jsx(C,{children:"End Date"}),s.jsx(C,{children:"Days"}),s.jsx(C,{children:"Status"}),s.jsx(C,{children:"Applied On"}),s.jsx(C,{children:"Actions"})]})}),s.jsx(L,{children:ye.map(e=>s.jsxs(D,{children:[s.jsxs(k,{className:"font-medium",children:[e.leave_type,e.is_half_day&&s.jsx("span",{className:"ml-1 text-xs text-muted-foreground",children:"(Half day)"})]}),s.jsx(k,{children:l(new Date(e.start_date),"dd MMM yyyy")}),s.jsx(k,{children:l(new Date(e.end_date),"dd MMM yyyy")}),s.jsx(k,{children:e.total_days}),s.jsx(k,{children:_e(e.approval_status)}),s.jsx(k,{children:l(new Date(e.created_at),"dd MMM yyyy")}),s.jsx(k,{children:0===e.approval_status&&s.jsx(N,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700",onClick:()=>(async e=>{var a,s,l,r;try{const l=await me.mutateAsync({api:y.cancelLeave,data:{leave_id:e,emp_id:X}});(null==(a=null==l?void 0:l.data)?void 0:a.success)?(t.success(l.data.message||"Leave application cancelled"),ue()):t.error((null==(s=null==l?void 0:l.data)?void 0:s.message)||"Failed to cancel leave")}catch(n){t.error((null==(r=null==(l=null==n?void 0:n.response)?void 0:l.data)?void 0:r.message)||"Failed to cancel leave")}})(e.id),children:"Cancel"})})]},e.id))})]})})]})]})})};export{J as default};
