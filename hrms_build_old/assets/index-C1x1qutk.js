import{h as e,f as a,r as s,j as i,z as l,m as d,n as r,B as t,L as n,l as c}from"./index-BJ2Di0BB.js";import{P as o}from"./index-L2kacWh6.js";import{h as m}from"./moment-CBOc1lqT.js";import{C as x,a as p,c as u,b as v}from"./card-CrOEotWM.js";import{S as y,T as h,a as j,b,c as _,d as g,e as N}from"./index-BxKGIMG5.js";import{u as f,b as L}from"./useCustomQuery-DkqDqiry.js";import{S as P}from"./Spinner-DjUjMlqR.js";import{a as S,o as B,c as q,b as M,f as w}from"./yup-BTlf5Wf5.js";import{F as C}from"./datetime-picker-cKnQNXMD.js";import{R as E}from"./RHFTextField-BK1QXo_s.js";import{R as A}from"./RHFTextArea-CtK9XJcE.js";import{B as k}from"./ButtonLoading-B5GmY3N3.js";import"./select-4D5dQM-6.js";import{S as F}from"./separator-BtSn9EpY.js";import{D}from"./index-ClKtlEeL.js";import{G as R}from"./grid-3x3-BSgvruiA.js";import{P as $}from"./pen-CY8Xewxs.js";import{E as I}from"./eye-BEN4pZFN.js";import"./calendar-B99NsLtP.js";import"./clock-PqgEqIzL.js";import"./check-DiqtQ1XW.js";const V=q().shape({pay_commission_id:w().required("Pay Commission is required"),level:w().required("Level is required").positive("Level must be positive"),level_name:M().required("Level Name is required"),min_basic_pay:w().required("Minimum Basic Pay is required").positive("Must be positive"),max_basic_pay:w().required("Maximum Basic Pay is required").positive("Must be positive"),description:M().required("Description is required")}),G=q().shape({pay_commission_id:w().required("Pay Commission is required"),level:w().required("Level is required").positive("Level must be positive"),level_name:M().required("Level Name is required"),min_basic_pay:w().required("Minimum Basic Pay is required").positive("Must be positive"),max_basic_pay:w().required("Maximum Basic Pay is required").positive("Must be positive"),pay_band_name:M().required("Pay Band Name is required"),grade_pay:w().required("Grade Pay is required").positive("Must be positive"),description:M().nullable()});function T({open:d,setOpen:r,title:t,id:n,edit:c,setEdit:o,isMatrixBased:m,payCommissionId:x,payLevelListData:p}){var u,v,y,h,j;const b=f({}),_="true"===m||"1"===m,{data:g,isFetching:N}=L({api:`${null==(u=e)?void 0:u.getPayLevelById}?id=${a(String(n))}`,key:"getPayLevelById",options:{enabled:!!c}}),P=(null==p?void 0:p.data)&&(null==(y=null==(v=null==p?void 0:p.data)?void 0:v.data)?void 0:y.length)>0?Math.max(...null==(j=null==(h=null==p?void 0:p.data)?void 0:h.data)?void 0:j.map(e=>null==e?void 0:e.level))+1:0,q={pay_commission_id:x?Number(x):0,level:0,level_name:"",min_basic_pay:0,max_basic_pay:0,description:""},M={pay_commission_id:x?Number(x):0,level:0,level_name:"",min_basic_pay:0,max_basic_pay:0,pay_band_name:"",grade_pay:0,description:""},w=S({defaultValues:_?q:M,resolver:B(_?V:G)});return s.useEffect(()=>{(null==p?void 0:p.data)&&!c&&(w.setValue("level",P),w.setValue("level_name",`Level ${P}`))},[p,c,P,w]),s.useEffect(()=>{c&&(null==g?void 0:g.data)?w.reset(g.data):w.reset(_?q:M)},[c,g,w]),i.jsx(D,{open:d,setOpen:r,title:t,setEdit:o,edit:c,isLoading:N,children:i.jsx(C,{methods:w,onSubmit:w.handleSubmit(async a=>{var s,i,d,t,m,x,u,v;try{if(c&&a){const r=await b.mutateAsync({api:`${null==(s=e)?void 0:s.updatePayLevel}`,data:{id:n,pay_commission_id:a.pay_commission_id,level:a.level,level_name:a.level_name,min_basic_pay:a.min_basic_pay,max_basic_pay:a.max_basic_pay,...!_&&{pay_band_name:a.pay_band_name,pay_band_min:a.min_basic_pay,pay_band_max:a.min_basic_pay,grade_pay:a.grade_pay},description:a.description}});(null==(i=r.data)?void 0:i.success)?l.success(null==(d=null==r?void 0:r.data)?void 0:d.message):l.error((null==(t=r.data)?void 0:t.message)||"Pay Level not updated successfully")}else{const s=await b.mutateAsync({api:null==(m=e)?void 0:m.createPayLevel,data:{pay_commission_id:a.pay_commission_id,level:P||a.level,level_name:`Level ${P}`||a.level_name,min_basic_pay:a.min_basic_pay,max_basic_pay:a.max_basic_pay,...!_&&{pay_band_name:a.pay_band_name,pay_band_min:a.min_basic_pay,pay_band_max:a.min_basic_pay,grade_pay:a.grade_pay},description:a.description}});(null==(x=s.data)?void 0:x.success)?l.success(null==(u=null==s?void 0:s.data)?void 0:u.message):l.error((null==(v=s.data)?void 0:v.message)||"Pay Level not created successfully"),w.reset(_?q:M)}r(!1),o(!1),null==p||p.refetch()}catch(y){l.error("An error occurred. Please try again.")}}),children:i.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[i.jsx("input",{type:"hidden",...w.register("pay_commission_id"),value:x||""}),i.jsxs("div",{className:"grid grid-cols-2 gap-x-2",children:[i.jsx(E,{label:"Level",disabled:!0,type:"number",name:"level",placeholder:"Enter Level"}),i.jsx(E,{disabled:!0,name:"level_name",label:"Level Name",placeholder:"Enter Level Name",inputValidation:["removeSpecialCharacterExceptSpace"]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-x-2",children:[i.jsx(E,{type:"number",name:"min_basic_pay",label:"Minimum Basic Pay",placeholder:"Minimum Basic Pay"}),i.jsx(E,{type:"number",name:"max_basic_pay",label:"Maximum Basic Pay",placeholder:"Maximum Basic Pay"})]}),!_&&i.jsxs(i.Fragment,{children:[i.jsx("div",{children:i.jsx(E,{name:"pay_band_name",label:"Pay Band Name",placeholder:"Enter Pay Band Name (e.g., PB-2)"})}),i.jsx("div",{children:i.jsx(E,{type:"number",name:"grade_pay",label:"Grade Pay",placeholder:"Grade Pay"})})]}),i.jsx("div",{children:i.jsx(A,{name:"description",placeholder:"Enter description",label:"Description",rows:4,inputValidation:["removeSpecialCharacterExceptSpace"]})}),i.jsx(F,{}),i.jsx("div",{children:i.jsx(k,{isLoading:w.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function z(){var l,o,f,S,B,q,M,w,C,E,A,k,F,D;const[V]=d(),G=V.get("commission_id"),z=V.get("is_matrix_based"),O=V.get("commission_name"),[Y,H]=s.useState(""),[U,J]=s.useState(!1),[K,Q]=s.useState(""),[W,X]=s.useState(!1),[Z,ee]=s.useState("chart"),ae=L({api:`${null==(l=e)?void 0:l.getAllPayLevels}?pay_commission_id=${G}`,key:"getAllPayLevels",options:{enabled:!!G}});L({api:`${null==(o=e)?void 0:o.getPayLevelById}?id=${K}`,key:"getPayLevelById",value:[K],options:{enabled:!!K}});const se=e=>{X(!0),J(!0),Q(e)},ie=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e);return i.jsxs("main",{className:"grid items-start",children:[i.jsx(T,{open:U,setOpen:J,title:W?"Edit Pay Level":"Add Pay Level",id:K,edit:W,setEdit:X,isMatrixBased:z,payCommissionId:r(G||""),payLevelListData:ae}),i.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[i.jsx(x,{className:"border-l-4 border-l-blue-500",children:i.jsx(p,{className:"pb-3",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:O}),i.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"true"===z?"Matrix Based Commission":"Non-Matrix Based Commission"}),i.jsxs("p",{className:"mt-1 text-xs text-gray-400",children:["Total Levels: ",(null==(S=null==(f=null==ae?void 0:ae.data)?void 0:f.data)?void 0:S.length)||0]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs(t,{variant:"chart"===Z?"default":"outline",size:"sm",onClick:()=>ee("chart"),className:"flex items-center gap-2",children:[i.jsx(R,{className:"h-4 w-4"}),"Chart View"]}),i.jsxs(t,{variant:"list"===Z?"default":"outline",size:"sm",onClick:()=>ee("list"),className:"flex items-center gap-2",children:[i.jsx(n,{className:"h-4 w-4"}),"List View"]})]})]})})}),i.jsxs("div",{className:"flex w-full justify-between gap-2",children:[i.jsx("div",{className:"flex-1",children:i.jsx(y,{search:Y,setSearch:H,refetch:ae.refetch,isFetching:null==ae?void 0:ae.isLoading})}),i.jsx(t,{className:"flex items-center gap-2",onClick:()=>J(!0),children:"Add New Pay Level"})]}),ae.isLoading?i.jsx(x,{children:i.jsx(u,{className:"flex h-64 items-center justify-center",children:i.jsx(P,{})})}):"chart"===Z?i.jsxs(x,{children:[i.jsx(p,{className:"bg-gray-50",children:i.jsx("h2",{className:"text-center text-lg font-semibold",children:"PAY SCALE STRUCTURE"})}),i.jsx(u,{className:"p-0",children:i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full border-collapse",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"border-y-2 border-gray-300 bg-gray-100",children:[i.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left text-sm font-semibold",children:"Level"}),i.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left text-sm font-semibold",children:"Level Name"}),"true"===z?i.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left text-sm font-semibold",children:"Revised Pay Band (Rs.)"}):i.jsxs(i.Fragment,{children:[i.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left text-sm font-semibold",children:"Pay Band"}),i.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left text-sm font-semibold",children:"Grade Pay (Rs.)"})]}),i.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left text-sm font-semibold",children:"Description"}),i.jsx("th",{className:"border border-gray-300 px-4 py-3 text-center text-sm font-semibold",children:"Actions"})]})}),i.jsxs("tbody",{children:[null==(q=null==(B=null==ae?void 0:ae.data)?void 0:B.data)?void 0:q.map(e=>i.jsxs("tr",{className:"transition-colors hover:bg-blue-50",children:[i.jsx("td",{className:"border border-gray-300 px-4 py-3",children:i.jsxs("span",{className:"font-bold text-blue-600",children:["Level ",null==e?void 0:e.level]})}),i.jsx("td",{className:"border border-gray-300 px-4 py-3",children:i.jsx("span",{className:"font-medium",children:null==e?void 0:e.level_name})}),"true"===z?i.jsx("td",{className:"border border-gray-300 px-4 py-3",children:i.jsxs("div",{className:"font-medium",children:[ie(null==e?void 0:e.min_basic_pay)," -"," ",ie(null==e?void 0:e.max_basic_pay)]})}):i.jsxs(i.Fragment,{children:[i.jsx("td",{className:"border border-gray-300 px-4 py-3",children:(null==e?void 0:e.pay_band_name)?i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:null==e?void 0:e.pay_band_name}),i.jsxs("div",{className:"text-sm text-gray-600",children:[ie((null==e?void 0:e.pay_band_min)||0)," -"," ",ie((null==e?void 0:e.pay_band_max)||0)]})]}):i.jsx("span",{className:"text-gray-400",children:"-"})}),i.jsx("td",{className:"border border-gray-300 px-4 py-3 text-center",children:(null==e?void 0:e.grade_pay)?i.jsx("span",{className:"font-semibold",children:ie(null==e?void 0:e.grade_pay)}):i.jsx("span",{className:"text-gray-400",children:"-"})})]}),i.jsx("td",{className:"border border-gray-300 px-4 py-3",children:i.jsx("span",{className:"text-sm text-gray-600",children:(null==e?void 0:e.description)||"-"})}),i.jsx("td",{className:"border border-gray-300 px-4 py-3",children:i.jsxs("div",{className:"flex justify-center gap-2",children:[i.jsxs(t,{size:"sm",variant:"outline",onClick:()=>se(String(null==e?void 0:e.id)),className:"flex items-center gap-1",children:[i.jsx($,{className:"h-3 w-3"}),"Edit"]}),"true"===z&&i.jsxs(c,{className:"flex items-center gap-1 rounded-md bg-green-600 px-3 py-2 text-sm text-white hover:bg-green-700",to:`pay-matrix?pay_level_id=${a(String(null==e?void 0:e.id))}`,children:[i.jsx(I,{className:"h-3 w-3"}),"Matrix"]})]})})]},null==e?void 0:e.id)),(!(null==(M=null==ae?void 0:ae.data)?void 0:M.data)||0===(null==(C=null==(w=null==ae?void 0:ae.data)?void 0:w.data)?void 0:C.length))&&i.jsx("tr",{children:i.jsxs("td",{colSpan:"true"===z?5:6,className:"border border-gray-300 py-12 text-center",children:[i.jsx("p",{className:"text-gray-500",children:"No pay levels found"}),i.jsx("p",{className:"mt-1 text-sm text-gray-400",children:'Click "Add New Pay Level" to create one'})]})})]})]})})})]}):i.jsxs(x,{children:[i.jsx(p,{className:"px-7",children:i.jsx(v,{children:i.jsx("h2",{className:"text-lg font-semibold",children:"Pay Level Details"})})}),i.jsx(u,{children:i.jsxs(h,{children:[i.jsx(j,{children:i.jsxs(b,{children:[i.jsx(_,{children:"#"}),i.jsx(_,{children:"Level"}),i.jsx(_,{children:"Level Name"}),"true"===z&&i.jsx(_,{children:"Pay Range"}),"false"===z&&i.jsxs(i.Fragment,{children:[i.jsx(_,{children:"Pay Band"}),i.jsx(_,{children:"Grade Pay"})]}),i.jsx(_,{children:"Description"}),i.jsx(_,{children:"Created On"}),i.jsx(_,{children:"Actions"})]})}),i.jsxs(g,{children:[null==(A=null==(E=null==ae?void 0:ae.data)?void 0:E.data)?void 0:A.map((e,s)=>i.jsxs(b,{children:[i.jsx(N,{children:s+1}),i.jsx(N,{children:i.jsxs("span",{className:"font-semibold",children:["Level ",null==e?void 0:e.level]})}),i.jsx(N,{children:null==e?void 0:e.level_name}),"true"===z&&i.jsx(N,{children:i.jsxs("div",{className:"text-sm",children:[i.jsx("div",{children:ie(null==e?void 0:e.min_basic_pay)}),i.jsx("div",{className:"text-muted-foreground",children:"to"}),i.jsx("div",{children:ie(null==e?void 0:e.max_basic_pay)})]})}),"false"===z&&i.jsx(N,{children:(null==e?void 0:e.pay_band_name)?i.jsxs("div",{className:"text-sm",children:[i.jsx("div",{className:"font-medium",children:null==e?void 0:e.pay_band_name}),i.jsxs("div",{className:"text-muted-foreground",children:[ie((null==e?void 0:e.pay_band_min)||0)," -"," ",ie((null==e?void 0:e.pay_band_max)||0)]})]}):i.jsx("span",{className:"text-muted-foreground",children:"-"})}),"false"===z&&i.jsx(N,{children:(null==e?void 0:e.grade_pay)?ie(null==e?void 0:e.grade_pay):i.jsx("span",{className:"text-muted-foreground",children:"-"})}),i.jsx(N,{children:(null==e?void 0:e.description)||i.jsx("span",{className:"text-muted-foreground",children:"-"})}),i.jsx(N,{children:m(null==e?void 0:e.created_at).format("DD MMM YYYY")}),i.jsx(N,{children:i.jsxs("div",{className:"flex gap-2",children:[i.jsx(t,{size:"sm",variant:"outline",onClick:()=>se(String(null==e?void 0:e.id)),children:"Edit"}),"true"===z&&i.jsx(c,{className:"rounded-lg bg-green-600 px-4 py-2 text-white",to:`pay-matrix?pay_level_id=${a(String(null==e?void 0:e.id))}`,children:"View Matrix"})]})})]},null==e?void 0:e.id)),(!(null==(k=null==ae?void 0:ae.data)?void 0:k.data)||0===(null==(D=null==(F=null==ae?void 0:ae.data)?void 0:F.data)?void 0:D.length))&&i.jsx(b,{children:i.jsx(N,{colSpan:9,className:"py-8 text-center text-muted-foreground",children:'No pay levels found. Click "Add New Pay Level" to create one.'})})]})]})})]})]})]})}function O(){return i.jsx(o,{title:"Pay Level",subTitle:"Manage all the Pay Levels here",children:i.jsx("div",{className:"py-12",children:i.jsx(z,{})})})}export{O as default};
