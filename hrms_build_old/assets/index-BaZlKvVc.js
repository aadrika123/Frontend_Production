import{h as A,e as J,r as d,j as a,z as _,B as M}from"./index-Df4ChAN-.js";import{P as K}from"./index-DjNjGvXo.js";import{C as O,a as Q,b as X,c as Z,h as aa}from"./card-CW8LZ2r1.js";import{S as ea,T as la,a as sa,b as z,c as r,d as ca,e as n}from"./index-Tosm5l2v.js";import{u as U,b as I}from"./useCustomQuery-BBKf_waA.js";import{g as ra}from"./services-KQnp_8oA.js";import{P as na}from"./index-CRGyM8Pm.js";import{S as P,a as ia}from"./Spinner-CyN74T25.js";import{a as oa,o as ta,c as da,b as C,f as L,d as G}from"./yup-pPl0eVQc.js";import{F as ua,B as xa}from"./datetime-picker-EqBIIAIP.js";import{R as E}from"./RHFTextField-C5PfVKXx.js";import{R as ha}from"./RHFTextArea-bqK8EsA9.js";import{R as D}from"./RHFSelectField-Cy0QtYHL.js";import"./select-DZKz6XPY.js";import{R as W}from"./RHFCheckbox-DRpCJmEz.js";import{D as pa}from"./index-D4JNSpYb.js";import{B as $}from"./badge-D696_yJG.js";import{L as ma}from"./loader-circle-DH4IlwT9.js";import{T as ja}from"./trash-2-DOuI6ik9.js";import"./calendar-CMNTAmai.js";import"./clock-BxgzxCOp.js";import"./check-BzewUJFq.js";const fa=da().shape({allowance_code:C().required("Allowance Code is required"),allowance_name:C().required("Allowance Name is required"),calculation_type:C().required("Calculation Type is required"),default_value:L().typeError("Default Value must be a number").required("Default Value is required").min(0,"Default Value must be greater than or equal to 0"),calculation_base:C().required("Calculation Base is required"),is_taxable:G(),is_part_of_gross:G(),pay_commission_id:L().typeError("Pay Commission is required").required("Pay Commission is required"),description:C().required("Description is required")});function ga({open:R,setOpen:N,title:V,id:u,edit:h,setEdit:v,refetch:k}){var s,B,F;const T=U({}),{data:l,isFetching:H}=I({api:`${(s=A)==null?void 0:s.getAllowanceById}?id=${J(String(u))}`,key:"getAllowanceById",options:{enabled:!!u&&!!h}}),{data:S}=I({api:`${(B=A)==null?void 0:B.getAllPayCommissions}`,key:"getAllPayCommissions",options:{enabled:!0}}),w=d.useMemo(()=>{var i,p,m,j,f,g,e,t,y;return{allowance_code:((i=l==null?void 0:l.data)==null?void 0:i.allowance_code)||"",allowance_name:((p=l==null?void 0:l.data)==null?void 0:p.allowance_name)||"",calculation_type:((m=l==null?void 0:l.data)==null?void 0:m.calculation_type)||"",default_value:((j=l==null?void 0:l.data)==null?void 0:j.default_value)||0,calculation_base:((f=l==null?void 0:l.data)==null?void 0:f.calculation_base)||"",is_taxable:((g=l==null?void 0:l.data)==null?void 0:g.is_taxable)||!1,is_part_of_gross:((e=l==null?void 0:l.data)==null?void 0:e.is_part_of_gross)||!1,pay_commission_id:((t=l==null?void 0:l.data)==null?void 0:t.pay_commission_id)||0,description:((y=l==null?void 0:l.data)==null?void 0:y.description)||""}},[l]),o=oa({defaultValues:w,resolver:ta(fa)}),b=o.watch("calculation_type"),q=async i=>{var p,m,j,f,g,e,t,y;try{if(h&&u){const c=await T.mutateAsync({api:`${(p=A)==null?void 0:p.updateAllowance}`,data:{id:u,...i}});(m=c.data)!=null&&m.success?_.success((j=c==null?void 0:c.data)==null?void 0:j.message):_.error(((f=c.data)==null?void 0:f.message)||"Allowance not updated successfully")}else{const c=await T.mutateAsync({api:(g=A)==null?void 0:g.createAllowance,data:i});(e=c.data)!=null&&e.success?_.success((t=c==null?void 0:c.data)==null?void 0:t.message):_.error(((y=c.data)==null?void 0:y.message)||"Allowance not created successfully")}o.reset(),N(!1),v(!1),k()}catch(c){console.log(c)}};return d.useEffect(()=>{h&&l&&o.reset(w)},[w,h]),d.useEffect(()=>{b&&o.setValue("default_value",0)},[b]),a.jsx(pa,{open:R,setOpen:N,title:V,setEdit:v,edit:h,isLoading:H,children:a.jsx(ua,{methods:o,onSubmit:o.handleSubmit(q),children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Basic Information"}),a.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[a.jsx(E,{name:"allowance_code",label:"Allowance Code",placeholder:"e.g., WASH, HRA, DA",inputValidation:["removeSpecialCharacterExceptSpace"]}),a.jsx(E,{name:"allowance_name",label:"Allowance Name",placeholder:"e.g., Washing Allowance",inputValidation:["removeSpecialCharacterExceptSpace"]})]})]}),a.jsx("div",{children:a.jsx(ha,{name:"description",label:"Description",placeholder:"Brief description of this allowance type...",inputValidation:["removeSpecialCharacterExceptSpace"]})})]}),a.jsx(P,{}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Calculation Method"}),a.jsxs("div",{className:"space-y-4",children:[a.jsx(D,{label:"Calculation Type",name:"calculation_type",data:[{label:"Fixed Amount",value:"fixed"},{label:"Percentage of Salary",value:"percentage"}]}),b==="fixed"&&a.jsx("div",{children:a.jsx(E,{name:"default_value",label:"Amount",placeholder:"e.g., 5000",type:"number",inputValidation:["number"]})}),b==="percentage"&&a.jsx("div",{className:"space-y-4",children:a.jsx(E,{name:"default_value",label:"Percentage (%)",placeholder:"e.g., 12",inputValidation:["decimal"]})}),a.jsx(D,{name:"calculation_base",label:"Calculation Base",data:[{label:"Basic Salary",value:"basic"},{label:"Gross Salary",value:"gross"},{label:"Net Salary",value:"net"}]})]})]}),a.jsx(P,{}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Pay Commission"}),a.jsx(D,{name:"pay_commission_id",label:"Pay Commission",data:((F=S==null?void 0:S.data)==null?void 0:F.map(i=>({label:String(i.commission_name),value:String(i.id)})))||[]})]}),a.jsx(P,{}),a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{children:[a.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Tax & Gross Settings"}),a.jsxs("div",{className:"space-y-4 rounded-lg border border-gray-200 bg-gray-50 p-4",children:[a.jsx("div",{className:"flex items-start gap-3",children:a.jsx(W,{name:"is_taxable",label:"This allowance is taxable"})}),a.jsx("p",{className:"text-xs italic text-gray-600",children:"Check this if this allowance should be included in taxable income"}),a.jsx("div",{className:"flex items-start gap-3",children:a.jsx(W,{name:"is_part_of_gross",label:"This allowance is part of gross salary"})}),a.jsx("p",{className:"text-xs italic text-gray-600",children:"Check this if this allowance should be included in gross salary calculation"})]})]})}),a.jsx(P,{className:"my-6"}),a.jsx("div",{className:"pt-2",children:a.jsx(xa,{isLoading:o.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:h?"Update Allowance":"Create Allowance"})})]})})})}function ya(){var i,p,m,j,f,g;const R=U({}),[N,V]=d.useState(1),[u,h]=d.useState(10),[v,k]=d.useState(""),[T,l]=d.useState(!1),[H,S]=d.useState(""),[w,o]=d.useState(!1),[b,q]=d.useState(null),s=I({api:`${A.getAllAllowances}?page=${N}&limit=${u}&q=${v}`,key:"getAllAllowances",value:[N,u,v],options:{enabled:!0}}),B=e=>{o(!0),l(!0),S(e)},F=async e=>{var t,y,c,Y;q(e);try{const x=await R.mutateAsync({api:`${(t=A)==null?void 0:t.deleteAllowance}`,data:{id:e}});(y=x==null?void 0:x.data)!=null&&y.success?(s.refetch(),_.success(((c=x==null?void 0:x.data)==null?void 0:c.message)||"Allowance deleted successfully")):_.error(((Y=x.data)==null?void 0:Y.message)||"Failed to delete allowance")}catch(x){_.error(ra(x))}finally{q(null)}};return a.jsxs("main",{className:"grid items-start",children:[a.jsx(ga,{open:T,setOpen:l,title:w?"Edit Allowance":"Add Allowance",id:H,edit:w,setEdit:o,refetch:s.refetch}),a.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[a.jsxs("div",{className:"flex w-full justify-between gap-2",children:[a.jsx("div",{children:a.jsx(ea,{search:v,setSearch:k,refetch:s.refetch,isFetching:s==null?void 0:s.isLoading})}),a.jsx("div",{children:a.jsx(M,{className:"flex items-center gap-2",onClick:()=>l(!0),children:"Add New"})})]}),a.jsxs(O,{children:[a.jsx(Q,{className:"px-7",children:a.jsxs(X,{children:["Allowance List (",((p=(i=s==null?void 0:s.data)==null?void 0:i.data)==null?void 0:p.length)||0,")"]})}),a.jsx(Z,{children:s.isLoading?a.jsx("div",{className:"flex h-32 items-center justify-center",children:a.jsx(ia,{})}):a.jsxs(a.Fragment,{children:[a.jsxs(la,{children:[a.jsx(sa,{children:a.jsxs(z,{children:[a.jsx(r,{className:"",children:"#"}),a.jsx(r,{className:"",children:"Code"}),a.jsx(r,{className:"",children:"Name"}),a.jsx(r,{className:"",children:"Type"}),a.jsx(r,{className:"",children:"Default Value"}),a.jsx(r,{className:"",children:"Base"}),a.jsx(r,{className:"",children:"Taxable"}),a.jsx(r,{className:"",children:"Part of Gross"}),a.jsx(r,{className:"",children:"Description"}),a.jsx(r,{className:"",children:"Created at"}),a.jsx(r,{className:"",children:"Status"}),a.jsx(r,{children:"Action"})]})}),a.jsx(ca,{children:(j=(m=s==null?void 0:s.data)==null?void 0:m.data)==null?void 0:j.map((e,t)=>a.jsxs(z,{children:[a.jsx(n,{children:t+1}),a.jsx(n,{children:e==null?void 0:e.allowance_code}),a.jsx(n,{children:e==null?void 0:e.allowance_name}),a.jsx(n,{children:a.jsx($,{variant:"outline",className:"capitalize",children:e==null?void 0:e.calculation_type})}),a.jsxs(n,{children:[e==null?void 0:e.default_value,(e==null?void 0:e.calculation_type)==="percentage"&&"%"]}),a.jsx(n,{className:"capitalize",children:(e==null?void 0:e.calculation_base)||"-"}),a.jsx(n,{children:a.jsx($,{variant:e!=null&&e.is_taxable?"default":"secondary",children:e!=null&&e.is_taxable?"Yes":"No"})}),a.jsx(n,{children:a.jsx($,{variant:e!=null&&e.is_part_of_gross?"default":"secondary",children:e!=null&&e.is_part_of_gross?"Yes":"No"})}),a.jsx(n,{className:"max-w-xs truncate",children:e==null?void 0:e.description}),a.jsx(n,{children:aa(e==null?void 0:e.created_at).format("DD-MM-YYYY")}),a.jsx(n,{children:a.jsx($,{variant:(e==null?void 0:e.status)===1?"default":"secondary",children:(e==null?void 0:e.status)===1?"Active":"Inactive"})}),a.jsx(n,{children:a.jsxs("div",{className:"flex gap-2",children:[a.jsx(M,{className:"bg-primary",onClick:()=>B(String(e==null?void 0:e.id)),children:"Edit"}),a.jsx(M,{variant:"destructive",onClick:()=>F(String(e==null?void 0:e.id)),disabled:b===String(e==null?void 0:e.id),children:b===String(e==null?void 0:e.id)?a.jsx(ma,{className:"h-4 w-4 animate-spin"}):a.jsx(ja,{className:"h-4 w-4"})})]})})]},e==null?void 0:e.id))})]}),a.jsx(P,{className:"mb-2 mt-4"}),a.jsx("div",{className:"flex w-full justify-end",children:a.jsx(na,{page:N,limit:u,totalPages:Math.ceil((((g=(f=s==null?void 0:s.data)==null?void 0:f.data)==null?void 0:g.length)||0)/u),setPage:V,setLimit:h})})]})})]})]})]})}function Ya(){return a.jsx(K,{title:"Allowance List",subTitle:"Manage all the Allowances here",children:a.jsx("div",{className:"py-12",children:a.jsx(ya,{})})})}export{Ya as default};
