import{h as e,f as a,r as s,j as i,z as l,m as r,n as d,B as t,L as n,l as c}from"./index-UYY99J9q.js";import{P as o}from"./index-Dj741qwl.js";import{h as m}from"./moment-CBOc1lqT.js";import{C as x,a as p,c as u,b as v}from"./card-CtI_IPLF.js";import{T as y,a as h,b as j,c as b,d as _,e as g}from"./table-CS0u2e-w.js";import{u as f,b as N}from"./useCustomQuery-Dp3AX7R2.js";import{S as L}from"./index-UiGf0NcE.js";import{S as P}from"./Spinner-CjaIOVSb.js";import{a as S,o as q,c as B,b as w,f as M}from"./yup-jtZe4Tk8.js";import{F as C}from"./datetime-picker-CgwSorNf.js";import{R as E}from"./RHFTextField-BtYg5IGX.js";import{R as k}from"./RHFTextArea-twp-JmnQ.js";import{B as A}from"./ButtonLoading-C1bL9ixh.js";import"./select-CcbMZzqU.js";import"./input-qBPs6xkH.js";import"./switch-CnTLVnvq.js";import"./checkbox-D8MNaO54.js";import"./label-DVj88vWk.js";import{S as F}from"./separator-BrVypJ4m.js";import{D as R}from"./index-D5PwM2eu.js";import{G as $}from"./grid-3x3-B3Qx7Tqd.js";import{P as D}from"./pen-Dsze3v8c.js";import{E as I}from"./eye-xCG5v7vd.js";import"./calendar-ddNksXQs.js";import"./format-BkNqQ0tt.js";import"./chevron-right-BO4a-O50.js";import"./clock-CXHA5hGN.js";import"./check-B5JmqH3y.js";const V=B().shape({pay_commission_id:M().required("Pay Commission is required"),level:M().required("Level is required").positive("Level must be positive"),level_name:w().required("Level Name is required"),min_basic_pay:M().required("Minimum Basic Pay is required").positive("Must be positive"),max_basic_pay:M().required("Maximum Basic Pay is required").positive("Must be positive"),description:w().required("Description is required")}),T=B().shape({pay_commission_id:M().required("Pay Commission is required"),level:M().required("Level is required").positive("Level must be positive"),level_name:w().required("Level Name is required"),min_basic_pay:M().required("Minimum Basic Pay is required").positive("Must be positive"),max_basic_pay:M().required("Maximum Basic Pay is required").positive("Must be positive"),pay_band_name:w().required("Pay Band Name is required"),grade_pay:M().required("Grade Pay is required").positive("Must be positive"),description:w().nullable()});function G({open:r,setOpen:d,title:t,id:n,edit:c,setEdit:o,isMatrixBased:m,payCommissionId:x,payLevelListData:p}){var u,v,y,h,j;const b=f({}),_="true"===m||"1"===m,{data:g,isFetching:L}=N({api:`${null==(u=e)?void 0:u.getPayLevelById}?id=${a(String(n))}`,key:"getPayLevelById",options:{enabled:!!c}}),P=(null==p?void 0:p.data)&&(null==(y=null==(v=null==p?void 0:p.data)?void 0:v.data)?void 0:y.length)>0?Math.max(...null==(j=null==(h=null==p?void 0:p.data)?void 0:h.data)?void 0:j.map(e=>null==e?void 0:e.level))+1:0,B={pay_commission_id:x?Number(x):0,level:0,level_name:"",min_basic_pay:0,max_basic_pay:0,description:""},w={pay_commission_id:x?Number(x):0,level:0,level_name:"",min_basic_pay:0,max_basic_pay:0,pay_band_name:"",grade_pay:0,description:""},M=S({defaultValues:_?B:w,resolver:q(_?V:T)});return s.useEffect(()=>{(null==p?void 0:p.data)&&!c&&(M.setValue("level",P),M.setValue("level_name",`Level ${P}`))},[p,c,P,M]),s.useEffect(()=>{c&&(null==g?void 0:g.data)?M.reset(g.data):M.reset(_?B:w)},[c,g,M]),i.jsx(R,{open:r,setOpen:d,title:t,setEdit:o,edit:c,isLoading:L,children:i.jsx(C,{methods:M,onSubmit:M.handleSubmit(async a=>{var s,i,r,t,m,x,u,v;try{if(c&&a){const d=await b.mutateAsync({api:`${null==(s=e)?void 0:s.updatePayLevel}`,data:{id:n,pay_commission_id:a.pay_commission_id,level:a.level,level_name:a.level_name,min_basic_pay:a.min_basic_pay,max_basic_pay:a.max_basic_pay,...!_&&{pay_band_name:a.pay_band_name,pay_band_min:a.min_basic_pay,pay_band_max:a.max_basic_pay,grade_pay:a.grade_pay},description:a.description}});(null==(i=d.data)?void 0:i.success)?l.success(null==(r=null==d?void 0:d.data)?void 0:r.message):l.error((null==(t=d.data)?void 0:t.message)||"Pay Level not updated successfully")}else{const s=await b.mutateAsync({api:null==(m=e)?void 0:m.createPayLevel,data:{pay_commission_id:a.pay_commission_id,level:P||a.level,level_name:`Level ${P}`||a.level_name,min_basic_pay:a.min_basic_pay,max_basic_pay:a.max_basic_pay,...!_&&{pay_band_name:a.pay_band_name,pay_band_min:a.min_basic_pay,pay_band_max:a.max_basic_pay,grade_pay:a.grade_pay},description:a.description}});(null==(x=s.data)?void 0:x.success)?l.success(null==(u=null==s?void 0:s.data)?void 0:u.message):l.error((null==(v=s.data)?void 0:v.message)||"Pay Level not created successfully"),M.reset(_?B:w)}d(!1),o(!1),null==p||p.refetch()}catch(y){l.error("An error occurred. Please try again.")}}),children:i.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[i.jsx("input",{type:"hidden",...M.register("pay_commission_id"),value:x||""}),i.jsxs("div",{className:"grid grid-cols-2 gap-x-2",children:[i.jsx(E,{label:"Level",type:"number",name:"level",placeholder:"Enter Level"}),i.jsx(E,{name:"level_name",label:"Level Name",placeholder:"Enter Level Name",inputValidation:["removeSpecialCharacterExceptSpace"]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-x-2",children:[i.jsx(E,{type:"number",name:"min_basic_pay",label:"Minimum Basic Pay",placeholder:"Minimum Basic Pay"}),i.jsx(E,{type:"number",name:"max_basic_pay",label:"Maximum Basic Pay",placeholder:"Maximum Basic Pay"})]}),!_&&i.jsxs(i.Fragment,{children:[i.jsx("div",{children:i.jsx(E,{name:"pay_band_name",label:"Pay Band Name",placeholder:"Enter Pay Band Name (e.g., PB-2)"})}),i.jsx("div",{children:i.jsx(E,{type:"number",name:"grade_pay",label:"Grade Pay",placeholder:"Grade Pay"})})]}),i.jsx("div",{children:i.jsx(k,{name:"description",placeholder:"Enter description",label:"Description",rows:4,inputValidation:["removeSpecialCharacterExceptSpace"]})}),i.jsx(F,{}),i.jsx("div",{children:i.jsx(A,{isLoading:M.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function Y(){var l,o,f,S,q,B,w,M,C,E,k,A,F,R;const[V]=r(),T=V.get("commission_id"),Y=V.get("is_matrix_based"),z=V.get("commission_name"),[O,U]=s.useState(""),[H,Q]=s.useState(!1),[W,X]=s.useState(""),[Z,J]=s.useState(!1),[K,ee]=s.useState("chart"),ae=N({api:`${null==(l=e)?void 0:l.getAllPayLevels}?pay_commission_id=${T}`,key:"getAllPayLevels",options:{enabled:!!T}});N({api:`${null==(o=e)?void 0:o.getPayLevelById}?id=${W}`,key:"getPayLevelById",value:[W],options:{enabled:!!W}});const se=e=>{J(!0),Q(!0),X(e)},ie=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e);return i.jsxs("main",{className:"grid items-start",children:[i.jsx(G,{open:H,setOpen:Q,title:Z?"Edit Pay Level":"Add Pay Level",id:W,edit:Z,setEdit:J,isMatrixBased:Y,payCommissionId:d(T||""),payLevelListData:ae}),i.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[i.jsx(x,{className:"border-l-4 border-l-blue-500",children:i.jsx(p,{className:"pb-3",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:z}),i.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"true"===Y?"Matrix Based Commission":"Non-Matrix Based Commission"}),i.jsxs("p",{className:"mt-1 text-xs text-gray-400",children:["Total Levels: ",(null==(S=null==(f=null==ae?void 0:ae.data)?void 0:f.data)?void 0:S.length)||0]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs(t,{variant:"chart"===K?"default":"outline",size:"sm",onClick:()=>ee("chart"),className:"flex items-center gap-2",children:[i.jsx($,{className:"h-4 w-4"}),"Chart View"]}),i.jsxs(t,{variant:"list"===K?"default":"outline",size:"sm",onClick:()=>ee("list"),className:"flex items-center gap-2",children:[i.jsx(n,{className:"h-4 w-4"}),"List View"]})]})]})})}),i.jsxs("div",{className:"flex w-full justify-between gap-2",children:[i.jsx("div",{className:"flex-1",children:i.jsx(L,{search:O,setSearch:U,refetch:ae.refetch,isFetching:null==ae?void 0:ae.isLoading})}),i.jsx(t,{className:"flex items-center gap-2",onClick:()=>Q(!0),children:"Add New Pay Level"})]}),ae.isLoading?i.jsx(x,{children:i.jsx(u,{className:"flex h-64 items-center justify-center",children:i.jsx(P,{})})}):"chart"===K?i.jsxs(x,{children:[i.jsx(p,{className:"bg-gray-50",children:i.jsx("h2",{className:"text-center text-lg font-semibold",children:"PAY SCALE STRUCTURE"})}),i.jsx(u,{className:"p-0",children:i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full border-collapse",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"border-y-2 border-gray-300 bg-gray-100",children:[i.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left text-sm font-semibold",children:"Level"}),i.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left text-sm font-semibold",children:"Level Name"}),"true"===Y?i.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left text-sm font-semibold",children:"Revised Pay Band (Rs.)"}):i.jsxs(i.Fragment,{children:[i.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left text-sm font-semibold",children:"Pay Band"}),i.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left text-sm font-semibold",children:"Grade Pay (Rs.)"})]}),i.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left text-sm font-semibold",children:"Description"}),i.jsx("th",{className:"border border-gray-300 px-4 py-3 text-center text-sm font-semibold",children:"Actions"})]})}),i.jsxs("tbody",{children:[null==(B=null==(q=null==ae?void 0:ae.data)?void 0:q.data)?void 0:B.map(e=>i.jsxs("tr",{className:"transition-colors hover:bg-blue-50",children:[i.jsx("td",{className:"border border-gray-300 px-4 py-3",children:i.jsxs("span",{className:"font-bold text-blue-600",children:["Level ",null==e?void 0:e.level]})}),i.jsx("td",{className:"border border-gray-300 px-4 py-3",children:i.jsx("span",{className:"font-medium",children:null==e?void 0:e.level_name})}),"true"===Y?i.jsx("td",{className:"border border-gray-300 px-4 py-3",children:i.jsxs("div",{className:"font-medium",children:[ie(null==e?void 0:e.min_basic_pay)," -"," ",ie(null==e?void 0:e.max_basic_pay)]})}):i.jsxs(i.Fragment,{children:[i.jsx("td",{className:"border border-gray-300 px-4 py-3",children:(null==e?void 0:e.pay_band_name)?i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:null==e?void 0:e.pay_band_name}),i.jsxs("div",{className:"text-sm text-gray-600",children:[ie((null==e?void 0:e.pay_band_min)||0)," -"," ",ie((null==e?void 0:e.pay_band_max)||0)]})]}):i.jsx("span",{className:"text-gray-400",children:"-"})}),i.jsx("td",{className:"border border-gray-300 px-4 py-3 text-center",children:(null==e?void 0:e.grade_pay)?i.jsx("span",{className:"font-semibold",children:ie(null==e?void 0:e.grade_pay)}):i.jsx("span",{className:"text-gray-400",children:"-"})})]}),i.jsx("td",{className:"border border-gray-300 px-4 py-3",children:i.jsx("span",{className:"text-sm text-gray-600",children:(null==e?void 0:e.description)||"-"})}),i.jsx("td",{className:"border border-gray-300 px-4 py-3",children:i.jsxs("div",{className:"flex justify-center gap-2",children:[i.jsxs(t,{size:"sm",variant:"outline",onClick:()=>se(String(null==e?void 0:e.id)),className:"flex items-center gap-1",children:[i.jsx(D,{className:"h-3 w-3"}),"Edit"]}),"true"===Y&&i.jsxs(c,{className:"flex items-center gap-1 rounded-md bg-green-600 px-3 py-2 text-sm text-white hover:bg-green-700",to:`pay-matrix?pay_level_id=${a(String(null==e?void 0:e.id))}`,children:[i.jsx(I,{className:"h-3 w-3"}),"Matrix"]})]})})]},null==e?void 0:e.id)),(!(null==(w=null==ae?void 0:ae.data)?void 0:w.data)||0===(null==(C=null==(M=null==ae?void 0:ae.data)?void 0:M.data)?void 0:C.length))&&i.jsx("tr",{children:i.jsxs("td",{colSpan:"true"===Y?5:6,className:"border border-gray-300 py-12 text-center",children:[i.jsx("p",{className:"text-gray-500",children:"No pay levels found"}),i.jsx("p",{className:"mt-1 text-sm text-gray-400",children:'Click "Add New Pay Level" to create one'})]})})]})]})})})]}):i.jsxs(x,{children:[i.jsx(p,{className:"px-7",children:i.jsx(v,{children:i.jsx("h2",{className:"text-lg font-semibold",children:"Pay Level Details"})})}),i.jsx(u,{children:i.jsxs(y,{children:[i.jsx(h,{children:i.jsxs(j,{children:[i.jsx(b,{children:"#"}),i.jsx(b,{children:"Level"}),i.jsx(b,{children:"Level Name"}),"true"===Y&&i.jsx(b,{children:"Pay Range"}),"false"===Y&&i.jsxs(i.Fragment,{children:[i.jsx(b,{children:"Pay Band"}),i.jsx(b,{children:"Grade Pay"})]}),i.jsx(b,{children:"Description"}),i.jsx(b,{children:"Created On"}),i.jsx(b,{children:"Actions"})]})}),i.jsxs(_,{children:[null==(k=null==(E=null==ae?void 0:ae.data)?void 0:E.data)?void 0:k.map((e,s)=>i.jsxs(j,{children:[i.jsx(g,{children:s+1}),i.jsx(g,{children:i.jsxs("span",{className:"font-semibold",children:["Level ",null==e?void 0:e.level]})}),i.jsx(g,{children:null==e?void 0:e.level_name}),"true"===Y&&i.jsx(g,{children:i.jsxs("div",{className:"text-sm",children:[i.jsx("div",{children:ie(null==e?void 0:e.min_basic_pay)}),i.jsx("div",{className:"text-muted-foreground",children:"to"}),i.jsx("div",{children:ie(null==e?void 0:e.max_basic_pay)})]})}),"false"===Y&&i.jsx(g,{children:(null==e?void 0:e.pay_band_name)?i.jsxs("div",{className:"text-sm",children:[i.jsx("div",{className:"font-medium",children:null==e?void 0:e.pay_band_name}),i.jsxs("div",{className:"text-muted-foreground",children:[ie((null==e?void 0:e.pay_band_min)||0)," -"," ",ie((null==e?void 0:e.pay_band_max)||0)]})]}):i.jsx("span",{className:"text-muted-foreground",children:"-"})}),"false"===Y&&i.jsx(g,{children:(null==e?void 0:e.grade_pay)?ie(null==e?void 0:e.grade_pay):i.jsx("span",{className:"text-muted-foreground",children:"-"})}),i.jsx(g,{children:(null==e?void 0:e.description)||i.jsx("span",{className:"text-muted-foreground",children:"-"})}),i.jsx(g,{children:m(null==e?void 0:e.created_at).format("DD MMM YYYY")}),i.jsx(g,{children:i.jsxs("div",{className:"flex gap-2",children:[i.jsx(t,{size:"sm",variant:"outline",onClick:()=>se(String(null==e?void 0:e.id)),children:"Edit"}),"true"===Y&&i.jsx(c,{className:"rounded-lg bg-green-600 px-4 py-2 text-white",to:`pay-matrix?pay_level_id=${a(String(null==e?void 0:e.id))}`,children:"View Matrix"})]})})]},null==e?void 0:e.id)),(!(null==(A=null==ae?void 0:ae.data)?void 0:A.data)||0===(null==(R=null==(F=null==ae?void 0:ae.data)?void 0:F.data)?void 0:R.length))&&i.jsx(j,{children:i.jsx(g,{colSpan:9,className:"py-8 text-center text-muted-foreground",children:'No pay levels found. Click "Add New Pay Level" to create one.'})})]})]})})]})]})]})}function z(){return i.jsx(o,{title:"Pay Level",subTitle:"Manage all the Pay Levels here",children:i.jsx("div",{className:"py-12",children:i.jsx(Y,{})})})}export{z as default};
