import{r as e,j as s,al as l}from"./vendor-RyuIgj66.js";import{P as a}from"./index-DFF4_m_G.js";import{u as t,h as i,B as r}from"./index-ey2GEmQz.js";import{C as c,a as n,d,b as o,c as x}from"./card-u7M7FP5y.js";import{T as m,a as h,b as j,c as u,d as f,e as p}from"./table-B_npepsp.js";import{u as N,b as g}from"./useCustomQuery-DTB6aAiD.js";import{S as v}from"./Spinner-BwGzvoRj.js";import{S as b,a as y,b as S,c as T,d as w}from"./select-8PAfYjod.js";import{B as D}from"./badge-DbWnzWn2.js";import{T as _,a as R,b as F,c as L}from"./tabs-BzFjL9ks.js";import{al as Y,aD as k,_ as C}from"./icons-CxCh8mm_.js";import"./ui-B3c1eQmf.js";import"./query-BH9sOW2X.js";import"./axios-Dos3PyFQ.js";import"./zustand-C1rkr5lV.js";function E(){var a,E,I,$,B;const{user:P}=t(),V=N({}),[A,z]=e.useState(""),[q,O]=e.useState(""),Q=(()=>{const e=[],s=(new Date).getFullYear();for(let l=0;l<6;l++){const a=s-l;e.push(`${a}-${(a+1).toString().slice(-2)}`)}return e})(),G=g({api:`${i.getTdsShortfallReport}?financial_year=${q}&ulb_id=${null==P?void 0:P.ulbId}`,key:"getTdsShortfallReport",value:[q,null==P?void 0:P.ulbId],options:{enabled:!!q&&!!(null==P?void 0:P.ulbId)}}),H=null==(a=null==G?void 0:G.data)?void 0:a.data;return s.jsxs("main",{className:"grid items-start gap-4",children:[s.jsxs(c,{children:[s.jsxs(n,{children:[s.jsxs(d,{className:"flex items-center gap-2",children:[s.jsx(Y,{className:"h-5 w-5"}),"TDS Reconciliation"]}),s.jsx(o,{children:"View TDS shortfall report and reconcile tax deductions"})]}),s.jsx(x,{children:s.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-end",children:[s.jsxs("div",{children:[s.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-600",children:"Financial Year"}),s.jsxs(b,{value:A,onValueChange:z,children:[s.jsx(y,{className:"w-48",children:s.jsx(S,{placeholder:"Select Financial Year"})}),s.jsx(T,{children:Q.map(e=>s.jsxs(w,{value:e,children:["FY ",e]},e))})]})]}),s.jsx(r,{onClick:()=>{A&&O(A)},variant:"outline",children:"Load Report"}),q&&s.jsx(r,{onClick:async()=>{var e,s,a;if(q)try{const t=await V.mutateAsync({api:i.bulkReconcileTds,data:{financial_year:q}});(null==(e=t.data)?void 0:e.success)?(l.success((null==(s=null==t?void 0:t.data)?void 0:s.message)||"TDS reconciliation completed"),G.refetch()):l.error((null==(a=t.data)?void 0:a.message)||"Failed to reconcile TDS")}catch(t){l.error("Failed to reconcile TDS")}else l.error("Please select a financial year first")},disabled:V.isPending,className:"bg-blue-600 hover:bg-blue-700",children:V.isPending?s.jsxs(s.Fragment,{children:[s.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),"Reconciling..."]}):s.jsxs(s.Fragment,{children:[s.jsx(Y,{className:"mr-2 h-4 w-4"}),"Bulk Reconcile"]})})]})})]}),q&&(null==G?void 0:G.isLoading)&&s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx(v,{})}),H&&s.jsxs(_,{defaultValue:"shortfall",children:[s.jsxs(R,{className:"grid w-full grid-cols-2",children:[s.jsxs(F,{value:"shortfall",children:[s.jsx(k,{className:"mr-2 h-4 w-4"}),"Shortfall Report"]}),s.jsxs(F,{value:"summary",children:[s.jsx(C,{className:"mr-2 h-4 w-4"}),"Summary"]})]}),s.jsx(L,{value:"shortfall",children:s.jsxs(c,{children:[s.jsx(n,{className:"bg-gradient-to-r from-red-50 to-orange-50",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs(d,{className:"text-red-700",children:["TDS Shortfall Report - FY ",q]}),s.jsx(o,{children:"Employees with pending TDS to be collected"})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-sm text-slate-600",children:"Total Shortfall"}),s.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["₹",(null==(E=H.total_shortfall)?void 0:E.toLocaleString())||0]})]})]})}),s.jsx(x,{className:"pt-4",children:(null==(I=H.shortfall_employees)?void 0:I.length)>0?s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(m,{children:[s.jsx(h,{children:s.jsxs(j,{children:[s.jsx(u,{children:"Employee ID"}),s.jsx(u,{children:"Employee Code"}),s.jsx(u,{children:"Employee Name"}),s.jsx(u,{className:"text-right",children:"Tax Computed"}),s.jsx(u,{className:"text-right",children:"Tax Deducted"}),s.jsx(u,{className:"text-right",children:"Shortfall"})]})}),s.jsx(f,{children:H.shortfall_employees.map(e=>{var l,a,t;return s.jsxs(j,{children:[s.jsx(p,{children:e.emp_id}),s.jsx(p,{children:s.jsx(D,{variant:"outline",children:e.emp_code})}),s.jsx(p,{className:"font-medium",children:e.emp_name}),s.jsxs(p,{className:"text-right",children:["₹",null==(l=e.tax_computed)?void 0:l.toLocaleString()]}),s.jsxs(p,{className:"text-right",children:["₹",null==(a=e.tax_deducted)?void 0:a.toLocaleString()]}),s.jsxs(p,{className:"text-right font-semibold text-red-600",children:["₹",null==(t=e.shortfall)?void 0:t.toLocaleString()]})]},e.emp_id)})})]})}):s.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[s.jsx(C,{className:"h-12 w-12 text-green-500"}),s.jsx("p",{className:"mt-2 text-lg font-medium text-green-700",children:"No TDS shortfall found!"}),s.jsx("p",{className:"text-sm text-slate-500",children:"All employees have their TDS fully deducted."})]})})]})}),s.jsx(L,{value:"summary",children:s.jsxs(c,{children:[s.jsxs(n,{className:"bg-gradient-to-r from-blue-50 to-indigo-50",children:[s.jsxs(d,{className:"text-blue-700",children:["Reconciliation Summary - FY ",q]}),s.jsx(o,{children:"Overview of TDS status for the financial year"})]}),s.jsxs(x,{className:"pt-4",children:[s.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[s.jsx(c,{className:"bg-slate-50",children:s.jsx(x,{className:"pt-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-sm text-slate-600",children:"Total Employees with Shortfall"}),s.jsx("div",{className:"text-3xl font-bold text-slate-700",children:(null==($=H.shortfall_employees)?void 0:$.length)||0})]})})}),s.jsx(c,{className:"bg-red-50",children:s.jsx(x,{className:"pt-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-sm text-red-600",children:"Total Shortfall Amount"}),s.jsxs("div",{className:"text-3xl font-bold text-red-700",children:["₹",(null==(B=H.total_shortfall)?void 0:B.toLocaleString())||0]})]})})}),s.jsx(c,{className:"bg-green-50",children:s.jsx(x,{className:"pt-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-sm text-green-600",children:"Financial Year"}),s.jsx("div",{className:"text-3xl font-bold text-green-700",children:q})]})})})]}),s.jsxs("div",{className:"mt-6 rounded-lg bg-amber-50 p-4",children:[s.jsxs("h4",{className:"flex items-center gap-2 font-medium text-amber-700",children:[s.jsx(k,{className:"h-5 w-5"}),"Important Notes"]}),s.jsxs("ul",{className:"mt-2 list-inside list-disc text-sm text-amber-600",children:[s.jsx("li",{children:"TDS shortfall will be adjusted in the next salary cycle"}),s.jsx("li",{children:"Bulk reconciliation updates all pending TDS calculations"}),s.jsx("li",{children:"Ensure all attendance and salary data is finalized before reconciliation"})]})]})]})]})})]}),q&&!(null==G?void 0:G.isLoading)&&!H&&s.jsx(c,{className:"border-yellow-200 bg-yellow-50",children:s.jsx(x,{className:"flex items-center justify-center py-8",children:s.jsxs("div",{className:"text-center",children:[s.jsx(k,{className:"mx-auto h-10 w-10 text-yellow-500"}),s.jsxs("p",{className:"mt-2 text-yellow-700",children:["No TDS data found for FY ",q]})]})})})]})}function I(){return s.jsx(a,{title:"TDS Reconciliation",subTitle:"Reconcile TDS and View Shortfall Reports",children:s.jsx("div",{className:"py-12",children:s.jsx(E,{})})})}export{I as default};
