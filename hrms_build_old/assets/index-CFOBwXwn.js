import{r as e,aA as a,j as l,aB as s,al as i}from"./vendor-RyuIgj66.js";import{P as t}from"./index-DFF4_m_G.js";import{h as n}from"./moment-CBOc1lqT.js";import{h as d,e as c,B as o,g as r}from"./index-ey2GEmQz.js";import{C as u,a as m,b as x,c as p}from"./card-u7M7FP5y.js";import{T as h,a as j,b as v,c as f,d as g,e as y}from"./table-B_npepsp.js";import{u as b,b as _}from"./useCustomQuery-DTB6aAiD.js";import{P as N}from"./index-BHR1l08i.js";import{S as w}from"./separator-BQijJEjG.js";import{S as A}from"./index-CUStUwt1.js";import{S}from"./Spinner-BwGzvoRj.js";import{c as C,a as q,e as B,b as P}from"./yup-CH6wvET8.js";import{F as E}from"./datetime-picker-dN6E5dqy.js";import{R as F}from"./RHFTextField-BSZ_cEI3.js";import{R as T}from"./RHFTextArea-DpBxMoiQ.js";import{B as k}from"./ButtonLoading-DDalXO-W.js";import{R as D}from"./RHFSelectField-oISAIiMK.js";import"./input-DlX9dTT0.js";import"./switch-Cssv6fnZ.js";import{R as V}from"./RHFCheckbox-BZ4qq51l.js";import{D as $}from"./index-B2ia16z0.js";import{B as R}from"./badge-DbWnzWn2.js";import{q as L,T as H}from"./icons-CxCh8mm_.js";import"./ui-B3c1eQmf.js";import"./query-BH9sOW2X.js";import"./axios-Dos3PyFQ.js";import"./zustand-C1rkr5lV.js";import"./select-8PAfYjod.js";import"./checkbox-DFFItNXW.js";import"./label-BcY3kv5U.js";const M=C().shape({allowance_code:q().required("Allowance Code is required"),allowance_name:q().required("Allowance Name is required"),calculation_type:q().required("Calculation Type is required"),default_value:B().typeError("Default Value must be a number").required("Default Value is required").min(0,"Default Value must be greater than or equal to 0"),calculation_base:q().required("Calculation Base is required"),is_taxable:P(),is_part_of_gross:P(),pay_commission_id:B().typeError("Pay Commission is required").required("Pay Commission is required"),description:q().required("Description is required")});function Y({open:t,setOpen:n,title:o,id:r,edit:u,setEdit:m,refetch:x}){var p,h,j;const v=b({}),{data:f,isFetching:g}=_({api:`${null==(p=d)?void 0:p.getAllowanceById}?id=${c(String(r))}`,key:"getAllowanceById",options:{enabled:!!r&&!!u}}),{data:y}=_({api:`${null==(h=d)?void 0:h.getAllPayCommissions}`,key:"getAllPayCommissions",options:{enabled:!0}}),N=e.useMemo(()=>{var e,a,l,s,i,t,n,d,c;return{allowance_code:(null==(e=null==f?void 0:f.data)?void 0:e.allowance_code)||"",allowance_name:(null==(a=null==f?void 0:f.data)?void 0:a.allowance_name)||"",calculation_type:(null==(l=null==f?void 0:f.data)?void 0:l.calculation_type)||"",default_value:(null==(s=null==f?void 0:f.data)?void 0:s.default_value)||0,calculation_base:(null==(i=null==f?void 0:f.data)?void 0:i.calculation_base)||"",is_taxable:(null==(t=null==f?void 0:f.data)?void 0:t.is_taxable)||!1,is_part_of_gross:(null==(n=null==f?void 0:f.data)?void 0:n.is_part_of_gross)||!1,pay_commission_id:(null==(d=null==f?void 0:f.data)?void 0:d.pay_commission_id)||0,description:(null==(c=null==f?void 0:f.data)?void 0:c.description)||""}},[f]),A=a({defaultValues:N,resolver:s(M)}),S=A.watch("calculation_type");return e.useEffect(()=>{u&&f&&A.reset(N)},[N,u]),e.useEffect(()=>{S&&A.setValue("default_value",0)},[S]),l.jsx($,{open:t,setOpen:n,title:o,setEdit:m,edit:u,isLoading:g,children:l.jsx(E,{methods:A,onSubmit:A.handleSubmit(async e=>{var a,l,s,t,c,o,p,h;try{if(u&&r){const n=await v.mutateAsync({api:`${null==(a=d)?void 0:a.updateAllowance}`,data:{id:r,...e}});(null==(l=n.data)?void 0:l.success)?i.success(null==(s=null==n?void 0:n.data)?void 0:s.message):i.error((null==(t=n.data)?void 0:t.message)||"Allowance not updated successfully")}else{const a=await v.mutateAsync({api:null==(c=d)?void 0:c.createAllowance,data:e});(null==(o=a.data)?void 0:o.success)?i.success(null==(p=null==a?void 0:a.data)?void 0:p.message):i.error((null==(h=a.data)?void 0:h.message)||"Allowance not created successfully")}A.reset(),n(!1),m(!1),x()}catch(j){}}),children:l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Basic Information"}),l.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[l.jsx(F,{name:"allowance_code",label:"Allowance Code",placeholder:"e.g., WASH, HRA, DA",inputValidation:["removeSpecialCharacterExceptSpace"]}),l.jsx(F,{name:"allowance_name",label:"Allowance Name",placeholder:"e.g., Washing Allowance",inputValidation:["removeSpecialCharacterExceptSpace"]})]})]}),l.jsx("div",{children:l.jsx(T,{name:"description",label:"Description",placeholder:"Brief description of this allowance type...",inputValidation:["removeSpecialCharacterExceptSpace"]})})]}),l.jsx(w,{}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Calculation Method"}),l.jsxs("div",{className:"space-y-4",children:[l.jsx(D,{label:"Calculation Type",name:"calculation_type",data:[{label:"Fixed Amount",value:"fixed"},{label:"Percentage of Salary",value:"percentage"}]}),"fixed"===S&&l.jsx("div",{children:l.jsx(F,{name:"default_value",label:"Amount",placeholder:"e.g., 5000",type:"number",inputValidation:["number"]})}),"percentage"===S&&l.jsx("div",{className:"space-y-4",children:l.jsx(F,{name:"default_value",label:"Percentage (%)",placeholder:"e.g., 12",inputValidation:["decimal"]})}),l.jsx(D,{name:"calculation_base",label:"Calculation Base",data:[{label:"Basic Salary",value:"basic"},{label:"Gross Salary",value:"gross"},{label:"Net Salary",value:"net"}]})]})]}),l.jsx(w,{}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Pay Commission"}),l.jsx(D,{name:"pay_commission_id",label:"Pay Commission",data:(null==(j=null==y?void 0:y.data)?void 0:j.map(e=>({label:String(e.commission_name),value:String(e.id)})))||[]})]}),l.jsx(w,{}),l.jsx("div",{className:"space-y-4",children:l.jsxs("div",{children:[l.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Tax & Gross Settings"}),l.jsxs("div",{className:"space-y-4 rounded-lg border border-gray-200 bg-gray-50 p-4",children:[l.jsx("div",{className:"flex items-start gap-3",children:l.jsx(V,{name:"is_taxable",label:"This allowance is taxable"})}),l.jsx("p",{className:"text-xs italic text-gray-600",children:"Check this if this allowance should be included in taxable income"}),l.jsx("div",{className:"flex items-start gap-3",children:l.jsx(V,{name:"is_part_of_gross",label:"This allowance is part of gross salary"})}),l.jsx("p",{className:"text-xs italic text-gray-600",children:"Check this if this allowance should be included in gross salary calculation"})]})]})}),l.jsx(w,{className:"my-6"}),l.jsx("div",{className:"pt-2",children:l.jsx(k,{isLoading:A.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:u?"Update Allowance":"Create Allowance"})})]})})})}function I(){var a,s,t,c,C,q;const B=b({}),[P,E]=e.useState(1),[F,T]=e.useState(10),[k,D]=e.useState(""),[V,$]=e.useState(!1),[M,I]=e.useState(""),[z,G]=e.useState(!1),[O,W]=e.useState(null),Q=_({api:`${d.getAllAllowances}?page=${P}&limit=${F}&q=${k}`,key:"getAllAllowances",value:[P,F,k],options:{enabled:!0}});return l.jsxs("main",{className:"grid items-start",children:[l.jsx(Y,{open:V,setOpen:$,title:z?"Edit Allowance":"Add Allowance",id:M,edit:z,setEdit:G,refetch:Q.refetch}),l.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[l.jsxs("div",{className:"flex w-full justify-between gap-2",children:[l.jsx("div",{children:l.jsx(A,{search:k,setSearch:D,refetch:Q.refetch,isFetching:null==Q?void 0:Q.isLoading})}),l.jsx("div",{children:l.jsx(o,{className:"flex items-center gap-2",onClick:()=>$(!0),children:"Add New"})})]}),l.jsxs(u,{children:[l.jsx(m,{className:"px-7",children:l.jsxs(x,{children:["Allowance List (",(null==(s=null==(a=null==Q?void 0:Q.data)?void 0:a.data)?void 0:s.length)||0,")"]})}),l.jsx(p,{children:Q.isLoading?l.jsx("div",{className:"flex h-32 items-center justify-center",children:l.jsx(S,{})}):l.jsxs(l.Fragment,{children:[l.jsxs(h,{children:[l.jsx(j,{children:l.jsxs(v,{children:[l.jsx(f,{className:"",children:"#"}),l.jsx(f,{className:"",children:"Code"}),l.jsx(f,{className:"",children:"Name"}),l.jsx(f,{className:"",children:"Type"}),l.jsx(f,{className:"",children:"Default Value"}),l.jsx(f,{className:"",children:"Base"}),l.jsx(f,{className:"",children:"Taxable"}),l.jsx(f,{className:"",children:"Part of Gross"}),l.jsx(f,{className:"",children:"Description"}),l.jsx(f,{className:"",children:"Created at"}),l.jsx(f,{className:"",children:"Status"}),l.jsx(f,{children:"Action"})]})}),l.jsx(g,{children:null==(c=null==(t=null==Q?void 0:Q.data)?void 0:t.data)?void 0:c.map((e,a)=>l.jsxs(v,{children:[l.jsx(y,{children:a+1}),l.jsx(y,{children:null==e?void 0:e.allowance_code}),l.jsx(y,{children:null==e?void 0:e.allowance_name}),l.jsx(y,{children:l.jsx(R,{variant:"outline",className:"capitalize",children:null==e?void 0:e.calculation_type})}),l.jsxs(y,{children:[null==e?void 0:e.default_value,"percentage"===(null==e?void 0:e.calculation_type)&&"%"]}),l.jsx(y,{className:"capitalize",children:(null==e?void 0:e.calculation_base)||"-"}),l.jsx(y,{children:l.jsx(R,{variant:(null==e?void 0:e.is_taxable)?"default":"secondary",children:(null==e?void 0:e.is_taxable)?"Yes":"No"})}),l.jsx(y,{children:l.jsx(R,{variant:(null==e?void 0:e.is_part_of_gross)?"default":"secondary",children:(null==e?void 0:e.is_part_of_gross)?"Yes":"No"})}),l.jsx(y,{className:"max-w-xs truncate",children:null==e?void 0:e.description}),l.jsx(y,{children:n(null==e?void 0:e.created_at).format("DD-MM-YYYY")}),l.jsx(y,{children:l.jsx(R,{variant:1===(null==e?void 0:e.status)?"default":"secondary",children:1===(null==e?void 0:e.status)?"Active":"Inactive"})}),l.jsx(y,{children:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(o,{className:"bg-primary",onClick:()=>{return a=String(null==e?void 0:e.id),G(!0),$(!0),void I(a);var a},children:"Edit"}),l.jsx(o,{variant:"destructive",onClick:()=>(async e=>{var a,l,s,t;W(e);try{const n=await B.mutateAsync({api:`${null==(a=d)?void 0:a.deleteAllowance}`,data:{id:e}});(null==(l=null==n?void 0:n.data)?void 0:l.success)?(Q.refetch(),i.success((null==(s=null==n?void 0:n.data)?void 0:s.message)||"Allowance deleted successfully")):i.error((null==(t=n.data)?void 0:t.message)||"Failed to delete allowance")}catch(n){i.error(r(n))}finally{W(null)}})(String(null==e?void 0:e.id)),disabled:O===String(null==e?void 0:e.id),children:O===String(null==e?void 0:e.id)?l.jsx(L,{className:"h-4 w-4 animate-spin"}):l.jsx(H,{className:"h-4 w-4"})})]})})]},null==e?void 0:e.id))})]}),l.jsx(w,{className:"mb-2 mt-4"}),l.jsx("div",{className:"flex w-full justify-end",children:l.jsx(N,{page:P,limit:F,totalPages:Math.ceil(((null==(q=null==(C=null==Q?void 0:Q.data)?void 0:C.data)?void 0:q.length)||0)/F),setPage:E,setLimit:T})})]})})]})]})]})}function z(){return l.jsx(t,{title:"Allowance List",subTitle:"Manage all the Allowances here",children:l.jsx("div",{className:"py-12",children:l.jsx(I,{})})})}export{z as default};
