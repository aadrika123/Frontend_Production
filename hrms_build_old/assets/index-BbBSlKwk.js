import{h as e,f as s,r as a,j as i,z as t,B as r}from"./index-BJ2Di0BB.js";import{P as n}from"./index-L2kacWh6.js";import{h as d}from"./moment-CBOc1lqT.js";import{C as l,a as o,b as c,c as m}from"./card-CrOEotWM.js";import{S as u,T as v,a as x,b as f,c as p,d as j,e as h}from"./index-BxKGIMG5.js";import{u as g,b as _}from"./useCustomQuery-DkqDqiry.js";import{P as D}from"./index-DZvdNKxy.js";import{S as N}from"./separator-BtSn9EpY.js";import{S as b}from"./Spinner-DjUjMlqR.js";import{a as y,o as A,c as Y,b as M,f as S}from"./yup-BTlf5Wf5.js";import{F as R}from"./datetime-picker-cKnQNXMD.js";import{R as E}from"./RHFTextField-BK1QXo_s.js";import{R as P}from"./RHFTextArea-CtK9XJcE.js";import{B as C}from"./ButtonLoading-B5GmY3N3.js";import"./select-4D5dQM-6.js";import{D as O}from"./index-ClKtlEeL.js";import{B as q}from"./badge-DufY8Gpx.js";import"./calendar-B99NsLtP.js";import"./clock-PqgEqIzL.js";import"./check-DiqtQ1XW.js";const F=Y().shape({pay_commission_id:S().nullable().typeError("Pay Commission must be a number").transform((e,s)=>""===s||null===s?null:e),da_percentage:S().typeError("DA Percentage must be a number").required("DA Percentage is required").min(0,"DA Percentage must be greater than or equal to 0").max(100,"DA Percentage cannot exceed 100"),effective_from:M().required("Effective From date is required"),effective_to:M().nullable().transform((e,s)=>""===s?null:e),government_order_no:M().required("Government Order Number is required"),government_order_date:M().required("Government Order Date is required"),description:M().required("Description is required")});function B({open:r,setOpen:n,title:l,id:o,edit:c,setEdit:m,refetch:u}){var v,x;const f=g({}),{data:p,isFetching:j}=_({api:`${null==(v=e)?void 0:v.getDARevisionById}?id=${s(String(o))}`,key:"getDARevisionById",options:{enabled:!!o&&!!c}}),{data:h}=_({api:`${null==(x=e)?void 0:x.getAllPayCommissions}`,key:"getAllPayCommissions",options:{enabled:!0}}),D=a.useMemo(()=>{var e,s,a,i,t,r,n;return{pay_commission_id:(null==(e=null==p?void 0:p.data)?void 0:e.pay_commission_id)||null,da_percentage:(null==(s=null==p?void 0:p.data)?void 0:s.da_percentage)?Number(p.data.da_percentage):0,effective_from:(null==(a=null==p?void 0:p.data)?void 0:a.effective_from)?d(p.data.effective_from).format("YYYY-MM-DD"):"",effective_to:(null==(i=null==p?void 0:p.data)?void 0:i.effective_to)?d(p.data.effective_to).format("YYYY-MM-DD"):"",government_order_no:(null==(t=null==p?void 0:p.data)?void 0:t.government_order_no)||"",government_order_date:(null==(r=null==p?void 0:p.data)?void 0:r.government_order_date)?d(p.data.government_order_date).format("YYYY-MM-DD"):"",description:(null==(n=null==p?void 0:p.data)?void 0:n.description)||""}},[p]),b=y({defaultValues:D,resolver:A(F)});return a.useEffect(()=>{c&&p&&b.reset(D)},[D,c]),i.jsx(O,{open:r,setOpen:n,title:l,setEdit:m,edit:c,isLoading:j,children:i.jsx(R,{methods:b,onSubmit:b.handleSubmit(async s=>{var a,i,r,d,l,v,x,p;try{const j={...s,pay_commission_id:s.pay_commission_id||null,effective_to:s.effective_to||null};if(c&&o){const s=await f.mutateAsync({api:`${null==(a=e)?void 0:a.updateDARevision}`,data:{id:o,...j}});(null==(i=s.data)?void 0:i.success)?t.success(null==(r=null==s?void 0:s.data)?void 0:r.message):t.error((null==(d=s.data)?void 0:d.message)||"DA Revision not updated successfully")}else{const s=await f.mutateAsync({api:null==(l=e)?void 0:l.createDARevision,data:j});(null==(v=s.data)?void 0:v.success)?t.success(null==(x=null==s?void 0:s.data)?void 0:x.message):t.error((null==(p=s.data)?void 0:p.message)||"DA Revision not created successfully")}b.reset(),n(!1),m(!1),u()}catch(j){}}),children:i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Basic Information"}),i.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:i.jsx(E,{name:"da_percentage",label:"DA Percentage (%)",placeholder:"e.g., 50",type:"number",inputValidation:["decimal"]})})]}),i.jsx("div",{children:i.jsx(P,{name:"description",label:"Description",placeholder:"Brief description of this DA revision...",inputValidation:["removeSpecialCharacterExceptSpace"]})})]}),i.jsx(N,{}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Effective Period"}),i.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[i.jsx(E,{name:"effective_from",label:"Effective From",type:"date"}),i.jsx(E,{name:"effective_to",label:"Effective To (Optional)",type:"date"})]})]}),i.jsx(N,{}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Government Order Details"}),i.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[i.jsx(E,{name:"government_order_no",label:"Government Order Number",placeholder:"e.g., DA/2025/001",inputValidation:["removeSpecialCharacterExceptSpace"]}),i.jsx(E,{name:"government_order_date",label:"Government Order Date",type:"date"})]})]}),i.jsx(N,{className:"my-6"}),i.jsx("div",{className:"pt-2",children:i.jsx(C,{isLoading:b.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:c?"Update DA Revision":"Create DA Revision"})})]})})})}function L(){var s,t,n,y,A,Y,M;g({});const[S,R]=a.useState(1),[E,P]=a.useState(10),[C,O]=a.useState(""),[F,L]=a.useState(!1),[$,k]=a.useState(""),[w,G]=a.useState(!1),[T,I]=a.useState(null),V=_({api:`${e.getAllDARevisions}?page=${S}&limit=${E}&q=${C}`,key:"getAllDARevisions",value:[S,E,C],options:{enabled:!0}}),{data:H}=_({api:`${null==(s=e)?void 0:s.getCurrentDA}`,key:"getCurrentDA",options:{enabled:!0}});return i.jsxs("main",{className:"grid items-start",children:[i.jsx(B,{open:F,setOpen:L,title:w?"Edit DA Revision":"Add DA Revision",id:$,edit:w,setEdit:G,refetch:V.refetch}),i.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[(null==H?void 0:H.data)&&i.jsxs(l,{className:"border-primary/20 bg-primary/5",children:[i.jsx(o,{className:"px-7",children:i.jsx(c,{className:"text-lg font-semibold text-primary",children:"Current DA Rate"})}),i.jsx(m,{children:i.jsxs("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"DA Percentage"}),i.jsxs("p",{className:"text-2xl font-bold text-primary",children:[H.data.da_percentage,"%"]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Effective From"}),i.jsx("p",{className:"font-semibold",children:d(H.data.effective_from).format("DD-MM-YYYY")})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Government Order No"}),i.jsx("p",{className:"font-semibold",children:H.data.government_order_no})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Order Date"}),i.jsx("p",{className:"font-semibold",children:d(H.data.government_order_date).format("DD-MM-YYYY")})]})]})})]}),i.jsxs("div",{className:"flex w-full justify-between gap-2",children:[i.jsx("div",{children:i.jsx(u,{search:C,setSearch:O,refetch:V.refetch,isFetching:null==V?void 0:V.isLoading})}),i.jsx("div",{children:i.jsx(r,{className:"flex items-center gap-2",onClick:()=>L(!0),children:"Update DA Revision"})})]}),i.jsxs(l,{children:[i.jsx(o,{className:"px-7",children:i.jsxs(c,{children:["DA Revision List (",(null==(n=null==(t=null==V?void 0:V.data)?void 0:t.data)?void 0:n.length)||0,")"]})}),i.jsx(m,{children:V.isLoading?i.jsx("div",{className:"flex h-32 items-center justify-center",children:i.jsx(b,{})}):i.jsxs(i.Fragment,{children:[i.jsxs(v,{children:[i.jsx(x,{children:i.jsxs(f,{children:[i.jsx(p,{className:"",children:"#"}),i.jsx(p,{className:"",children:"DA Percentage"}),i.jsx(p,{className:"",children:"Effective From"}),i.jsx(p,{className:"",children:"Effective To"}),i.jsx(p,{className:"",children:"Government Order No"}),i.jsx(p,{className:"",children:"Order Date"}),i.jsx(p,{className:"",children:"Description"}),i.jsx(p,{className:"",children:"Created at"}),i.jsx(p,{className:"",children:"Status"})]})}),i.jsx(j,{children:null==(A=null==(y=null==V?void 0:V.data)?void 0:y.data)?void 0:A.map((e,s)=>i.jsxs(f,{children:[i.jsx(h,{children:s+1}),i.jsx(h,{children:i.jsxs(q,{variant:"default",className:"text-base font-semibold",children:[null==e?void 0:e.da_percentage,"%"]})}),i.jsx(h,{children:d(null==e?void 0:e.effective_from).format("DD-MM-YYYY")}),i.jsx(h,{children:(null==e?void 0:e.effective_to)?d(null==e?void 0:e.effective_to).format("DD-MM-YYYY"):"-"}),i.jsx(h,{children:null==e?void 0:e.government_order_no}),i.jsx(h,{children:d(null==e?void 0:e.government_order_date).format("DD-MM-YYYY")}),i.jsx(h,{className:"max-w-xs truncate",children:null==e?void 0:e.description}),i.jsx(h,{children:d(null==e?void 0:e.created_at).format("DD-MM-YYYY")}),i.jsx(h,{children:i.jsx(q,{variant:1===(null==e?void 0:e.status)?"default":"secondary",children:1===(null==e?void 0:e.status)?"Active":"Inactive"})})]},null==e?void 0:e.id))})]}),i.jsx(N,{className:"mb-2 mt-4"}),i.jsx("div",{className:"flex w-full justify-end",children:i.jsx(D,{page:S,limit:E,totalPages:Math.ceil(((null==(M=null==(Y=null==V?void 0:V.data)?void 0:Y.data)?void 0:M.length)||0)/E),setPage:R,setLimit:P})})]})})]})]})]})}function $(){return i.jsx(n,{title:"DA Revision List",subTitle:"Manage all the DA Revisions here",children:i.jsx("div",{className:"py-12",children:i.jsx(L,{})})})}export{$ as default};
