import{aA as e,r as a,j as i,aB as l,al as t}from"./vendor-RyuIgj66.js";import{P as s}from"./index-DFF4_m_G.js";import{h as n}from"./moment-CBOc1lqT.js";import{h as d,e as o,B as r,g as c}from"./index-ey2GEmQz.js";import{C as u,a as m,b as p,c as x}from"./card-u7M7FP5y.js";import{T as h,a as j,b as v,c as b,d as y,e as _}from"./table-B_npepsp.js";import{u as f,b as g}from"./useCustomQuery-DTB6aAiD.js";import{P as N}from"./index-BHR1l08i.js";import{S}from"./separator-BQijJEjG.js";import{S as D}from"./index-CUStUwt1.js";import{S as C}from"./Spinner-BwGzvoRj.js";import{c as w,a as E,e as T,b as A}from"./yup-CH6wvET8.js";import{F as q}from"./datetime-picker-dN6E5dqy.js";import{R as F}from"./RHFTextField-BSZ_cEI3.js";import{R as V}from"./RHFTextArea-DpBxMoiQ.js";import{B}from"./ButtonLoading-DDalXO-W.js";import{R as L}from"./RHFSelectField-oISAIiMK.js";import"./input-DlX9dTT0.js";import"./switch-Cssv6fnZ.js";import{R as P}from"./RHFCheckbox-BZ4qq51l.js";import{D as R}from"./index-B2ia16z0.js";import{B as $}from"./badge-DbWnzWn2.js";import{q as k,T as M}from"./icons-CxCh8mm_.js";import"./ui-B3c1eQmf.js";import"./query-BH9sOW2X.js";import"./axios-Dos3PyFQ.js";import"./zustand-C1rkr5lV.js";import"./select-8PAfYjod.js";import"./checkbox-DFFItNXW.js";import"./label-BcY3kv5U.js";const H=w().shape({deduction_code:E().required("Deduction Code is required"),deduction_name:E().required("Deduction Name is required"),calculation_type:E().required("Calculation Type is required"),default_value:T().typeError("Default Value must be a number").required("Default Value is required").min(0,"Default Value must be greater than or equal to 0"),calculation_base:E().nullable(),max_limit:T().typeError("Max Limit must be a number").nullable().transform((e,a)=>""===a?null:e),is_employer_contribution:A(),employer_contribution_rate:T().typeError("Employer Contribution Rate must be a number").nullable().transform((e,a)=>""===a?null:e),description:E().required("Description is required")});function I({open:s,setOpen:n,title:r,id:c,edit:u,setEdit:m,refetch:p}){var x;const h=f({}),{data:j,isFetching:v}=g({api:`${null==(x=d)?void 0:x.getDeductionById}?id=${o(String(c))}`,key:"getDeductionById",options:{enabled:u&&!!c}}),b=e({defaultValues:{deduction_code:"",deduction_name:"",calculation_type:"",default_value:0,calculation_base:null,max_limit:null,is_employer_contribution:!1,employer_contribution_rate:null,description:""},resolver:l(H)}),y=b.watch("calculation_type"),_=b.watch("is_employer_contribution");return a.useEffect(()=>{var e,a,i,l,t,s,n,d,o,r,c;u&&(null==j?void 0:j.data)?b.reset({deduction_code:(null==(e=null==j?void 0:j.data)?void 0:e.deduction_code)||"",deduction_name:(null==(a=null==j?void 0:j.data)?void 0:a.deduction_name)||"",calculation_type:(null==(i=null==j?void 0:j.data)?void 0:i.calculation_type)||"",default_value:Number(null==(l=null==j?void 0:j.data)?void 0:l.default_value)||0,calculation_base:(null==(t=null==j?void 0:j.data)?void 0:t.calculation_base)||null,max_limit:(null==(s=null==j?void 0:j.data)?void 0:s.max_limit)?Number(null==(n=null==j?void 0:j.data)?void 0:n.max_limit):null,is_employer_contribution:(null==(d=null==j?void 0:j.data)?void 0:d.is_employer_contribution)||!1,employer_contribution_rate:(null==(o=null==j?void 0:j.data)?void 0:o.employer_contribution_rate)?Number(null==(r=null==j?void 0:j.data)?void 0:r.employer_contribution_rate):null,description:(null==(c=null==j?void 0:j.data)?void 0:c.description)||""}):b.reset({deduction_code:"",deduction_name:"",calculation_type:"",default_value:0,calculation_base:null,max_limit:null,is_employer_contribution:!1,employer_contribution_rate:null,description:""})},[u,j]),a.useEffect(()=>{(null==b?void 0:b.watch("calculation_type"))&&b.setValue("default_value",0)},[y]),i.jsx(R,{open:s,setOpen:n,title:r,setEdit:m,edit:u,isLoading:v,children:i.jsx(q,{methods:b,onSubmit:b.handleSubmit(async e=>{var a,i,l,s,o,r,x,j;try{if(u&&c){const n=await h.mutateAsync({api:`${null==(a=d)?void 0:a.updateDeduction}`,data:{id:Number(c),...e}});(null==(i=n.data)?void 0:i.success)?t.success(null==(l=null==n?void 0:n.data)?void 0:l.message):t.error((null==(s=n.data)?void 0:s.message)||"Deduction Type not updated successfully")}else{const a=await h.mutateAsync({api:null==(o=d)?void 0:o.createDeduction,data:e});(null==(r=a.data)?void 0:r.success)?t.success(null==(x=null==a?void 0:a.data)?void 0:x.message):t.error((null==(j=a.data)?void 0:j.message)||"Deduction Type not created successfully")}b.reset(),n(!1),m(!1),p()}catch(v){}}),children:i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Basic Information"}),i.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[i.jsx(F,{name:"deduction_code",label:"Deduction Code",placeholder:"e.g., EPF, TAX, INS",inputValidation:["removeSpecialCharacterExceptSpace"]}),i.jsx(F,{name:"deduction_name",label:"Deduction Name",placeholder:"e.g., Provident Fund",inputValidation:["removeSpecialCharacterExceptSpace"]})]})]}),i.jsx("div",{children:i.jsx(V,{name:"description",label:"Description",placeholder:"Brief description of this deduction type...",inputValidation:["removeSpecialCharacterExceptSpace"]})})]}),i.jsx(S,{}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Calculation Method"}),i.jsxs("div",{className:"space-y-4",children:[i.jsx(L,{label:"How to Calculate",name:"calculation_type",data:[{label:"Fixed Amount",value:"fixed"},{label:"Percentage of Salary",value:"percentage"}]}),"fixed"===y&&i.jsx("div",{children:i.jsx(F,{name:"default_value",label:"Amount",placeholder:"e.g., 5000",type:"number",inputValidation:["number"]})}),"percentage"===y&&i.jsxs("div",{className:"space-y-4",children:[i.jsx(F,{name:"default_value",label:"Percentage (%)",placeholder:"e.g., 12",type:"number",inputValidation:"percentage"==y?["number","maxTwoDecimalPlaces"]:["number"],maxLength:2}),i.jsxs("div",{className:"space-y-4 rounded-lg border border-blue-200 bg-blue-50 p-4",children:[i.jsx("p",{className:"text-xs font-medium text-blue-700",children:"Additional Settings for Percentage Calculation"}),i.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[i.jsx(L,{name:"calculation_base",label:"Calculate Based On",data:[{label:"Basic Salary",value:"basic"},{label:"Gross Salary",value:"gross"},{label:"Net Salary",value:"net"}]}),i.jsx(F,{name:"max_limit",label:"Maximum Limit (Optional)",placeholder:"e.g., 15000",type:"number",inputValidation:["number"]})]}),i.jsx("p",{className:"text-xs italic text-gray-600",children:"Maximum limit caps the deduction amount regardless of the calculated percentage"})]})]})]})]}),i.jsx(S,{}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Employer Contribution"}),i.jsxs("div",{className:"space-y-4 rounded-lg border border-gray-200 bg-gray-50 p-4",children:[i.jsx("div",{className:"flex items-start gap-3",children:i.jsx(P,{name:"is_employer_contribution",label:"Employer also contributes to this deduction"})}),i.jsx("p",{className:"text-xs italic text-gray-600",children:"Check this if your organization contributes an amount in addition to the employee's deduction"}),_&&i.jsxs("div",{className:"mt-4 border-t border-gray-300 pt-4",children:[i.jsx(F,{name:"employer_contribution_rate",label:"Employer Contribution Rate (%)",placeholder:"e.g., 13",type:"number",inputValidation:["number"]}),i.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"This is the percentage or amount that the employer will contribute"})]})]})]})}),i.jsx(S,{className:"my-6"}),i.jsx("div",{className:"pt-2",children:i.jsx(B,{isLoading:b.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:u?"Update Deduction Type":"Create Deduction Type"})})]})})})}function O(){var e,l,s,o,w,E;const T=f({}),[A,q]=a.useState(1),[F,V]=a.useState(10),[B,L]=a.useState(""),[P,R]=a.useState(!1),[H,O]=a.useState(""),[Y,z]=a.useState(!1),[G,Q]=a.useState(null),U=g({api:`${d.getAllDeductions}?page=${A}&limit=${F}&q=${B}`,key:"getAllDeductions",value:[A,F,B],options:{enabled:!0}});return i.jsxs("main",{className:"grid items-start",children:[i.jsx(I,{open:P,setOpen:R,title:Y?"Edit Deduction Type":"Add Deduction Type",id:H,edit:Y,setEdit:z,refetch:U.refetch}),i.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[i.jsxs("div",{className:"flex w-full justify-between gap-2",children:[i.jsx("div",{children:i.jsx(D,{search:B,setSearch:L,refetch:U.refetch,isFetching:null==U?void 0:U.isLoading})}),i.jsx("div",{children:i.jsx(r,{className:"flex items-center gap-2",onClick:()=>R(!0),children:"Add New"})})]}),i.jsxs(u,{children:[i.jsx(m,{className:"px-7",children:i.jsxs(p,{children:["Deduction Type List (",(null==(l=null==(e=null==U?void 0:U.data)?void 0:e.data)?void 0:l.length)||0,")"]})}),i.jsx(x,{children:U.isLoading?i.jsx("div",{className:"flex h-32 items-center justify-center",children:i.jsx(C,{})}):i.jsxs(i.Fragment,{children:[i.jsxs(h,{children:[i.jsx(j,{children:i.jsxs(v,{children:[i.jsx(b,{className:"",children:"#"}),i.jsx(b,{className:"",children:"Code"}),i.jsx(b,{className:"",children:"Name"}),i.jsx(b,{className:"",children:"Type"}),i.jsx(b,{className:"",children:"Default Value"}),i.jsx(b,{className:"",children:"Base"}),i.jsx(b,{className:"",children:"Max Limit"}),i.jsx(b,{className:"",children:"Employer Contribution"}),i.jsx(b,{className:"",children:"Description"}),i.jsx(b,{className:"",children:"Created at"}),i.jsx(b,{className:"",children:"Status"}),i.jsx(b,{children:"Action"})]})}),i.jsx(y,{children:null==(o=null==(s=null==U?void 0:U.data)?void 0:s.data)?void 0:o.map((e,a)=>i.jsxs(v,{children:[i.jsx(_,{children:a+1}),i.jsx(_,{children:null==e?void 0:e.deduction_code}),i.jsx(_,{children:null==e?void 0:e.deduction_name}),i.jsx(_,{children:i.jsx($,{variant:"outline",className:"capitalize",children:null==e?void 0:e.calculation_type})}),i.jsxs(_,{children:[null==e?void 0:e.default_value,"percentage"===(null==e?void 0:e.calculation_type)&&"%"]}),i.jsx(_,{children:(null==e?void 0:e.calculation_base)||"-"}),i.jsx(_,{children:(null==e?void 0:e.max_limit)||"-"}),i.jsx(_,{children:i.jsxs($,{variant:(null==e?void 0:e.is_employer_contribution)?"default":"secondary",children:[(null==e?void 0:e.is_employer_contribution)?"Yes":"No",(null==e?void 0:e.is_employer_contribution)&&(null==e?void 0:e.employer_contribution_rate)&&` (${null==e?void 0:e.employer_contribution_rate}%)`]})}),i.jsx(_,{className:"max-w-xs truncate",children:null==e?void 0:e.description}),i.jsx(_,{children:n(null==e?void 0:e.created_at).format("DD-MM-YYYY")}),i.jsx(_,{children:i.jsx($,{variant:1===(null==e?void 0:e.status)?"default":"secondary",children:1===(null==e?void 0:e.status)?"Active":"Inactive"})}),i.jsx(_,{children:i.jsxs("div",{className:"flex gap-2",children:[i.jsx(r,{className:"bg-primary",onClick:()=>{return a=String(null==e?void 0:e.id),z(!0),R(!0),void O(a);var a},children:"Edit"}),i.jsx(r,{variant:"destructive",onClick:()=>(async e=>{var a,i,l,s;Q(e);try{const n=await T.mutateAsync({api:`${null==(a=d)?void 0:a.deleteDeduction}`,data:{id:Number(e)}});(null==(i=null==n?void 0:n.data)?void 0:i.success)?(U.refetch(),t.success((null==(l=null==n?void 0:n.data)?void 0:l.message)||"Deduction deleted successfully")):t.error((null==(s=n.data)?void 0:s.message)||"Failed to delete deduction")}catch(n){t.error(c(n))}finally{Q(null)}})(String(null==e?void 0:e.id)),disabled:G===String(null==e?void 0:e.id),children:G===String(null==e?void 0:e.id)?i.jsx(k,{className:"h-4 w-4 animate-spin"}):i.jsx(M,{className:"h-4 w-4"})})]})})]},null==e?void 0:e.id))})]}),i.jsx(S,{className:"mb-2 mt-4"}),i.jsx("div",{className:"flex w-full justify-end",children:i.jsx(N,{page:A,limit:F,totalPages:Math.ceil(((null==(E=null==(w=null==U?void 0:U.data)?void 0:w.data)?void 0:E.length)||0)/F),setPage:q,setLimit:V})})]})})]})]})]})}function Y(){return i.jsx(s,{title:"Deduction Type List",subTitle:"Manage all the Deduction Types here",children:i.jsx("div",{className:"py-12",children:i.jsx(O,{})})})}export{Y as default};
