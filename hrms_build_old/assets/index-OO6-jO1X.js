import{h as e,f as a,r as l,j as s,z as i,B as t,e as n}from"./index-BJ2Di0BB.js";import{P as d}from"./index-L2kacWh6.js";import{h as c}from"./moment-CBOc1lqT.js";import{C as r,a as o,b as u,c as m}from"./card-CrOEotWM.js";import{S as x,T as p,a as h,b as j,c as v,d as f,e as g}from"./index-BxKGIMG5.js";import{u as y,b}from"./useCustomQuery-DkqDqiry.js";import{P as _}from"./index-DZvdNKxy.js";import{S as N}from"./separator-BtSn9EpY.js";import{S as w}from"./Spinner-DjUjMlqR.js";import{a as A,o as S,c as C,b as q,f as P,d as B}from"./yup-BTlf5Wf5.js";import{F as E}from"./datetime-picker-cKnQNXMD.js";import{R as F}from"./RHFTextField-BK1QXo_s.js";import{R as T}from"./RHFTextArea-CtK9XJcE.js";import{B as k}from"./ButtonLoading-B5GmY3N3.js";import{R as D}from"./RHFSelectField-CxYg0t7R.js";import"./select-4D5dQM-6.js";import{R as V}from"./RHFCheckbox-gxPdkAtn.js";import{D as L}from"./index-ClKtlEeL.js";import{B as R}from"./badge-DufY8Gpx.js";import{L as $}from"./loader-circle--1riX2Rm.js";import{T as H}from"./trash-2-DvAODSCO.js";import"./calendar-B99NsLtP.js";import"./clock-PqgEqIzL.js";import"./check-DiqtQ1XW.js";const M=C().shape({allowance_code:q().required("Allowance Code is required"),allowance_name:q().required("Allowance Name is required"),calculation_type:q().required("Calculation Type is required"),default_value:P().typeError("Default Value must be a number").required("Default Value is required").min(0,"Default Value must be greater than or equal to 0"),calculation_base:q().required("Calculation Base is required"),is_taxable:B(),is_part_of_gross:B(),pay_commission_id:P().typeError("Pay Commission is required").required("Pay Commission is required"),description:q().required("Description is required")});function Y({open:t,setOpen:n,title:d,id:c,edit:r,setEdit:o,refetch:u}){var m,x,p;const h=y({}),{data:j,isFetching:v}=b({api:`${null==(m=e)?void 0:m.getAllowanceById}?id=${a(String(c))}`,key:"getAllowanceById",options:{enabled:!!c&&!!r}}),{data:f}=b({api:`${null==(x=e)?void 0:x.getAllPayCommissions}`,key:"getAllPayCommissions",options:{enabled:!0}}),g=l.useMemo(()=>{var e,a,l,s,i,t,n,d,c;return{allowance_code:(null==(e=null==j?void 0:j.data)?void 0:e.allowance_code)||"",allowance_name:(null==(a=null==j?void 0:j.data)?void 0:a.allowance_name)||"",calculation_type:(null==(l=null==j?void 0:j.data)?void 0:l.calculation_type)||"",default_value:(null==(s=null==j?void 0:j.data)?void 0:s.default_value)||0,calculation_base:(null==(i=null==j?void 0:j.data)?void 0:i.calculation_base)||"",is_taxable:(null==(t=null==j?void 0:j.data)?void 0:t.is_taxable)||!1,is_part_of_gross:(null==(n=null==j?void 0:j.data)?void 0:n.is_part_of_gross)||!1,pay_commission_id:(null==(d=null==j?void 0:j.data)?void 0:d.pay_commission_id)||0,description:(null==(c=null==j?void 0:j.data)?void 0:c.description)||""}},[j]),_=A({defaultValues:g,resolver:S(M)}),w=_.watch("calculation_type");return l.useEffect(()=>{r&&j&&_.reset(g)},[g,r]),l.useEffect(()=>{w&&_.setValue("default_value",0)},[w]),s.jsx(L,{open:t,setOpen:n,title:d,setEdit:o,edit:r,isLoading:v,children:s.jsx(E,{methods:_,onSubmit:_.handleSubmit(async a=>{var l,s,t,d,m,x,p,j;try{if(r&&c){const n=await h.mutateAsync({api:`${null==(l=e)?void 0:l.updateAllowance}`,data:{id:c,...a}});(null==(s=n.data)?void 0:s.success)?i.success(null==(t=null==n?void 0:n.data)?void 0:t.message):i.error((null==(d=n.data)?void 0:d.message)||"Allowance not updated successfully")}else{const l=await h.mutateAsync({api:null==(m=e)?void 0:m.createAllowance,data:a});(null==(x=l.data)?void 0:x.success)?i.success(null==(p=null==l?void 0:l.data)?void 0:p.message):i.error((null==(j=l.data)?void 0:j.message)||"Allowance not created successfully")}_.reset(),n(!1),o(!1),u()}catch(v){}}),children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Basic Information"}),s.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[s.jsx(F,{name:"allowance_code",label:"Allowance Code",placeholder:"e.g., WASH, HRA, DA",inputValidation:["removeSpecialCharacterExceptSpace"]}),s.jsx(F,{name:"allowance_name",label:"Allowance Name",placeholder:"e.g., Washing Allowance",inputValidation:["removeSpecialCharacterExceptSpace"]})]})]}),s.jsx("div",{children:s.jsx(T,{name:"description",label:"Description",placeholder:"Brief description of this allowance type...",inputValidation:["removeSpecialCharacterExceptSpace"]})})]}),s.jsx(N,{}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Calculation Method"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(D,{label:"Calculation Type",name:"calculation_type",data:[{label:"Fixed Amount",value:"fixed"},{label:"Percentage of Salary",value:"percentage"}]}),"fixed"===w&&s.jsx("div",{children:s.jsx(F,{name:"default_value",label:"Amount",placeholder:"e.g., 5000",type:"number",inputValidation:["number"]})}),"percentage"===w&&s.jsx("div",{className:"space-y-4",children:s.jsx(F,{name:"default_value",label:"Percentage (%)",placeholder:"e.g., 12",inputValidation:["decimal"]})}),s.jsx(D,{name:"calculation_base",label:"Calculation Base",data:[{label:"Basic Salary",value:"basic"},{label:"Gross Salary",value:"gross"},{label:"Net Salary",value:"net"}]})]})]}),s.jsx(N,{}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Pay Commission"}),s.jsx(D,{name:"pay_commission_id",label:"Pay Commission",data:(null==(p=null==f?void 0:f.data)?void 0:p.map(e=>({label:String(e.commission_name),value:String(e.id)})))||[]})]}),s.jsx(N,{}),s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{children:[s.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Tax & Gross Settings"}),s.jsxs("div",{className:"space-y-4 rounded-lg border border-gray-200 bg-gray-50 p-4",children:[s.jsx("div",{className:"flex items-start gap-3",children:s.jsx(V,{name:"is_taxable",label:"This allowance is taxable"})}),s.jsx("p",{className:"text-xs italic text-gray-600",children:"Check this if this allowance should be included in taxable income"}),s.jsx("div",{className:"flex items-start gap-3",children:s.jsx(V,{name:"is_part_of_gross",label:"This allowance is part of gross salary"})}),s.jsx("p",{className:"text-xs italic text-gray-600",children:"Check this if this allowance should be included in gross salary calculation"})]})]})}),s.jsx(N,{className:"my-6"}),s.jsx("div",{className:"pt-2",children:s.jsx(k,{isLoading:_.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:r?"Update Allowance":"Create Allowance"})})]})})})}function I(){var a,d,A,S,C,q;const P=y({}),[B,E]=l.useState(1),[F,T]=l.useState(10),[k,D]=l.useState(""),[V,L]=l.useState(!1),[M,I]=l.useState(""),[z,G]=l.useState(!1),[O,W]=l.useState(null),J=b({api:`${e.getAllAllowances}?page=${B}&limit=${F}&q=${k}`,key:"getAllAllowances",value:[B,F,k],options:{enabled:!0}});return s.jsxs("main",{className:"grid items-start",children:[s.jsx(Y,{open:V,setOpen:L,title:z?"Edit Allowance":"Add Allowance",id:M,edit:z,setEdit:G,refetch:J.refetch}),s.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[s.jsxs("div",{className:"flex w-full justify-between gap-2",children:[s.jsx("div",{children:s.jsx(x,{search:k,setSearch:D,refetch:J.refetch,isFetching:null==J?void 0:J.isLoading})}),s.jsx("div",{children:s.jsx(t,{className:"flex items-center gap-2",onClick:()=>L(!0),children:"Add New"})})]}),s.jsxs(r,{children:[s.jsx(o,{className:"px-7",children:s.jsxs(u,{children:["Allowance List (",(null==(d=null==(a=null==J?void 0:J.data)?void 0:a.data)?void 0:d.length)||0,")"]})}),s.jsx(m,{children:J.isLoading?s.jsx("div",{className:"flex h-32 items-center justify-center",children:s.jsx(w,{})}):s.jsxs(s.Fragment,{children:[s.jsxs(p,{children:[s.jsx(h,{children:s.jsxs(j,{children:[s.jsx(v,{className:"",children:"#"}),s.jsx(v,{className:"",children:"Code"}),s.jsx(v,{className:"",children:"Name"}),s.jsx(v,{className:"",children:"Type"}),s.jsx(v,{className:"",children:"Default Value"}),s.jsx(v,{className:"",children:"Base"}),s.jsx(v,{className:"",children:"Taxable"}),s.jsx(v,{className:"",children:"Part of Gross"}),s.jsx(v,{className:"",children:"Description"}),s.jsx(v,{className:"",children:"Created at"}),s.jsx(v,{className:"",children:"Status"}),s.jsx(v,{children:"Action"})]})}),s.jsx(f,{children:null==(S=null==(A=null==J?void 0:J.data)?void 0:A.data)?void 0:S.map((a,l)=>s.jsxs(j,{children:[s.jsx(g,{children:l+1}),s.jsx(g,{children:null==a?void 0:a.allowance_code}),s.jsx(g,{children:null==a?void 0:a.allowance_name}),s.jsx(g,{children:s.jsx(R,{variant:"outline",className:"capitalize",children:null==a?void 0:a.calculation_type})}),s.jsxs(g,{children:[null==a?void 0:a.default_value,"percentage"===(null==a?void 0:a.calculation_type)&&"%"]}),s.jsx(g,{className:"capitalize",children:(null==a?void 0:a.calculation_base)||"-"}),s.jsx(g,{children:s.jsx(R,{variant:(null==a?void 0:a.is_taxable)?"default":"secondary",children:(null==a?void 0:a.is_taxable)?"Yes":"No"})}),s.jsx(g,{children:s.jsx(R,{variant:(null==a?void 0:a.is_part_of_gross)?"default":"secondary",children:(null==a?void 0:a.is_part_of_gross)?"Yes":"No"})}),s.jsx(g,{className:"max-w-xs truncate",children:null==a?void 0:a.description}),s.jsx(g,{children:c(null==a?void 0:a.created_at).format("DD-MM-YYYY")}),s.jsx(g,{children:s.jsx(R,{variant:1===(null==a?void 0:a.status)?"default":"secondary",children:1===(null==a?void 0:a.status)?"Active":"Inactive"})}),s.jsx(g,{children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx(t,{className:"bg-primary",onClick:()=>{return e=String(null==a?void 0:a.id),G(!0),L(!0),void I(e);var e},children:"Edit"}),s.jsx(t,{variant:"destructive",onClick:()=>(async a=>{var l,s,t,d;W(a);try{const n=await P.mutateAsync({api:`${null==(l=e)?void 0:l.deleteAllowance}`,data:{id:a}});(null==(s=null==n?void 0:n.data)?void 0:s.success)?(J.refetch(),i.success((null==(t=null==n?void 0:n.data)?void 0:t.message)||"Allowance deleted successfully")):i.error((null==(d=n.data)?void 0:d.message)||"Failed to delete allowance")}catch(c){i.error(n(c))}finally{W(null)}})(String(null==a?void 0:a.id)),disabled:O===String(null==a?void 0:a.id),children:O===String(null==a?void 0:a.id)?s.jsx($,{className:"h-4 w-4 animate-spin"}):s.jsx(H,{className:"h-4 w-4"})})]})})]},null==a?void 0:a.id))})]}),s.jsx(N,{className:"mb-2 mt-4"}),s.jsx("div",{className:"flex w-full justify-end",children:s.jsx(_,{page:B,limit:F,totalPages:Math.ceil(((null==(q=null==(C=null==J?void 0:J.data)?void 0:C.data)?void 0:q.length)||0)/F),setPage:E,setLimit:T})})]})})]})]})]})}function z(){return s.jsx(d,{title:"Allowance List",subTitle:"Manage all the Allowances here",children:s.jsx("div",{className:"py-12",children:s.jsx(I,{})})})}export{z as default};
