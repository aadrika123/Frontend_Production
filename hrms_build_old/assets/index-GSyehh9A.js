import{j as e,r as s,D as a,B as l,n as t,h as r,x as n,v as i}from"./index-BJ2Di0BB.js";import{C as d,c,a as m,d as o,b as x}from"./card-CrOEotWM.js";import{A as p,b as h,f as u,T as b,c as j,d as N,e as v}from"./alert-BMnZh-St.js";import{u as _,b as g}from"./useCustomQuery-DkqDqiry.js";import{B as f}from"./badge-DufY8Gpx.js";import{L as y}from"./loader-circle--1riX2Rm.js";import{C as w}from"./circle-alert-BAbvq769.js";import{T as P}from"./trending-up-BYweVeOB.js";import{C}from"./calendar-B99NsLtP.js";import{C as I}from"./circle-check-DwPXeHSD.js";import{A as S,t as F,a as D,o as E,s as L,S as B}from"./use-toast-Cg3rxy4C.js";import{a as A,o as R,c as $,b as k,d as q}from"./yup-BTlf5Wf5.js";import{F as T,C as O,L as V}from"./datetime-picker-cKnQNXMD.js";import{R as M}from"./RHFTextField-BK1QXo_s.js";import"./select-4D5dQM-6.js";import{R as G}from"./RHFSelectField-CxYg0t7R.js";import{d as Q,P as K}from"./index-L2kacWh6.js";import"./clock-PqgEqIzL.js";import"./check-DiqtQ1XW.js";function H({incrementData:s,promotionData:a}){var l,t,r,n;if(s.isLoading)return e.jsx(d,{className:"border-slate-200 bg-white",children:e.jsxs(c,{className:"flex items-center justify-center py-12",children:[e.jsx(y,{className:"h-8 w-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-slate-600",children:"Loading increment preview..."})]})});if(s.error||!(null==(l=s.data)?void 0:l.success))return e.jsxs(p,{className:"border-red-200 bg-red-50",children:[e.jsx(w,{className:"h-4 w-4 text-red-600"}),e.jsx(h,{className:"text-red-700",children:"Failed to load increment preview. Please try again."})]});const i=null==(t=null==s?void 0:s.data)?void 0:t.data,u=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e),b=e=>e?new Date(e).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"Not set";return e.jsx("div",{className:"space-y-6",children:e.jsxs(d,{className:"border-slate-200 bg-white",children:[e.jsxs(m,{className:"border-b border-slate-100 bg-gradient-to-r from-slate-50 to-white pb-4",children:[e.jsxs(o,{className:"flex items-center gap-2 text-lg",children:[e.jsx(P,{className:"h-5 w-5 text-blue-600"}),"Increment Preview"]}),e.jsx(x,{children:"Current pay details and upcoming increment calculation"})]}),e.jsxs(c,{className:"pt-6",children:[e.jsxs("div",{className:"mb-6 grid grid-cols-2 gap-4 rounded-lg bg-slate-50 p-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Employee"}),e.jsx("p",{className:"font-semibold text-slate-900",children:i.emp_name}),e.jsx("p",{className:"text-sm text-slate-600",children:i.emp_code})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Pay Commission"}),e.jsx("p",{className:"font-semibold text-slate-900",children:null==(n=null==(r=null==a?void 0:a.data)?void 0:r.data)?void 0:n.pay_commission})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Current Level"}),e.jsx("p",{className:"font-semibold text-slate-900",children:i.current_level}),i.current_cell&&e.jsxs("p",{className:"text-sm text-slate-600",children:["Cell ",i.current_cell]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Current Basic Pay"}),e.jsx("p",{className:"text-lg font-bold text-emerald-600",children:u(i.current_basic_pay)})]})]}),e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-slate-200 bg-white p-4",children:[e.jsx(C,{className:"h-5 w-5 text-slate-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Last Increment"}),e.jsx("p",{className:"font-semibold text-slate-900",children:b(i.last_increment_date)})]})]}),e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-slate-200 bg-white p-4",children:[e.jsx(C,{className:"h-5 w-5 text-slate-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Next Increment Due"}),e.jsx("p",{className:"font-semibold text-slate-900",children:b(i.next_increment_date)})]}),i.is_increment_due&&e.jsx(f,{className:"ml-auto bg-emerald-100 text-emerald-700",children:"Due"}),!1===i.is_increment_due&&e.jsx(f,{className:"ml-auto bg-amber-100 text-amber-700",children:"Not Due"})]})]}),i.can_increment?e.jsxs(e.Fragment,{children:[e.jsxs(p,{className:"mb-6 border-emerald-200 bg-emerald-50",children:[e.jsx(I,{className:"h-4 w-4 text-emerald-600"}),e.jsxs(h,{className:"text-emerald-700",children:[e.jsx("span",{className:"font-semibold",children:"Increment Available"})," - Employee is eligible for annual increment"]})]}),i.preview&&e.jsxs(d,{className:"border-blue-200 bg-gradient-to-br from-blue-50 to-white",children:[e.jsx(m,{className:"pb-3",children:e.jsxs(o,{className:"text-base text-blue-900",children:["Increment Calculation"," ",e.jsx(f,{variant:"outline",className:"ml-2",children:"7th_cpc_matrix"===i.increment_type?"7th CPC Matrix":"6th CPC Grade Pay"})]})}),e.jsx(c,{children:"7th_cpc_matrix"===i.increment_type?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-4 text-center",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Current Cell"}),e.jsx("p",{className:"text-2xl font-bold text-slate-700",children:i.current_cell}),e.jsx("p",{className:"text-sm text-slate-600",children:u(i.current_basic_pay)})]}),e.jsx(S,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{className:"rounded-lg border-2 border-emerald-300 bg-emerald-50 p-4 text-center",children:[e.jsx("p",{className:"text-xs text-emerald-600",children:"New Cell"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-700",children:i.preview.new_cell}),e.jsx("p",{className:"text-sm text-emerald-600",children:u(i.preview.new_basic_pay)})]})]}),e.jsx("div",{className:"rounded-lg bg-emerald-100 p-3 text-center",children:e.jsxs("p",{className:"text-sm text-emerald-700",children:["Increment:"," ",e.jsx("span",{className:"font-bold",children:u(i.preview.increment_amount)})," ","(",i.preview.increment_percentage,"%)"]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Increment Rate"}),e.jsx("p",{className:"text-lg font-bold text-slate-700",children:i.preview.increment_rate})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Increment Base"}),e.jsx("p",{className:"text-lg font-bold text-slate-700",children:u(i.preview.increment_base||0)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Current Pay Band Pay"}),e.jsx("p",{className:"font-semibold text-slate-700",children:u(i.preview.current_pay_band_pay||0)})]}),e.jsxs("div",{className:"rounded-lg border-2 border-emerald-300 bg-emerald-50 p-3",children:[e.jsx("p",{className:"text-xs text-emerald-600",children:"New Pay Band Pay"}),e.jsx("p",{className:"font-semibold text-emerald-700",children:u(i.preview.new_pay_band_pay||0)})]})]}),e.jsx("div",{className:"rounded-lg bg-slate-100 p-3",children:e.jsxs("p",{className:"text-sm text-slate-600",children:["Grade Pay:"," ",e.jsx("span",{className:"font-semibold",children:u(i.preview.grade_pay||0)})," ","(unchanged)"]})}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-4 text-center",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Current Basic"}),e.jsx("p",{className:"text-xl font-bold text-slate-700",children:u(i.current_basic_pay)})]}),e.jsx(S,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{className:"rounded-lg border-2 border-emerald-300 bg-emerald-50 p-4 text-center",children:[e.jsx("p",{className:"text-xs text-emerald-600",children:"New Basic"}),e.jsx("p",{className:"text-xl font-bold text-emerald-700",children:u(i.preview.new_basic_pay)})]})]}),e.jsx("div",{className:"rounded-lg bg-emerald-100 p-3 text-center",children:e.jsxs("p",{className:"text-sm text-emerald-700",children:["Increment:"," ",e.jsx("span",{className:"font-bold",children:u(i.preview.increment_amount)})," ","(",i.preview.increment_percentage,"%)"]})})]})})]})]}):e.jsxs(p,{className:"border-amber-200 bg-amber-50",children:[e.jsx(w,{className:"h-4 w-4 text-amber-600"}),e.jsx(h,{className:"text-amber-700",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-semibold",children:"Increment Not Available"}),e.jsx("p",{children:i.reason}),i.recommendation&&e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Recommendation:"})," ",i.recommendation]})]})})]})]})]})})}const z=E({effective_date:L().min(1,"Effective date is required"),vide_order_no:L().optional(),vide_order_date:L().optional()});function J({empId:n,canIncrement:i,isIncrementDue:u,onSuccess:b}){const[j,N]=s.useState(!1),[v,g]=s.useState(null),S=a(),E=_({}),L=A({resolver:F(z),defaultValues:{effective_date:(new Date).toISOString().split("T")[0],vide_order_no:"",vide_order_date:""}}),{handleSubmit:B,reset:R}=L,$=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e);return v?e.jsxs(d,{className:"border-emerald-200 bg-gradient-to-br from-emerald-50 to-white",children:[e.jsx(m,{className:"pb-3",children:e.jsxs(o,{className:"flex items-center gap-2 text-emerald-700",children:[e.jsx(I,{className:"h-5 w-5"}),"Increment Processed Successfully"]})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"rounded-lg bg-white p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Increment Type"}),e.jsx("p",{className:"font-semibold text-slate-900",children:"7th_cpc_matrix"===v.increment_type?"7th CPC Matrix":"6th CPC Grade Pay"})]}),e.jsxs("div",{className:"rounded-lg bg-white p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Previous Basic"}),e.jsx("p",{className:"font-semibold text-slate-900",children:$(v.previous_basic)})]}),e.jsxs("div",{className:"rounded-lg bg-emerald-100 p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-emerald-600",children:"New Basic"}),e.jsx("p",{className:"font-bold text-emerald-700",children:$(v.new_basic)})]}),e.jsxs("div",{className:"rounded-lg bg-blue-100 p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-blue-600",children:"Increment Amount"}),e.jsxs("p",{className:"font-bold text-blue-700",children:["+",$(v.increment_amount)," (",v.increment_percentage,"%)"]})]})]}),"7th_cpc_matrix"===v.increment_type&&e.jsx("div",{className:"rounded-lg bg-slate-100 p-3",children:e.jsxs("p",{className:"text-sm text-slate-600",children:["Cell moved from"," ",e.jsx(f,{variant:"outline",children:v.previous_cell})," to"," ",e.jsx(f,{className:"bg-emerald-100 text-emerald-700",children:v.new_cell})]})}),e.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-blue-50 p-3",children:[e.jsx(C,{className:"h-4 w-4 text-blue-600"}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Effective: ",e.jsx("strong",{children:v.effective_date})," | Next Increment: ",e.jsx("strong",{children:v.next_increment_date})]})]}),e.jsx(l,{onClick:()=>{g(null),R(),N(!1)},variant:"outline",className:"w-full",children:"Process Another Increment"})]})})]}):e.jsxs(d,{className:"border-slate-200 bg-white",children:[e.jsxs(m,{className:"border-b border-slate-100 pb-4",children:[e.jsxs(o,{className:"flex items-center gap-2 text-lg",children:[e.jsx(P,{className:"h-5 w-5 text-blue-600"}),"Process Annual Increment"]}),e.jsx(x,{children:"Apply annual increment to employee's pay configuration"})]}),e.jsxs(c,{className:"pt-6",children:[!i&&e.jsxs(p,{className:"mb-6 border-red-200 bg-red-50",children:[e.jsx(w,{className:"h-4 w-4 text-red-600"}),e.jsx(h,{className:"text-red-700",children:"Employee is not eligible for increment. They may have reached maximum cell/pay band. Consider processing a promotion instead."})]}),i&&!u&&e.jsxs(p,{className:"mb-6 border-amber-200 bg-amber-50",children:[e.jsx(w,{className:"h-4 w-4 text-amber-600"}),e.jsxs(h,{className:"text-amber-700",children:[e.jsx("p",{className:"font-semibold",children:"Increment Not Yet Due"}),e.jsx("p",{className:"text-sm",children:'The next increment date has not arrived. Enable "Force Processing" below to process anyway.'})]})]}),e.jsx(T,{methods:L,onSubmit:B(async e=>{var s,a;if(i)try{const s=t(String(n)),a={emp_id:Number(s),effective_date:e.effective_date,vide_order_no:e.vide_order_no||null,vide_order_date:e.vide_order_date||null,force:j},l=await E.mutateAsync({api:r.processIncrement,data:a});l.data.success&&(g(l.data.data),D({title:"Increment Processed Successfully",description:`Annual increment applied. New basic pay: ₹${l.data.data.new_basic}`}),S.invalidateQueries({queryKey:[`incrementPreview-${n}`]}),S.invalidateQueries({queryKey:[`getEmployeeSalary-${n}`]}),b&&b(l.data))}catch(l){D({title:"Failed to Process Increment",description:(null==(a=null==(s=null==l?void 0:l.response)?void 0:s.data)?void 0:a.message)||"An error occurred. Please try again.",variant:"destructive"})}else D({title:"Cannot Process Increment",description:"Employee is not eligible for increment at this time. Consider promotion.",variant:"destructive"})}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(M,{name:"effective_date",label:"Effective Date *",type:"date"}),e.jsx(M,{name:"vide_order_date",label:"Order Date",type:"date"})]}),e.jsx(M,{name:"vide_order_no",label:"Order Number",placeholder:"e.g., INC/2025/001"}),i&&!u&&e.jsxs("div",{className:"flex items-center space-x-2 rounded-lg border border-amber-200 bg-amber-50 p-4",children:[e.jsx(O,{id:"force",checked:j,onCheckedChange:e=>N(e)}),e.jsx(V,{htmlFor:"force",className:"cursor-pointer text-sm text-amber-700",children:"Force Processing - Process increment before due date"})]}),e.jsx(l,{type:"submit",disabled:(null==E?void 0:E.isPending)||!i,className:"w-full bg-blue-600 hover:bg-blue-700",children:(null==E?void 0:E.isPending)?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing Increment..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Process Increment"]})})]})})]})]})}function X({onSelectLevel:a,promotionData:l}){var t,r,n,i;const[b,j]=s.useState(null);if(l.isLoading)return e.jsx(d,{className:"border-slate-200 bg-white",children:e.jsxs(c,{className:"flex items-center justify-center py-12",children:[e.jsx(y,{className:"h-8 w-8 animate-spin text-purple-600"}),e.jsx("span",{className:"ml-3 text-slate-600",children:"Loading promotion preview..."})]})});if(l.error||!(null==(t=l.data)?void 0:t.success))return e.jsxs(p,{className:"border-red-200 bg-red-50",children:[e.jsx(w,{className:"h-4 w-4 text-red-600"}),e.jsx(h,{className:"text-red-700",children:"Failed to load promotion preview. Please try again."})]});const N=l.data.data,v=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e),_=(e,s)=>{j(e),a&&a(e,s)};return e.jsx("div",{className:"space-y-6",children:e.jsxs(d,{className:"border-slate-200 bg-white",children:[e.jsxs(m,{className:"border-b border-slate-100 bg-gradient-to-r from-slate-50 to-white pb-4",children:[e.jsxs(o,{className:"flex items-center gap-2 text-lg",children:[e.jsx(u,{className:"h-5 w-5 text-purple-600"}),"Promotion Preview"]}),e.jsx(x,{children:"View eligible promotion levels with pay fitment analysis"})]}),e.jsxs(c,{className:"pt-6",children:[e.jsxs("div",{className:"mb-6 grid grid-cols-2 gap-4 rounded-lg bg-slate-50 p-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Employee"}),e.jsx("p",{className:"font-semibold text-slate-900",children:N.emp_name}),e.jsx("p",{className:"text-sm text-slate-600",children:N.emp_code})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Pay Commission"}),e.jsx("p",{className:"font-semibold text-slate-900",children:N.pay_commission}),e.jsx(f,{variant:"outline",className:"mt-1",children:N.is_matrix_based?"7th CPC Matrix":"6th CPC GP"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Current Level"}),e.jsx("p",{className:"font-semibold text-slate-900",children:N.current_level_name}),N.is_matrix_based&&N.current_cell&&e.jsxs("p",{className:"text-sm text-slate-600",children:["Cell ",N.current_cell]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Current Basic Pay"}),e.jsx("p",{className:"text-lg font-bold text-emerald-600",children:v(N.current_basic_pay)})]})]}),N.can_promote?e.jsxs(e.Fragment,{children:[(null==N?void 0:N.recommended_promotion)&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"mb-3 flex items-center gap-2 text-sm font-semibold text-purple-700",children:[e.jsx(B,{className:"h-4 w-4"}),"Recommended Promotion"]}),e.jsx(d,{className:"cursor-pointer border-2 transition-all "+(b===N.recommended_promotion.pay_level_id?"border-purple-500 bg-purple-50":"border-purple-200 bg-gradient-to-r from-purple-50 to-white hover:border-purple-400"),onClick:()=>_(N.recommended_promotion.pay_level_id,N.recommended_promotion),children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-purple-900",children:N.recommended_promotion.level_name}),N.is_matrix_based&&N.recommended_promotion.recommended_cell&&e.jsxs("p",{className:"text-sm text-purple-600",children:["Recommended Cell:"," ",N.recommended_promotion.recommended_cell]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-emerald-600",children:v(N.recommended_promotion.new_basic_pay)}),e.jsxs(f,{className:"bg-emerald-100 text-emerald-700",children:["+",v(N.recommended_promotion.increment_amount)]})]})]})})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"mb-3 text-sm font-semibold text-slate-700",children:["All Eligible Promotion Levels (",N.eligible_levels.length,")"]}),e.jsx("div",{className:"grid-rows-auto grid grid-cols-1 gap-4 md:grid-cols-2",children:(null==N?void 0:N.is_matrix_based)?null==(n=null==N?void 0:N.eligible_levels)?void 0:n.map(s=>e.jsx(d,{className:"cursor-pointer border transition-all "+(b===s.pay_level_id?"border-purple-500 bg-purple-50":"border-slate-200 hover:border-purple-300 hover:bg-slate-50"),onClick:()=>_(s.pay_level_id,s),children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-slate-900",children:s.level_name}),e.jsxs(f,{variant:"outline",children:["Level ",s.level]}),s.fitment_required&&e.jsx(f,{className:"bg-amber-100 text-amber-700",children:"Fitment Required"})]}),e.jsxs("p",{className:"mt-1 text-sm text-slate-500",children:["Range: ",v(s.min_basic_pay)," -"," ",v(s.max_basic_pay)]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xs text-slate-500",children:["Entry Cell (",s.entry_cell.cell_index,")"]}),e.jsx("p",{className:"font-semibold "+(s.entry_cell.would_result_in_pay_cut?"text-red-600":"text-slate-700"),children:v(s.entry_cell.basic_pay)}),s.entry_cell.would_result_in_pay_cut&&e.jsx("p",{className:"text-xs text-red-500",children:"Pay cut!"})]}),s.recommended_cell&&e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4 text-slate-400"}),e.jsxs("div",{className:"rounded-lg bg-emerald-50 p-2 text-center",children:[e.jsxs("p",{className:"text-xs text-emerald-600",children:["Fitted Cell (",s.recommended_cell.cell_index,")"]}),e.jsx("p",{className:"font-bold text-emerald-700",children:v(s.recommended_cell.basic_pay)}),e.jsxs("p",{className:"text-xs text-emerald-600",children:["+",v(s.recommended_cell.increment_amount)," ","(",s.recommended_cell.increment_percentage,"%)"]})]})]})]}),b===s.pay_level_id&&e.jsx(I,{className:"h-5 w-5 text-purple-600"})]})})},s.pay_level_id)):null==(i=null==N?void 0:N.eligible_levels)?void 0:i.map(s=>e.jsx(d,{className:"cursor-pointer border transition-all "+(b===s.pay_level_id?"border-purple-500 bg-purple-50":"border-slate-200 hover:border-purple-300 hover:bg-slate-50"),onClick:()=>_(s.pay_level_id,s),children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-slate-900",children:s.level_name}),e.jsxs(f,{variant:"outline",children:["GP ₹",s.new_grade_pay]}),s.pay_band_changed&&e.jsx(f,{className:"bg-blue-100 text-blue-700",children:"Pay Band Change"}),s.fitment_applied&&e.jsx(f,{className:"bg-amber-100 text-amber-700",children:"Fitment Applied"})]}),e.jsxs("p",{className:"mt-1 text-sm text-slate-500",children:[s.pay_band_name," (",v(s.pay_band_min)," -"," ",v(s.pay_band_max),")"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"New Pay Band Pay"}),e.jsx("p",{className:"font-semibold text-slate-700",children:v(s.new_pay_band_pay)})]}),e.jsxs("div",{className:"rounded-lg bg-emerald-50 p-2 text-center",children:[e.jsx("p",{className:"text-xs text-emerald-600",children:"New Basic"}),e.jsx("p",{className:"font-bold text-emerald-700",children:v(s.new_basic_pay)}),e.jsxs("p",{className:"text-xs text-emerald-600",children:["+",v(s.increment_amount)," (",s.increment_percentage,"%)"]})]}),b===s.pay_level_id&&e.jsx(I,{className:"h-5 w-5 text-purple-600"})]})]})})},s.pay_level_id))})]})]}):e.jsxs(p,{className:"border-amber-200 bg-amber-50",children:[e.jsx(w,{className:"h-4 w-4 text-amber-600"}),e.jsxs(h,{className:"text-amber-700",children:[e.jsx("p",{className:"font-semibold",children:"No Promotion Levels Available"}),e.jsx("p",{children:null==(r=null==l?void 0:l.data)?void 0:r.message})]})]})]})]})})}const Y=$({new_pay_level_id:k().min(1,"Pay level is required"),new_designation_id:k().optional(),is_matrix_based:q().optional(),cell_index:k().optional(),new_pay_band_pay:k().optional(),effective_date:k().min(1,"Effective date is required"),vide_order_no:k().optional(),vide_order_date:k().optional(),promotion_reason:k().optional()});function U({empId:i,selectedLevel:b,canPromote:j,onSuccess:N,onReset:v,isMatrixBased:_,getEmpData:g}){var P,S,F,E,L;const[B,$]=s.useState(!1),[k,q]=s.useState(null),O=a(),{data:V}=Q(),K=A({resolver:R(Y),defaultValues:{new_pay_level_id:"",new_designation_id:"",cell_index:"1",is_matrix_based:!1,new_pay_band_pay:"",effective_date:(new Date).toISOString().split("T")[0],vide_order_no:"",vide_order_date:"",promotion_reason:""}}),{handleSubmit:H,reset:z,setValue:J,watch:X}=K;s.useEffect(()=>{var e,s;(null==g?void 0:g.data)&&(null==K||K.reset({...K.getValues(),new_designation_id:String((null==(s=null==(e=null==g?void 0:g.data)?void 0:e.data)?void 0:s.designation_id)||"")}))},[g,K]),s.useEffect(()=>{var e;b&&(J("new_pay_level_id",String(b.pay_level_id)),_?J("cell_index",String(null==(e=b.recommended_cell)?void 0:e.cell_index)):J("new_pay_band_pay",String(null==b?void 0:b.new_pay_band_pay)))},[b,J]);const U=X("new_pay_level_id"),W=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e),Z=(null==(P=null==V?void 0:V.data)?void 0:P.map(e=>({label:e.designation_name,value:String(e.id)})))||[];return k?e.jsxs(d,{className:"border-purple-200 bg-gradient-to-br from-purple-50 to-white",children:[e.jsx(m,{className:"pb-3",children:e.jsxs(o,{className:"flex items-center gap-2 text-purple-700",children:[e.jsx(I,{className:"h-5 w-5"}),"Promotion Processed Successfully"]})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg bg-white p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Previous Level"}),e.jsx("p",{className:"font-semibold text-slate-900",children:k.previous_level_name}),k.previous_cell&&e.jsxs("p",{className:"text-sm text-slate-600",children:["Cell ",k.previous_cell]})]}),e.jsxs("div",{className:"rounded-lg bg-purple-100 p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-purple-600",children:"New Level"}),e.jsx("p",{className:"font-bold text-purple-700",children:k.new_level_name}),k.new_cell&&e.jsxs("p",{className:"text-sm text-purple-600",children:["Cell ",k.new_cell]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg bg-white p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Previous Basic"}),e.jsx("p",{className:"font-semibold text-slate-900",children:W(k.previous_basic)})]}),e.jsxs("div",{className:"rounded-lg bg-emerald-100 p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-emerald-600",children:"New Basic"}),e.jsx("p",{className:"font-bold text-emerald-700",children:W(k.new_basic)})]}),e.jsxs("div",{className:"rounded-lg bg-blue-100 p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-blue-600",children:"Increment"}),e.jsxs("p",{className:"font-bold text-blue-700",children:["+",W(k.increment_amount)]})]})]}),k.fitment_applied&&e.jsxs(p,{className:"border-amber-200 bg-amber-50",children:[e.jsx(w,{className:"h-4 w-4 text-amber-600"}),e.jsxs(h,{className:"text-amber-700",children:[e.jsx("strong",{children:"Fitment Applied:"})," Cell adjusted from"," ",k.requested_cell," to ",k.new_cell," to maintain pay protection."]})]}),e.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-blue-50 p-3",children:[e.jsx(C,{className:"h-4 w-4 text-blue-600"}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Effective: ",e.jsx("strong",{children:k.effective_date})," | Next Increment: ",e.jsx("strong",{children:k.next_increment_date})]})]}),e.jsx(l,{onClick:()=>{q(null),z(),null==v||v()},variant:"outline",className:"w-full",children:"Process Another Promotion"})]})})]}):e.jsxs(d,{className:"border-slate-200 bg-white",children:[e.jsxs(m,{className:"border-b border-slate-100 pb-4",children:[e.jsxs(o,{className:"flex items-center gap-2 text-lg",children:[e.jsx(u,{className:"h-5 w-5 text-purple-600"}),"Process Promotion"]}),e.jsx(x,{children:"Promote employee to a higher pay level"})]}),e.jsxs(c,{className:"pt-6",children:[!j&&e.jsxs(p,{className:"mb-6 border-red-200 bg-red-50",children:[e.jsx(w,{className:"h-4 w-4 text-red-600"}),e.jsx(h,{className:"text-red-700",children:"Employee is not eligible for promotion. They may already be at the highest level."})]}),!b&&j&&e.jsxs(p,{className:"mb-6 border-blue-200 bg-blue-50",children:[e.jsx(w,{className:"h-4 w-4 text-blue-600"}),e.jsx(h,{className:"text-blue-700",children:"Please select a promotion level from the preview above to proceed."})]}),b&&e.jsxs("div",{className:"mb-6 rounded-lg border-2 border-purple-200 bg-purple-50 p-4",children:[e.jsx("p",{className:"text-sm font-medium text-purple-700",children:"Selected Level"}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-purple-900",children:b.level_name}),b.level&&e.jsxs(f,{variant:"outline",children:["Level ",b.level]})]}),(null==(S=null==b?void 0:b.recommended_cell)?void 0:S.basic_pay)&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-emerald-600",children:W(null==(F=null==b?void 0:b.recommended_cell)?void 0:F.basic_pay)}),(null==(E=b.recommended_cell)?void 0:E.increment_amount)&&e.jsxs("p",{className:"text-sm text-emerald-600",children:["+",W((null==(L=b.recommended_cell)?void 0:L.increment_amount)||0)," "]})]})]})]}),e.jsx(T,{methods:K,onSubmit:H(async e=>{var s,a;if(j)if(e.new_pay_level_id){$(!0);try{const s=t(String(i)),a=parseInt(e.cell_index||"1",10),l=isNaN(a)||a<1?1:a,d={emp_id:Number(s),new_pay_level_id:Number(e.new_pay_level_id),new_designation_id:e.new_designation_id?Number(e.new_designation_id):null,..._&&{cell_index:l},...!_&&{new_pay_band_pay:Number(e.new_pay_band_pay)},effective_date:e.effective_date,vide_order_no:e.vide_order_no||null,vide_order_date:e.vide_order_date||null,promotion_reason:e.promotion_reason||null},c=await n.post(r.processPromotion,d);c.data.success&&(q(c.data.data),D({title:"Promotion Processed Successfully",description:`Promoted to ${c.data.data.new_level_name}. New basic pay: ₹${c.data.data.new_basic}`}),O.invalidateQueries({queryKey:[`promotionPreview-${i}`]}),O.invalidateQueries({queryKey:[`incrementPreview-${i}`]}),O.invalidateQueries({queryKey:[`getEmployeeSalary-${i}`]}),N&&N(c.data))}catch(l){D({title:"Failed to Process Promotion",description:(null==(a=null==(s=null==l?void 0:l.response)?void 0:s.data)?void 0:a.message)||"An error occurred. Please try again.",variant:"destructive"})}finally{$(!1)}}else D({title:"Select a Level",description:"Please select a promotion level from the preview above.",variant:"destructive"});else D({title:"Cannot Process Promotion",description:"Employee is not eligible for promotion at this time.",variant:"destructive"})}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("input",{type:"hidden",...K.register("new_pay_level_id")}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(M,{name:"effective_date",label:"Effective Date *",type:"date"}),_?e.jsx(M,{disabled:!0,name:"cell_index",label:"Cell Index",inputValidation:["number"]}):e.jsx(M,{disabled:!0,name:"new_pay_band_pay",label:"New Pay Band Pay",inputValidation:["number"]})]}),e.jsx(G,{name:"new_designation_id",label:"New Designation (Optional)",data:Z,isSearch:!0}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(M,{name:"vide_order_no",label:"Order Number",placeholder:"e.g., PROM/2025/001"}),e.jsx(M,{name:"vide_order_date",label:"Order Date",type:"date"})]}),e.jsx(M,{name:"promotion_reason",label:"Promotion Reason (Optional)",placeholder:"e.g., Promotion based on annual performance review"}),e.jsx(l,{type:"submit",disabled:B||!j||!U,className:"w-full bg-purple-600 hover:bg-purple-700",children:B?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing Promotion..."]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"mr-2 h-4 w-4"}),"Process Promotion"]})})]})})]})]})}function W({onBack:a}){var l,t,n,m,o,x,p,h,_,f,w,C,S,F,D,E,L;const{id:B}=i(),A=B||"",[R,$]=s.useState("increment"),[k,q]=s.useState(null),T=g({api:`${null==(l=r)?void 0:l.getEmployeeById}?id=${B}`,key:`${null==(t=r)?void 0:t.getEmployeeById}-${B}`,value:[B],options:{enabled:Boolean(B)}}),O=g({api:`${r.getIncrementPreview}?emp_id=${A}`,key:`incrementPreview-${A}`,value:[A],options:{enabled:!!A}}),V=g({api:`${r.getPromotionPreview}?emp_id=${A}`,key:`promotionPreview-${A}`,value:[A],options:{enabled:!!A}}),M=(null==(m=null==(n=null==O?void 0:O.data)?void 0:n.data)?void 0:m.can_increment)??!1,G=(null==(x=null==(o=null==O?void 0:O.data)?void 0:o.data)?void 0:x.is_increment_due)??!0,Q=(null==(h=null==(p=null==V?void 0:V.data)?void 0:p.data)?void 0:h.can_promote)??!1;return O.isLoading||V.isLoading?e.jsx("div",{className:"flex h-screen w-full items-center justify-center",children:e.jsx(y,{className:"h-8 w-8 animate-spin text-blue-600"})}):e.jsx(K,{title:"Increment & Promotion",subTitle:"Process annual increment or promotion for employee",name:null==(f=null==(_=null==V?void 0:V.data)?void 0:_.data)?void 0:f.emp_name,code:null==(C=null==(w=null==V?void 0:V.data)?void 0:w.data)?void 0:C.emp_code,description:"Manage and process employee increments and promotions efficiently.",children:e.jsxs("div",{className:"min-h-screen space-y-6 bg-gradient-to-br from-slate-50 via-blue-50/30 to-slate-50",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(d,{className:"cursor-pointer border-2 transition-all "+("increment"===R?"border-blue-500 bg-blue-50":"border-slate-200 hover:border-blue-300"),onClick:()=>$("increment"),children:e.jsxs(c,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"rounded-full p-3 "+(M?"bg-emerald-100":"bg-amber-100"),children:e.jsx(P,{className:"h-6 w-6 "+(M?"text-emerald-600":"text-amber-600")})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900",children:"Annual Increment"}),e.jsx("p",{className:"text-sm text-slate-600",children:M?e.jsxs("span",{className:"flex items-center gap-1 text-emerald-600",children:[e.jsx(I,{className:"h-3 w-3"})," Eligible",G?" - Due now":" - Not yet due"]}):e.jsx("span",{className:"text-amber-600",children:"Not eligible - Promotion required"})})]})]})}),e.jsx(d,{className:"cursor-pointer border-2 transition-all "+("promotion"===R?"border-purple-500 bg-purple-50":"border-slate-200 hover:border-purple-300"),onClick:()=>$("promotion"),children:e.jsxs(c,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"rounded-full p-3 "+(Q?"bg-emerald-100":"bg-amber-100"),children:e.jsx(u,{className:"h-6 w-6 "+(Q?"text-emerald-600":"text-amber-600")})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900",children:"Promotion"}),e.jsx("p",{className:"text-sm text-slate-600",children:Q?e.jsxs("span",{className:"flex items-center gap-1 text-emerald-600",children:[e.jsx(I,{className:"h-3 w-3"})," ",(null==(D=null==(F=null==(S=null==V?void 0:V.data)?void 0:S.data)?void 0:F.eligible_levels)?void 0:D.length)||0," ","levels available"]}):e.jsx("span",{className:"text-amber-600",children:"Already at highest level"})})]})]})})]}),e.jsx(d,{className:"border-slate-200 bg-white shadow-lg",children:e.jsx(c,{className:"p-0",children:e.jsxs(b,{value:R,onValueChange:$,className:"w-full",children:[e.jsxs(j,{className:"grid h-auto w-full grid-cols-2 gap-0 rounded-none rounded-t-lg border-b bg-slate-100 p-0",children:[e.jsxs(N,{value:"increment",className:"flex items-center gap-2 rounded-none rounded-tl-lg py-4 data-[state=active]:bg-white data-[state=active]:shadow-none",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{children:"Annual Increment"})]}),e.jsxs(N,{value:"promotion",className:"flex items-center gap-2 rounded-none rounded-tr-lg py-4 data-[state=active]:bg-white data-[state=active]:shadow-none",children:[e.jsx(u,{className:"h-4 w-4"}),e.jsx("span",{children:"Promotion"})]})]}),e.jsx(v,{value:"increment",className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e.jsx(H,{incrementData:O,promotionData:V}),e.jsx(J,{empId:A,canIncrement:M,isIncrementDue:G})]})}),e.jsx(v,{value:"promotion",className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(X,{onSelectLevel:(e,s)=>{q(s)},promotionData:V}),e.jsx(U,{empId:A,selectedLevel:k,canPromote:Q,onReset:()=>q(null),isMatrixBased:(null==(L=null==(E=null==V?void 0:V.data)?void 0:E.data)?void 0:L.is_matrix_based)||!1,getEmpData:T})]})})]})})})]})})}export{W as default};
