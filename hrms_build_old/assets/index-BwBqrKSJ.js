import{i as te,j as e,h as H,z as $,r as i,B as he,e as be}from"./index-Df4ChAN-.js";import{g as fe,P as ye}from"./index-DjNjGvXo.js";import{u as se,b as je}from"./useCustomQuery-BBKf_waA.js";import{a as Ne,o as ve,c as we,b as q}from"./yup-pPl0eVQc.js";import{F as Se,B as _e,C as ke}from"./datetime-picker-EqBIIAIP.js";import"./select-DZKz6XPY.js";import{R as Ae}from"./RHFSelectField-Cy0QtYHL.js";import{R as Q}from"./DateAndTimePicker-YyDdH3It.js";import{S as Ce}from"./Spinner-CyN74T25.js";import{D as Fe}from"./index-D4JNSpYb.js";import{C as W,S as Ie}from"./search-V3vfnyKc.js";import{C as B}from"./calendar-CMNTAmai.js";import{B as Z}from"./briefcase-S-Dqqc17.js";import{U as Le}from"./users-axBRK0bb.js";import{a as Pe,C as Te}from"./clock-BxgzxCOp.js";import"./check-BzewUJFq.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=te("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=te("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),Re=we().shape({attendance_status:q().required("Attendance status is required"),emp_in_time:q().when("attendance_status",{is:r=>r==="1"||r==="2",then:r=>r.required("In Time is required for Present or Half Day"),otherwise:r=>r.notRequired()}),emp_out_time:q().when("attendance_status",{is:r=>r==="1"||r==="2",then:r=>r.required("Out Time is required for Present or Half Day"),otherwise:r=>r.notRequired()})});function De({open:r,setOpen:g,title:y,id:A,edit:C,setEdit:F,refetch:I}){const x=se({}),L=new Date,c=Ne({defaultValues:{attendance_status:"",emp_in_time:"",emp_out_time:""},resolver:ve(Re)}),P=async l=>{var h,o,j,m;try{const d=await x.mutateAsync({api:(h=H)==null?void 0:h.createAttendance,data:{emp_id:A,date:L.toISOString().split("T")[0],attendance_status:l.attendance_status,...l.emp_in_time&&{emp_in_time:l.emp_in_time},...l.emp_out_time&&{emp_out_time:l.emp_out_time}}});(o=d.data)!=null&&o.success?($.success(((j=d==null?void 0:d.data)==null?void 0:j.message)||"Attendance created successfully"),g(!1),I()):$.error(((m=d.data)==null?void 0:m.message)||"Failed to create attendance")}catch(d){console.log(d),$.error("An error occurred while creating attendance")}};return e.jsx(Fe,{open:r,setOpen:g,title:y,edit:C,setEdit:F,children:e.jsx(Se,{methods:c,onSubmit:c.handleSubmit(P),children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-2 gap-y-4",children:[e.jsx("div",{className:"col-span-2",children:e.jsx(Ae,{name:"attendance_status",label:"Attendance Status",data:[{label:"Absent",value:"0"},{label:"Present",value:"1"},{label:"Half Day",value:"2"},{label:"Leave",value:"3"}]})}),e.jsx("div",{children:e.jsx(Q,{label:"In Time",name:"emp_in_time",placeholder:"Enter In Time"})}),e.jsx("div",{children:e.jsx(Q,{label:"Out Time",name:"emp_out_time",placeholder:"Enter Out Time"})}),e.jsx(Ce,{className:"col-span-2 my-2"}),e.jsx("div",{className:"col-span-2 flex justify-end",children:e.jsx(_e,{isLoading:c.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}const $e=()=>{var z,U,J,V,X,G;const r=new Date,[g,y]=i.useState(!1),[A,C]=i.useState(!1),[F,I]=i.useState(""),[x,L]=i.useState(r.toLocaleString("en-IN",{month:"long"})),[c,P]=i.useState(r.getFullYear()),[l,h]=i.useState(1),[o,j]=i.useState(20),[m,d]=i.useState(r.toISOString().split("T")[0]),ae=se({}),[N,re]=i.useState(""),[v,le]=i.useState(""),[w,ne]=i.useState("all"),[qe,E]=i.useState({present:0,absent:0,halfDay:0,leave:0,total:0}),[b,O]=i.useState(null),T=fe(),ie=()=>{const t=new URLSearchParams;return x&&t.append("month",x),c&&t.append("year",c.toString()),m&&t.append("date",m),N&&t.append("department_id",be(String(N))),v&&t.append("q",v),w!=="all"&&t.append("status",w.toString()),t.append("page",l.toString()),t.append("limit",o.toString()),t.toString()},s=je({api:`${(z=H)==null?void 0:z.getAllAttendance}?${ie()}`,value:[l,o,x,c,m,N,v,w],options:{enabled:!0}});i.useEffect(()=>{oe()},[s==null?void 0:s.data]);const oe=()=>{var n;if(!((n=s==null?void 0:s.data)!=null&&n.data)){E({present:0,absent:0,halfDay:0,leave:0,total:0});return}const t=s.data.data.reduce((a,p)=>{switch(p.attendance_status){case 1:a.present++;break;case 0:a.absent++;break;case 2:a.halfDay++;break;case 3:a.leave++;break}return a},{present:0,absent:0,halfDay:0,leave:0,total:s.data.data.length});E(t)},S=async(t,n)=>{var a,p,k,K;try{const f=await ae.mutateAsync({api:(a=H)==null?void 0:a.createAttendance,data:{emp_id:t,date:m||r.toISOString().split("T")[0],attendance_status:n}});(p=f.data)!=null&&p.success?(M("success",((k=f.data)==null?void 0:k.message)||"Status updated successfully"),s.refetch()):M("error",((K=f.data)==null?void 0:K.message)||"Failed to update status")}catch(f){console.log(f),M("error","An error occurred while updating status")}},M=(t,n)=>{O({type:t,text:n}),setTimeout(()=>O(null),3e3)},de=t=>{const a={1:{label:"Present",color:"bg-emerald-500",icon:ee},0:{label:"Absent",color:"bg-red-500",icon:W},2:{label:"Half Day",color:"bg-amber-500",icon:Te},3:{label:"Leave",color:"bg-blue-500",icon:Z}}[t];return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:`${a==null?void 0:a.color} h-2 w-2 rounded-full`}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:a==null?void 0:a.label})]})},_=({status:t,currentStatus:n,onClick:a,label:p,color:k})=>e.jsx("button",{onClick:a,className:`rounded-lg px-3 py-1.5 text-xs font-medium transition-all duration-200 ${n===t?`${k} text-white shadow-sm`:"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:p}),ce=["January","February","March","April","May","June","July","August","September","October","November","December"],me=Array.from({length:10},(t,n)=>r.getFullYear()-n),Y=(s==null?void 0:s.isLoading)||(s==null?void 0:s.isFetching),R=((J=(U=s==null?void 0:s.data)==null?void 0:U.pagination)==null?void 0:J.total)||0,u=Math.ceil(R/o),xe=(l-1)*o+1,ue=Math.min(l*o,R),D=t=>{h(t)},pe=t=>{j(t),h(1)},ge=t=>{I(t),y(!g)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[e.jsx(De,{setOpen:y,open:g,id:F,setEdit:C,edit:A,title:"Create Attendance",refetch:s==null?void 0:s.refetch}),b&&e.jsxs("div",{className:`mb-6 flex items-center gap-3 rounded-xl p-4 ${b.type==="success"?"border border-emerald-200 bg-emerald-50":"border border-red-200 bg-red-50"} duration-300 animate-in fade-in slide-in-from-top-2`,children:[b.type==="success"?e.jsx(ee,{className:"h-5 w-5 text-emerald-600"}):e.jsx(W,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:`text-sm font-medium ${b.type==="success"?"text-emerald-800":"text-red-800"}`,children:b.text})]}),e.jsx("div",{className:"mb-6 rounded-xl border border-gray-200 bg-white p-5 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Select Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsx("input",{type:"date",value:m,onChange:t=>d(t.target.value),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Select Month"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsx("select",{value:x,onChange:t=>L(t.target.value),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:ce.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Select Year"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsx("select",{value:c,onChange:t=>P(parseInt(t.target.value)),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:me.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Department"}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsxs("select",{value:N,onChange:t=>re(t.target.value),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"All Departments"}),(X=(V=T==null?void 0:T.data)==null?void 0:V.data)==null?void 0:X.map(t=>e.jsx("option",{value:t.id,children:t.department_name},t.id))]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Search Employee"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Name, code...",value:v,onChange:t=>le(t.target.value),className:"w-full rounded-lg border border-gray-300 py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Filter by Status"}),e.jsxs("div",{className:"relative",children:[e.jsx(Me,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsxs("select",{value:w,onChange:t=>ne(t.target.value==="all"?"all":parseInt(t.target.value)),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"0",children:"Absent"}),e.jsx("option",{value:"1",children:"Present"}),e.jsx("option",{value:"2",children:"Half Day"}),e.jsx("option",{value:"3",children:"Leave"})]})]})]})]})}),e.jsx("div",{className:"overflow-hidden rounded-xl border border-gray-200 bg-white shadow-sm",children:Y?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"mb-4 h-12 w-12 animate-spin rounded-full border-4 border-indigo-200 border-t-indigo-600"}),e.jsx("p",{className:"font-medium text-gray-500",children:"Loading attendance data..."})]}):!((G=s==null?void 0:s.data)!=null&&G.data)||s.data.data.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(Le,{className:"mb-4 h-16 w-16 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium text-gray-400",children:"No records found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-400",children:"Try adjusting your filters"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gradient-to-r from-indigo-50 to-purple-50",children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Employee"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Department"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Check In"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Check Out"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Hours"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Actions"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Mark Attendance"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:s.data.data.map(t=>e.jsxs("tr",{className:"transition-colors hover:bg-indigo-50/50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800",children:t.emp_name}),e.jsx("div",{className:"text-xs text-gray-500",children:t.emp_code})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex items-center rounded-md bg-gray-100 px-2.5 py-1 text-xs font-medium text-gray-700",children:t.department_name})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:t.emp_in_time?e.jsx("span",{className:"font-medium",children:new Date(t.emp_in_time).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})}):e.jsx("span",{className:"text-gray-400",children:"--:--"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:t.emp_out_time?e.jsx("span",{className:"font-medium",children:new Date(t.emp_out_time).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})}):e.jsx("span",{className:"text-gray-400",children:"--:--"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"inline-flex items-center rounded-md bg-indigo-50 px-2.5 py-1 text-sm font-bold text-indigo-700",children:[t==null?void 0:t.total_working_hours,"h"]})}),e.jsx("td",{className:"px-6 py-4",children:de(t.attendance_status)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{status:1,currentStatus:t.attendance_status,onClick:()=>S(t.emp_id,1),label:"Present",color:"bg-emerald-500"}),e.jsx(_,{status:0,currentStatus:t.attendance_status,onClick:()=>S(t.emp_id,0),label:"Absent",color:"bg-red-500"}),e.jsx(_,{status:2,currentStatus:t.attendance_status,onClick:()=>S(t.emp_id,2),label:"Half Day",color:"bg-amber-500"}),e.jsx(_,{status:3,currentStatus:t.attendance_status,onClick:()=>S(t.emp_id,3),label:"Leave",color:"bg-blue-500"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(he,{variant:"outline",size:"sm",className:`border-indigo-500 text-indigo-600 hover:border-indigo-600 hover:bg-indigo-50 \r
                        hover:text-indigo-700 \r
                        `,onClick:()=>ge(String(t.emp_id)),children:"Mark Attendance"})})]},t.id))})]})})}),e.jsx("div",{className:"mt-6 rounded-xl border border-gray-200 bg-white p-4 shadow-sm",children:e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Rows per page:"}),e.jsxs("select",{value:o,onChange:t=>pe(parseInt(t.target.value)),className:"rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Showing"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:xe})," ","to"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:ue})," ","of"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:R})," ","entries"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>D(l-1),disabled:l===1||Y,className:"flex items-center gap-1 rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 transition-all hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx(ke,{className:"h-4 w-4"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,u)},(t,n)=>{let a;return u<=5||l<=3?a=n+1:l>=u-2?a=u-4+n:a=l-2+n,e.jsx("button",{onClick:()=>D(a),disabled:s==null?void 0:s.isFetching,className:`h-8 w-8 rounded-lg text-sm font-medium transition-all disabled:cursor-not-allowed ${l===a?"bg-indigo-600 text-white shadow-sm":"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"}`,children:a},a)})}),e.jsxs("button",{onClick:()=>D(l+1),disabled:l===u||(s==null?void 0:s.isFetching),className:"flex items-center gap-1 rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 transition-all hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50",children:["Next",e.jsx(Pe,{className:"h-4 w-4"})]})]})]})]})}),e.jsx("div",{className:"mt-4 rounded-xl border border-gray-200 bg-white p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Page ",e.jsx("span",{className:"font-semibold text-gray-800",children:l})," of"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:u})]}),e.jsxs("span",{className:"text-gray-500",children:["Last updated: ",new Date().toLocaleTimeString("en-IN")]})]})})]})};function tt(){return e.jsx(ye,{title:"Attendance List",subTitle:"Manage all the Attendance here",children:e.jsx($e,{})})}export{tt as default};
