import{aA as e,aB as t,j as a,al as s,r}from"./vendor-RyuIgj66.js";import{g as l,P as n}from"./index-DFF4_m_G.js";import{u as i,b as d}from"./useCustomQuery-DTB6aAiD.js";import{h as o,B as c,e as m}from"./index-ey2GEmQz.js";import{c as x,a as u}from"./yup-CH6wvET8.js";import{F as p}from"./datetime-picker-dN6E5dqy.js";import"./input-DlX9dTT0.js";import{B as g}from"./ButtonLoading-DDalXO-W.js";import{R as h}from"./RHFSelectField-oISAIiMK.js";import"./switch-Cssv6fnZ.js";import"./checkbox-DFFItNXW.js";import"./label-BcY3kv5U.js";import{R as b}from"./DateAndTimePicker-CtTdRVKm.js";import{S as j}from"./separator-BQijJEjG.js";import{D as f}from"./index-B2ia16z0.js";import{ai as y,$ as v,s as N,B as w,a2 as _,ac as S,U as k,ag as A,af as D,a4 as C}from"./icons-CxCh8mm_.js";import"./ui-B3c1eQmf.js";import"./query-BH9sOW2X.js";import"./axios-Dos3PyFQ.js";import"./zustand-C1rkr5lV.js";import"./select-8PAfYjod.js";import"./Spinner-BwGzvoRj.js";const T=x().shape({attendance_status:u().required("Attendance status is required"),emp_in_time:u().when("attendance_status",{is:e=>"1"===e||"2"===e,then:e=>e.required("In Time is required for Present or Half Day"),otherwise:e=>e.notRequired()}),emp_out_time:u().when("attendance_status",{is:e=>"1"===e||"2"===e,then:e=>e.required("Out Time is required for Present or Half Day"),otherwise:e=>e.notRequired()})});function L({open:r,setOpen:l,title:n,id:d,edit:c,setEdit:m,refetch:x}){const u=i({}),y=new Date,v=e({defaultValues:{attendance_status:"",emp_in_time:"",emp_out_time:""},resolver:t(T)});return a.jsx(f,{open:r,setOpen:l,title:n,edit:c,setEdit:m,children:a.jsx(p,{methods:v,onSubmit:v.handleSubmit(async e=>{var t,a,r,n;try{const i=await u.mutateAsync({api:null==(t=o)?void 0:t.createAttendance,data:{emp_id:d,date:y.toISOString().split("T")[0],attendance_status:e.attendance_status,...e.emp_in_time&&{emp_in_time:e.emp_in_time},...e.emp_out_time&&{emp_out_time:e.emp_out_time}}});(null==(a=i.data)?void 0:a.success)?(s.success((null==(r=null==i?void 0:i.data)?void 0:r.message)||"Attendance created successfully"),l(!1),x()):s.error((null==(n=i.data)?void 0:n.message)||"Failed to create attendance")}catch(i){s.error("An error occurred while creating attendance")}}),children:a.jsxs("div",{className:"grid grid-cols-2 gap-x-2 gap-y-4",children:[a.jsx("div",{className:"col-span-2",children:a.jsx(h,{name:"attendance_status",label:"Attendance Status",data:[{label:"Absent",value:"0"},{label:"Present",value:"1"},{label:"Half Day",value:"2"},{label:"Leave",value:"3"}]})}),a.jsx("div",{children:a.jsx(b,{label:"In Time",name:"emp_in_time",placeholder:"Enter In Time"})}),a.jsx("div",{children:a.jsx(b,{label:"Out Time",name:"emp_out_time",placeholder:"Enter Out Time"})}),a.jsx(j,{className:"col-span-2 my-2"}),a.jsx("div",{className:"col-span-2 flex justify-end",children:a.jsx(g,{isLoading:v.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}const I=()=>{var e,t,s,n,x,u;const p=new Date,[g,h]=r.useState(!1),[b,j]=r.useState(!1),[f,T]=r.useState(""),[I,F]=r.useState(p.toLocaleString("en-IN",{month:"long"})),[q,O]=r.useState(p.getFullYear()),[P,M]=r.useState(1),[E,H]=r.useState(20),[R,$]=r.useState(p.toISOString().split("T")[0]),B=i({}),[J,Y]=r.useState(""),[z,U]=r.useState(""),[Q,V]=r.useState("all"),[Z,G]=r.useState({present:0,absent:0,halfDay:0,leave:0,total:0}),[K,W]=r.useState(null),X=l(),ee=d({api:`${null==(e=o)?void 0:e.getAllAttendance}?${(()=>{const e=new URLSearchParams;return I&&e.append("month",I),q&&e.append("year",q.toString()),R&&e.append("date",R),J&&e.append("department_id",m(String(J))),z&&e.append("q",z),"all"!==Q&&e.append("status",Q.toString()),e.append("page",P.toString()),e.append("limit",E.toString()),e.toString()})()}`,value:[P,E,I,q,R,J,z,Q],options:{enabled:!0}});r.useEffect(()=>{te()},[null==ee?void 0:ee.data]);const te=()=>{var e;if(!(null==(e=null==ee?void 0:ee.data)?void 0:e.data))return void G({present:0,absent:0,halfDay:0,leave:0,total:0});const t=ee.data.data.reduce((e,t)=>{switch(t.attendance_status){case 1:e.present++;break;case 0:e.absent++;break;case 2:e.halfDay++;break;case 3:e.leave++}return e},{present:0,absent:0,halfDay:0,leave:0,total:ee.data.data.length});G(t)},ae=async(e,t)=>{var a,s,r,l;try{const n=await B.mutateAsync({api:null==(a=o)?void 0:a.createAttendance,data:{emp_id:e,date:R||p.toISOString().split("T")[0],attendance_status:t}});(null==(s=n.data)?void 0:s.success)?(se("success",(null==(r=n.data)?void 0:r.message)||"Status updated successfully"),ee.refetch()):se("error",(null==(l=n.data)?void 0:l.message)||"Failed to update status")}catch(n){se("error","An error occurred while updating status")}},se=(e,t)=>{W({type:e,text:t}),setTimeout(()=>W(null),3e3)},re=e=>{const t={1:{label:"Present",color:"bg-emerald-500",icon:y},0:{label:"Absent",color:"bg-red-500",icon:v},2:{label:"Half Day",color:"bg-amber-500",icon:C},3:{label:"Leave",color:"bg-blue-500",icon:w}}[e];return a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("div",{className:`${null==t?void 0:t.color} h-2 w-2 rounded-full`}),a.jsx("span",{className:"text-sm font-medium text-gray-700",children:null==t?void 0:t.label})]})},le=({status:e,currentStatus:t,onClick:s,label:r,color:l})=>a.jsx("button",{onClick:s,className:"rounded-lg px-3 py-1.5 text-xs font-medium transition-all duration-200 "+(t===e?`${l} text-white shadow-sm`:"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:r}),ne=Array.from({length:10},(e,t)=>p.getFullYear()-t),ie=(null==ee?void 0:ee.isLoading)||(null==ee?void 0:ee.isFetching),de=(null==(s=null==(t=null==ee?void 0:ee.data)?void 0:t.pagination)?void 0:s.total)||0,oe=Math.ceil(de/E),ce=(P-1)*E+1,me=Math.min(P*E,de),xe=e=>{M(e)};return a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[a.jsx(L,{setOpen:h,open:g,id:f,setEdit:j,edit:b,title:"Create Attendance",refetch:null==ee?void 0:ee.refetch}),K&&a.jsxs("div",{className:`mb-6 flex items-center gap-3 rounded-xl p-4 ${"success"===K.type?"border border-emerald-200 bg-emerald-50":"border border-red-200 bg-red-50"} duration-300 animate-in fade-in slide-in-from-top-2`,children:["success"===K.type?a.jsx(y,{className:"h-5 w-5 text-emerald-600"}):a.jsx(v,{className:"h-5 w-5 text-red-600"}),a.jsx("span",{className:"text-sm font-medium "+("success"===K.type?"text-emerald-800":"text-red-800"),children:K.text})]}),a.jsx("div",{className:"mb-6 rounded-xl border border-gray-200 bg-white p-5 shadow-sm",children:a.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-6",children:[a.jsxs("div",{className:"relative",children:[a.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Select Date"}),a.jsxs("div",{className:"relative",children:[a.jsx(N,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),a.jsx("input",{type:"date",value:R,onChange:e=>$(e.target.value),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500"})]})]}),a.jsxs("div",{className:"relative",children:[a.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Select Month"}),a.jsxs("div",{className:"relative",children:[a.jsx(N,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),a.jsx("select",{value:I,onChange:e=>F(e.target.value),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:["January","February","March","April","May","June","July","August","September","October","November","December"].map(e=>a.jsx("option",{value:e,children:e},e))})]})]}),a.jsxs("div",{className:"relative",children:[a.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Select Year"}),a.jsxs("div",{className:"relative",children:[a.jsx(N,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),a.jsx("select",{value:q,onChange:e=>O(parseInt(e.target.value)),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:ne.map(e=>a.jsx("option",{value:e,children:e},e))})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Department"}),a.jsxs("div",{className:"relative",children:[a.jsx(w,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),a.jsxs("select",{value:J,onChange:e=>Y(e.target.value),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:[a.jsx("option",{value:"",children:"All Departments"}),null==(x=null==(n=null==X?void 0:X.data)?void 0:n.data)?void 0:x.map(e=>a.jsx("option",{value:e.id,children:e.department_name},e.id))]})]})]}),a.jsxs("div",{className:"relative",children:[a.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Search Employee"}),a.jsxs("div",{className:"relative",children:[a.jsx(_,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),a.jsx("input",{type:"text",placeholder:"Name, code...",value:z,onChange:e=>U(e.target.value),className:"w-full rounded-lg border border-gray-300 py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500"})]})]}),a.jsxs("div",{className:"relative",children:[a.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Filter by Status"}),a.jsxs("div",{className:"relative",children:[a.jsx(S,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),a.jsxs("select",{value:Q,onChange:e=>V("all"===e.target.value?"all":parseInt(e.target.value)),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:[a.jsx("option",{value:"all",children:"All Status"}),a.jsx("option",{value:"0",children:"Absent"}),a.jsx("option",{value:"1",children:"Present"}),a.jsx("option",{value:"2",children:"Half Day"}),a.jsx("option",{value:"3",children:"Leave"})]})]})]})]})}),a.jsx("div",{className:"overflow-hidden rounded-xl border border-gray-200 bg-white shadow-sm",children:ie?a.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[a.jsx("div",{className:"mb-4 h-12 w-12 animate-spin rounded-full border-4 border-indigo-200 border-t-indigo-600"}),a.jsx("p",{className:"font-medium text-gray-500",children:"Loading attendance data..."})]}):(null==(u=null==ee?void 0:ee.data)?void 0:u.data)&&0!==ee.data.data.length?a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"border-b border-gray-200 bg-gradient-to-r from-indigo-50 to-purple-50",children:[a.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Employee"}),a.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Department"}),a.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Check In"}),a.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Check Out"}),a.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Hours"}),a.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Status"}),a.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Actions"}),a.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Mark Attendance"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-100",children:ee.data.data.map(e=>a.jsxs("tr",{className:"transition-colors hover:bg-indigo-50/50",children:[a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{children:[a.jsx("div",{className:"font-semibold text-gray-800",children:e.emp_name}),a.jsx("div",{className:"text-xs text-gray-500",children:e.emp_code})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"inline-flex items-center rounded-md bg-gray-100 px-2.5 py-1 text-xs font-medium text-gray-700",children:e.department_name})}),a.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:e.emp_in_time?a.jsx("span",{className:"font-medium",children:new Date(e.emp_in_time).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})}):a.jsx("span",{className:"text-gray-400",children:"--:--"})}),a.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:e.emp_out_time?a.jsx("span",{className:"font-medium",children:new Date(e.emp_out_time).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})}):a.jsx("span",{className:"text-gray-400",children:"--:--"})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("span",{className:"inline-flex items-center rounded-md bg-indigo-50 px-2.5 py-1 text-sm font-bold text-indigo-700",children:[null==e?void 0:e.total_working_hours,"h"]})}),a.jsx("td",{className:"px-6 py-4",children:re(e.attendance_status)}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex gap-2",children:[a.jsx(le,{status:1,currentStatus:e.attendance_status,onClick:()=>ae(e.emp_id,1),label:"Present",color:"bg-emerald-500"}),a.jsx(le,{status:0,currentStatus:e.attendance_status,onClick:()=>ae(e.emp_id,0),label:"Absent",color:"bg-red-500"}),a.jsx(le,{status:2,currentStatus:e.attendance_status,onClick:()=>ae(e.emp_id,2),label:"Half Day",color:"bg-amber-500"}),a.jsx(le,{status:3,currentStatus:e.attendance_status,onClick:()=>ae(e.emp_id,3),label:"Leave",color:"bg-blue-500"})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx(c,{variant:"outline",size:"sm",className:"border-indigo-500 text-indigo-600 hover:border-indigo-600 hover:bg-indigo-50 \r\n                        hover:text-indigo-700 \r\n                        ",onClick:()=>{return t=String(e.emp_id),T(t),void h(!g);var t},children:"Mark Attendance"})})]},e.id))})]})}):a.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[a.jsx(k,{className:"mb-4 h-16 w-16 text-gray-300"}),a.jsx("p",{className:"text-lg font-medium text-gray-400",children:"No records found"}),a.jsx("p",{className:"mt-1 text-sm text-gray-400",children:"Try adjusting your filters"})]})}),a.jsx("div",{className:"mt-6 rounded-xl border border-gray-200 bg-white p-4 shadow-sm",children:a.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Rows per page:"}),a.jsxs("select",{value:E,onChange:e=>{return t=parseInt(e.target.value),H(t),void M(1);var t},className:"rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:[a.jsx("option",{value:10,children:"10"}),a.jsx("option",{value:20,children:"20"}),a.jsx("option",{value:50,children:"50"}),a.jsx("option",{value:100,children:"100"})]})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("span",{className:"text-sm text-gray-600",children:["Showing"," ",a.jsx("span",{className:"font-semibold text-gray-800",children:ce})," ","to"," ",a.jsx("span",{className:"font-semibold text-gray-800",children:me})," ","of"," ",a.jsx("span",{className:"font-semibold text-gray-800",children:de})," ","entries"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>xe(P-1),disabled:1===P||ie,className:"flex items-center gap-1 rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 transition-all hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50",children:[a.jsx(A,{className:"h-4 w-4"}),"Previous"]}),a.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,oe)},(e,t)=>{let s;return s=oe<=5||P<=3?t+1:P>=oe-2?oe-4+t:P-2+t,a.jsx("button",{onClick:()=>xe(s),disabled:null==ee?void 0:ee.isFetching,className:"h-8 w-8 rounded-lg text-sm font-medium transition-all disabled:cursor-not-allowed "+(P===s?"bg-indigo-600 text-white shadow-sm":"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:s},s)})}),a.jsxs("button",{onClick:()=>xe(P+1),disabled:P===oe||(null==ee?void 0:ee.isFetching),className:"flex items-center gap-1 rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 transition-all hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50",children:["Next",a.jsx(D,{className:"h-4 w-4"})]})]})]})]})}),a.jsx("div",{className:"mt-4 rounded-xl border border-gray-200 bg-white p-4 shadow-sm",children:a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsxs("span",{className:"text-gray-600",children:["Page ",a.jsx("span",{className:"font-semibold text-gray-800",children:P})," of"," ",a.jsx("span",{className:"font-semibold text-gray-800",children:oe})]}),a.jsxs("span",{className:"text-gray-500",children:["Last updated: ",(new Date).toLocaleTimeString("en-IN")]})]})})]})};function F(){return a.jsx(n,{title:"Attendance List",subTitle:"Manage all the Attendance here",children:a.jsx(I,{})})}export{F as default};
