import{r as e,h as s,j as a,B as l,z as r}from"./index-UYY99J9q.js";import{P as n,D as t,e as i,f as d,h as c,i as o,j as x}from"./index-Dj741qwl.js";import{C as m,a as j,d as p,c as h}from"./card-CtI_IPLF.js";import{B as u}from"./badge-B68rjZDB.js";import{T as v,a as g,b as f,c as y,d as N,e as w}from"./table-CS0u2e-w.js";import{T as b}from"./textarea-QU3wdoxC.js";import{L as A}from"./label-DVj88vWk.js";import{T as C,a as _,b as L,c as M}from"./tabs-cT8NCL-f.js";import{u as k,b as D}from"./useCustomQuery-Dp3AX7R2.js";import{R as P}from"./refresh-cw-C-bnmyXW.js";import{C as R}from"./circle-alert-hO7QbpNV.js";import{C as $}from"./calendar-days-EQ7_KAfx.js";import{U as S}from"./users-D-23bw5D.js";import{C as T}from"./clock-CXHA5hGN.js";import{C as z}from"./calendar-ddNksXQs.js";import{C as B}from"./circle-check-big-COIXu31i.js";import{C as E}from"./circle-x-BxUp7gAN.js";import{B as F}from"./ban-CAznY8R6.js";import{f as O}from"./format-BkNqQ0tt.js";const U=()=>{const[U,Q]=e.useState("pending"),[Y,H]=e.useState(1),[I,V]=e.useState(null),[X,Z]=e.useState(null),[q,G]=e.useState(""),[J,K]=e.useState(!1),W=k({}),ee=(new Date).getFullYear(),{data:se,refetch:ae,isLoading:le}=D({api:`${s.getPendingLeaves}?page=${Y}&limit=20`,key:`pendingLeaves-${Y}`,options:{enabled:"pending"===U}}),{data:re,refetch:ne,isLoading:te}=D({api:`${s.getLeaveApplications}?year=${ee}&page=${Y}&limit=20`,key:`allLeaves-${Y}-${ee}`,options:{enabled:"all"===U}}),ie=(null==se?void 0:se.data)||[],de=(null==re?void 0:re.data)||[],ce=null==se?void 0:se.pagination,oe=null==re?void 0:re.pagination,xe=(e,s)=>{V(e),Z(s),K(!0)},me=e=>{switch(e){case 0:return a.jsxs(u,{variant:"outline",className:"border-yellow-200 bg-yellow-50 text-yellow-700",children:[a.jsx(T,{className:"mr-1 h-3 w-3"})," Pending"]});case 1:return a.jsxs(u,{variant:"outline",className:"border-green-200 bg-green-50 text-green-700",children:[a.jsx(B,{className:"mr-1 h-3 w-3"})," Approved"]});case 2:return a.jsxs(u,{variant:"outline",className:"border-red-200 bg-red-50 text-red-700",children:[a.jsx(E,{className:"mr-1 h-3 w-3"})," Rejected"]});case 3:return a.jsxs(u,{variant:"outline",className:"border-gray-200 bg-gray-50 text-gray-700",children:[a.jsx(F,{className:"mr-1 h-3 w-3"})," Cancelled"]});default:return a.jsx(u,{variant:"outline",children:"Unknown"})}},je=({leaves:e,showActions:s,loading:r})=>r?a.jsx("div",{className:"py-8 text-center",children:"Loading..."}):0===e.length?a.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[a.jsx(z,{className:"mx-auto mb-4 h-12 w-12 opacity-50"}),a.jsx("p",{children:"No leave applications found"})]}):a.jsxs(v,{children:[a.jsx(g,{children:a.jsxs(f,{children:[a.jsx(y,{children:"Employee"}),a.jsx(y,{children:"Department"}),a.jsx(y,{children:"Leave Type"}),a.jsx(y,{children:"Period"}),a.jsx(y,{children:"Days"}),a.jsx(y,{children:"Reason"}),a.jsx(y,{children:"Status"}),a.jsx(y,{children:"Applied On"}),s&&a.jsx(y,{children:"Actions"})]})}),a.jsx(N,{children:e.map(e=>a.jsxs(f,{children:[a.jsx(w,{children:a.jsxs("div",{children:[a.jsx("p",{className:"font-medium",children:e.emp_name}),a.jsx("p",{className:"text-xs text-muted-foreground",children:e.emp_code})]})}),a.jsx(w,{children:e.department_name||"-"}),a.jsxs(w,{children:[e.leave_type,e.is_half_day&&a.jsx("span",{className:"ml-1 text-xs text-muted-foreground",children:"(Half)"})]}),a.jsx(w,{children:a.jsxs("div",{className:"text-sm",children:[a.jsx("p",{children:O(new Date(e.start_date),"dd MMM yyyy")}),a.jsxs("p",{className:"text-muted-foreground",children:["to ",O(new Date(e.end_date),"dd MMM yyyy")]})]})}),a.jsx(w,{children:e.total_days}),a.jsx(w,{className:"max-w-[200px] truncate",children:e.reason||"-"}),a.jsx(w,{children:me(e.approval_status)}),a.jsx(w,{children:O(new Date(e.created_at),"dd MMM yyyy")}),s&&a.jsx(w,{children:a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(l,{variant:"outline",size:"sm",className:"text-green-600 hover:bg-green-50 hover:text-green-700",onClick:()=>xe(e,"approve"),children:[a.jsx(B,{className:"mr-1 h-4 w-4"}),"Approve"]}),a.jsxs(l,{variant:"outline",size:"sm",className:"text-red-600 hover:bg-red-50 hover:text-red-700",onClick:()=>xe(e,"reject"),children:[a.jsx(E,{className:"mr-1 h-4 w-4"}),"Reject"]})]})})]},e.id))})]});return a.jsx(n,{title:"Leave Approval",children:a.jsxs("div",{className:"container mx-auto space-y-6 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold",children:"Leave Approval"}),a.jsx("p",{className:"text-muted-foreground",children:"Review and manage employee leave applications"})]}),a.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{ae(),ne()},children:[a.jsx(P,{className:"mr-2 h-4 w-4"}),"Refresh"]})]}),a.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[a.jsxs(m,{children:[a.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(p,{className:"text-sm font-medium",children:"Pending Approvals"}),a.jsx(R,{className:"h-4 w-4 text-yellow-600"})]}),a.jsxs(h,{children:[a.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:(null==ce?void 0:ce.total)||ie.length}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Awaiting your review"})]})]}),a.jsxs(m,{children:[a.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(p,{className:"text-sm font-medium",children:"Total Applications"}),a.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(h,{children:[a.jsx("div",{className:"text-2xl font-bold",children:(null==oe?void 0:oe.total)||de.length}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"This year"})]})]}),a.jsxs(m,{children:[a.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(p,{className:"text-sm font-medium",children:"Employees"}),a.jsx(S,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(h,{children:[a.jsx("div",{className:"text-2xl font-bold",children:new Set(de.map(e=>e.emp_id)).size}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Applied for leave"})]})]})]}),a.jsx(m,{children:a.jsx(h,{className:"p-6",children:a.jsxs(C,{value:U,onValueChange:Q,children:[a.jsxs(_,{children:[a.jsxs(L,{value:"pending",className:"gap-2",children:[a.jsx(T,{className:"h-4 w-4"}),"Pending",ie.length>0&&a.jsx(u,{variant:"secondary",className:"ml-1",children:ie.length})]}),a.jsxs(L,{value:"all",className:"gap-2",children:[a.jsx(z,{className:"h-4 w-4"}),"All Applications"]})]}),a.jsx(M,{value:"pending",className:"mt-4",children:a.jsx(je,{leaves:ie,showActions:!0,loading:le})}),a.jsx(M,{value:"all",className:"mt-4",children:a.jsx(je,{leaves:de,showActions:!1,loading:te})})]})})}),a.jsx(t,{open:J,onOpenChange:K,children:a.jsxs(i,{children:[a.jsxs(d,{children:[a.jsx(c,{children:"approve"===X?"Approve Leave":"Reject Leave"}),a.jsx(o,{children:"approve"===X?"Confirm approval of this leave application":"Provide a reason for rejecting this leave application"})]}),I&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2 rounded-lg bg-gray-50 p-4",children:[a.jsxs("p",{children:[a.jsx("span",{className:"text-muted-foreground",children:"Employee:"})," ",a.jsx("strong",{children:I.emp_name})]}),a.jsxs("p",{children:[a.jsx("span",{className:"text-muted-foreground",children:"Leave Type:"})," ",I.leave_type]}),a.jsxs("p",{children:[a.jsx("span",{className:"text-muted-foreground",children:"Period:"})," ",O(new Date(I.start_date),"dd MMM yyyy")," ","to ",O(new Date(I.end_date),"dd MMM yyyy")]}),a.jsxs("p",{children:[a.jsx("span",{className:"text-muted-foreground",children:"Days:"})," ",I.total_days]}),I.reason&&a.jsxs("p",{children:[a.jsx("span",{className:"text-muted-foreground",children:"Reason:"})," ",I.reason]})]}),a.jsxs("div",{className:"grid gap-2",children:[a.jsx(A,{children:"Remarks (Optional)"}),a.jsx(b,{placeholder:"Add any remarks...",value:q,onChange:e=>G(e.target.value)})]})]}),a.jsxs(x,{children:[a.jsx(l,{variant:"outline",onClick:()=>K(!1),children:"Cancel"}),a.jsx(l,{variant:"approve"===X?"default":"destructive",onClick:async()=>{var e,a,l,n;if(I&&X)try{const l=await W.mutateAsync({api:s.approveLeave,data:{leave_id:I.id,action:X,remarks:q}});(null==(e=null==l?void 0:l.data)?void 0:e.success)?(r.success(l.data.message),K(!1),V(null),Z(null),G(""),ae(),ne()):r.error((null==(a=null==l?void 0:l.data)?void 0:a.message)||"Failed to process leave")}catch(t){r.error((null==(n=null==(l=null==t?void 0:t.response)?void 0:l.data)?void 0:n.message)||"Failed to process leave")}},disabled:W.isPending,children:W.isPending?"Processing...":"approve"===X?"Approve":"Reject"})]})]})})]})})};export{U as default};
