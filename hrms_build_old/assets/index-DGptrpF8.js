import{h as e,f as a,r as l,j as s,z as i,B as t,e as n}from"./index-CaGgFSeq.js";import{P as d}from"./index-_Ebnz7ZO.js";import{h as c}from"./moment-CBOc1lqT.js";import{C as r,a as o,b as u,c as m}from"./card-DpoqoWLt.js";import{T as x,a as p,b as h,c as j,d as v,e as f}from"./table-Cx7GlPK-.js";import{u as g,b as y}from"./useCustomQuery-kAcgaiYY.js";import{P as b}from"./index-DPZPUd0B.js";import{S as _}from"./separator-BjkNEWW3.js";import{S as N}from"./index-BTP_FOeW.js";import{S as w}from"./Spinner-qexXCl2s.js";import{a as A,o as S,c as C,b as q,f as k,d as P}from"./yup-CKEuqCyz.js";import{F as T}from"./datetime-picker-BtprqcV1.js";import{R as B}from"./RHFTextField-DnsEykRH.js";import{R as E}from"./RHFTextArea-7uaYu2_S.js";import{B as F}from"./ButtonLoading-B22z2lRV.js";import{R as V}from"./RHFSelectField-XaTdgr7j.js";import"./input-D-UmUPn3.js";import"./switch-Dzwmyki0.js";import{R as D}from"./RHFCheckbox-Ma2BiBD9.js";import{D as R}from"./index-atwvxgXU.js";import{B as $}from"./badge-BIrBucNW.js";import{L}from"./loader-circle-Oz4TaF6r.js";import{T as Y}from"./trash-2-DL1oepIx.js";import"./select-CIf9vlQt.js";import"./check-DrWmecxK.js";import"./calendar-B5etLz2h.js";import"./format-BkNqQ0tt.js";import"./chevron-right-CSfpr0N3.js";import"./clock-B2whL4Nd.js";import"./checkbox-BzF0hRJq.js";import"./label-CInbbuF8.js";const H=C().shape({allowance_code:q().required("Allowance Code is required"),allowance_name:q().required("Allowance Name is required"),calculation_type:q().required("Calculation Type is required"),default_value:k().typeError("Default Value must be a number").required("Default Value is required").min(0,"Default Value must be greater than or equal to 0"),calculation_base:q().required("Calculation Base is required"),is_taxable:P(),is_part_of_gross:P(),pay_commission_id:k().typeError("Pay Commission is required").required("Pay Commission is required"),description:q().required("Description is required")});function M({open:t,setOpen:n,title:d,id:c,edit:r,setEdit:o,refetch:u}){var m,x,p;const h=g({}),{data:j,isFetching:v}=y({api:`${null==(m=e)?void 0:m.getAllowanceById}?id=${a(String(c))}`,key:"getAllowanceById",options:{enabled:!!c&&!!r}}),{data:f}=y({api:`${null==(x=e)?void 0:x.getAllPayCommissions}`,key:"getAllPayCommissions",options:{enabled:!0}}),b=l.useMemo(()=>{var e,a,l,s,i,t,n,d,c;return{allowance_code:(null==(e=null==j?void 0:j.data)?void 0:e.allowance_code)||"",allowance_name:(null==(a=null==j?void 0:j.data)?void 0:a.allowance_name)||"",calculation_type:(null==(l=null==j?void 0:j.data)?void 0:l.calculation_type)||"",default_value:(null==(s=null==j?void 0:j.data)?void 0:s.default_value)||0,calculation_base:(null==(i=null==j?void 0:j.data)?void 0:i.calculation_base)||"",is_taxable:(null==(t=null==j?void 0:j.data)?void 0:t.is_taxable)||!1,is_part_of_gross:(null==(n=null==j?void 0:j.data)?void 0:n.is_part_of_gross)||!1,pay_commission_id:(null==(d=null==j?void 0:j.data)?void 0:d.pay_commission_id)||0,description:(null==(c=null==j?void 0:j.data)?void 0:c.description)||""}},[j]),N=A({defaultValues:b,resolver:S(H)}),w=N.watch("calculation_type");return l.useEffect(()=>{r&&j&&N.reset(b)},[b,r]),l.useEffect(()=>{w&&N.setValue("default_value",0)},[w]),s.jsx(R,{open:t,setOpen:n,title:d,setEdit:o,edit:r,isLoading:v,children:s.jsx(T,{methods:N,onSubmit:N.handleSubmit(async a=>{var l,s,t,d,m,x,p,j;try{if(r&&c){const n=await h.mutateAsync({api:`${null==(l=e)?void 0:l.updateAllowance}`,data:{id:c,...a}});(null==(s=n.data)?void 0:s.success)?i.success(null==(t=null==n?void 0:n.data)?void 0:t.message):i.error((null==(d=n.data)?void 0:d.message)||"Allowance not updated successfully")}else{const l=await h.mutateAsync({api:null==(m=e)?void 0:m.createAllowance,data:a});(null==(x=l.data)?void 0:x.success)?i.success(null==(p=null==l?void 0:l.data)?void 0:p.message):i.error((null==(j=l.data)?void 0:j.message)||"Allowance not created successfully")}N.reset(),n(!1),o(!1),u()}catch(v){}}),children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Basic Information"}),s.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[s.jsx(B,{name:"allowance_code",label:"Allowance Code",placeholder:"e.g., WASH, HRA, DA",inputValidation:["removeSpecialCharacterExceptSpace"]}),s.jsx(B,{name:"allowance_name",label:"Allowance Name",placeholder:"e.g., Washing Allowance",inputValidation:["removeSpecialCharacterExceptSpace"]})]})]}),s.jsx("div",{children:s.jsx(E,{name:"description",label:"Description",placeholder:"Brief description of this allowance type...",inputValidation:["removeSpecialCharacterExceptSpace"]})})]}),s.jsx(_,{}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Calculation Method"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(V,{label:"Calculation Type",name:"calculation_type",data:[{label:"Fixed Amount",value:"fixed"},{label:"Percentage of Salary",value:"percentage"}]}),"fixed"===w&&s.jsx("div",{children:s.jsx(B,{name:"default_value",label:"Amount",placeholder:"e.g., 5000",type:"number",inputValidation:["number"]})}),"percentage"===w&&s.jsx("div",{className:"space-y-4",children:s.jsx(B,{name:"default_value",label:"Percentage (%)",placeholder:"e.g., 12",inputValidation:["decimal"]})}),s.jsx(V,{name:"calculation_base",label:"Calculation Base",data:[{label:"Basic Salary",value:"basic"},{label:"Gross Salary",value:"gross"},{label:"Net Salary",value:"net"}]})]})]}),s.jsx(_,{}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Pay Commission"}),s.jsx(V,{name:"pay_commission_id",label:"Pay Commission",data:(null==(p=null==f?void 0:f.data)?void 0:p.map(e=>({label:String(e.commission_name),value:String(e.id)})))||[]})]}),s.jsx(_,{}),s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{children:[s.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Tax & Gross Settings"}),s.jsxs("div",{className:"space-y-4 rounded-lg border border-gray-200 bg-gray-50 p-4",children:[s.jsx("div",{className:"flex items-start gap-3",children:s.jsx(D,{name:"is_taxable",label:"This allowance is taxable"})}),s.jsx("p",{className:"text-xs italic text-gray-600",children:"Check this if this allowance should be included in taxable income"}),s.jsx("div",{className:"flex items-start gap-3",children:s.jsx(D,{name:"is_part_of_gross",label:"This allowance is part of gross salary"})}),s.jsx("p",{className:"text-xs italic text-gray-600",children:"Check this if this allowance should be included in gross salary calculation"})]})]})}),s.jsx(_,{className:"my-6"}),s.jsx("div",{className:"pt-2",children:s.jsx(F,{isLoading:N.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:r?"Update Allowance":"Create Allowance"})})]})})})}function I(){var a,d,A,S,C,q;const k=g({}),[P,T]=l.useState(1),[B,E]=l.useState(10),[F,V]=l.useState(""),[D,R]=l.useState(!1),[H,I]=l.useState(""),[z,G]=l.useState(!1),[O,W]=l.useState(null),Q=y({api:`${e.getAllAllowances}?page=${P}&limit=${B}&q=${F}`,key:"getAllAllowances",value:[P,B,F],options:{enabled:!0}});return s.jsxs("main",{className:"grid items-start",children:[s.jsx(M,{open:D,setOpen:R,title:z?"Edit Allowance":"Add Allowance",id:H,edit:z,setEdit:G,refetch:Q.refetch}),s.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[s.jsxs("div",{className:"flex w-full justify-between gap-2",children:[s.jsx("div",{children:s.jsx(N,{search:F,setSearch:V,refetch:Q.refetch,isFetching:null==Q?void 0:Q.isLoading})}),s.jsx("div",{children:s.jsx(t,{className:"flex items-center gap-2",onClick:()=>R(!0),children:"Add New"})})]}),s.jsxs(r,{children:[s.jsx(o,{className:"px-7",children:s.jsxs(u,{children:["Allowance List (",(null==(d=null==(a=null==Q?void 0:Q.data)?void 0:a.data)?void 0:d.length)||0,")"]})}),s.jsx(m,{children:Q.isLoading?s.jsx("div",{className:"flex h-32 items-center justify-center",children:s.jsx(w,{})}):s.jsxs(s.Fragment,{children:[s.jsxs(x,{children:[s.jsx(p,{children:s.jsxs(h,{children:[s.jsx(j,{className:"",children:"#"}),s.jsx(j,{className:"",children:"Code"}),s.jsx(j,{className:"",children:"Name"}),s.jsx(j,{className:"",children:"Type"}),s.jsx(j,{className:"",children:"Default Value"}),s.jsx(j,{className:"",children:"Base"}),s.jsx(j,{className:"",children:"Taxable"}),s.jsx(j,{className:"",children:"Part of Gross"}),s.jsx(j,{className:"",children:"Description"}),s.jsx(j,{className:"",children:"Created at"}),s.jsx(j,{className:"",children:"Status"}),s.jsx(j,{children:"Action"})]})}),s.jsx(v,{children:null==(S=null==(A=null==Q?void 0:Q.data)?void 0:A.data)?void 0:S.map((a,l)=>s.jsxs(h,{children:[s.jsx(f,{children:l+1}),s.jsx(f,{children:null==a?void 0:a.allowance_code}),s.jsx(f,{children:null==a?void 0:a.allowance_name}),s.jsx(f,{children:s.jsx($,{variant:"outline",className:"capitalize",children:null==a?void 0:a.calculation_type})}),s.jsxs(f,{children:[null==a?void 0:a.default_value,"percentage"===(null==a?void 0:a.calculation_type)&&"%"]}),s.jsx(f,{className:"capitalize",children:(null==a?void 0:a.calculation_base)||"-"}),s.jsx(f,{children:s.jsx($,{variant:(null==a?void 0:a.is_taxable)?"default":"secondary",children:(null==a?void 0:a.is_taxable)?"Yes":"No"})}),s.jsx(f,{children:s.jsx($,{variant:(null==a?void 0:a.is_part_of_gross)?"default":"secondary",children:(null==a?void 0:a.is_part_of_gross)?"Yes":"No"})}),s.jsx(f,{className:"max-w-xs truncate",children:null==a?void 0:a.description}),s.jsx(f,{children:c(null==a?void 0:a.created_at).format("DD-MM-YYYY")}),s.jsx(f,{children:s.jsx($,{variant:1===(null==a?void 0:a.status)?"default":"secondary",children:1===(null==a?void 0:a.status)?"Active":"Inactive"})}),s.jsx(f,{children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx(t,{className:"bg-primary",onClick:()=>{return e=String(null==a?void 0:a.id),G(!0),R(!0),void I(e);var e},children:"Edit"}),s.jsx(t,{variant:"destructive",onClick:()=>(async a=>{var l,s,t,d;W(a);try{const n=await k.mutateAsync({api:`${null==(l=e)?void 0:l.deleteAllowance}`,data:{id:a}});(null==(s=null==n?void 0:n.data)?void 0:s.success)?(Q.refetch(),i.success((null==(t=null==n?void 0:n.data)?void 0:t.message)||"Allowance deleted successfully")):i.error((null==(d=n.data)?void 0:d.message)||"Failed to delete allowance")}catch(c){i.error(n(c))}finally{W(null)}})(String(null==a?void 0:a.id)),disabled:O===String(null==a?void 0:a.id),children:O===String(null==a?void 0:a.id)?s.jsx(L,{className:"h-4 w-4 animate-spin"}):s.jsx(Y,{className:"h-4 w-4"})})]})})]},null==a?void 0:a.id))})]}),s.jsx(_,{className:"mb-2 mt-4"}),s.jsx("div",{className:"flex w-full justify-end",children:s.jsx(b,{page:P,limit:B,totalPages:Math.ceil(((null==(q=null==(C=null==Q?void 0:Q.data)?void 0:C.data)?void 0:q.length)||0)/B),setPage:T,setLimit:E})})]})})]})]})]})}function z(){return s.jsx(d,{title:"Allowance List",subTitle:"Manage all the Allowances here",children:s.jsx("div",{className:"py-12",children:s.jsx(I,{})})})}export{z as default};
