import{r as e,aA as a,j as l,aB as s,al as i}from"./vendor-RyuIgj66.js";import{P as t}from"./index-DFF4_m_G.js";import{j as r,e as n,g as d,B as o,T as c,k as m,l as x,m as u}from"./index-ey2GEmQz.js";import{C as p,a as _,d as h,b as j,c as g}from"./card-u7M7FP5y.js";import{T as b,a as f,b as w,c as v,d as N,e as y}from"./table-B_npepsp.js";import{S as A,a as C,b as k,c as S,d as T}from"./select-8PAfYjod.js";import{u as E,b as O}from"./useCustomQuery-DTB6aAiD.js";import{S as R}from"./separator-BQijJEjG.js";import{S as L}from"./Spinner-BwGzvoRj.js";import{c as F,b as $,a as q,e as M}from"./yup-CH6wvET8.js";import{F as B}from"./datetime-picker-dN6E5dqy.js";import{R as D}from"./RHFTextField-BSZ_cEI3.js";import{B as H}from"./ButtonLoading-DDalXO-W.js";import{R as I}from"./RHFSelectField-oISAIiMK.js";import"./input-DlX9dTT0.js";import"./switch-Cssv6fnZ.js";import{R as Z}from"./RHFCheckbox-BZ4qq51l.js";import{D as P}from"./index-B2ia16z0.js";import{L as U}from"./label-BcY3kv5U.js";import{an as W,ao as z,O as V,$ as G,_ as J}from"./icons-CxCh8mm_.js";import{B as Q}from"./badge-DbWnzWn2.js";import"./ui-B3c1eQmf.js";import"./query-BH9sOW2X.js";import"./axios-Dos3PyFQ.js";import"./zustand-C1rkr5lV.js";import"./checkbox-DFFItNXW.js";const Y=[{value:"daily_wage",label:"Daily Wage"},{value:"contractual",label:"Contractual"},{value:"monthly",label:"Monthly (Regular)"}],K=F().shape({allowance_code:q().required("Allowance code is required").matches(/^[A-Z][A-Z0-9_]*$/,"Code must start with uppercase letter, contain only A-Z, 0-9, underscore").min(2,"Code must be at least 2 characters").max(30,"Code must not exceed 30 characters"),allowance_name:q().required("Allowance name is required"),allowance_short_name:q().nullable(),applicable_salary_modes:q().required("Salary mode is required"),display_order:M().required("Display order is required").min(1,"Display order must be at least 1"),is_taxable_new_regime:$().default(!0),is_taxable_old_regime:$().default(!0),exempt_limit_new_regime:M().default(0),exempt_limit_old_regime:M().default(0),group_name:q().nullable(),description:q().nullable(),is_active:$().default(!0)});function X({open:t,setOpen:o,title:c,id:m,edit:x,setEdit:u,refetch:p,currentSalaryMode:_}){const h=E({}),{data:j,isFetching:g}=O({api:`${r.getAllowanceConfigs}?id=${n(String(m))}`,key:"getAllowanceConfigById",value:[m],options:{enabled:x&&null!==m}}),b=(null==j?void 0:j.data)&&j.data.length>0?j.data[0]:null,f=e.useMemo(()=>({allowance_code:(null==b?void 0:b.allowance_code)||"",allowance_name:(null==b?void 0:b.allowance_name)||"",allowance_short_name:(null==b?void 0:b.allowance_short_name)||"",applicable_salary_modes:(null==b?void 0:b.applicable_salary_modes)||_||"all",display_order:(null==b?void 0:b.display_order)||1,is_taxable_new_regime:(null==b?void 0:b.is_taxable_new_regime)??!0,is_taxable_old_regime:(null==b?void 0:b.is_taxable_old_regime)??!0,exempt_limit_new_regime:(null==b?void 0:b.exempt_limit_new_regime)||0,exempt_limit_old_regime:(null==b?void 0:b.exempt_limit_old_regime)||0,group_name:(null==b?void 0:b.group_name)||"Other Allowances",description:(null==b?void 0:b.description)||"",is_active:1===(null==b?void 0:b.status)}),[b,_]),w=a({defaultValues:f,resolver:s(K)}),v=w.watch("is_taxable_new_regime"),N=w.watch("is_taxable_old_regime"),y=w.watch("allowance_code");e.useEffect(()=>{if(y){const e=y.toUpperCase().replace(/[^A-Z0-9_]/g,"_");e!==y&&w.setValue("allowance_code",e)}},[y,w]),e.useEffect(()=>{w.reset(f)},[f,w]);return l.jsx(P,{open:t,setOpen:o,title:c,setEdit:u,edit:x,isLoading:g,children:l.jsx(B,{methods:w,onSubmit:w.handleSubmit(async e=>{var a,l,s;try{const t=await h.mutateAsync({api:r.upsertAllowanceConfig,data:{...x&&m?{id:Number(m)}:{},allowance_code:e.allowance_code,allowance_name:e.allowance_name,allowance_short_name:e.allowance_short_name||null,applicable_salary_modes:e.applicable_salary_modes,display_order:e.display_order,is_taxable_new_regime:e.is_taxable_new_regime,is_taxable_old_regime:e.is_taxable_old_regime,exempt_limit_new_regime:e.is_taxable_new_regime?0:e.exempt_limit_new_regime,exempt_limit_old_regime:e.is_taxable_old_regime?0:e.exempt_limit_old_regime,group_name:e.group_name||"Other Allowances",description:e.description||null,status:e.is_active?1:0}});(null==(a=t.data)?void 0:a.success)?(i.success((null==(l=null==t?void 0:t.data)?void 0:l.message)||`Allowance configuration ${x?"updated":"created"} successfully`),o(!1),null==u||u(!1),null==p||p(),w.reset({allowance_code:"",allowance_name:"",allowance_short_name:"",applicable_salary_modes:"all",display_order:1,is_taxable_new_regime:!0,is_taxable_old_regime:!0,exempt_limit_new_regime:0,exempt_limit_old_regime:0,group_name:"Other Allowances",description:"",is_active:!0})):i.error((null==(s=t.data)?void 0:s.message)||"Failed to save configuration")}catch(t){i.error(d(t))}}),children:l.jsxs("div",{className:"space-y-6",children:[!x&&l.jsx("div",{className:"rounded-lg border border-blue-200 bg-blue-50/50 p-3 dark:border-blue-800 dark:bg-blue-950/20",children:l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx(W,{className:"mt-0.5 h-4 w-4 text-blue-600 dark:text-blue-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Common Allowance Codes"}),l.jsx("p",{className:"mt-1 text-xs text-blue-600 dark:text-blue-400",children:"HRA, TA, MA, CA, CEA, WA, LTC or create your own like SITE_ALLOWANCE, PROJECT_PAY"})]})]})}),l.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-4",children:[l.jsxs("div",{children:[l.jsx(D,{name:"allowance_code",label:"Allowance Code",placeholder:"e.g., SITE_ALLOWANCE",disabled:x}),l.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Unique code (uppercase letters, numbers, underscores)"})]}),l.jsx("div",{children:l.jsx(D,{name:"allowance_name",label:"Allowance Name",placeholder:"e.g., House Rent Allowance"})}),l.jsx("div",{children:l.jsx(D,{name:"allowance_short_name",label:"Short Name",placeholder:"e.g., HRA"})}),l.jsx("div",{children:l.jsx(I,{name:"applicable_salary_modes",label:"Applicable Salary Modes",data:[{label:"All Modes",value:"all"},...Y.map(e=>({label:e.label,value:e.value}))]})}),l.jsx("div",{children:l.jsx(D,{name:"display_order",label:"Display Order",type:"number"})}),l.jsx("div",{children:l.jsx(D,{name:"group_name",label:"UI Group",placeholder:"e.g., Other Allowances"})}),l.jsx("div",{className:"flex items-end",children:l.jsx(Z,{name:"is_active",label:"Active"})})]}),l.jsx(R,{}),l.jsxs("div",{children:[l.jsxs(U,{className:"flex items-center gap-2 text-base font-semibold",children:["Tax Configuration",l.jsx(z,{className:"h-4 w-4 text-muted-foreground"})]}),l.jsx("p",{className:"mb-4 mt-1 text-sm text-muted-foreground",children:"Configure how this allowance is treated for income tax under each regime"}),l.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[l.jsxs("div",{className:"rounded-lg border bg-blue-50/50 p-4 dark:bg-blue-950/20",children:[l.jsx(U,{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"New Tax Regime"}),l.jsxs("div",{className:"mt-3 space-y-3",children:[l.jsx(Z,{name:"is_taxable_new_regime",label:"Fully Taxable"}),!v&&l.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2",children:[l.jsx(D,{name:"exempt_limit_new_regime",label:"Exemption Limit (₹)",type:"number",placeholder:"0 for fully exempt"}),l.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Amount exempt from tax. 0 = fully exempt."})]})]})]}),l.jsxs("div",{className:"rounded-lg border bg-amber-50/50 p-4 dark:bg-amber-950/20",children:[l.jsx(U,{className:"text-sm font-medium text-amber-700 dark:text-amber-300",children:"Old Tax Regime"}),l.jsxs("div",{className:"mt-3 space-y-3",children:[l.jsx(Z,{name:"is_taxable_old_regime",label:"Fully Taxable"}),!N&&l.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2",children:[l.jsx(D,{name:"exempt_limit_old_regime",label:"Exemption Limit (₹)",type:"number",placeholder:"0 for fully exempt"}),l.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Amount exempt from tax. 0 = fully exempt."})]})]})]})]})]}),l.jsx(R,{}),l.jsx("div",{children:l.jsx(D,{name:"description",label:"Description (Optional)",placeholder:"Add notes about this allowance configuration"})}),l.jsx("div",{className:"flex justify-end",children:l.jsx(H,{type:"submit",isLoading:h.isPending,children:x?"Update Configuration":"Add Configuration"})})]})})})}function ee(){var a,s,i;E({});const[t,n]=e.useState("all"),[d,F]=e.useState(!1),[$,q]=e.useState(null),[M,B]=e.useState(!1),D=O({api:`${r.getAllowanceConfigs}?salary_mode=${t}`,key:"getAllowanceConfigs",value:[t],options:{enabled:!0}}),H=()=>{B(!1),q(null),F(!0)},I=e=>null==e?"No Limit":`₹${e.toLocaleString("en-IN")}`,Z=({taxable:e,limit:a})=>l.jsx(c,{children:l.jsxs(m,{children:[l.jsx(x,{children:l.jsx("div",{className:"flex items-center gap-1",children:e?l.jsxs(Q,{variant:"destructive",className:"flex items-center gap-1",children:[l.jsx(G,{className:"h-3 w-3"}),"Taxable"]}):l.jsxs(Q,{variant:"default",className:"flex items-center gap-1 bg-green-600",children:[l.jsx(J,{className:"h-3 w-3"}),"Exempt"]})})}),l.jsx(u,{children:e?"Fully taxable":`Exempt up to ${I(a)}`})]})});return l.jsxs("main",{className:"grid items-start",children:[l.jsx(X,{open:d,setOpen:F,title:M?"Edit Allowance Configuration":"Add Allowance Configuration",id:$,edit:M,setEdit:B,refetch:D.refetch,currentSalaryMode:t}),l.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[l.jsxs("div",{className:"flex w-full flex-wrap justify-between gap-4",children:[l.jsx("div",{className:"flex items-center gap-4",children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("label",{className:"whitespace-nowrap text-sm font-medium",children:"Salary Mode:"}),l.jsxs(A,{value:t,onValueChange:n,children:[l.jsx(C,{className:"w-[160px]",children:l.jsx(k,{})}),l.jsxs(S,{children:[l.jsx(T,{value:"all",children:"All Modes"}),Y.map(e=>l.jsx(T,{value:e.value,children:e.label},e.value))]})]})]})}),l.jsx("div",{className:"flex gap-2",children:l.jsxs(o,{className:"flex items-center gap-2",onClick:H,children:[l.jsx(V,{className:"h-4 w-4"}),"Add New"]})})]}),l.jsx(R,{}),l.jsxs("div",{className:"flex items-start gap-2 rounded-lg border border-blue-200 bg-blue-50 p-3 dark:border-blue-800 dark:bg-blue-950",children:[l.jsx(z,{className:"mt-0.5 h-5 w-5 text-blue-600"}),l.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:[l.jsx("strong",{children:"Note:"})," These configurations define the tax treatment of each allowance under New and Old tax regimes. Configurations are universal and apply across all financial years."]})]}),l.jsxs(p,{children:[l.jsxs(_,{children:[l.jsxs(h,{className:"flex items-center gap-2",children:["Allowance Tax Configurations",l.jsx(Q,{variant:"secondary",children:null==(a=Y.find(e=>e.value===t))?void 0:a.label})]}),l.jsx(j,{children:"Configure taxability and exemption limits for each allowance type"})]}),l.jsx(g,{children:(null==D?void 0:D.isLoading)?l.jsx("div",{className:"flex items-center justify-center py-8",children:l.jsx(L,{})}):l.jsx("div",{className:"overflow-x-auto",children:l.jsxs(b,{children:[l.jsx(f,{children:l.jsxs(w,{children:[l.jsx(v,{className:"w-[50px]",children:"#"}),l.jsx(v,{children:"Allowance"}),l.jsx(v,{children:"Code"}),l.jsx(v,{className:"text-center",children:l.jsxs("div",{className:"flex flex-col items-center",children:[l.jsx("span",{children:"New Regime"}),l.jsx("span",{className:"text-xs text-muted-foreground",children:"Tax Status"})]})}),l.jsx(v,{className:"text-center",children:l.jsxs("div",{className:"flex flex-col items-center",children:[l.jsx("span",{children:"Old Regime"}),l.jsx("span",{className:"text-xs text-muted-foreground",children:"Tax Status"})]})}),l.jsx(v,{children:"Exemption (New)"}),l.jsx(v,{children:"Exemption (Old)"}),l.jsx(v,{children:"Status"}),l.jsx(v,{children:"Actions"})]})}),l.jsx(N,{children:(null==(s=null==D?void 0:D.data)?void 0:s.data)&&D.data.data.length>0?D.data.data.map((e,a)=>l.jsxs(w,{children:[l.jsx(y,{children:e.display_order||a+1}),l.jsx(y,{className:"font-medium",children:e.allowance_name}),l.jsx(y,{children:l.jsx("code",{className:"rounded bg-muted px-1 py-0.5 text-xs",children:e.allowance_code})}),l.jsx(y,{className:"text-center",children:l.jsx(Z,{taxable:e.is_taxable_new_regime,limit:e.exempt_limit_new_regime})}),l.jsx(y,{className:"text-center",children:l.jsx(Z,{taxable:e.is_taxable_old_regime,limit:e.exempt_limit_old_regime})}),l.jsx(y,{children:e.is_taxable_new_regime?l.jsx("span",{className:"text-muted-foreground",children:"N/A"}):I(e.exempt_limit_new_regime)}),l.jsx(y,{children:e.is_taxable_old_regime?l.jsx("span",{className:"text-muted-foreground",children:"N/A"}):I(e.exempt_limit_old_regime)}),l.jsx(y,{children:l.jsx("span",{className:"rounded-full px-3 py-1 text-xs font-semibold "+(1===e.status?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300"),children:1===e.status?"Active":"Inactive"})}),l.jsx(y,{children:l.jsx(o,{variant:"outline",size:"sm",onClick:()=>{return a=e.id,B(!0),q(a),void F(!0);var a},children:"Edit"})})]},e.id)):l.jsx(w,{children:l.jsx(y,{colSpan:9,className:"py-8 text-center",children:l.jsxs("div",{className:"flex flex-col items-center gap-2",children:[l.jsxs("p",{className:"text-muted-foreground",children:["No configurations found","all"!==t?` for ${(null==(i=Y.find(e=>e.value===t))?void 0:i.label)||t}`:""]}),l.jsx(o,{variant:"outline",size:"sm",onClick:H,children:"Add First Configuration"})]})})})})]})})})]})]})]})}function ae(){return l.jsx(t,{title:"Allowance Tax Configuration",subTitle:"Manage allowance tax rules by financial year and regime",children:l.jsx("div",{className:"py-12",children:l.jsx(ee,{})})})}export{ae as default};
