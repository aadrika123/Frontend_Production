import{ao as e,r as s,j as a,al as i}from"./vendor-RyuIgj66.js";import{D as t,c as r,e as n,f as l,h as o,P as d}from"./index-DFF4_m_G.js";import{c,B as m,t as x,g as j}from"./index-ey2GEmQz.js";import{C as u,a as h,b as p,c as v}from"./card-u7M7FP5y.js";import{T as f,a as g,b,c as y,d as N,e as _}from"./table-B_npepsp.js";import{C}from"./checkbox-DFFItNXW.js";import{u as w,b as S}from"./useCustomQuery-DTB6aAiD.js";import{P as k}from"./index-BHR1l08i.js";import{S as P}from"./separator-BQijJEjG.js";import{S as R}from"./Spinner-BwGzvoRj.js";import{B as A}from"./badge-DbWnzWn2.js";import{A as $,a as I,b as q,c as z,d as V,e as F,f as E,g as D}from"./alert-dialog-DDS3Mbsz.js";import{T as B}from"./textarea-CIMcDPG7.js";import{I as L}from"./input-DlX9dTT0.js";import{L as O}from"./label-BcY3kv5U.js";import{S as T,a as M,b as Q,c as U,d as W}from"./select-8PAfYjod.js";import{az as Y,aA as Z,al as G,Z as H,_ as J,$ as K,F as X,E as ee}from"./icons-CxCh8mm_.js";import"./ui-B3c1eQmf.js";import"./query-BH9sOW2X.js";import"./axios-Dos3PyFQ.js";import"./zustand-C1rkr5lV.js";const se=e=>{const s={pending:{variant:"secondary",icon:a.jsx(X,{className:"mr-1 h-3 w-3"})},approved:{variant:"default",icon:a.jsx(J,{className:"mr-1 h-3 w-3"})},rejected:{variant:"destructive",icon:a.jsx(K,{className:"mr-1 h-3 w-3"})},needs_clarification:{variant:"outline",icon:a.jsx(X,{className:"mr-1 h-3 w-3"})}},{variant:i,icon:t}=s[e]||s.pending;return a.jsxs(A,{variant:i,className:"flex items-center",children:[t,e.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())]})},ae=e=>null==e?"₹0":`₹${e.toLocaleString("en-IN")}`;function ie(){var d,ie,te;const{id:re}=e(),{user:ne}=c(),le=w({}),[oe,de]=s.useState(1),[ce]=s.useState(10),[me,xe]=s.useState("all"),[je,ue]=s.useState(null),[he,pe]=s.useState(!1),[ve,fe]=s.useState("approved"),[ge,be]=s.useState(""),[ye,Ne]=s.useState(""),[_e,Ce]=s.useState([]),[we,Se]=s.useState(!1),[ke,Pe]=s.useState("approved"),[Re,Ae]=s.useState(""),[$e,Ie]=s.useState(!1),[qe,ze]=s.useState(!1),[Ve,Fe]=s.useState(null),Ee=!re,De=(null==ne?void 0:ne.ulbId)||localStorage.getItem("ulbId"),Be=S({api:`${x.getInvestmentProofs}/${re}`,key:`getInvestmentProofs-${re}`,value:[oe,ce,me,re],options:{enabled:!!re}}),Le=S({api:`${x.getPendingProofs}?ulb_id=${De}&page=${oe}&limit=${ce}${"all"!==me?`&status=${me}`:""}`,key:"getPendingProofs",value:[oe,ce,me,De],options:{enabled:Ee&&!!De}}),Oe=Ee?Le.isLoading:Be.isLoading,Te=Ee?((null==(d=Le.data)?void 0:d.data)||[]).map(e=>({...e.proof,employee:e.employee})):(null==(te=null==(ie=Be.data)?void 0:ie.data)?void 0:te.proofs)||[],Me=()=>{Ee?Le.refetch():Be.refetch()},Qe="all"===me?Te:Te.filter(e=>e.verification_status===me),Ue=Te.filter(e=>"pending"===e.verification_status),We=(e,s)=>{ue(e),fe(s),be(""),Ne(String(e.declared_amount)),pe(!0)};return a.jsxs("main",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50",children:[a.jsx($,{open:he,onOpenChange:pe,children:a.jsxs(I,{children:[a.jsxs(q,{children:[a.jsx(z,{children:"approved"===ve?"Approve Proof":"rejected"===ve?"Reject Proof":"Request Clarification"}),a.jsxs(V,{children:[null==je?void 0:je.section_code," - ",null==je?void 0:je.investment_type,a.jsx("br",{}),"Declared Amount: ",ae(null==je?void 0:je.declared_amount)]})]}),a.jsxs("div",{className:"space-y-4",children:["approved"===ve&&a.jsxs("div",{children:[a.jsx(O,{children:"Verified Amount"}),a.jsx(L,{type:"number",value:ye,onChange:e=>Ne(e.target.value),placeholder:"Enter verified amount"})]}),a.jsxs("div",{children:[a.jsx(O,{children:"approved"===ve?"Remarks (Optional)":"Remarks *"}),a.jsx(B,{value:ge,onChange:e=>be(e.target.value),placeholder:"needs_clarification"===ve?"What clarification is needed?":"rejected"===ve?"Reason for rejection":"Enter remarks...",required:"approved"!==ve})]})]}),a.jsxs(F,{children:[a.jsx(E,{children:"Cancel"}),a.jsx(D,{onClick:async()=>{var e,s,a;if(je)try{const t=await le.mutateAsync({api:`${x.verifyInvestmentProof}/${je.id}/verify`,data:{verification_status:ve,rejection_reason:"rejected"===ve?ge:void 0,clarification_request:"needs_clarification"===ve?ge:void 0,verified_amount:"approved"===ve?Number(ye):void 0,verified_by:null==ne?void 0:ne._id}});(null==(e=null==t?void 0:t.data)?void 0:e.success)?(Me(),i.success((null==(s=null==t?void 0:t.data)?void 0:s.message)||`Proof ${ve} successfully`),pe(!1),Ce(e=>e.filter(e=>e!==je.id))):i.error((null==(a=t.data)?void 0:a.message)||"Failed to update proof")}catch(t){i.error(j(t))}},className:"rejected"===ve?"bg-destructive":"needs_clarification"===ve?"bg-orange-500":"",disabled:"approved"!==ve&&!ge.trim(),children:"Confirm"})]})]})}),a.jsx($,{open:we,onOpenChange:Se,children:a.jsxs(I,{children:[a.jsxs(q,{children:[a.jsxs(z,{children:["Bulk ","approved"===ke?"Approve":"Reject"," Proofs"]}),a.jsxs(V,{children:["You are about to"," ","approved"===ke?"approve":"reject"," ",a.jsx("strong",{children:_e.length})," investment proof(s)."]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(O,{children:"Action"}),a.jsxs(T,{value:ke,onValueChange:e=>Pe(e),children:[a.jsx(M,{children:a.jsx(Q,{})}),a.jsxs(U,{children:[a.jsx(W,{value:"approved",children:"Approve All"}),a.jsx(W,{value:"rejected",children:"Reject All"})]})]})]}),"rejected"===ke&&a.jsxs("div",{children:[a.jsx(O,{children:"Rejection Reason *"}),a.jsx(B,{value:Re,onChange:e=>Ae(e.target.value),placeholder:"Enter reason for rejection (applies to all selected)"})]})]}),a.jsxs(F,{children:[a.jsx(E,{children:"Cancel"}),a.jsx(D,{onClick:async()=>{var e,s,a,t,r;if(0!==_e.length){Ie(!0);try{const n=await le.mutateAsync({api:x.bulkVerifyProofs,data:{proof_ids:_e,verification_status:ke,verified_by:null==ne?void 0:ne._id,rejection_reason:"rejected"===ke?Re:void 0}});(null==(e=null==n?void 0:n.data)?void 0:e.success)?(i.success((null==(s=null==n?void 0:n.data)?void 0:s.message)||`${null==(t=null==(a=null==n?void 0:n.data)?void 0:a.data)?void 0:t.updatedCount} proofs ${ke} successfully`),Me(),Ce([]),Se(!1),Ae("")):i.error((null==(r=null==n?void 0:n.data)?void 0:r.message)||"Failed to bulk verify proofs")}catch(n){i.error(j(n))}finally{Ie(!1)}}else i.error("Please select at least one proof")},className:"rejected"===ke?"bg-destructive":"",disabled:$e||"rejected"===ke&&!Re.trim(),children:$e?"Processing...":`${"approved"===ke?"Approve":"Reject"} ${_e.length} Proofs`})]})]})}),a.jsx(t,{open:qe,onOpenChange:ze,children:a.jsxs(r,{children:[a.jsxs(n,{children:[a.jsx(l,{children:"Employee Response"}),a.jsxs(o,{children:["Response to clarification request for ",null==Ve?void 0:Ve.section_code," ","- ",null==Ve?void 0:Ve.investment_type]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(O,{className:"text-muted-foreground",children:"Clarification Request"}),a.jsx("p",{className:"mt-1 rounded-md bg-muted p-3 text-sm",children:(null==Ve?void 0:Ve.clarification_request)||"No request recorded"})]}),a.jsxs("div",{children:[a.jsx(O,{className:"text-muted-foreground",children:"Employee Response"}),a.jsx("p",{className:"mt-1 rounded-md bg-muted p-3 text-sm",children:(null==Ve?void 0:Ve.employee_response)||"No response yet"})]})]})]})}),a.jsx("div",{className:"space-y-6",children:a.jsxs(u,{className:"border border-gray-200 bg-white shadow-lg",children:[a.jsx(h,{className:"rounded-t-lg bg-gradient-to-r from-blue-600 to-indigo-600 text-white",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Y,{className:"h-6 w-6"}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Investment Proofs"}),a.jsx(p,{className:"mt-1 text-blue-100",children:re?`Proofs for Declaration #${re}`:"Review and verify employee investment proofs"})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[_e.length>0&&a.jsxs(m,{variant:"secondary",onClick:()=>Se(!0),className:"bg-white text-blue-600 hover:bg-blue-50",children:[a.jsx(Z,{className:"mr-2 h-4 w-4"}),"Bulk Verify (",_e.length,")"]}),a.jsxs(m,{variant:"outline",onClick:Me,className:"border-blue-300 bg-blue-500/20 text-white hover:bg-blue-500/30",children:[a.jsx(G,{className:"mr-2 h-4 w-4"}),"Refresh"]})]})]})}),a.jsxs(v,{className:"p-6",children:[a.jsx("div",{className:"mb-6",children:a.jsx("div",{className:"flex flex-wrap items-center gap-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(T,{value:me,onValueChange:xe,children:[a.jsx(M,{className:"w-[180px]",children:a.jsx(Q,{placeholder:"Filter by Status"})}),a.jsxs(U,{children:[a.jsx(W,{value:"all",children:"All Status"}),a.jsx(W,{value:"pending",children:"Pending"}),a.jsx(W,{value:"approved",children:"Approved"}),a.jsx(W,{value:"rejected",children:"Rejected"}),a.jsx(W,{value:"needs_clarification",children:"Needs Clarification"})]})]}),_e.length>0&&a.jsxs(A,{variant:"secondary",children:[_e.length," selected"]})]})})}),a.jsx(P,{className:"my-6"}),Oe?a.jsx("div",{className:"flex items-center justify-center py-20",children:a.jsx(R,{})}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-200",children:a.jsxs(f,{children:[a.jsx(g,{children:a.jsxs(b,{className:"bg-gray-50 hover:bg-gray-50",children:[a.jsx(y,{className:"w-[50px]",children:a.jsx(C,{checked:Ue.length>0&&Ue.every(e=>_e.includes(e.id)),onCheckedChange:e=>{Ce(e?Ue.map(e=>e.id):[])},disabled:0===Ue.length})}),a.jsx(y,{className:"w-16 font-semibold text-gray-700",children:"#"}),Ee&&a.jsx(y,{className:"font-semibold text-gray-700",children:"Employee"}),a.jsx(y,{className:"font-semibold text-gray-700",children:"Section"}),a.jsx(y,{className:"font-semibold text-gray-700",children:"Investment Type"}),a.jsx(y,{className:"font-semibold text-gray-700",children:"Declared"}),a.jsx(y,{className:"font-semibold text-gray-700",children:"Verified"}),a.jsx(y,{className:"font-semibold text-gray-700",children:"Document"}),a.jsx(y,{className:"font-semibold text-gray-700",children:"Status"}),a.jsx(y,{className:"text-center font-semibold text-gray-700",children:"Actions"})]})}),a.jsx(N,{children:Qe.length>0?Qe.map((e,s)=>{var i,t;return a.jsxs(b,{className:"transition-colors duration-150 hover:bg-blue-50/50",children:[a.jsx(_,{children:a.jsx(C,{checked:_e.includes(e.id),onCheckedChange:s=>((e,s)=>{Ce(s?s=>[...s,e]:s=>s.filter(s=>s!==e))})(e.id,s),disabled:"pending"!==e.verification_status})}),a.jsx(_,{className:"font-medium text-gray-600",children:(oe-1)*ce+s+1}),Ee&&a.jsxs(_,{children:[a.jsx("div",{className:"font-medium text-gray-900",children:(null==(i=e.employee)?void 0:i.emp_name)||"N/A"}),a.jsx("div",{className:"text-xs text-muted-foreground",children:(null==(t=e.employee)?void 0:t.emp_code)||"N/A"})]}),a.jsx(_,{children:a.jsx(A,{variant:"outline",children:e.section_code})}),a.jsxs(_,{className:"font-medium text-gray-900",children:[e.investment_type,e.investment_description&&a.jsx("div",{className:"text-xs text-muted-foreground",children:e.investment_description})]}),a.jsx(_,{className:"font-medium",children:ae(e.declared_amount)}),a.jsx(_,{children:null!==e.verified_amount?ae(e.verified_amount):"-"}),a.jsx(_,{children:e.document_url?a.jsx(m,{variant:"ghost",size:"icon",asChild:!0,children:a.jsx("a",{href:e.document_url,target:"_blank",rel:"noreferrer",title:e.document_name||"View Document",children:a.jsx(H,{className:"h-4 w-4"})})}):"-"}),a.jsx(_,{children:a.jsxs("div",{className:"space-y-1",children:[se(e.verification_status),e.rejection_reason&&a.jsx("p",{className:"text-xs text-destructive",children:e.rejection_reason})]})}),a.jsx(_,{children:a.jsxs("div",{className:"flex items-center justify-center gap-1",children:["pending"===e.verification_status&&a.jsxs(a.Fragment,{children:[a.jsx(m,{variant:"outline",size:"icon",title:"Approve",onClick:()=>We(e,"approved"),children:a.jsx(J,{className:"h-4 w-4 text-green-600"})}),a.jsx(m,{variant:"outline",size:"icon",title:"Reject",onClick:()=>We(e,"rejected"),children:a.jsx(K,{className:"h-4 w-4 text-destructive"})}),a.jsx(m,{variant:"outline",size:"icon",title:"Request Clarification",onClick:()=>We(e,"needs_clarification"),children:a.jsx(X,{className:"h-4 w-4 text-orange-500"})})]}),"needs_clarification"===e.verification_status&&a.jsxs(a.Fragment,{children:[e.employee_response&&a.jsxs(a.Fragment,{children:[a.jsx(m,{variant:"outline",size:"icon",title:"Approve",onClick:()=>We(e,"approved"),children:a.jsx(J,{className:"h-4 w-4 text-green-600"})}),a.jsx(m,{variant:"outline",size:"icon",title:"Reject",onClick:()=>We(e,"rejected"),children:a.jsx(K,{className:"h-4 w-4 text-destructive"})})]}),a.jsx(m,{variant:"outline",size:"icon",title:"View Response",onClick:()=>(e=>{Fe(e),ze(!0)})(e),children:a.jsx(ee,{className:"h-4 w-4"})})]})]})})]},e.id)}):a.jsx(b,{children:a.jsx(_,{colSpan:Ee?10:9,className:"py-8 text-center text-gray-500",children:"No proofs found"})})})]})}),Ee&&a.jsxs("div",{className:"mt-6 flex items-center justify-between rounded-lg border border-gray-200 bg-gray-50 p-4",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",Qe.length," proofs"]}),a.jsx(k,{page:oe,setPage:de,limit:ce,totalPages:Math.ceil((Te.length||1)/ce)})]})]})]})]})})]})}function te(){return a.jsx(d,{title:"Investment Proofs",subTitle:"Verify employee investment proofs",children:a.jsx(ie,{})})}export{te as default};
