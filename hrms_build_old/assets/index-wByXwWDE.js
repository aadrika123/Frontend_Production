import{j as e,h as r,z as a,u as s,r as l,B as t}from"./index-C0dR7KKl.js";import{P as i}from"./index-DLwgcCrU.js";import{h as n}from"./moment-CBOc1lqT.js";import{C as d,c as o,a as m,b as c}from"./card-dfHK731x.js";import{T as u,a as p,b as x,c as j,d as h,e as v}from"./table-DGsqq0wP.js";import{u as f,b}from"./useCustomQuery-DfubPPhS.js";import{S as y}from"./Spinner-Bh5S-NfG.js";import{a as g,o as _,c as A,b as N,f as P}from"./yup-D-4eAt9F.js";import{F as S}from"./datetime-picker-Chw5tpGr.js";import{R as D}from"./RHFTextField-Bf4PLUtQ.js";import{B as w}from"./ButtonLoading-CtnN6-Kp.js";import{R as M}from"./RHFSelectField-DetLCX2z.js";import{I as E}from"./input-5m-sj67D.js";import"./switch-DfyNgsks.js";import"./checkbox-5PN_yyUS.js";import"./label-BBEmak6c.js";import{R as Y}from"./DateAndTimePicker-CIIj3P6-.js";import{S as k}from"./separator-DK9wbIss.js";import{D as q}from"./index-Bak7Z6rK.js";import{B as I}from"./badge-ssHwjf40.js";import{S as R}from"./search-CZNK2cDk.js";import"./select-PSqof_An.js";import"./check-DJnOI1b1.js";import"./calendar-D3nBqMDA.js";import"./chevron-right-ZD98JKF5.js";import"./clock-zyZI13Cr.js";const F=A().shape({emp_id:P().required("Employee ID is required").positive(),arrear_type:N().required("Arrear type is required"),arrear_amount:P().required("Arrear amount is required").positive(),for_period_start:N().required("Period start date is required"),for_period_end:N().required("Period end date is required"),payment_month:P().required("Payment month is required").min(1).max(12),payment_year:P().required("Payment year is required").min(2020).max(2100),remarks:N().nullable()}),T=[{value:"da_revision",label:"DA Revision"},{value:"increment_arrear",label:"Increment Arrear"},{value:"promotion_arrear",label:"Promotion Arrear"},{value:"pay_revision",label:"Pay Revision"},{value:"other",label:"Other"}],O=[{value:"1",label:"January"},{value:"2",label:"February"},{value:"3",label:"March"},{value:"4",label:"April"},{value:"5",label:"May"},{value:"6",label:"June"},{value:"7",label:"July"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"October"},{value:"11",label:"November"},{value:"12",label:"December"}];function C({open:s,setOpen:l,title:t,refetch:i}){const n=f({}),d=g({defaultValues:{emp_id:void 0,arrear_type:"",arrear_amount:void 0,for_period_start:"",for_period_end:"",payment_month:(new Date).getMonth()+1,payment_year:(new Date).getFullYear(),remarks:""},resolver:_(F)});return e.jsx(q,{open:s,setOpen:l,title:t,setEdit:()=>(d.reset(),void l(!1)),children:e.jsx(S,{methods:d,onSubmit:d.handleSubmit(async e=>{var s,t,o,m;try{const c=await n.mutateAsync({api:null==(s=r)?void 0:s.addArrears,data:e});(null==(t=c.data)?void 0:t.success)?(a.success((null==(o=null==c?void 0:c.data)?void 0:o.message)||"Arrears added successfully"),d.reset(),l(!1),null==i||i()):a.error((null==(m=c.data)?void 0:m.message)||"Failed to add arrears")}catch(c){a.error("Failed to add arrears")}}),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-4 gap-y-4 md:grid-cols-2",children:[e.jsx("div",{children:e.jsx(D,{label:"Employee ID",name:"emp_id",placeholder:"Enter Employee ID",type:"number"})}),e.jsx("div",{children:e.jsx(M,{label:"Arrear Type",name:"arrear_type",data:T})}),e.jsx("div",{children:e.jsx(D,{label:"Arrear Amount (₹)",name:"arrear_amount",placeholder:"Enter Arrear Amount",type:"number"})}),e.jsx("div",{children:e.jsx(Y,{name:"for_period_start",label:"Period Start Date",placeholder:"Select start date"})}),e.jsx("div",{children:e.jsx(Y,{name:"for_period_end",label:"Period End Date",placeholder:"Select end date"})}),e.jsx("div",{children:e.jsx(M,{label:"Payment Month",name:"payment_month",data:O})}),e.jsx("div",{children:e.jsx(D,{label:"Payment Year",name:"payment_year",placeholder:"Enter Year",type:"number"})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(D,{label:"Remarks",name:"remarks",placeholder:"Enter remarks (optional)"})}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(k,{className:"my-2"}),e.jsx(w,{isLoading:d.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Add Arrears"})]})]})})})}function L(){var a,i,f,g,_,A,N,P,S,D,w;const{user:M}=s(),[Y,k]=l.useState(!1),[q,F]=l.useState(""),[T,O]=l.useState(""),L=b({api:`${r.getPendingArrears}?emp_id=${T}&ulb_id=${null==M?void 0:M.ulbId}`,key:"getPendingArrears",value:[T,null==M?void 0:M.ulbId],options:{enabled:!!T&&!!(null==M?void 0:M.ulbId)}}),$=r=>{switch(r){case"pending":return e.jsx(I,{variant:"outline",className:"bg-yellow-100 text-yellow-700",children:"Pending"});case"partial":return e.jsx(I,{variant:"outline",className:"bg-blue-100 text-blue-700",children:"Partial"});case"paid":return e.jsx(I,{variant:"outline",className:"bg-green-100 text-green-700",children:"Paid"});default:return e.jsx(I,{variant:"outline",children:r})}};return e.jsxs("main",{className:"grid items-start",children:[e.jsx(C,{open:Y,setOpen:k,title:"Add Arrears",refetch:L.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full flex-col gap-4 sm:flex-row sm:justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{placeholder:"Enter Employee ID",value:q,onChange:e=>F(e.target.value),className:"w-48"}),e.jsxs(t,{onClick:()=>{q&&O(q)},variant:"outline",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Search"]})]}),e.jsx("div",{children:e.jsx(t,{className:"flex items-center gap-2",onClick:()=>k(!0),children:"Add Arrears"})})]}),T&&void 0!==(null==(i=null==(a=null==L?void 0:L.data)?void 0:a.data)?void 0:i.total_pending)&&e.jsx(d,{className:"bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsx(o,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Total Pending Arrears"}),e.jsxs("span",{className:"text-xl font-bold text-blue-700",children:["₹",(null==(_=null==(g=null==(f=null==L?void 0:L.data)?void 0:f.data)?void 0:g.total_pending)?void 0:_.toLocaleString())||0]})]})})}),e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(c,{children:T?`Pending Arrears for Employee ID: ${T}`:"Enter Employee ID to view pending arrears"})}),e.jsx(o,{children:T?(null==L?void 0:L.isLoading)?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(y,{})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(u,{children:[e.jsx(p,{children:e.jsxs(x,{children:[e.jsx(j,{children:"Type"}),e.jsx(j,{children:"Arrear Amount"}),e.jsx(j,{children:"Pending Amount"}),e.jsx(j,{children:"Period"}),e.jsx(j,{children:"Payment Month"}),e.jsx(j,{children:"Status"}),e.jsx(j,{children:"Remarks"}),e.jsx(j,{children:"Created At"})]})}),e.jsx(h,{children:(null==(N=null==(A=null==L?void 0:L.data)?void 0:A.data)?void 0:N.arrears)&&(null==(S=null==(P=null==L?void 0:L.data)?void 0:P.data)?void 0:S.arrears.length)>0?null==(w=null==(D=null==L?void 0:L.data)?void 0:D.data)?void 0:w.arrears.map(r=>{var a,s,l;return e.jsxs(x,{children:[e.jsx(v,{className:"font-medium",children:(l=r.arrear_type,{da_revision:"DA Revision",increment_arrear:"Increment Arrear",promotion_arrear:"Promotion Arrear",pay_revision:"Pay Revision",other:"Other"}[l]||l)}),e.jsxs(v,{children:["₹",null==(a=r.arrear_amount)?void 0:a.toLocaleString()]}),e.jsxs(v,{className:"font-semibold text-blue-600",children:["₹",null==(s=r.pending_amount)?void 0:s.toLocaleString()]}),e.jsxs(v,{children:[n(r.for_period_start).format("DD/MM/YYYY")," ","- ",n(r.for_period_end).format("DD/MM/YYYY")]}),e.jsxs(v,{children:[n().month(r.payment_month-1).format("MMM")," ",r.payment_year]}),e.jsx(v,{children:$(r.status)}),e.jsx(v,{className:"max-w-xs truncate",children:r.remarks||"-"}),e.jsx(v,{children:n(r.created_at).format("DD/MM/YYYY")})]},r.id)}):e.jsx(x,{children:e.jsx(v,{colSpan:8,className:"text-center",children:"No pending arrears found"})})})]})}):e.jsx("div",{className:"flex items-center justify-center py-8 text-slate-500",children:"Please enter an Employee ID to search for arrears"})})]})]})]})}function $(){return e.jsx(i,{title:"Arrears Management",subTitle:"Manage Employee Arrears",children:e.jsx("div",{className:"py-12",children:e.jsx(L,{})})})}export{$ as default};
