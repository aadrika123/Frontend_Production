import{aA as e,r as a,j as l,aB as t,al as s}from"./vendor-RyuIgj66.js";import{P as i}from"./index-DFF4_m_G.js";import{h as o}from"./moment-CBOc1lqT.js";import{h as r,e as n,B as d,g as c}from"./index-ey2GEmQz.js";import{C as m,a as u,b as f,c as x}from"./card-u7M7FP5y.js";import{T as h,a as p,b as v,c as j,d as _,e as y}from"./table-B_npepsp.js";import{u as b,b as g}from"./useCustomQuery-DTB6aAiD.js";import{P as S}from"./index-BHR1l08i.js";import{S as N}from"./separator-BQijJEjG.js";import{S as T}from"./index-CUStUwt1.js";import{S as P}from"./Spinner-BwGzvoRj.js";import{c as C,e as A,a as E}from"./yup-CH6wvET8.js";import{F as w}from"./datetime-picker-dN6E5dqy.js";import{R as q}from"./RHFTextField-BSZ_cEI3.js";import{B as F}from"./ButtonLoading-DDalXO-W.js";import"./select-8PAfYjod.js";import{I as M}from"./input-DlX9dTT0.js";import"./switch-Cssv6fnZ.js";import"./checkbox-DFFItNXW.js";import{L as k}from"./label-BcY3kv5U.js";import{R as L}from"./DateAndTimePicker-CtTdRVKm.js";import{D as $}from"./index-B2ia16z0.js";import{ah as D,O as H}from"./icons-CxCh8mm_.js";import"./ui-B3c1eQmf.js";import"./query-BH9sOW2X.js";import"./axios-Dos3PyFQ.js";import"./zustand-C1rkr5lV.js";const O=C().shape({state_code:E().required("State Code is required").max(2),salary_from:A().required("Salary From is required").min(0),salary_to:A().nullable().min(0).optional(),monthly_tax:A().required("Monthly Tax is required").min(0),applicable_month:E().nullable().optional(),effective_from:E().required("Effective From date is required"),effective_to:E().nullable().optional(),status:A().optional()});function J({open:i,setOpen:o,title:d,id:c,edit:m,setEdit:u,ptSlabListData:f}){var x,h,p,v,j;const _=b({}),{data:y,isFetching:S}=g({api:`${null==(x=r)?void 0:x.getPTSlabById}?id=${n(String(c))}`,key:"getPTSlabById",options:{enabled:m&&!!c}}),T=(null==f?void 0:f.data)&&(null==(p=null==(h=null==f?void 0:f.data)?void 0:h.data)?void 0:p.length)>0?Math.max(...null==(j=null==(v=null==f?void 0:f.data)?void 0:v.data)?void 0:j.map(e=>(null==e?void 0:e.salary_to)||0))+1:0,P=e({defaultValues:{state_code:"JH",salary_from:0,salary_to:0,monthly_tax:0,applicable_month:"",effective_from:"",effective_to:"",status:1},resolver:t(O)});return a.useEffect(()=>{var e,a,l,t,s,i,o,r,n;m&&y?P.reset({state_code:(null==(e=null==y?void 0:y.data)?void 0:e.state_code)||"",salary_from:Number(null==(a=null==y?void 0:y.data)?void 0:a.salary_from)||0,salary_to:(null==(l=null==y?void 0:y.data)?void 0:l.salary_to)?Number(null==(t=null==y?void 0:y.data)?void 0:t.salary_to):0,monthly_tax:Number(null==(s=null==y?void 0:y.data)?void 0:s.monthly_tax)||0,applicable_month:(null==(i=null==y?void 0:y.data)?void 0:i.applicable_month)||"",effective_from:(null==(o=null==y?void 0:y.data)?void 0:o.effective_from)||"",effective_to:(null==(r=null==y?void 0:y.data)?void 0:r.effective_to)||"",status:(null==(n=null==y?void 0:y.data)?void 0:n.status)||1}):P.reset({state_code:"JH",salary_from:T||0,salary_to:0,monthly_tax:0,applicable_month:"",effective_from:"",effective_to:"",status:1})},[m,y,P,T]),l.jsx($,{open:i,setOpen:o,title:d,setEdit:u,edit:m,isLoading:S,children:l.jsx(w,{methods:P,onSubmit:P.handleSubmit(async e=>{var a,l,t,i,n,d,x,h,p;try{if(m&&c){const o=await _.mutateAsync({api:null==(a=r)?void 0:a.updatePTSlab,data:{id:Number(c),...e}});(null==(l=o.data)?void 0:l.success)?s.success((null==(t=null==o?void 0:o.data)?void 0:t.message)||"Professional Tax Slab updated successfully"):s.error((null==(i=o.data)?void 0:i.message)||"Professional Tax Slab not updated successfully")}else{const a=await _.mutateAsync({api:null==(n=r)?void 0:n.createPTSlab,data:e});(null==(d=a.data)?void 0:d.success)?s.success((null==(x=null==a?void 0:a.data)?void 0:x.message)||"Professional Tax Slab created successfully"):s.error((null==(h=a.data)?void 0:h.message)||"Professional Tax Slab not created successfully")}P.reset({state_code:"",salary_from:0,salary_to:0,monthly_tax:0,applicable_month:"",effective_from:"",effective_to:"",status:1}),o(!1),null==u||u(!1),null==(p=f.refetch)||p.call(f)}catch(v){}}),children:l.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[l.jsx("div",{children:l.jsx(q,{label:"State Code",name:"state_code",placeholder:"Enter State Code (e.g., JH)",type:"text",maxLength:2})}),l.jsx("div",{children:l.jsx(q,{label:"Salary From",name:"salary_from",placeholder:"Enter Salary From",type:"number",step:"1"})}),l.jsx("div",{children:l.jsx(q,{label:"Salary To (Optional)",name:"salary_to",placeholder:"Enter Salary To (Leave empty for unlimited)",type:"number",step:"1"})}),l.jsx("div",{children:l.jsx(q,{label:"Monthly Tax",name:"monthly_tax",placeholder:"Enter Monthly Tax Amount",type:"number",step:"1"})}),l.jsx("div",{children:l.jsx(q,{label:"Applicable Month (Optional)",name:"applicable_month",placeholder:"Enter Applicable Month",type:"text"})}),l.jsx("div",{children:l.jsx(L,{name:"effective_from",label:"Effective From",placeholder:"Select effective from date"})}),l.jsx("div",{children:l.jsx(L,{name:"effective_to",label:"Effective To (Optional)",placeholder:"Select effective to date"})}),l.jsx(N,{}),l.jsx("div",{children:l.jsx(F,{isLoading:P.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}const B={state_code:"JH",salary_from:0,salary_to:"",monthly_tax:0,applicable_month:"",effective_from:"2024-01-01"},Y=[{state_code:"JH",salary_from:0,salary_to:25e3,monthly_tax:0,applicable_month:"",effective_from:"2024-01-01"},{state_code:"JH",salary_from:25001,salary_to:41666,monthly_tax:100,applicable_month:"",effective_from:"2024-01-01"},{state_code:"JH",salary_from:41667,salary_to:66666,monthly_tax:150,applicable_month:"",effective_from:"2024-01-01"},{state_code:"JH",salary_from:66667,salary_to:83333,monthly_tax:175,applicable_month:"",effective_from:"2024-01-01"},{state_code:"JH",salary_from:83334,salary_to:"",monthly_tax:200,applicable_month:"",effective_from:"2024-01-01"}];function U({open:e,setOpen:t,refetch:i}){const[o,n]=a.useState(Y),[c,u]=a.useState(!1),f=b({});a.useEffect(()=>{e&&n(Y)},[e]);const x=(e,a,l)=>{const t=[...o];t[e]={...t[e],[a]:l},n(t)};return l.jsx($,{open:e,setOpen:t,title:"Bulk Upload Professional Tax Slabs",edit:!1,setEdit:()=>{},children:l.jsx("form",{onSubmit:async e=>{var a,l,d,c;e.preventDefault(),u(!0);try{for(let a=0;a<o.length;a++){const e=o[a];if(!e.state_code||!e.effective_from)return s.error(`Slab ${a+1}: State Code and Effective From are required`),void u(!1);if(""===e.salary_from||""===e.monthly_tax)return s.error(`Slab ${a+1}: Salary From and Monthly Tax are required`),void u(!1)}const e=o.map(e=>({state_code:e.state_code,salary_from:Number(e.salary_from),salary_to:""===e.salary_to||null===e.salary_to?null:Number(e.salary_to),monthly_tax:Number(e.monthly_tax),applicable_month:""===e.applicable_month?null:e.applicable_month,effective_from:e.effective_from})),m=await f.mutateAsync({api:null==(a=r)?void 0:a.bulkCreatePTSlab,data:{slabs:e}});(null==(l=m.data)?void 0:l.success)?(s.success((null==(d=null==m?void 0:m.data)?void 0:d.message)||"Professional Tax Slabs created successfully"),t(!1),n(Y),null==i||i()):s.error((null==(c=m.data)?void 0:c.message)||"Failed to create Professional Tax Slabs")}catch(m){s.error("An error occurred while uploading slabs")}finally{u(!1)}},children:l.jsxs("div",{className:"grid gap-4",children:[l.jsx("div",{className:"max-h-[500px] space-y-4 overflow-y-auto pr-2",children:o.map((e,a)=>l.jsxs(m,{className:"relative p-4",children:[l.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[l.jsxs("h4",{className:"text-sm font-semibold",children:["Slab ",a+1]}),l.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{o.length>1?n(o.filter((a,l)=>l!==e)):s.error("At least one slab is required")})(a),className:"h-8 w-8 p-0",children:l.jsx(D,{className:"h-4 w-4"})})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[l.jsxs("div",{children:[l.jsx(k,{className:"text-xs",children:"State Code*"}),l.jsx(M,{type:"text",value:e.state_code,onChange:e=>x(a,"state_code",e.target.value.toUpperCase()),maxLength:2,placeholder:"JH",className:"h-9",required:!0})]}),l.jsxs("div",{children:[l.jsx(k,{className:"text-xs",children:"Salary From*"}),l.jsx(M,{type:"number",value:e.salary_from,onChange:e=>x(a,"salary_from",e.target.value),placeholder:"0",className:"h-9",required:!0})]}),l.jsxs("div",{children:[l.jsx(k,{className:"text-xs",children:"Salary To"}),l.jsx(M,{type:"number",value:null===e.salary_to?"":e.salary_to,onChange:e=>x(a,"salary_to",e.target.value),placeholder:"Leave empty for unlimited",className:"h-9"})]}),l.jsxs("div",{children:[l.jsx(k,{className:"text-xs",children:"Monthly Tax*"}),l.jsx(M,{type:"number",value:e.monthly_tax,onChange:e=>x(a,"monthly_tax",e.target.value),placeholder:"0",className:"h-9",required:!0})]}),l.jsxs("div",{children:[l.jsx(k,{className:"text-xs",children:"Applicable Month"}),l.jsx(M,{type:"text",value:e.applicable_month||"",onChange:e=>x(a,"applicable_month",e.target.value),placeholder:"Optional",className:"h-9"})]}),l.jsxs("div",{children:[l.jsx(k,{className:"text-xs",children:"Effective From*"}),l.jsx(M,{type:"date",value:e.effective_from,onChange:e=>x(a,"effective_from",e.target.value),className:"h-9",required:!0})]})]})]},a))}),l.jsxs(d,{type:"button",variant:"outline",onClick:()=>{n([...o,{...B}])},className:"w-full",children:[l.jsx(H,{className:"mr-2 h-4 w-4"}),"Add Another Slab"]}),l.jsx("div",{className:"flex gap-2",children:l.jsx(d,{type:"button",variant:"outline",onClick:()=>{n(Y)},className:"flex-1",children:"Reset to Default"})}),l.jsx(N,{}),l.jsx(d,{type:"submit",disabled:c,className:"h-11 w-full rounded-xl",children:c?"Uploading...":`Upload ${o.length} Slab${o.length>1?"s":""}`})]})})})}function z(){var e,t,i,n,C,A;const E=b({}),[w,q]=a.useState(1),[F]=a.useState(10),[M,k]=a.useState(""),[L,$]=a.useState(!1),[D,H]=a.useState(!1),[O,B]=a.useState(""),[Y,z]=a.useState(!1),I=g({api:`${r.getAllPTSlabs}?page=${w}&limit=${F}&q=${M}`,key:"getAllPTSlabs",value:[w,F,M],options:{enabled:!0}});return l.jsxs("main",{className:"grid items-start",children:[l.jsx(J,{open:L,setOpen:$,title:Y?"Edit Professional Tax Slab":"Add Professional Tax Slab",id:O,edit:Y,setEdit:z,ptSlabListData:I}),l.jsx(U,{open:D,setOpen:H,refetch:I.refetch}),l.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[l.jsxs("div",{className:"flex w-full justify-between gap-2",children:[l.jsx("div",{children:l.jsx(T,{search:M,setSearch:k,refetch:I.refetch,isFetching:null==I?void 0:I.isLoading})}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx(d,{variant:"outline",className:"flex items-center gap-2",onClick:()=>H(!0),children:"Bulk Upload"}),l.jsx(d,{className:"flex items-center gap-2",onClick:()=>$(!0),children:"Add New"})]})]}),l.jsx(N,{}),l.jsxs(m,{children:[l.jsx(u,{children:l.jsx(f,{children:"Professional Tax Slabs"})}),l.jsx(x,{children:(null==I?void 0:I.isLoading)?l.jsx("div",{className:"flex items-center justify-center",children:l.jsx(P,{})}):l.jsx("div",{className:"overflow-x-auto",children:l.jsxs(h,{children:[l.jsx(p,{children:l.jsxs(v,{children:[l.jsx(j,{children:"State Code"}),l.jsx(j,{children:"Salary From"}),l.jsx(j,{children:"Salary To"}),l.jsx(j,{children:"Monthly Tax"}),l.jsx(j,{children:"Applicable Month"}),l.jsx(j,{children:"Effective From"}),l.jsx(j,{children:"Effective To"}),l.jsx(j,{children:"Status"}),l.jsx(j,{children:"Actions"})]})}),l.jsx(_,{children:(null==(e=null==I?void 0:I.data)?void 0:e.data)&&(null==(t=null==I?void 0:I.data)?void 0:t.data.length)>0?null==(i=null==I?void 0:I.data)?void 0:i.data.map(e=>l.jsxs(v,{children:[l.jsx(y,{className:"font-medium",children:e.state_code}),l.jsxs(y,{children:["₹",e.salary_from.toLocaleString()]}),l.jsx(y,{children:e.salary_to?`₹${e.salary_to.toLocaleString()}`:"Above"}),l.jsxs(y,{children:["₹",e.monthly_tax]}),l.jsx(y,{children:e.applicable_month||"-"}),l.jsx(y,{children:o(e.effective_from).format("DD/MM/YYYY")}),l.jsx(y,{children:e.effective_to?o(e.effective_to).format("DD/MM/YYYY"):"-"}),l.jsx(y,{children:l.jsx("span",{className:"rounded-full px-3 py-1 text-xs font-semibold "+(1===e.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:1===e.status?"Active":"Inactive"})}),l.jsxs(y,{className:"flex gap-2",children:[l.jsx(d,{variant:"outline",size:"sm",onClick:()=>{return a=String(e.id),z(!0),$(!0),void B(a);var a},children:"Edit"}),l.jsx(d,{variant:"destructive",size:"sm",onClick:()=>(async e=>{var a,l,t,i;try{const o=await E.mutateAsync({api:null==(a=r)?void 0:a.deletePTSlab,data:{id:Number(e)}});(null==(l=null==o?void 0:o.data)?void 0:l.success)?(I.refetch(),s.success((null==(t=null==o?void 0:o.data)?void 0:t.message)||"Professional Tax Slab deleted successfully")):s.error((null==(i=o.data)?void 0:i.message)||"Failed to delete Professional Tax Slab")}catch(o){s.error(c(o))}})(String(e.id)),children:"Delete"})]})]},e.id)):l.jsx(v,{children:l.jsx(y,{colSpan:9,className:"text-center",children:"No Professional Tax Slabs found"})})})]})})})]}),(null==(n=null==I?void 0:I.data)?void 0:n.pagination)&&l.jsx(S,{page:w,setPage:q,limit:F,totalPages:(null==(A=null==(C=null==I?void 0:I.data)?void 0:C.pagination)?void 0:A.totalPages)||1})]})]})}function I(){return l.jsx(i,{title:"Professional Slab",subTitle:"Manage Professional Slabs",children:l.jsx("div",{className:"py-12",children:l.jsx(z,{})})})}export{I as default};
