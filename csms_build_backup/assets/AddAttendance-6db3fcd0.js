import{u as rt,r as o,S as b,R as ct,j as e}from"./index-0cd5b1c8.js";import{u as nt,a as st,b as dt,g as N}from"./formik.esm-59936898.js";import{c as q,g as ot,a as lt}from"./index.esm-2daf9377.js";import{A as j,a as y,b as it}from"./AxiosInterceptors-d192cef8.js";import{h as T}from"./moment-fbc5633a.js";import{B as xt}from"./BottomErrorCard-5e21225b.js";import{B as ut}from"./BarLoader-475527d2.js";import{u as pt}from"./useErrorAutoFocusField-d26393d4.js";import"./hoist-non-react-statics.cjs-ef0c9066.js";let ht=q().shape({attendance:ot().of(q().shape({description:lt().when("attendanceStatus",{is:h=>h=="2",then:h=>h.required("Description is required").min(3,"Must be at least 3 characters").max(100,"Must be at most 100 characters"),otherwise:h=>h.notRequired()})}))});function Dt(){var E,$,A,F,Y,B,M,R;rt();const{AutoFocusErrorField:h}=pt(),{api_retrieve_all_student:ft,api_getClassData:V,api_getSectionData:bt,api_student_attendance:O,api_section_group_map:J,api_fetch_student_attendance:z}=it(),[H,d]=o.useState(!1),[f,g]=o.useState([]),[U,G]=o.useState(!1),[K,Q]=o.useState(null),[S,W]=o.useState([]),[k,_]=o.useState([]),X=()=>{d(!0),j.post(V,{},y()).then(function(t){var a,c,s,p;console.log("Class Data..",(a=t==null?void 0:t.data)==null?void 0:a.data),(c=t==null?void 0:t.data)!=null&&c.status?W((s=t==null?void 0:t.data)==null?void 0:s.data):u(!0,(p=t==null?void 0:t.data)==null?void 0:p.message),d(!1)}).catch(function(t){console.log("==2 error list...",t),u(!0,"Error occured while fetching data."),d(!1)})},Z=()=>{if(f){const t=f==null?void 0:f.map(a=>({studentId:a==null?void 0:a.id,admissionNo:a==null?void 0:a.admission_no,classId:a==null?void 0:a.class_id,sectionId:a==null?void 0:a.section_id,rollNo:a==null?void 0:a.roll_no,fullName:a==null?void 0:a.full_name,className:a==null?void 0:a.class_name,sectionName:a==null?void 0:a.section_name,attendanceStatus:"1",description:"",date:T().format("YYYY-MM-DD"),isCheck:!1}));m.setFieldValue("attendance",t)}},m=nt({enableReinitialize:!0,initialValues:{class_id:"",section_id:"",attendance:[{studentId:"",admissionNo:"",classId:"",sectionId:"",rollNo:"",fullName:"",className:"",sectionName:"",attendanceStatus:"",description:"",date:""}]},validationSchema:ht,onSubmit:t=>{var p;if(console.log("values",t),(p=t==null?void 0:t.attendance)==null?void 0:p.some(n=>(n==null?void 0:n.attendanceStatus)=="")){b.fire({icon:"error",title:"Oops...",text:"Please select attendance present, absent or leave for all students!"});return}const s={attendance:t==null?void 0:t.attendance.map(n=>({studentId:n==null?void 0:n.studentId,admissionNo:n==null?void 0:n.admissionNo,classId:t==null?void 0:t.class_id,sectionId:t==null?void 0:t.section_id,attendanceStatus:parseInt(n==null?void 0:n.attendanceStatus),description:n==null?void 0:n.description,attendanceDate:n==null?void 0:n.date})),classId:parseInt(t==null?void 0:t.class_id),sectionId:parseInt(t==null?void 0:t.section_id),attendanceDate:T().format("YYYY-MM-DD")};b.fire({title:"Are you sure?",text:"You want to submit attendance!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, submit it!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(n=>{n.isConfirmed?(d(!0),j.post(O,{...s},y()).then(function(l){var L,P;console.log("Class Data..",l),((L=l==null?void 0:l.data)==null?void 0:L.status)==!0?(b.fire("Submitted!","Attendance has been submitted.","success"),m.resetForm()):u(!0,(P=l==null?void 0:l.data)==null?void 0:P.message),d(!1)}).catch(function(l){console.log("==2 error list...",l),u(!0,"Error occured while fetching data."),d(!1)})):n.dismiss===b.DismissReason.cancel&&b.fire("Cancelled","Your form data is safe :)","error")})}}),{values:r,handleSubmit:v,getFieldProps:D,setFieldValue:i,errors:x,touched:w,isValid:tt,isSubmitting:I,submitCount:C}=m,et=()=>{d(!0),j.post(z,{classId:r==null?void 0:r.class_id,id:r==null?void 0:r.section_id},y()).then(function(t){var a,c,s;console.log("Student Data..",(a=t==null?void 0:t.data)==null?void 0:a.data),(c=t==null?void 0:t.data)!=null&&c.status?g((s=t==null?void 0:t.data)==null?void 0:s.data):g([]),d(!1)}).catch(function(t){console.log("==2 error list...",t),u(!0,"Error occured while fetching data."),d(!1)})};o.useEffect(()=>{X()},[]),o.useEffect(()=>{r!=null&&r.section_id&&et()},[r==null?void 0:r.section_id]),o.useEffect(()=>{f&&Z()},[f]);const at=()=>{d(!0),j.post(J,{classId:r.class_id},y()).then(function(t){var a,c,s,p;console.log("section Data..",(a=t==null?void 0:t.data)==null?void 0:a.data),((c=t==null?void 0:t.data)==null?void 0:c.status)==!0?_((s=t==null?void 0:t.data)==null?void 0:s.data):u(!0,(p=t==null?void 0:t.data)==null?void 0:p.message),d(!1)}).catch(function(t){console.log("==2 error list...",t),u(!0,"Error occured while fetching data."),d(!1)})};o.useEffect(()=>{i("section_id",""),r.class_id?(at(),g([])):(_([]),g([]))},[r==null?void 0:r.class_id]);const u=(t,a)=>{Q(a),G(t)};return ct.useEffect(()=>{h({isValid:tt,submitCount:C,isSubmitting:I,errors:x})},[x,C,I]),e.jsxs(e.Fragment,{children:[H&&e.jsx(ut,{}),U&&e.jsx(xt,{activateBottomErrorCard:u,errorTitle:K}),e.jsx(st,{value:r,children:e.jsx(dt,{onSubmit:v,children:e.jsx("div",{className:"w-full col-span-10 2xl:py-3 2xl:px-6 px-6 py-2",children:e.jsxs("div",{className:"border-[2px] border-gray-200 rounded-md h-[82vh] 2xl:p-6 p-4 overflow-y-auto",children:[e.jsx("div",{className:"",children:e.jsxs("div",{className:"flex w-full justify-between items-center max-[870px]:block",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-3xl text-center font-semibold text-gray-600 flex flex-start",children:"Add Attendance"}),e.jsx("span",{className:"text-sm text-center font-medium text-gray-400",children:"Unlock Your Potential. Join Our Journey Of Education And Excellence"})]}),e.jsxs("div",{className:"flex gap-6 mt-4 md:mt-0 flex-col lg:flex-row",children:[e.jsx("input",{disabled:!0,type:"text",className:"mt-7 h-8 w-full lg:w-40 form-control block  px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md ",value:Date().toLocaleString().slice(0,15)}),e.jsxs("div",{className:"form-group  md:col-span-2 mb-6 md:px-4",children:[e.jsxs("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:["Class",e.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),e.jsxs("select",{className:"form-control block w-full lg:w-40 px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",...D("class_id"),children:[e.jsx("option",{value:"",children:"Select"}),S==null?void 0:S.map(t=>e.jsx("option",{value:t==null?void 0:t.id,children:t==null?void 0:t.class_name}))]}),e.jsx("span",{className:"text-red-600 text-xs",children:w.class_id&&x.class_id?x.class_id:null})]}),e.jsxs("div",{className:"form-group col-span-12 md:col-span-2 mb-6 md:px-4",children:[e.jsxs("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:["Sections",e.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),e.jsxs("select",{...D("section_id"),className:"form-control block w-full lg:w-40 px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",children:[e.jsx("option",{value:"",children:"Select"}),k==null?void 0:k.map(t=>e.jsx("option",{value:t==null?void 0:t.id,children:t==null?void 0:t.section_name}))]}),e.jsx("span",{className:"text-red-600 text-xs",children:w.section_id&&x.section_id?x.section_id:null})]})]})]})}),((E=r==null?void 0:r.attendance)==null?void 0:E.length)>0?e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{className:"overflow-x-auto sm:-mx-6 lg:-mx-8",children:e.jsx("div",{className:"inline-block min-w-full py-2 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("table",{className:"min-w-full border text-center text-sm font-light dark:border-neutral-500",children:[e.jsx("thead",{className:"border-b font-medium dark:border-neutral-500",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 font-medium dark:border-neutral-500",children:"sl.no"}),e.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:"Admission no"}),e.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:"Class"}),e.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:"Section"}),e.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:"Roll No"}),e.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:"Full name"}),e.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Present",e.jsx("input",{type:"checkbox",className:"h-[18px] w-[18px]",onChange:t=>{var c;const a=(c=r==null?void 0:r.attendance)==null?void 0:c.map(s=>({...s,attendanceStatus:t.target.checked?"1":""}));i("attendance",a)},checked:(($=r==null?void 0:r.attendance)==null?void 0:$.filter(t=>(t==null?void 0:t.attendanceStatus)=="1").length)===((A=r==null?void 0:r.attendance)==null?void 0:A.length)})]})}),e.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Absent",e.jsx("input",{type:"checkbox",className:"h-[18px] w-[18px]",onChange:t=>{var c;const a=(c=r==null?void 0:r.attendance)==null?void 0:c.map(s=>({...s,attendanceStatus:t.target.checked?"0":""}));i("attendance",a)},checked:((F=r==null?void 0:r.attendance)==null?void 0:F.filter(t=>(t==null?void 0:t.attendanceStatus)=="0").length)===((Y=r==null?void 0:r.attendance)==null?void 0:Y.length)})]})}),e.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Leave",e.jsx("input",{type:"checkbox",className:"h-[18px] w-[18px]",onChange:t=>{var c;const a=(c=r==null?void 0:r.attendance)==null?void 0:c.map(s=>({...s,attendanceStatus:t.target.checked?"2":""}));i("attendance",a)},checked:((B=r==null?void 0:r.attendance)==null?void 0:B.filter(t=>(t==null?void 0:t.attendanceStatus)==="2").length)===((M=r==null?void 0:r.attendance)==null?void 0:M.length)})]})}),e.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-4 py-4 dark:border-neutral-500",children:"Description"})]})}),e.jsx("tbody",{children:(R=r==null?void 0:r.attendance)==null?void 0:R.map((t,a)=>e.jsxs("tr",{className:"border-b dark:border-neutral-500",children:[e.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 font-medium dark:border-neutral-500",children:a+1}),e.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:(t==null?void 0:t.admissionNo)||"N/A"}),e.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:t==null?void 0:t.className}),e.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:t==null?void 0:t.sectionName}),e.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:t==null?void 0:t.rollNo}),e.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:t==null?void 0:t.fullName}),e.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:e.jsx("input",{className:"h-[18px] w-[18px]  ",type:"checkbox",value:"1",name:`attendance[${a}].attendanceStatus`,onChange:c=>{i(`attendance[${a}].attendanceStatus`,c.target.value)},checked:(t==null?void 0:t.attendanceStatus)=="1"})}),e.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:e.jsx("input",{className:"h-[18px] w-[18px]",type:"checkbox",value:"0",name:`attendance[${a}].attendanceStatus`,onChange:c=>{i(`attendance[${a}].attendanceStatus`,c.target.value)},checked:(t==null?void 0:t.attendanceStatus)=="0"})}),e.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:e.jsx("input",{className:"h-[18px] w-[18px]",type:"checkbox",value:"2",name:`attendance[${a}].attendanceStatus`,onChange:c=>{i(`attendance[${a}].attendanceStatus`,c.target.value)},checked:(t==null?void 0:t.attendanceStatus)=="2"})}),e.jsxs("td",{className:"whitespace-nowrap border-r px-4 py-4 dark:border-neutral-500",children:[e.jsx("input",{disabled:(t==null?void 0:t.attendanceStatus)=="1"||(t==null?void 0:t.attendanceStatus)=="0",type:"text",className:`form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid ${N(w,`attendance[${a}].description`)&&N(x,`attendance[${a}].description`)?"border-red-300 bg-red-50":"border-gray-300 bg-white"} rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 `,name:`attendance[${a}].description`,onChange:c=>{i(`attendance[${a}].description`,c.target.value),(`attendance[${a}].attendanceStatus`=="1"||`attendance[${a}].attendanceStatus`=="0")&&m.setTouched({[`attendance[${a}].description`]:!0})},value:t==null?void 0:t.description}),e.jsx("h1",{className:"text-red-500 text-[11px]",children:N(w,`attendance[${a}].description`)&&N(x,`attendance[${a}].description`)})]})]}))})]}),e.jsx("div",{className:"flex justify-end w-full gap-4 mt-4",children:e.jsx("button",{type:"submit",className:"bg-blue-500 text- text-white px-4 py-2 rounded-md mt-4",children:"Submit"})})]})})})}):e.jsx("h1",{className:"text-gray-600 text-center mt-56 text-2xl",children:"No Data Found! please select class and section"})]})})})})]})}export{Dt as default};
