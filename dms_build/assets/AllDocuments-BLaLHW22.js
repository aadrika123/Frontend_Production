import{q as V,r as a,j as e,ac as ue,ad as pe,ae as me,af as he,ag as xe,aa as h,Z as fe,ah as se,a1 as L,a7 as x,ai as te,W as X,X as ae,aj as ge,V as je,L as G,$ as ye,a0 as ve,U as we,a8 as Se,a9 as Ne,I as be,ak as ee,ab as ke}from"./index-CTy7VBfZ.js";import{U as le}from"./upload-BmfsAvjW.js";import{S as De,a as Ce,b as Fe,c as ze,d as m}from"./select-C2Verkrw.js";const Be=V("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const Pe=V("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);const Ae=V("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);function $e({open:D,onOpenChange:C,onUploadComplete:d}){const[o,f]=a.useState([]),[p,A]=a.useState(!1),[$,F]=a.useState(!1),[q,U]=a.useState(!1),v=a.useRef(null),I=localStorage.getItem("token")||"",w=s=>{s.preventDefault(),s.stopPropagation(),s.type==="dragenter"||s.type==="dragover"?U(!0):s.type==="dragleave"&&U(!1)},T=s=>{s.preventDefault(),s.stopPropagation(),U(!1),s.dataTransfer.files&&s.dataTransfer.files.length>0&&S(Array.from(s.dataTransfer.files))},B=s=>{s.target.files&&s.target.files.length>0&&S(Array.from(s.target.files))},S=s=>{const l=s.filter(i=>{const u=i.type.startsWith("image/"),N=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(i.type);return u||N});l.length!==s.length&&x.error("Some files were skipped. Only images and documents are allowed."),f(i=>[...i,...l])},R=s=>{f(l=>l.filter((i,u)=>u!==s))},g=async s=>{const l=await s.arrayBuffer(),i=await crypto.subtle.digest("SHA-256",l);return Array.from(new Uint8Array(i)).map(P=>P.toString(16).padStart(2,"0")).join("")},z=async()=>{if(o.length===0){x.error("Please select at least one file");return}A(!0),F(!1);try{let s=0,l=0;if(await Promise.all(o.map(async i=>{var u,N,P;try{const c=await g(i),j=new FormData;j.append("file",i),j.append("tags",i.name.substring(0,7));const H={"x-digest":c,token:"8Ufn6Jio6Obv9V7VXeP7gbzHSyRJcKluQOGorAD58qA1IQKYE0",folderPathId:"1",Authorization:`Bearer ${I}`},b=await te.post(`${X}/${ae.uploadDocument}`,j,{headers:H});((u=b==null?void 0:b.data)==null?void 0:u.status)===!0||(P=(N=b==null?void 0:b.data)==null?void 0:N.data)!=null&&P.ReferenceNo?s++:l++}catch{l++}})),s>0&&l===0)F(!0),x.success(`Successfully uploaded ${s} file(s)!`);else if(s>0&&l>0)x.success(`Uploaded ${s} file(s). ${l} failed.`);else throw new Error("All uploads failed");setTimeout(()=>{f([]),C(!1),F(!1),d==null||d()},1500)}catch(s){x.error(s.message||"Failed to upload files")}finally{A(!1)}},M=s=>{if(s===0)return"0 Bytes";const l=1024,i=["Bytes","KB","MB","GB"],u=Math.floor(Math.log(s)/Math.log(l));return Math.round(s/Math.pow(l,u)*100)/100+" "+i[u]},E=()=>{p||(f([]),F(!1),C(!1))};return e.jsx(ue,{open:D,onOpenChange:E,children:e.jsxs(pe,{className:"sm:max-w-[600px]",children:[e.jsxs(me,{children:[e.jsx(he,{className:"text-2xl",children:"Upload Documents"}),e.jsx(xe,{children:"Upload single or multiple images and documents to your library"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:`relative border-2 border-dashed rounded-lg p-8 text-center transition-all ${q?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-primary/50"}`,onDragEnter:w,onDragLeave:w,onDragOver:w,onDrop:T,children:[e.jsx("input",{ref:v,type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:B,className:"hidden"}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"p-4 bg-primary/10 rounded-full",children:e.jsx(le,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"font-semibold text-lg",children:q?"Drop files here":"Choose files or drag & drop"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Images, PDF, Word documents supported"}),e.jsx(h,{type:"button",variant:"outline",onClick:()=>{var s;return(s=v.current)==null?void 0:s.click()},className:"mt-2",children:"Browse Files"})]})]}),o.length>0&&e.jsxs("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:[e.jsxs("h4",{className:"font-semibold text-sm text-muted-foreground",children:["Selected Files (",o.length,")"]}),o.map((s,l)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg hover:bg-muted transition-colors",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded",children:s.type.startsWith("image/")?e.jsx("img",{src:URL.createObjectURL(s),alt:s.name,className:"h-10 w-10 object-cover rounded"}):e.jsx(fe,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:M(s.size)})]}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>R(l),disabled:p,children:e.jsx(se,{className:"h-4 w-4"})})]},l))]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(h,{type:"button",variant:"outline",onClick:E,disabled:p,children:"Cancel"}),e.jsxs(h,{type:"button",onClick:z,disabled:o.length===0||p||$,children:[p&&e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),$&&e.jsx(Be,{className:"mr-2 h-4 w-4"}),$?"Uploaded!":p?"Uploading...":"Upload"]})]})]})})}const Ue=(D,C=2)=>{if(!+D)return"0 Bytes";const d=1024,o=C<0?0:C,f=["Bytes","KB","MB","GB","TB"],p=Math.floor(Math.log(D)/Math.log(d));return`${parseFloat((D/Math.pow(d,p)).toFixed(o))} ${f[p]}`},Ie={pdf:{exts:["%.pdf"],types:["%pdf%"]},png:{exts:["%.png"],types:["%png%"]},jpg:{exts:["%.jpg","%.jpeg"],types:["%jpeg%","%jpg%"]},jpeg:{exts:["%.jpg","%.jpeg"],types:["%jpeg%","%jpg%"]},gif:{exts:["%.gif"],types:["%gif%"]},doc:{exts:["%.doc","%.docx"],types:["%doc%","%word%"]},docx:{exts:["%.doc","%.docx"],types:["%doc%","%word%"]},excel:{exts:["%.xls","%.xlsx"],types:["%xls%","%excel%","%spreadsheet%"]},ppt:{exts:["%.ppt","%.pptx"],types:["%ppt%"]},txt:{exts:["%.txt"],types:["%txt%","%text%"]},zip:{exts:["%.zip"],types:["%zip%"]},rar:{exts:["%.rar"],types:["%rar%"]},archive:{exts:["%.zip","%.rar"],types:["%zip%","%rar%"]}};function Oe(){var Z;const[D,C]=ge(),d=D.get("fileType")||"all",[o,f]=a.useState([]),[p,A]=a.useState(!1),[$,F]=a.useState(!1),[q,U]=a.useState(null),[v,I]=a.useState(1),[w]=a.useState(20),[T,B]=a.useState(!0),[S,R]=a.useState(!1),[g,z]=a.useState(new Set),[M,E]=a.useState(!1),[s,l]=a.useState(""),[i,u]=a.useState("");a.useEffect(()=>{const t=setTimeout(()=>{u(s)},500);return()=>clearTimeout(t)},[s]);const N=localStorage.getItem("token")||"",P=`${X}/document/view-all?page=${v}&limit=${w}`+(d!=="all"?`&fileType=${encodeURIComponent(d)}`:"")+(i?`&uniqueId=${encodeURIComponent(i)}`:""),{data:c,loading:j,error:H,refetch:b}=je(P,"POST",{page:v,limit:w,uniqueId:i,...d!=="all"?Ie[d]:{}},N);a.useEffect(()=>{if(c){const t=Array.isArray(c)?c:c.data||[];c.meta?v>=c.meta.totalPages&&B(!1):t.length<w&&B(!1);const r=t.map(n=>{var Y;const k=((Y=n.original_file_name.split(".").pop())==null?void 0:Y.toLowerCase())||"";let y="application/octet-stream";return["jpg","jpeg","png","gif","webp"].includes(k)&&(y="image/"+k),k==="pdf"&&(y="application/pdf"),k==="svg"&&(y="image/svg+xml"),{id:n.unique_id,name:n.original_file_name,size:Ue(parseInt(n.size)),type:(n.file_type||k).toUpperCase(),mimeType:y,url:n.fullPath,created_date:n.created_date}});f(n=>v===1?r:[...n,...r])}H&&x.error("Failed to load documents")},[c,H,v,w]),a.useEffect(()=>{I(1),f([]),B(!0)},[d,i]);const _=a.useRef(null),re=a.useCallback(t=>{j||(_.current&&_.current.disconnect(),_.current=new IntersectionObserver(r=>{r[0].isIntersecting&&T&&I(n=>n+1)}),t&&_.current.observe(t))},[j,T]),O=()=>{I(1),f([]),B(!0),z(new Set),R(!1),b()},ne=()=>{O()},W=t=>{S||(U(t),A(!0))},J=()=>{R(!S),z(new Set)},K=t=>{z(r=>{const n=new Set(r);return n.has(t)?n.delete(t):n.add(t),n})},ie=()=>{z(new Set(o.map(t=>t.id)))},ce=()=>{z(new Set)},oe=t=>{C(r=>(t==="all"?r.delete("fileType"):r.set("fileType",t),r))},de=async()=>{if(g.size===0){x.error("No files selected");return}E(!0);let t=0,r=0;try{await Promise.all(Array.from(g).map(async n=>{var k;try{const y=await te.post(`${X}/${ae.softDelete}`,{uniqueId:n},{headers:{Authorization:`Bearer ${N}`}});((k=y==null?void 0:y.data)==null?void 0:k.status)===!0?t++:r++}catch{r++}})),t>0&&(x.success(`Moved ${t} file(s) to trash!`,{icon:"ðŸ—‘ï¸"}),O()),r>0&&x.error(`Failed to delete ${r} file(s)`)}catch{x.error("Bulk delete failed")}finally{E(!1)}},Q=t=>{x.success(`Backup started for ${t.name}`,{icon:"â˜ï¸"})};return e.jsxs(G,{fixed:!0,className:"h-full overflow-hidden",children:[e.jsx(G.Header,{className:"relative border-b-0",children:e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ye,{}),e.jsx(ve,{}),e.jsx(we,{})]})}),e.jsxs(G.Body,{className:"flex-1 overflow-y-auto md:overflow-y-auto pt-0",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between space-y-2 sticky top-0 bg-secondary/95 backdrop-blur z-20 py-2 border-b",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground mb-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Se,{size:14})," Home"]}),e.jsx(Ne,{size:14}),e.jsx("span",{className:"font-semibold text-foreground",children:"All Documents"})]}),e.jsxs("h2",{className:"text-2xl font-bold tracking-tight",children:["All Documents (",((Z=c==null?void 0:c.pagination)==null?void 0:Z.totalDocuments)||0,")",c!=null&&c.size?e.jsxs("span",{className:"text-lg font-normal text-muted-foreground ml-2",children:["(",c.size.gb," GB / ",c.size.mb," MB)"]}):""]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative w-full max-w-sm",children:[e.jsx(Ae,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(be,{type:"search",placeholder:"Search by Unique ID...",className:"pl-8 h-9 w-[150px] lg:w-[250px]",value:s,onChange:t=>l(t.target.value)})]}),S?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[g.size," selected"]}),e.jsx(h,{onClick:ie,variant:"outline",size:"sm",children:"Select All"}),e.jsx(h,{onClick:ce,variant:"outline",size:"sm",children:"Deselect All"}),e.jsxs(h,{onClick:de,variant:"destructive",size:"sm",disabled:g.size===0||M,children:[M?e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}):"Delete ",!M&&`(${g.size})`]}),e.jsx(h,{onClick:J,variant:"ghost",size:"sm",children:e.jsx(se,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-[120px]",children:e.jsxs(De,{value:d,onValueChange:oe,children:[e.jsx(Ce,{className:"h-9",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx(Fe,{placeholder:"File Type"})]})}),e.jsxs(ze,{children:[e.jsx(m,{value:"all",children:"All Files"}),e.jsx(m,{value:"pdf",children:"PDF"}),e.jsx(m,{value:"jpeg",children:"JPEG/JPG"}),e.jsx(m,{value:"png",children:"PNG"}),e.jsx(m,{value:"webp",children:"WEBP"}),e.jsx(m,{value:"docx",children:"DOCX"}),e.jsx(m,{value:"txt",children:"TXT"}),e.jsx(m,{value:"excel",children:"EXCEL"}),e.jsx(m,{value:"ppt",children:"PPT"}),e.jsx(m,{value:"zip",children:"ZIP"}),e.jsx(m,{value:"rar",children:"RAR"})]})]})}),e.jsx(h,{onClick:J,variant:"outline",size:"sm",children:"Select"}),e.jsx(h,{onClick:O,variant:"outline",size:"sm",children:"Refresh"}),e.jsxs(h,{onClick:()=>F(!0),size:"sm",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Upload"]})]})]})]}),e.jsxs("div",{className:"flex-1 min-h-0",id:"scrollable-content",children:[o.length===0&&j?e.jsx("div",{className:"flex items-center justify-center h-full min-h-[400px]",children:e.jsx(L,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 pb-4",children:[o.map((t,r)=>o.length===r+1?e.jsx("div",{ref:re,children:e.jsx(ee,{file:t,onPreview:W,onBackup:Q,onDeleteSuccess:O,selectionMode:S,isSelected:g.has(t.id),onSelect:K})},`${t.id}-${r}`):e.jsx(ee,{file:t,onPreview:W,onBackup:Q,onDeleteSuccess:O,selectionMode:S,isSelected:g.has(t.id),onSelect:K},`${t.id}-${r}`)),o.length===0&&!j&&e.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center h-64 text-muted-foreground",children:[e.jsx("h1",{className:"font-thin text-3xl",children:"ðŸ¤” Oops!"}),e.jsxs("p",{className:"text-xl font-thin mt-2",children:["No documents found ",d!=="all"?`matching '${d}'`:"","."]})]})]}),j&&o.length>0&&e.jsx("div",{className:"flex justify-center py-4 w-full",children:e.jsx(L,{className:"h-6 w-6 animate-spin text-primary/60"})}),!T&&o.length>0&&e.jsx("div",{className:"py-4 text-center text-xs text-muted-foreground w-full",children:"End of list"})]}),e.jsx(ke,{open:p,onOpenChange:A,file:q}),e.jsx($e,{open:$,onOpenChange:F,onUploadComplete:ne})]})]})}export{Oe as default};
