import{j as e}from"./mui-8e804a04.js";import{u as T,r as m,f as ne,a as te}from"./router-87042356.js";import{M as oe}from"./index-4e794517.js";import"./RazorpayPaymentScreen-2bf023de.js";import{W as E}from"./WaterApiList-e2feff6c.js";import{i as le}from"./success-39308b33.js";import{l as G,c as ie,d as W,u as re,A as F,R as X,b as ce,N as Q}from"./index-26b92597.js";import{a as ae}from"./axios-97164839.js";import{a as D}from"./index.esm-2e3a7c1f.js";import{a as ee}from"./index.esm-e8e486ac.js";import{U as se}from"./UseRazorpay-62e4000a.js";const de="/assets/pending-daaf9508.png",me=i=>{var B,V,$,L,U,q,Y,H,J,Z;const{handlePayment:R}=se(),y=T(),[_,u]=m.useState(!1),[n,N]=m.useState(!1),[t,O]=m.useState(""),{notify:k}=m.useContext(G),{api_WaterGetDetailsById:d,header:I,api_rzpWaterOrderId:p,api_generatedreceipt:v}=E(),r=i==null?void 0:i.paymentData;console.log("props paymentData==>>",r);const f=s=>{if(!(s==null||s==""))return JSON.parse(s)},C=ie({isInstallment:W().required("Require"),installment:W().when([],{is:()=>o.values.isInstallment=="yes",then:W().required("Select Installment")})}),o=re({enableReinitialize:!0,initialValues:{isInstallment:"no",installment:""},onSubmit:s=>{h(s)},validationSchema:C}),P=s=>{var b,M,z;const c=s.target.name,a=s.target.value;console.log("name",c,"vlue",a),a=="no"&&(console.log("Done.."),o.setFieldValue("installment","")),c=="installment"&&((b=f(a))==null?void 0:b.amount)==Number((M=t==null?void 0:t.calculation)==null?void 0:M.penalty)&&((z=t==null?void 0:t.calculation)==null?void 0:z.paidStatus)!=1&&(o.setFieldValue("installment",""),o.setFieldValue("isInstallment","no"))},w=()=>{i.closeModal()};m.useEffect(()=>{var s,c;((s=t==null?void 0:t.calculation)==null?void 0:s.paidStatus)==1&&((c=t==null?void 0:t.calculation)==null?void 0:c.chargeCatagoryId)==2&&o.setFieldValue("isInstallment","yes")},[t]);const l=()=>{var s;N(!0),console.log("before fetch property details in deactivation"),ae.post(d,{applicationId:(s=r==null?void 0:r.connectionCharges)==null?void 0:s.applicationId},I).then(function(c){console.log("view water details by id...",c.data.data),O(c.data.data),N(!1)}).catch(function(c){console.log("==2 details by id error...",c),N(!1),k("Something Went Wrong","error")})};m.useEffect(()=>{l()},[r]);const j=async s=>{console.log("generateReceipt",s),console.log(s);let c={applicationId:s==null?void 0:s.applicationId,departmentId:s==null?void 0:s.departmentId,status:"",captured:"1",card_id:"",amount:s==null?void 0:s.amount,payment_method:"upi/netbanking",workflow_id:s==null?void 0:s.workflowId,user_id:s==null?void 0:s.userId,ulb_id:s==null?void 0:s.ulbId,payment_order_id:s==null?void 0:s.razorpay_order_id,payment_id:s==null?void 0:s.razorpay_payment_id,created_at:""};console.log("Receipt",s),F.post(v,c,I).then(a=>{var b;console.log("genereted receipt",a),a.data.status==!0?(console.log("Oder ID Generated ++++dddddddddddddddddddddddd+++++",a.data),y(`/waterConnReceipt/${(b=a==null?void 0:a.data)==null?void 0:b.data}`,{replace:!0})):toast.error(a.data.message,"error")}).catch(a=>{console.log("Error genrating order id",a),toast.error(a.message,"error")})},h=s=>{var b,M,z;let c;s.isInstallment=="yes"&&(c=((b=f(s==null?void 0:s.installment))==null?void 0:b.ids).split(","));const a={id:(M=r==null?void 0:r.connectionCharges)==null?void 0:M.applicationId,applycationType:(z=r==null?void 0:r.connectionCharges)==null?void 0:z.type,isInstallment:s.isInstallment,penaltyIds:c};console.log("payment function hit..",a),u(!0),F.post(p,a,I).then(g=>{var K;console.log("Oder ID Generated",g),u(!1),g.data.status==!0?(console.log("done==>>",g),R((K=g==null?void 0:g.data)==null?void 0:K.data,j),i.closeModal(!0),y("/water-dashboard")):k(g.data.message,"error")}).catch(g=>{u(!1),console.log("Error generating order id",g),k(g.message,"error")})},x=s=>s==NaN||s==null?0:s;let S=0,A;return o.values.isInstallment=="yes"&&(A=0),o.values.isInstallment=="no"&&(A=Number((B=t==null?void 0:t.calculation)==null?void 0:B.penalty)/10),e.jsx(e.Fragment,{children:e.jsx("form",{onSubmit:o.handleSubmit,onChange:P,children:e.jsxs("div",{className:"bg-white #789fde shadow-2xl border border-red-200 p-5 rounded-md",children:[e.jsx("p",{onClick:w,className:"float-right absolute right-6 top-6 hover:bg-gray-300 bg-gray-200 p-1 cursor-pointer",children:e.jsx(D,{})}),e.jsxs("div",{className:"border-b-2  pl-3 font-semibold border-red-400 flex",children:[e.jsx(ee,{size:20,className:"mt-0.5 mr-1"}),"Regularization Payment"]}),e.jsx("p",{className:"text-center text-green-800 font-semibold",children:"Note: 10% rebate on penalty in case the whole penalty is paid"}),e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("img",{src:"https://img.freepik.com/free-vector/hand-holding-phone-with-credit-card-screen-man-making-purchase-shopping-paying-online-using-banking-app-flat-vector-illustration-transaction-e-commerce-concept_74855-26014.jpg?w=1380&t=st=1686898919~exp=1686899519~hmac=4b0ddb44860ec647fa33a1a0416ea0c1cc8167693a13fdba3f09058d099f0e76",alt:"My Image",width:200,height:100})}),e.jsxs("div",{className:"flex items-center px-10",children:[e.jsx("div",{className:"font-semibold text-lg text-gray-500",children:e.jsx("p",{children:"Application No.-"})}),e.jsx("p",{className:"font-semibold text-lg text-gray-500",children:(V=r==null?void 0:r.connectionCharges)==null?void 0:V.applicationNo})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-lg text-green-500",children:e.jsx("p",{children:"Total Amount ₹-"})}),e.jsxs("p",{className:"font-semibold text-lg text-green-500",children:[o.values.isInstallment==="yes"&&Number(($=t==null?void 0:t.calculation)==null?void 0:$.connectionFee)+Number(x((L=f(o.values.installment))==null?void 0:L.amount))-A,o.values.isInstallment==="no"&&Number((U=t==null?void 0:t.calculation)==null?void 0:U.connectionFee)+Number((q=t==null?void 0:t.calculation)==null?void 0:q.penalty)-A]})]}),e.jsxs("div",{className:"grid grid-cols-12 px-4 py-2 text-sm gap-y-2",children:[e.jsx("div",{className:"col-span-12 mt-2 text-gray-800",children:e.jsxs("div",{className:"grid grid-cols-12 text-base rounded",children:[e.jsxs("div",{className:"col-span-6 space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Payment For:"})," ",(Y=t==null?void 0:t.calculation)==null?void 0:Y.chargeCatagory]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Connection Fee:"})," ₹"," ",(H=t==null?void 0:t.calculation)==null?void 0:H.connectionFee]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Penalty:"})," ₹"," ",(J=t==null?void 0:t.calculation)==null?void 0:J.penalty]})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsxs("p",{className:"font-semibold",children:["Rebate: ₹ ",A]}),e.jsx("div",{className:"flex",children:e.jsxs("div",{children:[e.jsxs("label",{children:[e.jsx("span",{className:"font-semibold",children:"Installment Payment"}),e.jsx("input",{type:"radio",name:"isInstallment",value:"yes",checked:o.values.isInstallment==="yes",onChange:o.handleChange,onBlur:o.handleBlur}),"Yes",e.jsx("input",{type:"radio",name:"isInstallment",value:"no",checked:o.values.isInstallment==="no",onChange:o.handleChange,onBlur:o.handleBlur,disabled:((Z=t==null?void 0:t.calculation)==null?void 0:Z.paidStatus)===1}),"No"]}),e.jsx("p",{className:"text-red-500 text-xs font-semibold",children:o.touched.isInstallment&&o.errors.isInstallment?o.errors.isInstallment:null})]})}),e.jsxs("div",{className:`${o.values.isInstallment==="no"?"opacity-50":""} flex gap-2 disabled:opacity-60`,children:[e.jsx("p",{className:"font-semibold",children:"Select Installment"}),e.jsxs("select",{onChange:o.handleChange,disabled:o.values.isInstallment==="no",value:o.values.installment,name:"installment",className:"disabled:opacity-60 disabled:border-0 border border-gray-800 rounded shadow text-sm h-6",children:[e.jsx("option",{value:"",children:"Select"}),t&&(t==null?void 0:t.penaltyInstallments.map((s,c)=>(S+=Number(s.balance_amount),e.jsx("option",{value:JSON.stringify({ids:s.ids,amount:S}),children:S},c))))]})]}),e.jsx("p",{className:"text-red-500 text-xs text-center font-semibold",children:o.touched.installment&&o.errors.installment?o.errors.installment:null})]})]})}),e.jsx("div",{className:"col-span-12 mt-2",children:e.jsx("div",{className:"text-center font-light rounded",children:e.jsx("p",{children:"Note: You can pay using Card / UPI / Netbanking / Wallet etc."})})}),e.jsx("div",{className:"col-span-12 mt-2",children:e.jsx("div",{className:"flex justify-center",children:_?e.jsx(X,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"30",visible:!0}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i.closeModal,className:"mx-3 bg-red-600 hover:bg-red-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm rounded-sm shadow-xl",children:"Cancel"}),e.jsx("button",{type:"submit",className:"mx-3 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm rounded-sm shadow-xl",children:"Pay Now"})]})})})]})]})})})},he=i=>{var f,C,o,P,w;const{handlePayment:R}=se(),y=T(),[_,u]=m.useState(!1);m.useState();const n=i==null?void 0:i.paymentData,{id:N}=ne(),{notify:t}=m.useContext(G),{api_rzpWaterOrderId:O,api_getTranNo:k,header:d,api_generatedreceipt:I}=E(),p=()=>{i.closeModal()},v=async l=>{console.log("generateReceipt",l),console.log(l);let j={applicationId:l==null?void 0:l.applicationId,departmentId:l==null?void 0:l.departmentId,status:"",captured:"1",card_id:"",amount:l==null?void 0:l.amount,payment_method:"upi/netbanking",workflow_id:l==null?void 0:l.workflowId,user_id:l==null?void 0:l.userId,ulb_id:l==null?void 0:l.ulbId,payment_order_id:l==null?void 0:l.razorpay_order_id,payment_id:l==null?void 0:l.razorpay_payment_id,created_at:""};console.log("Receipt",l),F.post(I,j,ce()).then(h=>{console.log("genereted receipt",h),h.data.status==!0?(console.log("Oder ID Generated ++++dddddddddddddddddddddddd+++++",h.data),y(`/application-payment-history/${N}`,{replace:!0})):Q.error(h.data.message,"error")}).catch(h=>{console.log("Error genrating order id",h),Q.error(h.message,"error")})},r=()=>{var j,h;u(!0);const l={id:(j=n==null?void 0:n.connectionCharges)==null?void 0:j.applicationId,applycationType:(h=n==null?void 0:n.connectionCharges)==null?void 0:h.type};console.log("Payment Button Clicked..",l),F.post(O,l,d).then(x=>{var S;console.log("Oder ID Generated",x),u(!1),x.data.status==!0?(R((S=x==null?void 0:x.data)==null?void 0:S.data,v),i.closeModal(),y("/water-dashboard")):t(x.data.message,"error")}).catch(x=>{u(!1),console.log("Error genrating order id",x),t(x.message,"error")})};return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("p",{onClick:p,className:"float-right absolute right-12 top-12 hover:bg-gray-300 bg-gray-200 p-1 cursor-pointer",children:[" ",e.jsx(D,{})," "]}),e.jsxs("div",{className:"bg-white shadow-2xl border border-blue-200 md:p-5 md:m-5 rounded-md",children:[e.jsxs("div",{className:" border-b-2 py-1 pl-3 font-semibold border-red-400 flex",children:[e.jsx(ee,{size:20,className:"mt-0.5 mr-1"}),"Make Payment"," "]}),e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("img",{src:"https://img.freepik.com/free-vector/hand-holding-phone-with-credit-card-screen-man-making-purchase-shopping-paying-online-using-banking-app-flat-vector-illustration-transaction-e-commerce-concept_74855-26014.jpg?w=1380&t=st=1686898919~exp=1686899519~hmac=4b0ddb44860ec647fa33a1a0416ea0c1cc8167693a13fdba3f09058d099f0e76",alt:"My Image",width:200,height:100})}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-2xl text-gray-500",children:e.jsx("p",{children:"Application No:-"})}),e.jsx("p",{className:"font-semibold text-2xl text-gray-500",children:(f=n==null?void 0:n.connectionCharges)==null?void 0:f.applicationNo})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-2xl text-green-500",children:e.jsx("p",{children:"Amount-Rs:"})}),e.jsx("p",{className:"font-semibold text-2xl text-green-500",children:((C=n==null?void 0:n.connectionCharges)==null?void 0:C.amount)||"N/A"})]}),e.jsx("h1",{className:"text-center font-semibold",children:"Amount Breakup"}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"col-span-3 ",children:[e.jsxs("h1",{children:["Payment For : ",(o=n==null?void 0:n.connectionCharges)==null?void 0:o.charge_category]}),e.jsxs("h1",{children:["Penalty : ₹ ",(P=n==null?void 0:n.connectionCharges)==null?void 0:P.penalty]}),e.jsxs("h1",{children:["Connection Fee : ₹ ",(w=n==null?void 0:n.connectionCharges)==null?void 0:w.conn_fee]})]})}),e.jsx("div",{className:"md:col-span-12 col-span-12 md:mt-5 mt-2",children:e.jsx("div",{className:"text-center font-extralight px-2 rounded",children:e.jsx("p",{children:"Note : You can pay using Card / UPI / Netbanking / Wallet etc."})})}),e.jsx("div",{className:"col-span-12 md:mt-5 mt-2 max-sm:mb-2",children:e.jsx("div",{className:"flex justify-center",children:_?e.jsx(X,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"30",visible:!0}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:p,className:"mx-3 bg-red-600 hover:bg-red-700 transition duration-200 hover:scale-105 font-normal text-white px-6 py-2 text-sm rounded-sm shadow-xl",children:"Cancel"}),e.jsx("button",{onClick:r,className:"mx-3 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-5 py-2 text-sm  rounded-sm shadow-xl",children:"Pay Now"})]})})})]})]})})},xe={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",background:"transparent",border:"none"}};function we(i){var r,f,C;const[R,y]=te.useState(!1),[_,u]=m.useState(!1),[n,N]=m.useState(),[t,O]=m.useState(),k=T();m.useContext(G),E();const d=i.paymentData;console.log("paymentData==>",d),m.useEffect(()=>{y(!0)},[]);function I(){}function p(){y(!1),u(!1),N(!1),O(!1),i==null||i.openPaymentModal(!1)}const v=o=>{var w,l,j;o!=null&&o.status&&u(!0),console.log("fetchTransactionDetails",o);const P={orderId:(w=o==null?void 0:o.data)==null?void 0:w.razorpay_order_id,paymentId:(l=o==null?void 0:o.data)==null?void 0:l.razorpay_payment_id,signature:(j=o==null?void 0:o.data)==null?void 0:j.razorpay_signature};console.log("payload",P)};return e.jsx("div",{className:"",children:e.jsxs(oe,{isOpen:R,onAfterOpen:I,onRequestClose:p,style:xe,contentLabel:"Example Modal",children:[_&&e.jsxs("div",{className:`${n?"bg-green-200":"bg-yellow-50"} shadow-2xl border border-sky-200 md:p-5 md:m-5 rounded-md`,children:[e.jsxs("div",{className:"flex justify-center",children:[n&&e.jsx("img",{src:le,className:"h-16",alt:"Payment Success",srcset:""}),!n&&e.jsx("img",{src:de,className:"h-12",alt:"Payment Pending",srcset:""})]}),e.jsxs("div",{className:"py-1 pl-3 font-semibold text-center text-2xl text-gray-800",children:[n?"Payment Completed Successfully":"Payment Under Processing"," "]}),(n==null?void 0:n.transectionNo)&&e.jsxs("p",{className:"text-center",children:[e.jsx("span",{className:"text-base",children:" Payment Transaction No"})," ",e.jsx("span",{className:"font-bold text-blue-700 text-xl",children:n==null?void 0:n.transectionNo})]}),!(n!=null&&n.transectionNo)&&e.jsxs("p",{className:"text-center font-semibold",children:[e.jsx("span",{className:"text-base",children:" Payment Status"})," ",e.jsx("span",{className:" text-blue-500 text-base",children:"Pending"})]}),e.jsx("p",{className:"border-b border-gray-300 mx-10 py-1"}),e.jsxs("div",{className:"grid grid-cols-12 px-8 py-3 leading-8 space-x-8 text-sm",children:[e.jsx("div",{className:"md:col-span-6 col-span-12",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"col-span-6 font-semibold",children:[e.jsx("p",{children:"Application No"}),e.jsx("p",{children:"Transaction Type"})]}),e.jsxs("div",{className:"col-span-6 ml-3",children:[e.jsx("p",{children:((r=d==null?void 0:d.connectionCharges)==null?void 0:r.applicationNo)||"NA"}),e.jsx("p",{children:((f=d==null?void 0:d.connectionCharges)==null?void 0:f.charge_category)||"NA"})]})]})}),e.jsx("div",{className:"md:col-span-6 col-span-12",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"col-span-6 font-semibold",children:[e.jsx("p",{children:"Amount"}),e.jsx("p",{children:"Payment Date"})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsx("p",{children:(n==null?void 0:n.amount)||((C=d==null?void 0:d.connectionCharges)==null?void 0:C.amount)}),e.jsx("p",{children:(n==null?void 0:n.transectionDate)||"Pending"})]})]})}),e.jsx("div",{className:"col-span-12 md:mt-4 mt-10",children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx("button",{onClick:p,className:"mx-2 bg-sky-600 hover:bg-sky-700 transition duration-200 hover:scale-105 font-normal text-white px-6 py-1 text-sm rounded-sm shadow-xl",children:"Dashboard"}),n&&e.jsx("button",{onClick:()=>k(`/waterConnReceipt/${n==null?void 0:n.transectionNo}`),className:"mx-2 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm  rounded-sm shadow-xl",children:"View Receipt"}),!n&&e.jsx("button",{onClick:()=>v(),className:"mx-2 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm  rounded-sm shadow-xl",children:"Check Status"})]})})]})]}),!_&&((i==null?void 0:i.category)=="Regulaization"?e.jsx(me,{closeModal:p,fetchTransactionDetails:v,paymentData:d}):e.jsx(he,{closeModal:p,fetchTransactionDetails:v,paymentData:d}))]})})}export{we as W};
