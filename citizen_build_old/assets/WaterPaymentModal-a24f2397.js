import{j as e}from"./mui-376c770d.js";import{u as z,r as d,a as X}from"./router-87042356.js";import{M as D}from"./index-d22e5223.js";import{R as J}from"./RazorpayPaymentScreen-a218a938.js";import{W as A}from"./WaterApiList-2e0b6bb6.js";import{i as ee}from"./success-39308b33.js";import{l as T,c as se,d as M,u as ne,A as H,R as Z}from"./index-f75e40c0.js";import{a as te}from"./axios-97164839.js";import{a as K}from"./index.esm-2e3a7c1f.js";import{a as Q}from"./index.esm-e8e486ac.js";const le="/assets/pending-daaf9508.png",oe=o=>{var W,E,G,B,V,L,q,$,U,Y;const P=z(),[N,x]=d.useState(!1),[R,n]=d.useState(!1),[s,v]=d.useState(""),{notify:g}=d.useContext(T),{api_WaterGetDetailsById:F,header:r,api_rzpWaterOrderId:I}=A(),a=o==null?void 0:o.paymentData;console.log("props paymentData==>>",a);const u=l=>{if(!(l==null||l==""))return JSON.parse(l)},j=se({isInstallment:M().required("Require"),installment:M().when([],{is:()=>t.values.isInstallment=="yes",then:M().required("Select Installment")})}),t=ne({enableReinitialize:!0,initialValues:{isInstallment:"no",installment:""},onSubmit:l=>{b(l)},validationSchema:j}),y=l=>{var k,O,_;const c=l.target.name,w=l.target.value;console.log("name",c,"vlue",w),w=="no"&&(console.log("Done.."),t.setFieldValue("installment","")),c=="installment"&&((k=u(w))==null?void 0:k.amount)==Number((O=s==null?void 0:s.calculation)==null?void 0:O.penalty)&&((_=s==null?void 0:s.calculation)==null?void 0:_.paidStatus)!=1&&(t.setFieldValue("installment",""),t.setFieldValue("isInstallment","no"))},i=()=>{o.closeModal()};d.useEffect(()=>{var l,c;((l=s==null?void 0:s.calculation)==null?void 0:l.paidStatus)==1&&((c=s==null?void 0:s.calculation)==null?void 0:c.chargeCatagoryId)==2&&t.setFieldValue("isInstallment","yes")},[s]);const C=()=>{var l;n(!0),console.log("before fetch property details in deactivation"),te.post(F,{applicationId:(l=a==null?void 0:a.connectionCharges)==null?void 0:l.applicationId},r).then(function(c){console.log("view water details by id...",c.data.data),v(c.data.data),n(!1)}).catch(function(c){console.log("==2 details by id error...",c),n(!1),g("Something Went Wrong","error")})};d.useEffect(()=>{C()},[a]);const m=l=>{console.log("Payment Status =>",l),(l==null?void 0:l.status)==!0?(o.fetchTransactionDetails(l),o.success(10),g("Payment Successful","success")):g("Payment Failed","error")},b=l=>{var k,O,_;let c;l.isInstallment=="yes"&&(c=((k=u(l==null?void 0:l.installment))==null?void 0:k.ids).split(","));const w={id:(O=a==null?void 0:a.connectionCharges)==null?void 0:O.applicationId,applycationType:(_=a==null?void 0:a.connectionCharges)==null?void 0:_.type,isInstallment:l.isInstallment,penaltyIds:c};console.log("payment function hit..",w),x(!0),H.post(I,w,r).then(f=>{console.log("Oder ID Generated",f),x(!1),f.data.status==!0?(console.log("done==>>",f),J(f.data.data,m),o.closeModal(!0),P("/water-dashboard")):g(f.data.message,"error")}).catch(f=>{x(!1),console.log("Error generating order id",f),g(f.message,"error")})},p=l=>l==NaN||l==null?0:l;let h=0,S;return t.values.isInstallment=="yes"&&(S=0),t.values.isInstallment=="no"&&(S=Number((W=s==null?void 0:s.calculation)==null?void 0:W.penalty)/10),e.jsx(e.Fragment,{children:e.jsx("form",{onSubmit:t.handleSubmit,onChange:y,children:e.jsxs("div",{className:"bg-white #789fde shadow-2xl border border-red-200 p-5 rounded-md",children:[e.jsx("p",{onClick:i,className:"float-right absolute right-6 top-6 hover:bg-gray-300 bg-gray-200 p-1 cursor-pointer",children:e.jsx(K,{})}),e.jsxs("div",{className:"border-b-2  pl-3 font-semibold border-red-400 flex",children:[e.jsx(Q,{size:20,className:"mt-0.5 mr-1"}),"Regularization Payment"]}),e.jsx("p",{className:"text-center text-green-800 font-semibold",children:"Note: 10% rebate on penalty in case the whole penalty is paid"}),e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("img",{src:"https://img.freepik.com/free-vector/hand-holding-phone-with-credit-card-screen-man-making-purchase-shopping-paying-online-using-banking-app-flat-vector-illustration-transaction-e-commerce-concept_74855-26014.jpg?w=1380&t=st=1686898919~exp=1686899519~hmac=4b0ddb44860ec647fa33a1a0416ea0c1cc8167693a13fdba3f09058d099f0e76",alt:"My Image",width:200,height:100})}),e.jsxs("div",{className:"flex items-center px-10",children:[e.jsx("div",{className:"font-semibold text-lg text-gray-500",children:e.jsx("p",{children:"Application No.-"})}),e.jsx("p",{className:"font-semibold text-lg text-gray-500",children:(E=a==null?void 0:a.connectionCharges)==null?void 0:E.applicationNo})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-lg text-green-500",children:e.jsx("p",{children:"Total Amount ₹-"})}),e.jsxs("p",{className:"font-semibold text-lg text-green-500",children:[t.values.isInstallment==="yes"&&Number((G=s==null?void 0:s.calculation)==null?void 0:G.connectionFee)+Number(p((B=u(t.values.installment))==null?void 0:B.amount))-S,t.values.isInstallment==="no"&&Number((V=s==null?void 0:s.calculation)==null?void 0:V.connectionFee)+Number((L=s==null?void 0:s.calculation)==null?void 0:L.penalty)-S]})]}),e.jsxs("div",{className:"grid grid-cols-12 px-4 py-2 text-sm gap-y-2",children:[e.jsx("div",{className:"col-span-12 mt-2 text-gray-800",children:e.jsxs("div",{className:"grid grid-cols-12 text-base rounded",children:[e.jsxs("div",{className:"col-span-6 space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Payment For:"})," ",(q=s==null?void 0:s.calculation)==null?void 0:q.chargeCatagory]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Connection Fee:"})," ₹"," ",($=s==null?void 0:s.calculation)==null?void 0:$.connectionFee]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Penalty:"})," ₹"," ",(U=s==null?void 0:s.calculation)==null?void 0:U.penalty]})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsxs("p",{className:"font-semibold",children:["Rebate: ₹ ",S]}),e.jsx("div",{className:"flex",children:e.jsxs("div",{children:[e.jsxs("label",{children:[e.jsx("span",{className:"font-semibold",children:"Installment Payment"}),e.jsx("input",{type:"radio",name:"isInstallment",value:"yes",checked:t.values.isInstallment==="yes",onChange:t.handleChange,onBlur:t.handleBlur}),"Yes",e.jsx("input",{type:"radio",name:"isInstallment",value:"no",checked:t.values.isInstallment==="no",onChange:t.handleChange,onBlur:t.handleBlur,disabled:((Y=s==null?void 0:s.calculation)==null?void 0:Y.paidStatus)===1}),"No"]}),e.jsx("p",{className:"text-red-500 text-xs font-semibold",children:t.touched.isInstallment&&t.errors.isInstallment?t.errors.isInstallment:null})]})}),e.jsxs("div",{className:`${t.values.isInstallment==="no"?"opacity-50":""} flex gap-2 disabled:opacity-60`,children:[e.jsx("p",{className:"font-semibold",children:"Select Installment"}),e.jsxs("select",{onChange:t.handleChange,disabled:t.values.isInstallment==="no",value:t.values.installment,name:"installment",className:"disabled:opacity-60 disabled:border-0 border border-gray-800 rounded shadow text-sm h-6",children:[e.jsx("option",{value:"",children:"Select"}),s&&(s==null?void 0:s.penaltyInstallments.map((l,c)=>(h+=Number(l.balance_amount),e.jsx("option",{value:JSON.stringify({ids:l.ids,amount:h}),children:h},c))))]})]}),e.jsx("p",{className:"text-red-500 text-xs text-center font-semibold",children:t.touched.installment&&t.errors.installment?t.errors.installment:null})]})]})}),e.jsx("div",{className:"col-span-12 mt-2",children:e.jsx("div",{className:"text-center font-light rounded",children:e.jsx("p",{children:"Note: You can pay using Card / UPI / Netbanking / Wallet etc."})})}),e.jsx("div",{className:"col-span-12 mt-2",children:e.jsx("div",{className:"flex justify-center",children:N?e.jsx(Z,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"30",visible:!0}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:o.closeModal,className:"mx-3 bg-red-600 hover:bg-red-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm rounded-sm shadow-xl",children:"Cancel"}),e.jsx("button",{type:"submit",className:"mx-3 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm rounded-sm shadow-xl",children:"Pay Now"})]})})})]})]})})})},ae=o=>{var j,t,y,i,C;const P=z(),[N,x]=d.useState(!1),[R,n]=d.useState(),s=o==null?void 0:o.paymentData,{notify:v}=d.useContext(T),{api_rzpWaterOrderId:g,api_getTranNo:F,header:r}=A(),I=()=>{o.closeModal()},a=m=>{console.log("Payment Status =>",m),m.status==!0&&(v("Payment Done successfully","success"),n({orderId:m.data.razorpay_order_id,paymentId:m.data.razorpay_payment_id}),o.fetchTransactionDetails(m),o==null||o.refechList())},u=()=>{var b,p;x(!0);const m={id:(b=s==null?void 0:s.connectionCharges)==null?void 0:b.applicationId,applycationType:(p=s==null?void 0:s.connectionCharges)==null?void 0:p.type};console.log("Payment Button Clicked..",m),H.post(g,m,r).then(h=>{console.log("Oder ID Generated",h),x(!1),h.data.status==!0?(J(h.data.data,a),o.closeModal(),P("/water-dashboard")):v(h.data.message,"error")}).catch(h=>{x(!1),console.log("Error genrating order id",h),v(h.message,"error")})};return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("p",{onClick:I,className:"float-right absolute right-12 top-12 hover:bg-gray-300 bg-gray-200 p-1 cursor-pointer ",children:[" ",e.jsx(K,{})," "]}),e.jsxs("div",{className:"bg-white shadow-2xl border border-blue-200 md:p-5 md:m-5 rounded-md",children:[e.jsxs("div",{className:" border-b-2 py-1 pl-3 font-semibold border-red-400 flex",children:[e.jsx(Q,{size:20,className:"mt-0.5 mr-1"}),"Make Payment"," "]}),e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("img",{src:"https://img.freepik.com/free-vector/hand-holding-phone-with-credit-card-screen-man-making-purchase-shopping-paying-online-using-banking-app-flat-vector-illustration-transaction-e-commerce-concept_74855-26014.jpg?w=1380&t=st=1686898919~exp=1686899519~hmac=4b0ddb44860ec647fa33a1a0416ea0c1cc8167693a13fdba3f09058d099f0e76",alt:"My Image",width:200,height:100})}),e.jsxs("div",{className:"flex items-center px-28",children:[e.jsx("div",{className:"font-semibold text-2xl text-gray-500",children:e.jsx("p",{children:"Application No.-"})}),e.jsx("p",{className:"font-semibold text-2xl text-gray-500",children:(j=s==null?void 0:s.connectionCharges)==null?void 0:j.applicationNo})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-2xl text-green-500",children:e.jsx("p",{children:"Amount-Rs"})}),e.jsx("p",{className:"font-semibold text-2xl text-green-500",children:((t=s==null?void 0:s.connectionCharges)==null?void 0:t.amount)||"N/A"})]}),e.jsx("h1",{className:"text-center font-semibold",children:"Amount Breakup"}),e.jsxs("div",{className:"grid grid-cols-6 px-24",children:[e.jsxs("div",{className:"col-span-3 ",children:[e.jsxs("h1",{children:["Payment For : ",(y=s==null?void 0:s.connectionCharges)==null?void 0:y.charge_category]}),e.jsxs("h1",{children:["Penalty : ₹ ",(i=s==null?void 0:s.connectionCharges)==null?void 0:i.penalty]})]}),e.jsx("div",{className:"col-span-3",children:e.jsxs("h1",{children:["Connection Fee : ₹ ",(C=s==null?void 0:s.connectionCharges)==null?void 0:C.conn_fee]})})]}),e.jsx("div",{className:"md:col-span-12 col-span-12 md:mt-5 mt-2",children:e.jsx("div",{className:"text-center font-extralight px-2 rounded",children:e.jsx("p",{children:"Note : You can pay using Card / UPI / Netbanking / Wallet etc."})})}),e.jsx("div",{className:"col-span-12 md:mt-5 mt-2",children:e.jsx("div",{className:"flex justify-center",children:N?e.jsx(Z,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"30",visible:!0}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:I,className:"mx-3 bg-red-600 hover:bg-red-700 transition duration-200 hover:scale-105 font-normal text-white px-6 py-2 text-sm rounded-sm shadow-xl",children:"Cancel"}),e.jsx("button",{onClick:u,className:"mx-3 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-5 py-2 text-sm  rounded-sm shadow-xl",children:"Pay Now"})]})})})]})]})})},ie={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",background:"transparent",border:"none"}};function ye(o){var j,t,y;const[P,N]=X.useState(!1),[x,R]=d.useState(!1),[n,s]=d.useState(),[v,g]=d.useState(),F=z();d.useContext(T),A();const r=o.paymentData;console.log("paymentData==>",r),d.useEffect(()=>{N(!0)},[]);function I(){}function a(){N(!1),R(!1),s(!1),g(!1),o==null||o.openPaymentModal(!1)}const u=i=>{var m,b,p;i!=null&&i.status&&R(!0),console.log("fetchTransactionDetails",i);const C={orderId:(m=i==null?void 0:i.data)==null?void 0:m.razorpay_order_id,paymentId:(b=i==null?void 0:i.data)==null?void 0:b.razorpay_payment_id,signature:(p=i==null?void 0:i.data)==null?void 0:p.razorpay_signature};console.log("payload",C)};return e.jsx("div",{className:"",children:e.jsxs(D,{isOpen:P,onAfterOpen:I,onRequestClose:a,style:ie,contentLabel:"Example Modal",children:[x&&e.jsxs("div",{className:`${n?"bg-green-200":"bg-yellow-50"} shadow-2xl border border-sky-200 md:p-5 md:m-5 rounded-md`,children:[e.jsxs("div",{className:"flex justify-center",children:[n&&e.jsx("img",{src:ee,className:"h-16",alt:"Payment Success",srcset:""}),!n&&e.jsx("img",{src:le,className:"h-12",alt:"Payment Pending",srcset:""})]}),e.jsxs("div",{className:"py-1 pl-3 font-semibold text-center text-2xl text-gray-800",children:[n?"Payment Completed Successfully":"Payment Under Processing"," "]}),(n==null?void 0:n.transectionNo)&&e.jsxs("p",{className:"text-center",children:[e.jsx("span",{className:"text-base",children:" Payment Transaction No"})," ",e.jsx("span",{className:"font-bold text-blue-700 text-xl",children:n==null?void 0:n.transectionNo})]}),!(n!=null&&n.transectionNo)&&e.jsxs("p",{className:"text-center font-semibold",children:[e.jsx("span",{className:"text-base",children:" Payment Status"})," ",e.jsx("span",{className:" text-blue-500 text-base",children:"Pending"})]}),e.jsx("p",{className:"border-b border-gray-300 mx-10 py-1"}),e.jsxs("div",{className:"grid grid-cols-12 px-8 py-3 leading-8 space-x-8 text-sm",children:[e.jsx("div",{className:"md:col-span-6 col-span-12",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"col-span-6 font-semibold",children:[e.jsx("p",{children:"Application No"}),e.jsx("p",{children:"Connection Type"})]}),e.jsxs("div",{className:"col-span-6 ml-3",children:[e.jsx("p",{children:(n==null?void 0:n.applicationNo)||((j=r==null?void 0:r.connectionCharges)==null?void 0:j.applicationNo)}),e.jsx("p",{children:(n==null?void 0:n.tranType)||((t=r==null?void 0:r.connectionCharges)==null?void 0:t.charge_category)})]})]})}),e.jsx("div",{className:"md:col-span-6 col-span-12",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"col-span-6 font-semibold",children:[e.jsx("p",{children:"Amount"}),e.jsx("p",{children:"Payment Date"})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsx("p",{children:(n==null?void 0:n.amount)||((y=r==null?void 0:r.connectionCharges)==null?void 0:y.amount)}),e.jsx("p",{children:(n==null?void 0:n.transectionDate)||"Pending"})]})]})}),e.jsx("div",{className:"col-span-12 md:mt-4 mt-10",children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx("button",{onClick:a,className:"mx-2 bg-sky-600 hover:bg-sky-700 transition duration-200 hover:scale-105 font-normal text-white px-6 py-1 text-sm rounded-sm shadow-xl",children:"Dashboard"}),n&&e.jsx("button",{onClick:()=>F(`/waterConnReceipt/${n==null?void 0:n.transectionNo}`),className:"mx-2 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm  rounded-sm shadow-xl",children:"View Receipt"}),!n&&e.jsx("button",{onClick:()=>u(),className:"mx-2 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm  rounded-sm shadow-xl",children:"Check Status"})]})})]})]}),!x&&((o==null?void 0:o.category)=="Regulaization"?e.jsx(oe,{closeModal:a,fetchTransactionDetails:u,paymentData:r}):e.jsx(ae,{closeModal:a,fetchTransactionDetails:u,paymentData:r}))]})})}export{ye as W};
