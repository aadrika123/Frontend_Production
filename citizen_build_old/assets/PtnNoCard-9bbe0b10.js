import{j as a}from"./mui-8bd1858b.js";import{r as i,u as te}from"./router-56e993c5.js";import{M as ae,z as le,c as oe,d as f,u as ne,D as ie,L as se,A as de,n as w,b as B,k as H,E as re}from"./index-edfb7014.js";import{a as M}from"./axios-ab7cc016.js";import"./reactIcons-d26c0b2d.js";import"./materialTailwind-d2bf7798.js";import"./moment-a9aaa855.js";/* empty css                */import"./redux-a3f69129.js";import"./i18next-2edfafb0.js";ae.setAppElement("#root");function ve(o){i.useState(!0);const[N,g]=i.useState(!1),[j,h]=i.useState(!1),[y,v]=i.useState(""),{api_sendMobileOtpAttachment:P,api_verifyHolding:ce,api_filterPropertyDetails:A,api_getAllUlb:F,header:k}=re(),{notify:b}=i.useContext(le);te();const[T,L]=i.useState(!1),[V,O]=i.useState(null),[z,D]=i.useState(""),[ue,q]=i.useState(""),[m,R]=i.useState([]),[W,$]=i.useState(""),[G,J]=i.useState([]),[x,S]=i.useState(!1),K=()=>{S(!0),de.get(F,{},k).then(t=>{var l,e;(l=t==null?void 0:t.data)!=null&&l.status?J(((e=t==null?void 0:t.data)==null?void 0:e.data)||[]):b("Failed to fetch ULB list","error")}).catch(t=>{console.log("Error while fetching ulb list",t),b("Error occurred while fetching ULB list","error")}).finally(()=>S(!1))};i.useEffect(()=>{K()},[]);const Q=oe({ptn:f(),holdingNo:f(),ulbId:f().required("Please select ULB")}),n=ne({initialValues:{ptn:"",holdingNo:"",ulbId:""},onSubmit:t=>{console.log("at submit form.....",t)},validationSchema:Q}),p=t=>{let l=t.target.name,e=t.target.value;l==="ulbId"&&($(e),n.setFieldValue("ulbId",e)),l=="ptn"?(n.setFieldValue("holdingNo",""),o==null||o.setholdingNo("")):l=="holdingNo"&&(n.setFieldValue("ptn",""),o==null||o.setptnNo("")),l=="ptn"&&n.setFieldValue("ptn",e),l=="holdingNo"&&n.setFieldValue("holdingNo",e),W!==""&&(l=="ptn"&&e.length>=14||l=="holdingNo"&&e.length>=14)||n.values.ulbId!==""&&(l=="ptn"&&e.length>=14||l=="holdingNo"&&e.length>=14)?h(!0):h(!1),y&&v("")},X=t=>{L(!1),g(!0),h(!1);let l;t.ptn.length==0?l={holdingNo:t.holdingNo,ulbId:t.ulbId}:l={ptNo:t.ptn,ulbId:t.ulbId},console.log("before send otp for attachment...",l),M.post(P,l,B()).then(e=>{var s,d,c,u;console.log("otp send for attachment response",e==null?void 0:e.data),(s=e==null?void 0:e.data)!=null&&s.status?(o==null||o.setpropertyAttachedMobileNo((c=(d=e==null?void 0:e.data)==null?void 0:d.data)==null?void 0:c.mobileNo),o==null||o.setptnCardStatus(!1),o==null||o.setotpCardStatus(!0)):r(!0,H((u=e==null?void 0:e.data)==null?void 0:u.message)),g(!1)}).catch(e=>{console.log("error otp send",e),b("Something went wrong in attachment...","error"),g(!1),r(!0,"Error occured. Please try again later."),h(!0)})},r=(t,l)=>{O(l),L(t)},Y=(t,l,e)=>{if(n.values.holdingNo==""&&n.values.ptn==""){r(!0,"Enter holding or pt no.");return}if(!n.values.ulbId||n.values.ulbId===""){r(!0,"Please select ULB.");return}console.log("attach holding => ",t,l,e),D(""),console.log("otp send..."),g(!0),h(!1),l?o==null||o.setholdingNo(l):o==null||o.setptnNo(t),X(n.values)},Z=[{Header:"Ward No.",accessor:"ward_name"},{Header:"Owner's Name",accessor:"owner_name"},{Header:"PT No.",accessor:"pt_no",Cell:({cell:t})=>a.jsx("span",{children:w(t.row.original.pt_no)})},{Header:"Holding No",accessor:"new_holding_no",Cell:({cell:t})=>a.jsx("span",{children:w(t.row.original.new_holding_no)})},{Header:"Mobile No",accessor:"mobile_no",Cell:({cell:t})=>a.jsx("span",{children:w(t.row.original.mobile_no)})},{Header:"Action",accessor:"id",Cell:({cell:t})=>a.jsx("button",{onClick:()=>{var l,e,s,d,c,u;return Y((e=(l=t==null?void 0:t.row)==null?void 0:l.original)==null?void 0:e.pt_no,(d=(s=t==null?void 0:t.row)==null?void 0:s.original)==null?void 0:d.new_holding_no,(u=(c=t==null?void 0:t.row)==null?void 0:c.original)==null?void 0:u.ulb_id)},className:"bg-indigo-500 px-3 py-1 rounded-lg shadow-lg hover:shadow-xl hover:bg-indigo-700 text-white",children:"Attach"})}],ee=()=>{var l;if(!n.values.ulbId||n.values.ulbId===""){v("Please select ULB.");return}let t;(l=Object.entries(n==null?void 0:n.values))==null||l.map(([e,s],d)=>{s!=""&&e!=="ulbId"&&(t={filteredBy:e,parameter:s,isLegacy:!1,page:1,perPage:100,ulbId:n.values.ulbId},q(e))}),g(!0),console.log("getting body => ",t),M.post(A,t,B()).then(e=>{var s,d,c,u,I,C,_,E,U;console.log("holding list => ",(d=(s=e==null?void 0:e.data)==null?void 0:s.data)==null?void 0:d.data),(c=e==null?void 0:e.data)!=null&&c.status?(R((I=(u=e==null?void 0:e.data)==null?void 0:u.data)==null?void 0:I.data),((E=(_=(C=e==null?void 0:e.data)==null?void 0:C.data)==null?void 0:_.data)==null?void 0:E.length)==0&&r(!0,"No Data Found !!!")):r(!0,H((U=e==null?void 0:e.data)==null?void 0:U.message))}).catch(e=>{console.log("error getting holding list => ",e),r(!0,"Error occurred while fetching data.")}).finally(()=>g(!1))};return a.jsxs(a.Fragment,{children:[T&&a.jsx(ie,{activateBottomErrorCard:r,errorTitle:V}),a.jsx("div",{class:"w-full sm:w-full  mx-auto",children:a.jsx("div",{class:"container mx-auto",children:a.jsxs("div",{class:"mx-auto flex flex-wrap gap-4 justify-center items-center",children:[a.jsx("div",{class:"w-max bg-white rounded text-center shadow-xl relative py-10 px-8",children:a.jsxs("div",{class:"",children:[a.jsx("button",{onClick:()=>o==null?void 0:o.closeModal(!1),type:"button",class:"absolute top-6 right-6 bg-transparent bg-gray-200 text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center shadow-sm  hover:bg-red-200 hover:border-none",children:a.jsx("svg",{class:"w-5 h-5",fill:"currentColor",children:a.jsx("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})})}),a.jsx("div",{class:"text-2xl font-bold px-10",children:"Enter Holding or PT no."}),a.jsx("div",{class:"flex flex-col mt-4 text-center",children:a.jsxs("span",{className:"text-center",children:["Select ULB and enter 14 digit PTN no, or Holding no.",a.jsx("br",{}),"to attach a property"]})}),a.jsx("div",{class:"flex flex-col mt-4 text-center",children:a.jsx("span",{className:"text-center text-red-400",children:z})}),a.jsx("div",{class:"flex flex-row justify-center text-center mt-5",children:a.jsxs("form",{onSubmit:n.handleSubmit,onChange:p,children:[a.jsxs("div",{className:"mb-4",children:[a.jsxs("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold w-full text-left",children:["Select ULB",a.jsx("span",{className:"text-red-600",children:"*"})]}),a.jsxs("div",{className:"relative",children:[a.jsxs("select",{name:"ulbId",value:n.values.ulbId,onChange:p,className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md appearance-none",disabled:x,children:[a.jsx("option",{value:"",children:x?"Loading ULBs...":"Select ULB"}),!x&&G.map(t=>a.jsx("option",{value:t.id,children:t.ulb_name||t.name},t.id))]}),x&&a.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-indigo-600"})})]}),n.touched.ulbId&&n.errors.ulbId&&a.jsx("div",{className:"text-red-500 text-xs mt-1",children:n.errors.ulbId})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold w-full text-left",children:["PTN",a.jsx("span",{className:"text-red-600",children:"*"})]}),a.jsx("input",{type:"text",...n.getFieldProps("ptn"),className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md"})]}),a.jsx("div",{className:"font-semibold text-indigo-500 mt-2",children:"Or"}),a.jsxs("div",{children:[a.jsxs("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold w-full text-left",children:["Holding No.",a.jsx("span",{className:"text-red-600",children:"*"})]}),a.jsx("input",{type:"text",...n.getFieldProps("holdingNo"),className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md"})]}),a.jsx("div",{className:"text-red-500 mt-4",children:y}),a.jsxs("div",{class:"w-full text-center mt-4",children:[j&&!x&&a.jsx("button",{type:"button",onClick:ee,disabled:N,className:"w-full  py-2.5 bg-indigo-600 text-white font-medium text-xs leading-tight  rounded shadow-md hover:bg-indigo-700 hover:shadow-lg focus:bg-indigo-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-indigo-800 active:shadow-lg transition duration-150 ease-in-out",children:N?"Fetching...":"Submit"}),(!j||x)&&a.jsx("button",{type:"button",className:"w-full  py-2.5 bg-gray-400 text-white font-medium text-xs leading-tight  rounded shadow-md  hover:shadow-lg  focus:shadow-lg focus:outline-none focus:ring-0  transition duration-150 ease-in-out cursor-default ",children:"Submit"})]})]})})]})}),(m==null?void 0:m.length)>0&&a.jsx("div",{class:"bg-white py-10 px-8 rounded text-center shadow-xl relative md:w-auto w-[97vw]",children:a.jsx(se,{dataList:m,columns:Z})})]})})})]})}export{ve as default};
