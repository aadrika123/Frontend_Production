import{k as e,v as s,w as a,r as i,j as r,B as t,A as n,z as l,e as o}from"./index-pyCvve81.js";import{D as c,e as d,f as m,h as x,i as j,E as h,P as u}from"./index-BN0jNiUj.js";import{C as p,a as v,b as f,c as g}from"./card-bx3Oa7DD.js";import{T as b,a as y,b as N,c as _,d as C,e as w}from"./table-vFocFjjc.js";import{C as k}from"./checkbox-BD1KnAu3.js";import{u as S,b as P}from"./useCustomQuery-B1PLu8pZ.js";import{P as R}from"./index-By2ZT1Is.js";import{S as A}from"./separator-DS4WD8aU.js";import{S as $}from"./Spinner-BDgO_yrk.js";import{B as I}from"./badge-Cy7OSyyd.js";import{A as V,a as z,b as q,c as E,d as F,e as B,f as D,g as L}from"./alert-dialog-DqRU8PY3.js";import{T}from"./textarea-BWM1CVcT.js";import{I as O}from"./input-DWARB5Y9.js";import{L as U}from"./label-D5MVRa8l.js";import{S as W,a as M,b as Q,c as Y,d as H}from"./select-BIraycn9.js";import{F as X}from"./file-check-B5rYJiE0.js";import{R as G}from"./refresh-cw-CuK8fDd8.js";import{C as J}from"./circle-check-big-BF6C8Vh9.js";import{C as K}from"./circle-x-CMuzPAjJ.js";import{C as Z}from"./circle-alert-bSz2ewqB.js";import{E as ee}from"./eye-DTo8qJux.js";import"./check-BHEPqzdD.js";
/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=e("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),ae=e=>{const s={pending:{variant:"secondary",icon:r.jsx(Z,{className:"mr-1 h-3 w-3"})},approved:{variant:"default",icon:r.jsx(J,{className:"mr-1 h-3 w-3"})},rejected:{variant:"destructive",icon:r.jsx(K,{className:"mr-1 h-3 w-3"})},needs_clarification:{variant:"outline",icon:r.jsx(Z,{className:"mr-1 h-3 w-3"})}},{variant:a,icon:i}=s[e]||s.pending;return r.jsxs(I,{variant:a,className:"flex items-center",children:[i,e.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())]})},ie=e=>null==e?"₹0":`₹${e.toLocaleString("en-IN")}`;function re(){var e,u,re;const{id:te}=s(),{user:ne}=a(),le=S({}),[oe,ce]=i.useState(1),[de]=i.useState(10),[me,xe]=i.useState("all"),[je,he]=i.useState(null),[ue,pe]=i.useState(!1),[ve,fe]=i.useState("approved"),[ge,be]=i.useState(""),[ye,Ne]=i.useState(""),[_e,Ce]=i.useState([]),[we,ke]=i.useState(!1),[Se,Pe]=i.useState("approved"),[Re,Ae]=i.useState(""),[$e,Ie]=i.useState(!1),[Ve,ze]=i.useState(!1),[qe,Ee]=i.useState(null),Fe=!te,Be=(null==ne?void 0:ne.ulbId)||localStorage.getItem("ulbId"),De=P({api:`${n.getInvestmentProofs}/${te}`,key:`getInvestmentProofs-${te}`,value:[oe,de,me,te],options:{enabled:!!te}}),Le=P({api:`${n.getPendingProofs}?ulb_id=${Be}&page=${oe}&limit=${de}${"all"!==me?`&status=${me}`:""}`,key:"getPendingProofs",value:[oe,de,me,Be],options:{enabled:Fe&&!!Be}}),Te=Fe?Le.isLoading:De.isLoading,Oe=Fe?((null==(e=Le.data)?void 0:e.data)||[]).map(e=>({...e.proof,employee:e.employee})):(null==(re=null==(u=De.data)?void 0:u.data)?void 0:re.proofs)||[],Ue=()=>{Fe?Le.refetch():De.refetch()},We="all"===me?Oe:Oe.filter(e=>e.verification_status===me),Me=Oe.filter(e=>"pending"===e.verification_status),Qe=(e,s)=>{he(e),fe(s),be(""),Ne(String(e.declared_amount)),pe(!0)};return r.jsxs("main",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50",children:[r.jsx(V,{open:ue,onOpenChange:pe,children:r.jsxs(z,{children:[r.jsxs(q,{children:[r.jsx(E,{children:"approved"===ve?"Approve Proof":"rejected"===ve?"Reject Proof":"Request Clarification"}),r.jsxs(F,{children:[null==je?void 0:je.section_code," - ",null==je?void 0:je.investment_type,r.jsx("br",{}),"Declared Amount: ",ie(null==je?void 0:je.declared_amount)]})]}),r.jsxs("div",{className:"space-y-4",children:["approved"===ve&&r.jsxs("div",{children:[r.jsx(U,{children:"Verified Amount"}),r.jsx(O,{type:"number",value:ye,onChange:e=>Ne(e.target.value),placeholder:"Enter verified amount"})]}),r.jsxs("div",{children:[r.jsx(U,{children:"approved"===ve?"Remarks (Optional)":"Remarks *"}),r.jsx(T,{value:ge,onChange:e=>be(e.target.value),placeholder:"needs_clarification"===ve?"What clarification is needed?":"rejected"===ve?"Reason for rejection":"Enter remarks...",required:"approved"!==ve})]})]}),r.jsxs(B,{children:[r.jsx(D,{children:"Cancel"}),r.jsx(L,{onClick:async()=>{var e,s,a;if(je)try{const i=await le.mutateAsync({api:`${n.verifyInvestmentProof}/${je.id}/verify`,data:{verification_status:ve,rejection_reason:"rejected"===ve?ge:void 0,clarification_request:"needs_clarification"===ve?ge:void 0,verified_amount:"approved"===ve?Number(ye):void 0,verified_by:null==ne?void 0:ne._id}});(null==(e=null==i?void 0:i.data)?void 0:e.success)?(Ue(),l.success((null==(s=null==i?void 0:i.data)?void 0:s.message)||`Proof ${ve} successfully`),pe(!1),Ce(e=>e.filter(e=>e!==je.id))):l.error((null==(a=i.data)?void 0:a.message)||"Failed to update proof")}catch(i){l.error(o(i))}},className:"rejected"===ve?"bg-destructive":"needs_clarification"===ve?"bg-orange-500":"",disabled:"approved"!==ve&&!ge.trim(),children:"Confirm"})]})]})}),r.jsx(V,{open:we,onOpenChange:ke,children:r.jsxs(z,{children:[r.jsxs(q,{children:[r.jsxs(E,{children:["Bulk ","approved"===Se?"Approve":"Reject"," Proofs"]}),r.jsxs(F,{children:["You are about to"," ","approved"===Se?"approve":"reject"," ",r.jsx("strong",{children:_e.length})," investment proof(s)."]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(U,{children:"Action"}),r.jsxs(W,{value:Se,onValueChange:e=>Pe(e),children:[r.jsx(M,{children:r.jsx(Q,{})}),r.jsxs(Y,{children:[r.jsx(H,{value:"approved",children:"Approve All"}),r.jsx(H,{value:"rejected",children:"Reject All"})]})]})]}),"rejected"===Se&&r.jsxs("div",{children:[r.jsx(U,{children:"Rejection Reason *"}),r.jsx(T,{value:Re,onChange:e=>Ae(e.target.value),placeholder:"Enter reason for rejection (applies to all selected)"})]})]}),r.jsxs(B,{children:[r.jsx(D,{children:"Cancel"}),r.jsx(L,{onClick:async()=>{var e,s,a,i,r;if(0!==_e.length){Ie(!0);try{const t=await le.mutateAsync({api:n.bulkVerifyProofs,data:{proof_ids:_e,verification_status:Se,verified_by:null==ne?void 0:ne._id,rejection_reason:"rejected"===Se?Re:void 0}});(null==(e=null==t?void 0:t.data)?void 0:e.success)?(l.success((null==(s=null==t?void 0:t.data)?void 0:s.message)||`${null==(i=null==(a=null==t?void 0:t.data)?void 0:a.data)?void 0:i.updatedCount} proofs ${Se} successfully`),Ue(),Ce([]),ke(!1),Ae("")):l.error((null==(r=null==t?void 0:t.data)?void 0:r.message)||"Failed to bulk verify proofs")}catch(t){l.error(o(t))}finally{Ie(!1)}}else l.error("Please select at least one proof")},className:"rejected"===Se?"bg-destructive":"",disabled:$e||"rejected"===Se&&!Re.trim(),children:$e?"Processing...":`${"approved"===Se?"Approve":"Reject"} ${_e.length} Proofs`})]})]})}),r.jsx(c,{open:Ve,onOpenChange:ze,children:r.jsxs(d,{children:[r.jsxs(m,{children:[r.jsx(x,{children:"Employee Response"}),r.jsxs(j,{children:["Response to clarification request for ",null==qe?void 0:qe.section_code," ","- ",null==qe?void 0:qe.investment_type]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(U,{className:"text-muted-foreground",children:"Clarification Request"}),r.jsx("p",{className:"mt-1 rounded-md bg-muted p-3 text-sm",children:(null==qe?void 0:qe.clarification_request)||"No request recorded"})]}),r.jsxs("div",{children:[r.jsx(U,{className:"text-muted-foreground",children:"Employee Response"}),r.jsx("p",{className:"mt-1 rounded-md bg-muted p-3 text-sm",children:(null==qe?void 0:qe.employee_response)||"No response yet"})]})]})]})}),r.jsx("div",{className:"space-y-6",children:r.jsxs(p,{className:"border border-gray-200 bg-white shadow-lg",children:[r.jsx(v,{className:"rounded-t-lg bg-gradient-to-r from-blue-600 to-indigo-600 text-white",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(X,{className:"h-6 w-6"}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-semibold",children:"Investment Proofs"}),r.jsx(f,{className:"mt-1 text-blue-100",children:te?`Proofs for Declaration #${te}`:"Review and verify employee investment proofs"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[_e.length>0&&r.jsxs(t,{variant:"secondary",onClick:()=>ke(!0),className:"bg-white text-blue-600 hover:bg-blue-50",children:[r.jsx(se,{className:"mr-2 h-4 w-4"}),"Bulk Verify (",_e.length,")"]}),r.jsxs(t,{variant:"outline",onClick:Ue,className:"border-blue-300 bg-blue-500/20 text-white hover:bg-blue-500/30",children:[r.jsx(G,{className:"mr-2 h-4 w-4"}),"Refresh"]})]})]})}),r.jsxs(g,{className:"p-6",children:[r.jsx("div",{className:"mb-6",children:r.jsx("div",{className:"flex flex-wrap items-center gap-4",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(W,{value:me,onValueChange:xe,children:[r.jsx(M,{className:"w-[180px]",children:r.jsx(Q,{placeholder:"Filter by Status"})}),r.jsxs(Y,{children:[r.jsx(H,{value:"all",children:"All Status"}),r.jsx(H,{value:"pending",children:"Pending"}),r.jsx(H,{value:"approved",children:"Approved"}),r.jsx(H,{value:"rejected",children:"Rejected"}),r.jsx(H,{value:"needs_clarification",children:"Needs Clarification"})]})]}),_e.length>0&&r.jsxs(I,{variant:"secondary",children:[_e.length," selected"]})]})})}),r.jsx(A,{className:"my-6"}),Te?r.jsx("div",{className:"flex items-center justify-center py-20",children:r.jsx($,{})}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-200",children:r.jsxs(b,{children:[r.jsx(y,{children:r.jsxs(N,{className:"bg-gray-50 hover:bg-gray-50",children:[r.jsx(_,{className:"w-[50px]",children:r.jsx(k,{checked:Me.length>0&&Me.every(e=>_e.includes(e.id)),onCheckedChange:e=>{Ce(e?Me.map(e=>e.id):[])},disabled:0===Me.length})}),r.jsx(_,{className:"w-16 font-semibold text-gray-700",children:"#"}),Fe&&r.jsx(_,{className:"font-semibold text-gray-700",children:"Employee"}),r.jsx(_,{className:"font-semibold text-gray-700",children:"Section"}),r.jsx(_,{className:"font-semibold text-gray-700",children:"Investment Type"}),r.jsx(_,{className:"font-semibold text-gray-700",children:"Declared"}),r.jsx(_,{className:"font-semibold text-gray-700",children:"Verified"}),r.jsx(_,{className:"font-semibold text-gray-700",children:"Document"}),r.jsx(_,{className:"font-semibold text-gray-700",children:"Status"}),r.jsx(_,{className:"text-center font-semibold text-gray-700",children:"Actions"})]})}),r.jsx(C,{children:We.length>0?We.map((e,s)=>{var a,i;return r.jsxs(N,{className:"transition-colors duration-150 hover:bg-blue-50/50",children:[r.jsx(w,{children:r.jsx(k,{checked:_e.includes(e.id),onCheckedChange:s=>((e,s)=>{Ce(s?s=>[...s,e]:s=>s.filter(s=>s!==e))})(e.id,s),disabled:"pending"!==e.verification_status})}),r.jsx(w,{className:"font-medium text-gray-600",children:(oe-1)*de+s+1}),Fe&&r.jsxs(w,{children:[r.jsx("div",{className:"font-medium text-gray-900",children:(null==(a=e.employee)?void 0:a.emp_name)||"N/A"}),r.jsx("div",{className:"text-xs text-muted-foreground",children:(null==(i=e.employee)?void 0:i.emp_code)||"N/A"})]}),r.jsx(w,{children:r.jsx(I,{variant:"outline",children:e.section_code})}),r.jsxs(w,{className:"font-medium text-gray-900",children:[e.investment_type,e.investment_description&&r.jsx("div",{className:"text-xs text-muted-foreground",children:e.investment_description})]}),r.jsx(w,{className:"font-medium",children:ie(e.declared_amount)}),r.jsx(w,{children:null!==e.verified_amount?ie(e.verified_amount):"-"}),r.jsx(w,{children:e.document_url?r.jsx(t,{variant:"ghost",size:"icon",asChild:!0,children:r.jsx("a",{href:e.document_url,target:"_blank",rel:"noreferrer",title:e.document_name||"View Document",children:r.jsx(h,{className:"h-4 w-4"})})}):"-"}),r.jsx(w,{children:r.jsxs("div",{className:"space-y-1",children:[ae(e.verification_status),e.rejection_reason&&r.jsx("p",{className:"text-xs text-destructive",children:e.rejection_reason})]})}),r.jsx(w,{children:r.jsxs("div",{className:"flex items-center justify-center gap-1",children:["pending"===e.verification_status&&r.jsxs(r.Fragment,{children:[r.jsx(t,{variant:"outline",size:"icon",title:"Approve",onClick:()=>Qe(e,"approved"),children:r.jsx(J,{className:"h-4 w-4 text-green-600"})}),r.jsx(t,{variant:"outline",size:"icon",title:"Reject",onClick:()=>Qe(e,"rejected"),children:r.jsx(K,{className:"h-4 w-4 text-destructive"})}),r.jsx(t,{variant:"outline",size:"icon",title:"Request Clarification",onClick:()=>Qe(e,"needs_clarification"),children:r.jsx(Z,{className:"h-4 w-4 text-orange-500"})})]}),"needs_clarification"===e.verification_status&&r.jsxs(r.Fragment,{children:[e.employee_response&&r.jsxs(r.Fragment,{children:[r.jsx(t,{variant:"outline",size:"icon",title:"Approve",onClick:()=>Qe(e,"approved"),children:r.jsx(J,{className:"h-4 w-4 text-green-600"})}),r.jsx(t,{variant:"outline",size:"icon",title:"Reject",onClick:()=>Qe(e,"rejected"),children:r.jsx(K,{className:"h-4 w-4 text-destructive"})})]}),r.jsx(t,{variant:"outline",size:"icon",title:"View Response",onClick:()=>(e=>{Ee(e),ze(!0)})(e),children:r.jsx(ee,{className:"h-4 w-4"})})]})]})})]},e.id)}):r.jsx(N,{children:r.jsx(w,{colSpan:Fe?10:9,className:"py-8 text-center text-gray-500",children:"No proofs found"})})})]})}),Fe&&r.jsxs("div",{className:"mt-6 flex items-center justify-between rounded-lg border border-gray-200 bg-gray-50 p-4",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",We.length," proofs"]}),r.jsx(R,{page:oe,setPage:ce,limit:de,totalPages:Math.ceil((Oe.length||1)/de)})]})]})]})]})})]})}function te(){return r.jsx(u,{title:"Investment Proofs",subTitle:"Verify employee investment proofs",children:r.jsx(re,{})})}export{te as default};
