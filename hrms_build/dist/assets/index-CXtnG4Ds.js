import{j as e,h as t,z as a,r as s,B as r,f as l}from"./index-pyCvve81.js";import{a as n,P as i}from"./index-BN0jNiUj.js";import{u as d,b as o}from"./useCustomQuery-B1PLu8pZ.js";import{a as c,o as m,c as x,b as u}from"./yup-C9jKbjb2.js";import{F as p,C as g}from"./datetime-picker-CYDyb3rk.js";import"./input-DWARB5Y9.js";import{B as h}from"./ButtonLoading-C9GHL4iQ.js";import{R as b}from"./RHFSelectField-C9SERau7.js";import"./switch-Br0yiZF5.js";import"./checkbox-BD1KnAu3.js";import"./label-D5MVRa8l.js";import{R as j}from"./DateAndTimePicker-CD_49ExZ.js";import{S as f}from"./separator-DS4WD8aU.js";import{D as y}from"./index-CDBXPzA7.js";import{C as v}from"./circle-check-DEfxAydn.js";import{C as N}from"./circle-x-CMuzPAjJ.js";import{C as w}from"./calendar-DxovkaVF.js";import{B as _}from"./briefcase-DX1QaJl1.js";import{S}from"./search-Zsj49TaG.js";import{F as k}from"./filter-C8VDeqtM.js";import{U as A}from"./users-Cn2MP30X.js";import{C}from"./chevron-right-CT2wJ-fK.js";import{C as D}from"./clock-DqQh3QaC.js";import"./select-BIraycn9.js";import"./check-BHEPqzdD.js";import"./format-BkNqQ0tt.js";import"./Spinner-BDgO_yrk.js";const T=x().shape({attendance_status:u().required("Attendance status is required"),emp_in_time:u().when("attendance_status",{is:e=>"1"===e||"2"===e,then:e=>e.required("In Time is required for Present or Half Day"),otherwise:e=>e.notRequired()}),emp_out_time:u().when("attendance_status",{is:e=>"1"===e||"2"===e,then:e=>e.required("Out Time is required for Present or Half Day"),otherwise:e=>e.notRequired()})});function L({open:s,setOpen:r,title:l,id:n,edit:i,setEdit:o,refetch:x}){const u=d({}),g=new Date,v=c({defaultValues:{attendance_status:"",emp_in_time:"",emp_out_time:""},resolver:m(T)});return e.jsx(y,{open:s,setOpen:r,title:l,edit:i,setEdit:o,children:e.jsx(p,{methods:v,onSubmit:v.handleSubmit(async e=>{var s,l,i,d;try{const o=await u.mutateAsync({api:null==(s=t)?void 0:s.createAttendance,data:{emp_id:n,date:g.toISOString().split("T")[0],attendance_status:e.attendance_status,...e.emp_in_time&&{emp_in_time:e.emp_in_time},...e.emp_out_time&&{emp_out_time:e.emp_out_time}}});(null==(l=o.data)?void 0:l.success)?(a.success((null==(i=null==o?void 0:o.data)?void 0:i.message)||"Attendance created successfully"),r(!1),x()):a.error((null==(d=o.data)?void 0:d.message)||"Failed to create attendance")}catch(o){a.error("An error occurred while creating attendance")}}),children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-2 gap-y-4",children:[e.jsx("div",{className:"col-span-2",children:e.jsx(b,{name:"attendance_status",label:"Attendance Status",data:[{label:"Absent",value:"0"},{label:"Present",value:"1"},{label:"Half Day",value:"2"},{label:"Leave",value:"3"}]})}),e.jsx("div",{children:e.jsx(j,{label:"In Time",name:"emp_in_time",placeholder:"Enter In Time"})}),e.jsx("div",{children:e.jsx(j,{label:"Out Time",name:"emp_out_time",placeholder:"Enter Out Time"})}),e.jsx(f,{className:"col-span-2 my-2"}),e.jsx("div",{className:"col-span-2 flex justify-end",children:e.jsx(h,{isLoading:v.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}const I=()=>{var a,i,c,m,x,u;const p=new Date,[h,b]=s.useState(!1),[j,f]=s.useState(!1),[y,T]=s.useState(""),[I,F]=s.useState(p.toLocaleString("en-IN",{month:"long"})),[O,P]=s.useState(p.getFullYear()),[M,q]=s.useState(1),[E,H]=s.useState(20),[R,$]=s.useState(p.toISOString().split("T")[0]),B=d({}),[Y,J]=s.useState(""),[U,z]=s.useState(""),[Q,V]=s.useState("all"),[W,X]=s.useState({present:0,absent:0,halfDay:0,leave:0,total:0}),[Z,G]=s.useState(null),K=n(),ee=o({api:`${null==(a=t)?void 0:a.getAllAttendance}?${(()=>{const e=new URLSearchParams;return I&&e.append("month",I),O&&e.append("year",O.toString()),R&&e.append("date",R),Y&&e.append("department_id",l(String(Y))),U&&e.append("q",U),"all"!==Q&&e.append("status",Q.toString()),e.append("page",M.toString()),e.append("limit",E.toString()),e.toString()})()}`,value:[M,E,I,O,R,Y,U,Q],options:{enabled:!0}});s.useEffect(()=>{te()},[null==ee?void 0:ee.data]);const te=()=>{var e;if(!(null==(e=null==ee?void 0:ee.data)?void 0:e.data))return void X({present:0,absent:0,halfDay:0,leave:0,total:0});const t=ee.data.data.reduce((e,t)=>{switch(t.attendance_status){case 1:e.present++;break;case 0:e.absent++;break;case 2:e.halfDay++;break;case 3:e.leave++}return e},{present:0,absent:0,halfDay:0,leave:0,total:ee.data.data.length});X(t)},ae=async(e,a)=>{var s,r,l,n;try{const i=await B.mutateAsync({api:null==(s=t)?void 0:s.createAttendance,data:{emp_id:e,date:R||p.toISOString().split("T")[0],attendance_status:a}});(null==(r=i.data)?void 0:r.success)?(se("success",(null==(l=i.data)?void 0:l.message)||"Status updated successfully"),ee.refetch()):se("error",(null==(n=i.data)?void 0:n.message)||"Failed to update status")}catch(i){se("error","An error occurred while updating status")}},se=(e,t)=>{G({type:e,text:t}),setTimeout(()=>G(null),3e3)},re=t=>{const a={1:{label:"Present",color:"bg-emerald-500",icon:v},0:{label:"Absent",color:"bg-red-500",icon:N},2:{label:"Half Day",color:"bg-amber-500",icon:D},3:{label:"Leave",color:"bg-blue-500",icon:_}}[t];return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:`${null==a?void 0:a.color} h-2 w-2 rounded-full`}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:null==a?void 0:a.label})]})},le=({status:t,currentStatus:a,onClick:s,label:r,color:l})=>e.jsx("button",{onClick:s,className:"rounded-lg px-3 py-1.5 text-xs font-medium transition-all duration-200 "+(a===t?`${l} text-white shadow-sm`:"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:r}),ne=Array.from({length:10},(e,t)=>p.getFullYear()-t),ie=(null==ee?void 0:ee.isLoading)||(null==ee?void 0:ee.isFetching),de=(null==(c=null==(i=null==ee?void 0:ee.data)?void 0:i.pagination)?void 0:c.total)||0,oe=Math.ceil(de/E),ce=(M-1)*E+1,me=Math.min(M*E,de),xe=e=>{q(e)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[e.jsx(L,{setOpen:b,open:h,id:y,setEdit:f,edit:j,title:"Create Attendance",refetch:null==ee?void 0:ee.refetch}),Z&&e.jsxs("div",{className:`mb-6 flex items-center gap-3 rounded-xl p-4 ${"success"===Z.type?"border border-emerald-200 bg-emerald-50":"border border-red-200 bg-red-50"} duration-300 animate-in fade-in slide-in-from-top-2`,children:["success"===Z.type?e.jsx(v,{className:"h-5 w-5 text-emerald-600"}):e.jsx(N,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:"text-sm font-medium "+("success"===Z.type?"text-emerald-800":"text-red-800"),children:Z.text})]}),e.jsx("div",{className:"mb-6 rounded-xl border border-gray-200 bg-white p-5 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Select Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsx("input",{type:"date",value:R,onChange:e=>$(e.target.value),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Select Month"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsx("select",{value:I,onChange:e=>F(e.target.value),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:["January","February","March","April","May","June","July","August","September","October","November","December"].map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Select Year"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsx("select",{value:O,onChange:e=>P(parseInt(e.target.value)),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:ne.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Department"}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsxs("select",{value:Y,onChange:e=>J(e.target.value),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"All Departments"}),null==(x=null==(m=null==K?void 0:K.data)?void 0:m.data)?void 0:x.map(t=>e.jsx("option",{value:t.id,children:t.department_name},t.id))]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Search Employee"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Name, code...",value:U,onChange:e=>z(e.target.value),className:"w-full rounded-lg border border-gray-300 py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Filter by Status"}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsxs("select",{value:Q,onChange:e=>V("all"===e.target.value?"all":parseInt(e.target.value)),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"0",children:"Absent"}),e.jsx("option",{value:"1",children:"Present"}),e.jsx("option",{value:"2",children:"Half Day"}),e.jsx("option",{value:"3",children:"Leave"})]})]})]})]})}),e.jsx("div",{className:"overflow-hidden rounded-xl border border-gray-200 bg-white shadow-sm",children:ie?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"mb-4 h-12 w-12 animate-spin rounded-full border-4 border-indigo-200 border-t-indigo-600"}),e.jsx("p",{className:"font-medium text-gray-500",children:"Loading attendance data..."})]}):(null==(u=null==ee?void 0:ee.data)?void 0:u.data)&&0!==ee.data.data.length?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gradient-to-r from-indigo-50 to-purple-50",children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Employee"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Department"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Check In"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Check Out"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Hours"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Actions"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Mark Attendance"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:ee.data.data.map(t=>e.jsxs("tr",{className:"transition-colors hover:bg-indigo-50/50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800",children:t.emp_name}),e.jsx("div",{className:"text-xs text-gray-500",children:t.emp_code})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex items-center rounded-md bg-gray-100 px-2.5 py-1 text-xs font-medium text-gray-700",children:t.department_name})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:t.emp_in_time?e.jsx("span",{className:"font-medium",children:new Date(t.emp_in_time).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})}):e.jsx("span",{className:"text-gray-400",children:"--:--"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:t.emp_out_time?e.jsx("span",{className:"font-medium",children:new Date(t.emp_out_time).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})}):e.jsx("span",{className:"text-gray-400",children:"--:--"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"inline-flex items-center rounded-md bg-indigo-50 px-2.5 py-1 text-sm font-bold text-indigo-700",children:[null==t?void 0:t.total_working_hours,"h"]})}),e.jsx("td",{className:"px-6 py-4",children:re(t.attendance_status)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(le,{status:1,currentStatus:t.attendance_status,onClick:()=>ae(t.emp_id,1),label:"Present",color:"bg-emerald-500"}),e.jsx(le,{status:0,currentStatus:t.attendance_status,onClick:()=>ae(t.emp_id,0),label:"Absent",color:"bg-red-500"}),e.jsx(le,{status:2,currentStatus:t.attendance_status,onClick:()=>ae(t.emp_id,2),label:"Half Day",color:"bg-amber-500"}),e.jsx(le,{status:3,currentStatus:t.attendance_status,onClick:()=>ae(t.emp_id,3),label:"Leave",color:"bg-blue-500"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(r,{variant:"outline",size:"sm",className:"border-indigo-500 text-indigo-600 hover:border-indigo-600 hover:bg-indigo-50 \n                        hover:text-indigo-700 \n                        ",onClick:()=>{return e=String(t.emp_id),T(e),void b(!h);var e},children:"Mark Attendance"})})]},t.id))})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(A,{className:"mb-4 h-16 w-16 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium text-gray-400",children:"No records found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-400",children:"Try adjusting your filters"})]})}),e.jsx("div",{className:"mt-6 rounded-xl border border-gray-200 bg-white p-4 shadow-sm",children:e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Rows per page:"}),e.jsxs("select",{value:E,onChange:e=>{return t=parseInt(e.target.value),H(t),void q(1);var t},className:"rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Showing"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:ce})," ","to"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:me})," ","of"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:de})," ","entries"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>xe(M-1),disabled:1===M||ie,className:"flex items-center gap-1 rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 transition-all hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx(g,{className:"h-4 w-4"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,oe)},(t,a)=>{let s;return s=oe<=5||M<=3?a+1:M>=oe-2?oe-4+a:M-2+a,e.jsx("button",{onClick:()=>xe(s),disabled:null==ee?void 0:ee.isFetching,className:"h-8 w-8 rounded-lg text-sm font-medium transition-all disabled:cursor-not-allowed "+(M===s?"bg-indigo-600 text-white shadow-sm":"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:s},s)})}),e.jsxs("button",{onClick:()=>xe(M+1),disabled:M===oe||(null==ee?void 0:ee.isFetching),className:"flex items-center gap-1 rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 transition-all hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50",children:["Next",e.jsx(C,{className:"h-4 w-4"})]})]})]})]})}),e.jsx("div",{className:"mt-4 rounded-xl border border-gray-200 bg-white p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Page ",e.jsx("span",{className:"font-semibold text-gray-800",children:M})," of"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:oe})]}),e.jsxs("span",{className:"text-gray-500",children:["Last updated: ",(new Date).toLocaleTimeString("en-IN")]})]})})]})};function F(){return e.jsx(i,{title:"Attendance List",subTitle:"Manage all the Attendance here",children:e.jsx(I,{})})}export{F as default};
