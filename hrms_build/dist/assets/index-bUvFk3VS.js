import{h as e,f as a,r as l,j as i,z as t,B as s,e as n}from"./index-pyCvve81.js";import{P as d}from"./index-BN0jNiUj.js";import{h as r}from"./moment-CBOc1lqT.js";import{C as o,a as c,b as u,c as m}from"./card-bx3Oa7DD.js";import{T as p,a as x,b as h,c as j,d as v,e as b}from"./table-vFocFjjc.js";import{u as y,b as f}from"./useCustomQuery-B1PLu8pZ.js";import{P as _}from"./index-By2ZT1Is.js";import{S as g}from"./separator-DS4WD8aU.js";import{S as N}from"./index-cYG0LkNy.js";import{S}from"./Spinner-BDgO_yrk.js";import{a as D,o as C,c as T,b as w,f as E,d as A}from"./yup-C9jKbjb2.js";import{F}from"./datetime-picker-CYDyb3rk.js";import{R as V}from"./RHFTextField-oGT6ZvhB.js";import{R as L}from"./RHFTextArea-DiyrAPVA.js";import{B as k}from"./ButtonLoading-C9GHL4iQ.js";import{R as q}from"./RHFSelectField-C9SERau7.js";import"./input-DWARB5Y9.js";import"./switch-Br0yiZF5.js";import{R as B}from"./RHFCheckbox-BcntpIGW.js";import{D as P}from"./index-CDBXPzA7.js";import{B as R}from"./badge-Cy7OSyyd.js";import{L as $}from"./loader-circle-DXaVvWTg.js";import{T as M}from"./trash-2-BXm2aACA.js";import"./select-BIraycn9.js";import"./check-BHEPqzdD.js";import"./calendar-DxovkaVF.js";import"./format-BkNqQ0tt.js";import"./chevron-right-CT2wJ-fK.js";import"./clock-DqQh3QaC.js";import"./checkbox-BD1KnAu3.js";import"./label-D5MVRa8l.js";const Y=T().shape({deduction_code:w().required("Deduction Code is required"),deduction_name:w().required("Deduction Name is required"),calculation_type:w().required("Calculation Type is required"),default_value:E().typeError("Default Value must be a number").required("Default Value is required").min(0,"Default Value must be greater than or equal to 0"),calculation_base:w().nullable(),max_limit:E().typeError("Max Limit must be a number").nullable().transform((e,a)=>""===a?null:e),is_employer_contribution:A(),employer_contribution_rate:E().typeError("Employer Contribution Rate must be a number").nullable().transform((e,a)=>""===a?null:e),description:w().required("Description is required")});function H({open:s,setOpen:n,title:d,id:r,edit:o,setEdit:c,refetch:u}){var m;const p=y({}),{data:x,isFetching:h}=f({api:`${null==(m=e)?void 0:m.getDeductionById}?id=${a(String(r))}`,key:"getDeductionById",options:{enabled:o&&!!r}}),j=D({defaultValues:{deduction_code:"",deduction_name:"",calculation_type:"",default_value:0,calculation_base:null,max_limit:null,is_employer_contribution:!1,employer_contribution_rate:null,description:""},resolver:C(Y)}),v=j.watch("calculation_type"),b=j.watch("is_employer_contribution");return l.useEffect(()=>{var e,a,l,i,t,s,n,d,r,c,u;o&&(null==x?void 0:x.data)?j.reset({deduction_code:(null==(e=null==x?void 0:x.data)?void 0:e.deduction_code)||"",deduction_name:(null==(a=null==x?void 0:x.data)?void 0:a.deduction_name)||"",calculation_type:(null==(l=null==x?void 0:x.data)?void 0:l.calculation_type)||"",default_value:Number(null==(i=null==x?void 0:x.data)?void 0:i.default_value)||0,calculation_base:(null==(t=null==x?void 0:x.data)?void 0:t.calculation_base)||null,max_limit:(null==(s=null==x?void 0:x.data)?void 0:s.max_limit)?Number(null==(n=null==x?void 0:x.data)?void 0:n.max_limit):null,is_employer_contribution:(null==(d=null==x?void 0:x.data)?void 0:d.is_employer_contribution)||!1,employer_contribution_rate:(null==(r=null==x?void 0:x.data)?void 0:r.employer_contribution_rate)?Number(null==(c=null==x?void 0:x.data)?void 0:c.employer_contribution_rate):null,description:(null==(u=null==x?void 0:x.data)?void 0:u.description)||""}):j.reset({deduction_code:"",deduction_name:"",calculation_type:"",default_value:0,calculation_base:null,max_limit:null,is_employer_contribution:!1,employer_contribution_rate:null,description:""})},[o,x]),l.useEffect(()=>{(null==j?void 0:j.watch("calculation_type"))&&j.setValue("default_value",0)},[v]),i.jsx(P,{open:s,setOpen:n,title:d,setEdit:c,edit:o,isLoading:h,children:i.jsx(F,{methods:j,onSubmit:j.handleSubmit(async a=>{var l,i,s,d,m,x,h,v;try{if(o&&r){const n=await p.mutateAsync({api:`${null==(l=e)?void 0:l.updateDeduction}`,data:{id:Number(r),...a}});(null==(i=n.data)?void 0:i.success)?t.success(null==(s=null==n?void 0:n.data)?void 0:s.message):t.error((null==(d=n.data)?void 0:d.message)||"Deduction Type not updated successfully")}else{const l=await p.mutateAsync({api:null==(m=e)?void 0:m.createDeduction,data:a});(null==(x=l.data)?void 0:x.success)?t.success(null==(h=null==l?void 0:l.data)?void 0:h.message):t.error((null==(v=l.data)?void 0:v.message)||"Deduction Type not created successfully")}j.reset(),n(!1),c(!1),u()}catch(b){}}),children:i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Basic Information"}),i.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[i.jsx(V,{name:"deduction_code",label:"Deduction Code",placeholder:"e.g., EPF, TAX, INS",inputValidation:["removeSpecialCharacterExceptSpace"]}),i.jsx(V,{name:"deduction_name",label:"Deduction Name",placeholder:"e.g., Provident Fund",inputValidation:["removeSpecialCharacterExceptSpace"]})]})]}),i.jsx("div",{children:i.jsx(L,{name:"description",label:"Description",placeholder:"Brief description of this deduction type...",inputValidation:["removeSpecialCharacterExceptSpace"]})})]}),i.jsx(g,{}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Calculation Method"}),i.jsxs("div",{className:"space-y-4",children:[i.jsx(q,{label:"How to Calculate",name:"calculation_type",data:[{label:"Fixed Amount",value:"fixed"},{label:"Percentage of Salary",value:"percentage"}]}),"fixed"===v&&i.jsx("div",{children:i.jsx(V,{name:"default_value",label:"Amount",placeholder:"e.g., 5000",type:"number",inputValidation:["number"]})}),"percentage"===v&&i.jsxs("div",{className:"space-y-4",children:[i.jsx(V,{name:"default_value",label:"Percentage (%)",placeholder:"e.g., 12",type:"number",inputValidation:"percentage"==v?["number","maxTwoDecimalPlaces"]:["number"],maxLength:2}),i.jsxs("div",{className:"space-y-4 rounded-lg border border-blue-200 bg-blue-50 p-4",children:[i.jsx("p",{className:"text-xs font-medium text-blue-700",children:"Additional Settings for Percentage Calculation"}),i.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[i.jsx(q,{name:"calculation_base",label:"Calculate Based On",data:[{label:"Basic Salary",value:"basic"},{label:"Gross Salary",value:"gross"},{label:"Net Salary",value:"net"}]}),i.jsx(V,{name:"max_limit",label:"Maximum Limit (Optional)",placeholder:"e.g., 15000",type:"number",inputValidation:["number"]})]}),i.jsx("p",{className:"text-xs italic text-gray-600",children:"Maximum limit caps the deduction amount regardless of the calculated percentage"})]})]})]})]}),i.jsx(g,{}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Employer Contribution"}),i.jsxs("div",{className:"space-y-4 rounded-lg border border-gray-200 bg-gray-50 p-4",children:[i.jsx("div",{className:"flex items-start gap-3",children:i.jsx(B,{name:"is_employer_contribution",label:"Employer also contributes to this deduction"})}),i.jsx("p",{className:"text-xs italic text-gray-600",children:"Check this if your organization contributes an amount in addition to the employee's deduction"}),b&&i.jsxs("div",{className:"mt-4 border-t border-gray-300 pt-4",children:[i.jsx(V,{name:"employer_contribution_rate",label:"Employer Contribution Rate (%)",placeholder:"e.g., 13",type:"number",inputValidation:["number"]}),i.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"This is the percentage or amount that the employer will contribute"})]})]})]})}),i.jsx(g,{className:"my-6"}),i.jsx("div",{className:"pt-2",children:i.jsx(k,{isLoading:j.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:o?"Update Deduction Type":"Create Deduction Type"})})]})})})}function I(){var a,d,D,C,T,w;const E=y({}),[A,F]=l.useState(1),[V,L]=l.useState(10),[k,q]=l.useState(""),[B,P]=l.useState(!1),[Y,I]=l.useState(""),[O,z]=l.useState(!1),[Q,U]=l.useState(null),X=f({api:`${e.getAllDeductions}?page=${A}&limit=${V}&q=${k}`,key:"getAllDeductions",value:[A,V,k],options:{enabled:!0}});return i.jsxs("main",{className:"grid items-start",children:[i.jsx(H,{open:B,setOpen:P,title:O?"Edit Deduction Type":"Add Deduction Type",id:Y,edit:O,setEdit:z,refetch:X.refetch}),i.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[i.jsxs("div",{className:"flex w-full justify-between gap-2",children:[i.jsx("div",{children:i.jsx(N,{search:k,setSearch:q,refetch:X.refetch,isFetching:null==X?void 0:X.isLoading})}),i.jsx("div",{children:i.jsx(s,{className:"flex items-center gap-2",onClick:()=>P(!0),children:"Add New"})})]}),i.jsxs(o,{children:[i.jsx(c,{className:"px-7",children:i.jsxs(u,{children:["Deduction Type List (",(null==(d=null==(a=null==X?void 0:X.data)?void 0:a.data)?void 0:d.length)||0,")"]})}),i.jsx(m,{children:X.isLoading?i.jsx("div",{className:"flex h-32 items-center justify-center",children:i.jsx(S,{})}):i.jsxs(i.Fragment,{children:[i.jsxs(p,{children:[i.jsx(x,{children:i.jsxs(h,{children:[i.jsx(j,{className:"",children:"#"}),i.jsx(j,{className:"",children:"Code"}),i.jsx(j,{className:"",children:"Name"}),i.jsx(j,{className:"",children:"Type"}),i.jsx(j,{className:"",children:"Default Value"}),i.jsx(j,{className:"",children:"Base"}),i.jsx(j,{className:"",children:"Max Limit"}),i.jsx(j,{className:"",children:"Employer Contribution"}),i.jsx(j,{className:"",children:"Description"}),i.jsx(j,{className:"",children:"Created at"}),i.jsx(j,{className:"",children:"Status"}),i.jsx(j,{children:"Action"})]})}),i.jsx(v,{children:null==(C=null==(D=null==X?void 0:X.data)?void 0:D.data)?void 0:C.map((a,l)=>i.jsxs(h,{children:[i.jsx(b,{children:l+1}),i.jsx(b,{children:null==a?void 0:a.deduction_code}),i.jsx(b,{children:null==a?void 0:a.deduction_name}),i.jsx(b,{children:i.jsx(R,{variant:"outline",className:"capitalize",children:null==a?void 0:a.calculation_type})}),i.jsxs(b,{children:[null==a?void 0:a.default_value,"percentage"===(null==a?void 0:a.calculation_type)&&"%"]}),i.jsx(b,{children:(null==a?void 0:a.calculation_base)||"-"}),i.jsx(b,{children:(null==a?void 0:a.max_limit)||"-"}),i.jsx(b,{children:i.jsxs(R,{variant:(null==a?void 0:a.is_employer_contribution)?"default":"secondary",children:[(null==a?void 0:a.is_employer_contribution)?"Yes":"No",(null==a?void 0:a.is_employer_contribution)&&(null==a?void 0:a.employer_contribution_rate)&&` (${null==a?void 0:a.employer_contribution_rate}%)`]})}),i.jsx(b,{className:"max-w-xs truncate",children:null==a?void 0:a.description}),i.jsx(b,{children:r(null==a?void 0:a.created_at).format("DD-MM-YYYY")}),i.jsx(b,{children:i.jsx(R,{variant:1===(null==a?void 0:a.status)?"default":"secondary",children:1===(null==a?void 0:a.status)?"Active":"Inactive"})}),i.jsx(b,{children:i.jsxs("div",{className:"flex gap-2",children:[i.jsx(s,{className:"bg-primary",onClick:()=>{return e=String(null==a?void 0:a.id),z(!0),P(!0),void I(e);var e},children:"Edit"}),i.jsx(s,{variant:"destructive",onClick:()=>(async a=>{var l,i,s,d;U(a);try{const n=await E.mutateAsync({api:`${null==(l=e)?void 0:l.deleteDeduction}`,data:{id:Number(a)}});(null==(i=null==n?void 0:n.data)?void 0:i.success)?(X.refetch(),t.success((null==(s=null==n?void 0:n.data)?void 0:s.message)||"Deduction deleted successfully")):t.error((null==(d=n.data)?void 0:d.message)||"Failed to delete deduction")}catch(r){t.error(n(r))}finally{U(null)}})(String(null==a?void 0:a.id)),disabled:Q===String(null==a?void 0:a.id),children:Q===String(null==a?void 0:a.id)?i.jsx($,{className:"h-4 w-4 animate-spin"}):i.jsx(M,{className:"h-4 w-4"})})]})})]},null==a?void 0:a.id))})]}),i.jsx(g,{className:"mb-2 mt-4"}),i.jsx("div",{className:"flex w-full justify-end",children:i.jsx(_,{page:A,limit:V,totalPages:Math.ceil(((null==(w=null==(T=null==X?void 0:X.data)?void 0:T.data)?void 0:w.length)||0)/V),setPage:F,setLimit:L})})]})})]})]})]})}function O(){return i.jsx(d,{title:"Deduction Type List",subTitle:"Manage all the Deduction Types here",children:i.jsx("div",{className:"py-12",children:i.jsx(I,{})})})}export{O as default};
