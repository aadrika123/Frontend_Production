import{r as e,j as s,z as a,h as i,u as r,B as t}from"./index-pyCvve81.js";import{P as n}from"./index-BN0jNiUj.js";import{h as l}from"./moment-CBOc1lqT.js";import{C as o,c as d,a as c,b as m}from"./card-bx3Oa7DD.js";import{T as u,a as v,b as x,c as j,d as h,e as p}from"./table-vFocFjjc.js";import{u as g,b as f}from"./useCustomQuery-B1PLu8pZ.js";import{S as y}from"./Spinner-BDgO_yrk.js";import{a as b,o as N,c as _,b as w,f as S}from"./yup-C9jKbjb2.js";import{F as R}from"./datetime-picker-CYDyb3rk.js";import{R as L}from"./RHFTextField-oGT6ZvhB.js";import{R as A}from"./RHFTextArea-DiyrAPVA.js";import{B as E}from"./ButtonLoading-C9GHL4iQ.js";import"./select-BIraycn9.js";import{I as P}from"./input-DWARB5Y9.js";import"./switch-Br0yiZF5.js";import"./checkbox-BD1KnAu3.js";import"./label-D5MVRa8l.js";import{S as W}from"./separator-DS4WD8aU.js";import{D as z}from"./index-CDBXPzA7.js";import{B as I}from"./badge-Cy7OSyyd.js";import{S as O}from"./search-Zsj49TaG.js";import{T}from"./triangle-alert-pMzHo5ds.js";import"./calendar-DxovkaVF.js";import"./format-BkNqQ0tt.js";import"./chevron-right-CT2wJ-fK.js";import"./clock-DqQh3QaC.js";import"./check-BHEPqzdD.js";const k=_().shape({waive_amount:S().required("Waive amount is required").positive("Amount must be positive"),waive_reason:w().required("Reason for waiving is required"),authorized_by:w().nullable()});function C({open:r,setOpen:t,title:n,recovery:l,refetch:c}){var m,u,v,x,j;const h=g({}),p=b({defaultValues:{waive_amount:void 0,waive_reason:"",authorized_by:""},resolver:N(k)});e.useEffect(()=>{l&&p.reset({waive_amount:l.pending_amount,waive_reason:"",authorized_by:""})},[l,p]);return s.jsxs(z,{open:r,setOpen:t,title:n,setEdit:()=>(p.reset(),void t(!1)),children:[l&&s.jsx(o,{className:"mb-4 bg-slate-50",children:s.jsx(d,{className:"pt-4",children:s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-slate-500",children:"Original Amount:"}),s.jsxs("span",{className:"ml-2 font-semibold",children:["₹",null==(m=l.original_amount)?void 0:m.toLocaleString()]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-slate-500",children:"Pending Amount:"}),s.jsxs("span",{className:"ml-2 font-semibold text-red-600",children:["₹",null==(u=l.pending_amount)?void 0:u.toLocaleString()]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-slate-500",children:"Already Recovered:"}),s.jsxs("span",{className:"ml-2 font-semibold text-green-600",children:["₹",(null==(v=l.recovered_amount)?void 0:v.toLocaleString())||0]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-slate-500",children:"Already Waived:"}),s.jsxs("span",{className:"ml-2 font-semibold",children:["₹",(null==(x=l.waiver_amount)?void 0:x.toLocaleString())||0]})]})]})})}),s.jsx(R,{methods:p,onSubmit:p.handleSubmit(async e=>{var s,r,n,o;if(l)if(e.waive_amount>l.pending_amount)a.error(`Waive amount cannot exceed pending amount (₹${l.pending_amount})`);else try{const d=await h.mutateAsync({api:null==(s=i)?void 0:s.waiveRecovery,data:{recovery_id:l.id,...e}});(null==(r=d.data)?void 0:r.success)?(a.success((null==(n=null==d?void 0:d.data)?void 0:n.message)||"Recovery waived successfully"),p.reset(),t(!1),null==c||c()):a.error((null==(o=d.data)?void 0:o.message)||"Failed to waive recovery")}catch(d){a.error("Failed to waive recovery")}}),children:s.jsxs("div",{className:"grid grid-cols-1 gap-x-4 gap-y-4",children:[s.jsxs("div",{children:[s.jsx(L,{label:"Amount to Waive (₹)",name:"waive_amount",placeholder:"Enter amount to waive",type:"number"}),l&&s.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["Maximum: ₹",null==(j=l.pending_amount)?void 0:j.toLocaleString()]})]}),s.jsx("div",{children:s.jsx(A,{label:"Reason for Waiving",name:"waive_reason",placeholder:"Enter reason for waiving this recovery"})}),s.jsx("div",{children:s.jsx(L,{label:"Authorized By (Optional)",name:"authorized_by",placeholder:"Enter authorizing officer name"})}),s.jsxs("div",{children:[s.jsx(W,{className:"my-2"}),s.jsx(E,{isLoading:p.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Waive Recovery"})]})]})})]})}function M(){var a,n,g,b,N,_,w,S,R,L,A;const{user:E}=r(),[W,z]=e.useState(!1),[k,M]=e.useState(""),[F,$]=e.useState(""),[B,D]=e.useState(null),q=f({api:`${i.getPendingRecovery}?emp_id=${F}&ulb_id=${null==E?void 0:E.ulbId}`,key:"getPendingRecovery",value:[F,null==E?void 0:E.ulbId],options:{enabled:!!F&&!!(null==E?void 0:E.ulbId)}}),H=e=>{switch(e){case"pending":return s.jsx(I,{variant:"outline",className:"bg-yellow-100 text-yellow-700",children:"Pending"});case"partial":return s.jsx(I,{variant:"outline",className:"bg-blue-100 text-blue-700",children:"Partial"});case"completed":return s.jsx(I,{variant:"outline",className:"bg-green-100 text-green-700",children:"Completed"});case"waived":return s.jsx(I,{variant:"outline",className:"bg-gray-100 text-gray-700",children:"Waived"});default:return s.jsx(I,{variant:"outline",children:e})}};return s.jsxs("main",{className:"grid items-start",children:[s.jsx(C,{open:W,setOpen:z,title:"Waive Recovery",recovery:B,refetch:q.refetch}),s.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[s.jsx("div",{className:"flex w-full flex-col gap-4 sm:flex-row sm:justify-between",children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx(P,{placeholder:"Enter Employee ID",value:k,onChange:e=>M(e.target.value),className:"w-48"}),s.jsxs(t,{onClick:()=>{k&&$(k)},variant:"outline",children:[s.jsx(O,{className:"mr-2 h-4 w-4"}),"Search"]})]})}),F&&void 0!==(null==(n=null==(a=null==q?void 0:q.data)?void 0:a.data)?void 0:n.total_pending)&&s.jsx(o,{className:"bg-gradient-to-r from-red-50 to-orange-50",children:s.jsx(d,{className:"pt-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(T,{className:"h-5 w-5 text-red-500"}),s.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Total Pending Recovery"})]}),s.jsxs("span",{className:"text-xl font-bold text-red-700",children:["₹",(null==(N=null==(b=null==(g=null==q?void 0:q.data)?void 0:g.data)?void 0:b.total_pending)?void 0:N.toLocaleString())||0]})]})})}),s.jsxs(o,{children:[s.jsx(c,{children:s.jsx(m,{children:F?`Pending Recovery for Employee ID: ${F}`:"Enter Employee ID to view pending recovery"})}),s.jsx(d,{children:F?(null==q?void 0:q.isLoading)?s.jsx("div",{className:"flex items-center justify-center",children:s.jsx(y,{})}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(u,{children:[s.jsx(v,{children:s.jsxs(x,{children:[s.jsx(j,{children:"Type"}),s.jsx(j,{children:"Original Amount"}),s.jsx(j,{children:"Pending Amount"}),s.jsx(j,{children:"Recovered"}),s.jsx(j,{children:"Waived"}),s.jsx(j,{children:"Source Month"}),s.jsx(j,{children:"Status"}),s.jsx(j,{children:"Actions"})]})}),s.jsx(h,{children:(null==(w=null==(_=null==q?void 0:q.data)?void 0:_.data)?void 0:w.recovery)&&(null==(R=null==(S=null==q?void 0:q.data)?void 0:S.data)?void 0:R.recovery.length)>0?null==(A=null==(L=null==q?void 0:q.data)?void 0:L.data)?void 0:A.recovery.map(e=>{var a,i,r,n;return s.jsxs(x,{children:[s.jsx(p,{className:"font-medium",children:e.recovery_type||"Overpayment"}),s.jsxs(p,{children:["₹",null==(a=e.original_amount)?void 0:a.toLocaleString()]}),s.jsxs(p,{className:"font-semibold text-red-600",children:["₹",null==(i=e.pending_amount)?void 0:i.toLocaleString()]}),s.jsxs(p,{className:"text-green-600",children:["₹",(null==(r=e.recovered_amount)?void 0:r.toLocaleString())||0]}),s.jsxs(p,{className:"text-gray-600",children:["₹",(null==(n=e.waiver_amount)?void 0:n.toLocaleString())||0]}),s.jsxs(p,{children:[l().month(e.source_month-1).format("MMM")," ",e.source_year]}),s.jsx(p,{children:H(e.recovery_status)}),s.jsx(p,{children:("pending"===e.recovery_status||"partial"===e.recovery_status)&&s.jsx(t,{variant:"outline",size:"sm",onClick:()=>(D(e),void z(!0)),children:"Waive"})})]},e.id)}):s.jsx(x,{children:s.jsx(p,{colSpan:8,className:"text-center",children:"No pending recovery found"})})})]})}):s.jsx("div",{className:"flex items-center justify-center py-8 text-slate-500",children:"Please enter an Employee ID to search for recovery records"})})]})]})]})}function F(){return s.jsx(n,{title:"Recovery Management",subTitle:"Manage Employee Recovery/Overpayments",children:s.jsx("div",{className:"py-12",children:s.jsx(M,{})})})}export{F as default};
