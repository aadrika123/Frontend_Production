import{r as e,j as s,aH as a,al as l}from"./vendor-RyuIgj66.js";import{P as n,D as r,c as t,e as i,f as d,h as c,i as o}from"./index-DFF4_m_G.js";import{C as x,a as m,d as p,c as h}from"./card-u7M7FP5y.js";import{h as j,B as u}from"./index-ey2GEmQz.js";import{B as v}from"./badge-DbWnzWn2.js";import{T as g,a as y,b as f,c as N,d as w,e as b}from"./table-B_npepsp.js";import{T as A}from"./textarea-CIMcDPG7.js";import{L as _}from"./label-BcY3kv5U.js";import{T as M,a as L,b as C,c as k}from"./tabs-BzFjL9ks.js";import{u as P,b as D}from"./useCustomQuery-DTB6aAiD.js";import{al as R,F as $,a5 as S,U as T,a4 as z,s as F,_ as E,$ as O,aM as B}from"./icons-CxCh8mm_.js";import"./ui-B3c1eQmf.js";import"./query-BH9sOW2X.js";import"./axios-Dos3PyFQ.js";import"./zustand-C1rkr5lV.js";const H=()=>{const[H,U]=e.useState("pending"),[q,Q]=e.useState(1),[V,Y]=e.useState(null),[G,I]=e.useState(null),[J,K]=e.useState(""),[W,X]=e.useState(!1),Z=P({}),ee=(new Date).getFullYear(),{data:se,refetch:ae,isLoading:le}=D({api:`${j.getPendingLeaves}?page=${q}&limit=20`,key:`pendingLeaves-${q}`,options:{enabled:"pending"===H}}),{data:ne,refetch:re,isLoading:te}=D({api:`${j.getLeaveApplications}?year=${ee}&page=${q}&limit=20`,key:`allLeaves-${q}-${ee}`,options:{enabled:"all"===H}}),ie=(null==se?void 0:se.data)||[],de=(null==ne?void 0:ne.data)||[],ce=null==se?void 0:se.pagination,oe=null==ne?void 0:ne.pagination,xe=(e,s)=>{Y(e),I(s),X(!0)},me=e=>{switch(e){case 0:return s.jsxs(v,{variant:"outline",className:"border-yellow-200 bg-yellow-50 text-yellow-700",children:[s.jsx(z,{className:"mr-1 h-3 w-3"})," Pending"]});case 1:return s.jsxs(v,{variant:"outline",className:"border-green-200 bg-green-50 text-green-700",children:[s.jsx(E,{className:"mr-1 h-3 w-3"})," Approved"]});case 2:return s.jsxs(v,{variant:"outline",className:"border-red-200 bg-red-50 text-red-700",children:[s.jsx(O,{className:"mr-1 h-3 w-3"})," Rejected"]});case 3:return s.jsxs(v,{variant:"outline",className:"border-gray-200 bg-gray-50 text-gray-700",children:[s.jsx(B,{className:"mr-1 h-3 w-3"})," Cancelled"]});default:return s.jsx(v,{variant:"outline",children:"Unknown"})}},pe=({leaves:e,showActions:l,loading:n})=>n?s.jsx("div",{className:"py-8 text-center",children:"Loading..."}):0===e.length?s.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[s.jsx(F,{className:"mx-auto mb-4 h-12 w-12 opacity-50"}),s.jsx("p",{children:"No leave applications found"})]}):s.jsxs(g,{children:[s.jsx(y,{children:s.jsxs(f,{children:[s.jsx(N,{children:"Employee"}),s.jsx(N,{children:"Department"}),s.jsx(N,{children:"Leave Type"}),s.jsx(N,{children:"Period"}),s.jsx(N,{children:"Days"}),s.jsx(N,{children:"Reason"}),s.jsx(N,{children:"Status"}),s.jsx(N,{children:"Applied On"}),l&&s.jsx(N,{children:"Actions"})]})}),s.jsx(w,{children:e.map(e=>s.jsxs(f,{children:[s.jsx(b,{children:s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:e.emp_name}),s.jsx("p",{className:"text-xs text-muted-foreground",children:e.emp_code})]})}),s.jsx(b,{children:e.department_name||"-"}),s.jsxs(b,{children:[e.leave_type,e.is_half_day&&s.jsx("span",{className:"ml-1 text-xs text-muted-foreground",children:"(Half)"})]}),s.jsx(b,{children:s.jsxs("div",{className:"text-sm",children:[s.jsx("p",{children:a(new Date(e.start_date),"dd MMM yyyy")}),s.jsxs("p",{className:"text-muted-foreground",children:["to ",a(new Date(e.end_date),"dd MMM yyyy")]})]})}),s.jsx(b,{children:e.total_days}),s.jsx(b,{className:"max-w-[200px] truncate",children:e.reason||"-"}),s.jsx(b,{children:me(e.approval_status)}),s.jsx(b,{children:a(new Date(e.created_at),"dd MMM yyyy")}),l&&s.jsx(b,{children:s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(u,{variant:"outline",size:"sm",className:"text-green-600 hover:bg-green-50 hover:text-green-700",onClick:()=>xe(e,"approve"),children:[s.jsx(E,{className:"mr-1 h-4 w-4"}),"Approve"]}),s.jsxs(u,{variant:"outline",size:"sm",className:"text-red-600 hover:bg-red-50 hover:text-red-700",onClick:()=>xe(e,"reject"),children:[s.jsx(O,{className:"mr-1 h-4 w-4"}),"Reject"]})]})})]},e.id))})]});return s.jsx(n,{title:"Leave Approval",children:s.jsxs("div",{className:"container mx-auto space-y-6 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Leave Approval"}),s.jsx("p",{className:"text-muted-foreground",children:"Review and manage employee leave applications"})]}),s.jsxs(u,{variant:"outline",size:"sm",onClick:()=>{ae(),re()},children:[s.jsx(R,{className:"mr-2 h-4 w-4"}),"Refresh"]})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[s.jsxs(x,{children:[s.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(p,{className:"text-sm font-medium",children:"Pending Approvals"}),s.jsx($,{className:"h-4 w-4 text-yellow-600"})]}),s.jsxs(h,{children:[s.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:(null==ce?void 0:ce.total)||ie.length}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Awaiting your review"})]})]}),s.jsxs(x,{children:[s.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(p,{className:"text-sm font-medium",children:"Total Applications"}),s.jsx(S,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsxs(h,{children:[s.jsx("div",{className:"text-2xl font-bold",children:(null==oe?void 0:oe.total)||de.length}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"This year"})]})]}),s.jsxs(x,{children:[s.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(p,{className:"text-sm font-medium",children:"Employees"}),s.jsx(T,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsxs(h,{children:[s.jsx("div",{className:"text-2xl font-bold",children:new Set(de.map(e=>e.emp_id)).size}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Applied for leave"})]})]})]}),s.jsx(x,{children:s.jsx(h,{className:"p-6",children:s.jsxs(M,{value:H,onValueChange:U,children:[s.jsxs(L,{children:[s.jsxs(C,{value:"pending",className:"gap-2",children:[s.jsx(z,{className:"h-4 w-4"}),"Pending",ie.length>0&&s.jsx(v,{variant:"secondary",className:"ml-1",children:ie.length})]}),s.jsxs(C,{value:"all",className:"gap-2",children:[s.jsx(F,{className:"h-4 w-4"}),"All Applications"]})]}),s.jsx(k,{value:"pending",className:"mt-4",children:s.jsx(pe,{leaves:ie,showActions:!0,loading:le})}),s.jsx(k,{value:"all",className:"mt-4",children:s.jsx(pe,{leaves:de,showActions:!1,loading:te})})]})})}),s.jsx(r,{open:W,onOpenChange:X,children:s.jsxs(t,{children:[s.jsxs(i,{children:[s.jsx(d,{children:"approve"===G?"Approve Leave":"Reject Leave"}),s.jsx(c,{children:"approve"===G?"Confirm approval of this leave application":"Provide a reason for rejecting this leave application"})]}),V&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2 rounded-lg bg-gray-50 p-4",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-muted-foreground",children:"Employee:"})," ",s.jsx("strong",{children:V.emp_name})]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-muted-foreground",children:"Leave Type:"})," ",V.leave_type]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-muted-foreground",children:"Period:"})," ",a(new Date(V.start_date),"dd MMM yyyy")," ","to ",a(new Date(V.end_date),"dd MMM yyyy")]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-muted-foreground",children:"Days:"})," ",V.total_days]}),V.reason&&s.jsxs("p",{children:[s.jsx("span",{className:"text-muted-foreground",children:"Reason:"})," ",V.reason]})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(_,{children:"Remarks (Optional)"}),s.jsx(A,{placeholder:"Add any remarks...",value:J,onChange:e=>K(e.target.value)})]})]}),s.jsxs(o,{children:[s.jsx(u,{variant:"outline",onClick:()=>X(!1),children:"Cancel"}),s.jsx(u,{variant:"approve"===G?"default":"destructive",onClick:async()=>{var e,s,a,n;if(V&&G)try{const a=await Z.mutateAsync({api:j.approveLeave,data:{leave_id:V.id,action:G,remarks:J}});(null==(e=null==a?void 0:a.data)?void 0:e.success)?(l.success(a.data.message),X(!1),Y(null),I(null),K(""),ae(),re()):l.error((null==(s=null==a?void 0:a.data)?void 0:s.message)||"Failed to process leave")}catch(r){l.error((null==(n=null==(a=null==r?void 0:r.response)?void 0:a.data)?void 0:n.message)||"Failed to process leave")}},disabled:Z.isPending,children:Z.isPending?"Processing...":"approve"===G?"Approve":"Reject"})]})]})})]})})};export{H as default};
