import{h as e,f as a,r as s,j as t,F as i,z as r,B as n,e as l}from"./index-BJ2Di0BB.js";import{P as o}from"./index-L2kacWh6.js";import{C as c,a as d,b as m,c as u}from"./card-CrOEotWM.js";import{S as x,T as j,a as h,b as g,c as p,d as v,e as f}from"./index-BxKGIMG5.js";import{u as b,b as _}from"./useCustomQuery-DkqDqiry.js";import{P as S}from"./index-DZvdNKxy.js";import{S as y}from"./separator-BtSn9EpY.js";import{S as I}from"./Spinner-DjUjMlqR.js";import{a as T,o as R,c as F,f as N,b as w}from"./yup-BTlf5Wf5.js";import{F as A}from"./datetime-picker-cKnQNXMD.js";import{R as E}from"./RHFTextField-BK1QXo_s.js";import{B as C}from"./ButtonLoading-B5GmY3N3.js";import{R as q}from"./RHFSelectField-CxYg0t7R.js";import"./select-4D5dQM-6.js";import{R as k}from"./SelectField-DiJp5Ra2.js";import{D as L}from"./index-ClKtlEeL.js";import{B as $}from"./badge-DufY8Gpx.js";import"./calendar-B99NsLtP.js";import"./clock-PqgEqIzL.js";import"./check-DiqtQ1XW.js";const B=F().shape({financial_year:w().required("Financial Year is required"),regime:w().required("Regime is required").oneOf(["new","old"],"Invalid regime"),income_from:N().required("Income From is required").min(0,"Income From must be 0 or greater"),income_to:N().nullable().min(0,"Income To must be 0 or greater").test("income-to-greater","Income To must be greater than Income From",function(e){const{income_from:a}=this.parent;return null==e||e>a}),tax_rate:N().required("Tax Rate is required").min(0,"Tax Rate must be 0 or greater").max(100,"Tax Rate cannot exceed 100"),surcharge_rate:N().min(0,"Surcharge Rate must be 0 or greater").max(100,"Surcharge Rate cannot exceed 100").optional(),cess_rate:N().min(0,"Cess Rate must be 0 or greater").max(100,"Cess Rate cannot exceed 100").optional(),status:N().optional()});function O({open:n,setOpen:l,title:o,id:c,edit:d,setEdit:m,refetch:u}){var x;const j=b({}),{data:h,isFetching:g}=_({api:`${null==(x=e)?void 0:x.getIncomeTaxSlabById}?id=${a(String(c))}`,key:"getIncomeTaxSlabById",options:{enabled:d}}),p=s.useMemo(()=>{var e,a,s,t,i,r;return{financial_year:(null==(e=null==h?void 0:h.data)?void 0:e.financial_year)||"",regime:(null==(a=null==h?void 0:h.data)?void 0:a.regime)||"new",income_from:(null==(s=null==h?void 0:h.data)?void 0:s.income_from)||0,income_to:(null==(t=null==h?void 0:h.data)?void 0:t.income_to)||null,tax_rate:(null==(i=null==h?void 0:h.data)?void 0:i.tax_rate)?parseFloat(h.data.tax_rate):0,surcharge_rate:0,cess_rate:4,status:(null==(r=null==h?void 0:h.data)?void 0:r.status)||1}},[h]),v=T({defaultValues:p,resolver:R(B)});s.useEffect(()=>{v.reset(p)},[p,v]);return t.jsx(L,{open:n,setOpen:l,title:o,setEdit:m,edit:d,isLoading:g,children:t.jsxs(A,{methods:v,onSubmit:v.handleSubmit(async a=>{var s,t,i,n,o,x,h,g;try{if(d&&c){const l=await j.mutateAsync({api:`${null==(s=e)?void 0:s.updateIncomeTaxSlab}`,data:{id:Number(c),regime:a.regime,financial_year:a.financial_year,income_from:a.income_from,income_to:a.income_to,tax_rate:a.tax_rate,status:a.status}});(null==(t=l.data)?void 0:t.success)?r.success((null==(i=null==l?void 0:l.data)?void 0:i.message)||"Income Tax Slab updated successfully"):r.error((null==(n=l.data)?void 0:n.message)||"Failed to update Income Tax Slab")}else{const s=await j.mutateAsync({api:null==(o=e)?void 0:o.createIncomeTaxSlab,data:{financial_year:a.financial_year,regime:a.regime,income_from:a.income_from,income_to:a.income_to,tax_rate:a.tax_rate,surcharge_rate:a.surcharge_rate||0,cess_rate:a.cess_rate||4}});(null==(x=s.data)?void 0:x.success)?r.success((null==(h=null==s?void 0:s.data)?void 0:h.message)||"Income Tax Slab created successfully"):r.error((null==(g=s.data)?void 0:g.message)||"Failed to create Income Tax Slab"),v.reset({financial_year:"",regime:"new",income_from:0,income_to:null,tax_rate:0,surcharge_rate:0,cess_rate:4,status:1})}l(!1),m(!1),u()}catch(p){r.error("An error occurred")}}),children:[t.jsxs("div",{className:"grid grid-cols-2 gap-x-2 gap-y-4",children:[t.jsx("div",{children:t.jsx(k,{name:"financial_year",label:"Financial Year",data:i.map(e=>({label:e,value:e}))})}),t.jsx("div",{children:t.jsx(q,{name:"regime",label:"Regime",data:[{label:"New Regime",value:"new"},{label:"Old Regime",value:"old"}]})}),t.jsx("div",{children:t.jsx(E,{name:"income_from",placeholder:"Enter Income From",label:"Income From",type:"number"})}),t.jsx("div",{children:t.jsx(E,{name:"income_to",placeholder:"Enter Income To (Leave empty for above)",label:"Income To",type:"number"})}),t.jsx("div",{children:t.jsx(E,{name:"tax_rate",placeholder:"Enter Tax Rate (%)",label:"Tax Rate (%)",type:"number"})}),!d&&t.jsxs(t.Fragment,{children:[t.jsx("div",{children:t.jsx(E,{name:"surcharge_rate",placeholder:"Enter Surcharge Rate (%)",label:"Surcharge Rate (%)",type:"number"})}),t.jsx("div",{children:t.jsx(E,{name:"cess_rate",placeholder:"Enter Cess Rate (%)",label:"Cess Rate (%)",type:"number"})})]})]}),t.jsx(y,{}),t.jsx("div",{children:t.jsx(C,{isLoading:v.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:d?"Update":"Create"})})]})})}function P(){var a,i,o,T,R,F;const N=b({}),[w,A]=s.useState(1),[E]=s.useState(10),[C,q]=s.useState(""),[k,L]=s.useState(!1),[B,P]=s.useState(""),[z,D]=s.useState(!1),H=_({api:`${e.getAllIncomeTaxSlabs}?page=${w}&limit=${E}&q=${C}`,key:"getAllIncomeTaxSlabs",value:[w,E,C],options:{enabled:!0}}),M=e=>null===e?"Above":`â‚¹${e.toLocaleString("en-IN")}`;return t.jsxs("main",{className:"grid items-start",children:[t.jsx(O,{open:k,setOpen:L,title:z?"Edit Income Tax Slab":"Add Income Tax Slab",id:B,edit:z,setEdit:D,refetch:H.refetch}),t.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[t.jsxs("div",{className:"flex w-full justify-between gap-2",children:[t.jsx("div",{children:t.jsx(x,{search:C,setSearch:q,refetch:H.refetch,isFetching:null==H?void 0:H.isLoading})}),t.jsx("div",{className:"flex gap-2",children:t.jsx(n,{className:"flex items-center gap-2",onClick:()=>L(!0),children:"Add New"})})]}),t.jsx(y,{}),t.jsxs(c,{children:[t.jsx(d,{children:t.jsx(m,{children:"Income Tax Slabs"})}),t.jsx(u,{children:(null==H?void 0:H.isLoading)?t.jsx("div",{className:"flex items-center justify-center",children:t.jsx(I,{})}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs(j,{children:[t.jsx(h,{children:t.jsxs(g,{children:[t.jsx(p,{children:"#"}),t.jsx(p,{children:"Financial Year"}),t.jsx(p,{children:"Regime"}),t.jsx(p,{children:"Income From"}),t.jsx(p,{children:"Income To"}),t.jsx(p,{children:"Tax Rate (%)"}),t.jsx(p,{children:"Description"}),t.jsx(p,{children:"Status"}),t.jsx(p,{children:"Actions"})]})}),t.jsx(v,{children:(null==(a=null==H?void 0:H.data)?void 0:a.data)&&(null==(i=null==H?void 0:H.data)?void 0:i.data.length)>0?null==(o=null==H?void 0:H.data)?void 0:o.data.map((a,s)=>t.jsxs(g,{children:[t.jsx(f,{children:s+1}),t.jsx(f,{className:"font-medium",children:a.financial_year}),t.jsx(f,{children:t.jsx($,{variant:"new"===a.regime?"default":"secondary",children:"new"===a.regime?"New Regime":"Old Regime"})}),t.jsx(f,{children:M(a.income_from)}),t.jsx(f,{children:M(a.income_to)}),t.jsxs(f,{children:[a.tax_rate,"%"]}),t.jsx(f,{children:a.description}),t.jsx(f,{children:t.jsx("span",{className:"rounded-full px-3 py-1 text-xs font-semibold "+(1===a.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:1===a.status?"Active":"Inactive"})}),t.jsxs(f,{className:"flex gap-2",children:[t.jsx(n,{variant:"outline",size:"sm",onClick:()=>{return e=String(a.id),D(!0),L(!0),void P(e);var e},children:"Edit"}),t.jsx(n,{variant:"destructive",size:"sm",onClick:()=>(async a=>{var s,t,i,n;try{const l=await N.mutateAsync({api:null==(s=e)?void 0:s.deleteIncomeTaxSlab,data:{id:Number(a)}});(null==(t=null==l?void 0:l.data)?void 0:t.success)?(H.refetch(),r.success((null==(i=null==l?void 0:l.data)?void 0:i.message)||"Income Tax Slab deleted successfully")):r.error((null==(n=l.data)?void 0:n.message)||"Failed to delete Income Tax Slab")}catch(o){r.error(l(o))}})(String(a.id)),children:"Delete"})]})]},a.id)):t.jsx(g,{children:t.jsx(f,{colSpan:9,className:"text-center",children:"No Income Tax Slabs found"})})})]})})})]}),(null==(T=null==H?void 0:H.data)?void 0:T.pagination)&&t.jsx(S,{page:w,setPage:A,limit:E,totalPages:(null==(F=null==(R=null==H?void 0:H.data)?void 0:R.pagination)?void 0:F.totalPages)||1})]})]})}function z(){return t.jsx(o,{title:"Income Tax Slab",subTitle:"Manage Income Tax Slabs",children:t.jsx("div",{className:"py-12",children:t.jsx(P,{})})})}export{z as default};
