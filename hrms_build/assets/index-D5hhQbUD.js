import{r as e,aA as s,j as i,aB as a,al as t}from"./vendor-RyuIgj66.js";import{P as r}from"./index-DFF4_m_G.js";import{h as n}from"./moment-CBOc1lqT.js";import{h as d,e as l,B as o}from"./index-ey2GEmQz.js";import{C as c,a as m,b as u,c as v}from"./card-u7M7FP5y.js";import{T as x,a as p,b as f,c as j,d as h,e as g}from"./table-B_npepsp.js";import{u as _,b as D}from"./useCustomQuery-DTB6aAiD.js";import{P as b}from"./index-BHR1l08i.js";import{S as N}from"./separator-BQijJEjG.js";import{S as y}from"./index-CUStUwt1.js";import{S as A}from"./Spinner-BwGzvoRj.js";import{c as Y,a as S,e as M}from"./yup-CH6wvET8.js";import{F as R}from"./datetime-picker-dN6E5dqy.js";import{R as E}from"./RHFTextField-BSZ_cEI3.js";import{R as P}from"./RHFTextArea-DpBxMoiQ.js";import{B as q}from"./ButtonLoading-DDalXO-W.js";import"./select-8PAfYjod.js";import"./input-DlX9dTT0.js";import"./switch-Cssv6fnZ.js";import"./checkbox-DFFItNXW.js";import"./label-BcY3kv5U.js";import{D as C}from"./index-B2ia16z0.js";import{B as O}from"./badge-DbWnzWn2.js";import"./ui-B3c1eQmf.js";import"./icons-CxCh8mm_.js";import"./query-BH9sOW2X.js";import"./axios-Dos3PyFQ.js";import"./zustand-C1rkr5lV.js";const F=Y().shape({pay_commission_id:M().nullable().typeError("Pay Commission must be a number").transform((e,s)=>""===s||null===s?null:e),da_percentage:M().typeError("DA Percentage must be a number").required("DA Percentage is required").min(0,"DA Percentage must be greater than or equal to 0").max(100,"DA Percentage cannot exceed 100"),effective_from:S().required("Effective From date is required"),effective_to:S().nullable().transform((e,s)=>""===s?null:e),government_order_no:S().required("Government Order Number is required"),government_order_date:S().required("Government Order Date is required"),description:S().required("Description is required")});function $({open:r,setOpen:o,title:c,id:m,edit:u,setEdit:v,refetch:x}){var p,f;const j=_({}),{data:h,isFetching:g}=D({api:`${null==(p=d)?void 0:p.getDARevisionById}?id=${l(String(m))}`,key:"getDARevisionById",options:{enabled:!!m&&!!u}}),{data:b}=D({api:`${null==(f=d)?void 0:f.getAllPayCommissions}`,key:"getAllPayCommissions",options:{enabled:!0}}),y=e.useMemo(()=>{var e,s,i,a,t,r,d;return{pay_commission_id:(null==(e=null==h?void 0:h.data)?void 0:e.pay_commission_id)||null,da_percentage:(null==(s=null==h?void 0:h.data)?void 0:s.da_percentage)?Number(h.data.da_percentage):0,effective_from:(null==(i=null==h?void 0:h.data)?void 0:i.effective_from)?n(h.data.effective_from).format("YYYY-MM-DD"):"",effective_to:(null==(a=null==h?void 0:h.data)?void 0:a.effective_to)?n(h.data.effective_to).format("YYYY-MM-DD"):"",government_order_no:(null==(t=null==h?void 0:h.data)?void 0:t.government_order_no)||"",government_order_date:(null==(r=null==h?void 0:h.data)?void 0:r.government_order_date)?n(h.data.government_order_date).format("YYYY-MM-DD"):"",description:(null==(d=null==h?void 0:h.data)?void 0:d.description)||""}},[h]),A=s({defaultValues:y,resolver:a(F)});return e.useEffect(()=>{u&&h&&A.reset(y)},[y,u]),i.jsx(C,{open:r,setOpen:o,title:c,setEdit:v,edit:u,isLoading:g,children:i.jsx(R,{methods:A,onSubmit:A.handleSubmit(async e=>{var s,i,a,r,n,l,c,p;try{const f={...e,pay_commission_id:e.pay_commission_id||null,effective_to:e.effective_to||null};if(u&&m){const e=await j.mutateAsync({api:`${null==(s=d)?void 0:s.updateDARevision}`,data:{id:m,...f}});(null==(i=e.data)?void 0:i.success)?t.success(null==(a=null==e?void 0:e.data)?void 0:a.message):t.error((null==(r=e.data)?void 0:r.message)||"DA Revision not updated successfully")}else{const e=await j.mutateAsync({api:null==(n=d)?void 0:n.createDARevision,data:f});(null==(l=e.data)?void 0:l.success)?t.success(null==(c=null==e?void 0:e.data)?void 0:c.message):t.error((null==(p=e.data)?void 0:p.message)||"DA Revision not created successfully")}A.reset(),o(!1),v(!1),x()}catch(f){}}),children:i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Basic Information"}),i.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:i.jsx(E,{name:"da_percentage",label:"DA Percentage (%)",placeholder:"e.g., 50",type:"number",inputValidation:["decimal"]})})]}),i.jsx("div",{children:i.jsx(P,{name:"description",label:"Description",placeholder:"Brief description of this DA revision...",inputValidation:["removeSpecialCharacterExceptSpace"]})})]}),i.jsx(N,{}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Effective Period"}),i.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[i.jsx(E,{name:"effective_from",label:"Effective From",type:"date"}),i.jsx(E,{name:"effective_to",label:"Effective To (Optional)",type:"date"})]})]}),i.jsx(N,{}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Government Order Details"}),i.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[i.jsx(E,{name:"government_order_no",label:"Government Order Number",placeholder:"e.g., DA/2025/001",inputValidation:["removeSpecialCharacterExceptSpace"]}),i.jsx(E,{name:"government_order_date",label:"Government Order Date",type:"date"})]})]}),i.jsx(N,{className:"my-6"}),i.jsx("div",{className:"pt-2",children:i.jsx(q,{isLoading:A.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:u?"Update DA Revision":"Create DA Revision"})})]})})})}function w(){var s,a,t,r,l,Y,S;_({});const[M,R]=e.useState(1),[E,P]=e.useState(10),[q,C]=e.useState(""),[F,w]=e.useState(!1),[B,L]=e.useState(""),[k,G]=e.useState(!1),[T,I]=e.useState(null),V=D({api:`${d.getAllDARevisions}?page=${M}&limit=${E}&q=${q}`,key:"getAllDARevisions",value:[M,E,q],options:{enabled:!0}}),{data:H}=D({api:`${null==(s=d)?void 0:s.getCurrentDA}`,key:"getCurrentDA",options:{enabled:!0}});return i.jsxs("main",{className:"grid items-start",children:[i.jsx($,{open:F,setOpen:w,title:k?"Edit DA Revision":"Add DA Revision",id:B,edit:k,setEdit:G,refetch:V.refetch}),i.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[(null==H?void 0:H.data)&&i.jsxs(c,{className:"border-primary/20 bg-primary/5",children:[i.jsx(m,{className:"px-7",children:i.jsx(u,{className:"text-lg font-semibold text-primary",children:"Current DA Rate"})}),i.jsx(v,{children:i.jsxs("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"DA Percentage"}),i.jsxs("p",{className:"text-2xl font-bold text-primary",children:[H.data.da_percentage,"%"]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Effective From"}),i.jsx("p",{className:"font-semibold",children:n(H.data.effective_from).format("DD-MM-YYYY")})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Government Order No"}),i.jsx("p",{className:"font-semibold",children:H.data.government_order_no})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Order Date"}),i.jsx("p",{className:"font-semibold",children:n(H.data.government_order_date).format("DD-MM-YYYY")})]})]})})]}),i.jsxs("div",{className:"flex w-full justify-between gap-2",children:[i.jsx("div",{children:i.jsx(y,{search:q,setSearch:C,refetch:V.refetch,isFetching:null==V?void 0:V.isLoading})}),i.jsx("div",{children:i.jsx(o,{className:"flex items-center gap-2",onClick:()=>w(!0),children:"Update DA Revision"})})]}),i.jsxs(c,{children:[i.jsx(m,{className:"px-7",children:i.jsxs(u,{children:["DA Revision List (",(null==(t=null==(a=null==V?void 0:V.data)?void 0:a.data)?void 0:t.length)||0,")"]})}),i.jsx(v,{children:V.isLoading?i.jsx("div",{className:"flex h-32 items-center justify-center",children:i.jsx(A,{})}):i.jsxs(i.Fragment,{children:[i.jsxs(x,{children:[i.jsx(p,{children:i.jsxs(f,{children:[i.jsx(j,{className:"",children:"#"}),i.jsx(j,{className:"",children:"DA Percentage"}),i.jsx(j,{className:"",children:"Effective From"}),i.jsx(j,{className:"",children:"Effective To"}),i.jsx(j,{className:"",children:"Government Order No"}),i.jsx(j,{className:"",children:"Order Date"}),i.jsx(j,{className:"",children:"Description"}),i.jsx(j,{className:"",children:"Created at"}),i.jsx(j,{className:"",children:"Status"})]})}),i.jsx(h,{children:null==(l=null==(r=null==V?void 0:V.data)?void 0:r.data)?void 0:l.map((e,s)=>i.jsxs(f,{children:[i.jsx(g,{children:s+1}),i.jsx(g,{children:i.jsxs(O,{variant:"default",className:"text-base font-semibold",children:[null==e?void 0:e.da_percentage,"%"]})}),i.jsx(g,{children:n(null==e?void 0:e.effective_from).format("DD-MM-YYYY")}),i.jsx(g,{children:(null==e?void 0:e.effective_to)?n(null==e?void 0:e.effective_to).format("DD-MM-YYYY"):"-"}),i.jsx(g,{children:null==e?void 0:e.government_order_no}),i.jsx(g,{children:n(null==e?void 0:e.government_order_date).format("DD-MM-YYYY")}),i.jsx(g,{className:"max-w-xs truncate",children:null==e?void 0:e.description}),i.jsx(g,{children:n(null==e?void 0:e.created_at).format("DD-MM-YYYY")}),i.jsx(g,{children:i.jsx(O,{variant:1===(null==e?void 0:e.status)?"default":"secondary",children:1===(null==e?void 0:e.status)?"Active":"Inactive"})})]},null==e?void 0:e.id))})]}),i.jsx(N,{className:"mb-2 mt-4"}),i.jsx("div",{className:"flex w-full justify-end",children:i.jsx(b,{page:M,limit:E,totalPages:Math.ceil(((null==(S=null==(Y=null==V?void 0:V.data)?void 0:Y.data)?void 0:S.length)||0)/E),setPage:R,setLimit:P})})]})})]})]})]})}function B(){return i.jsx(r,{title:"DA Revision List",subTitle:"Manage all the DA Revisions here",children:i.jsx("div",{className:"py-12",children:i.jsx(w,{})})})}export{B as default};
