import{j as e,an as a,r as s,al as l}from"./vendor-RyuIgj66.js";import{D as i,c as t,e as n,f as r,P as c}from"./index-DFF4_m_G.js";import{c as o,B as d,t as x,g as m}from"./index-ey2GEmQz.js";import{C as u,a as j,b as v,c as _}from"./card-u7M7FP5y.js";import{T as h,a as p,b as f,c as g,d as b,e as y}from"./table-B_npepsp.js";import{u as N,b as w}from"./useCustomQuery-DTB6aAiD.js";import{P as S}from"./index-BHR1l08i.js";import{S as D}from"./separator-BQijJEjG.js";import{S as k}from"./index-CUStUwt1.js";import{S as C}from"./Spinner-BwGzvoRj.js";import{B as A}from"./badge-DbWnzWn2.js";import{S as P,a as T,b as $,c as R,d as F}from"./select-8PAfYjod.js";import{A as L,a as I,b as E,c as O,d as V,e as z,f as H,g as Y}from"./alert-dialog-DDS3Mbsz.js";import{T as M}from"./textarea-CIMcDPG7.js";import{ay as B,aj as q,E as U,ak as G,$ as J,N as Q}from"./icons-CxCh8mm_.js";import"./ui-B3c1eQmf.js";import"./query-BH9sOW2X.js";import"./axios-Dos3PyFQ.js";import"./zustand-C1rkr5lV.js";import"./input-DlX9dTT0.js";const W=e=>null==e||0===e?"-":`₹${e.toLocaleString("en-IN")}`,K=({title:a,children:s})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"mb-2 font-semibold text-primary",children:a}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:s})]}),X=({label:a,value:s})=>e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-muted-foreground",children:[a,":"]}),e.jsx("span",{className:"font-medium",children:s||"-"})]});function Z({open:a,setOpen:s,declaration:l}){var c;if(!l)return null;const o=()=>(l.sec_80c_ppf||0)+(l.sec_80c_epf||0)+(l.sec_80c_elss||0)+(l.sec_80c_life_insurance||0)+(l.sec_80c_nsc||0)+(l.sec_80c_tuition_fees||0)+(l.sec_80c_housing_loan_principal||0)+(l.sec_80c_sukanya_samriddhi||0)+(l.sec_80c_tax_saver_fd||0)+(l.sec_80c_ulip||0)+(l.sec_80c_other||0);return e.jsx(i,{open:a,onOpenChange:s,children:e.jsxs(t,{className:"max-w-2xl",children:[e.jsx(n,{children:e.jsxs(r,{className:"flex items-center gap-2",children:["Tax Declaration Details",e.jsx(A,{variant:"new"===l.tax_regime?"default":"secondary",children:"new"===l.tax_regime?"New Regime":"Old Regime"}),e.jsx(A,{variant:l.declaration_locked?"destructive":"approved"===l.verification_status?"default":"rejected"===l.verification_status?"destructive":"outline",children:l.declaration_locked?"Locked":l.verification_status?l.verification_status.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase()):"Pending"})]})}),e.jsxs("div",{className:"max-h-[70vh] pr-4",children:[e.jsxs(K,{title:"Employee Information",children:[e.jsx(X,{label:"Name",value:l.employee_name}),e.jsx(X,{label:"Code",value:l.employee_code}),e.jsx(X,{label:"Department",value:l.department_name}),e.jsx(X,{label:"Financial Year",value:l.financial_year})]}),e.jsx(D,{className:"my-4"}),"old"===l.tax_regime&&e.jsxs(e.Fragment,{children:[e.jsxs(K,{title:"Section 80C Investments (Max ₹1,50,000)",children:[e.jsx(X,{label:"PPF",value:W(l.sec_80c_ppf)}),e.jsx(X,{label:"EPF",value:W(l.sec_80c_epf)}),e.jsx(X,{label:"ELSS",value:W(l.sec_80c_elss)}),e.jsx(X,{label:"Life Insurance",value:W(l.sec_80c_life_insurance)}),e.jsx(X,{label:"NSC",value:W(l.sec_80c_nsc)}),e.jsx(X,{label:"Tuition Fees",value:W(l.sec_80c_tuition_fees)}),e.jsx(X,{label:"Housing Loan Principal",value:W(l.sec_80c_housing_loan_principal)}),e.jsx(X,{label:"Sukanya Samriddhi",value:W(l.sec_80c_sukanya_samriddhi)}),e.jsx(X,{label:"Tax Saver FD",value:W(l.sec_80c_tax_saver_fd)}),e.jsx(X,{label:"ULIP",value:W(l.sec_80c_ulip)}),e.jsx(X,{label:"Other",value:W(l.sec_80c_other)}),e.jsxs("div",{className:"col-span-2 mt-2 rounded bg-muted p-2",children:[e.jsxs("strong",{children:["Total 80C:"," ",W(Math.min(o(),15e4))]}),o()>15e4&&e.jsx("span",{className:"ml-2 text-xs text-destructive",children:"(Capped at ₹1,50,000)"})]})]}),e.jsx(D,{className:"my-4"}),e.jsxs(K,{title:"Section 80D - Health Insurance",children:[e.jsx(X,{label:"Self & Family",value:W(l.sec_80d_self_family)}),e.jsx(X,{label:"Parents",value:W(l.sec_80d_parents)}),e.jsx(X,{label:"Preventive Checkup",value:W(l.sec_80d_preventive_checkup)}),e.jsx(X,{label:"Self Senior Citizen",value:l.sec_80d_self_senior_citizen?"Yes":"No"}),e.jsx(X,{label:"Parents Senior Citizen",value:l.sec_80d_parents_senior_citizen?"Yes":"No"}),e.jsx("div",{className:"col-span-2 mt-2 rounded bg-muted p-2",children:e.jsxs("strong",{children:["Total 80D: ",W((l.sec_80d_self_family||0)+(l.sec_80d_parents||0)+(l.sec_80d_preventive_checkup||0))]})})]}),e.jsx(D,{className:"my-4"}),e.jsxs(K,{title:"Other Deductions",children:[e.jsx(X,{label:"80E Education Loan Interest",value:W(l.sec_80e_education_loan_interest)}),e.jsx(X,{label:"80G Donations (100%)",value:W(l.sec_80g_100_percent)}),e.jsx(X,{label:"80G Donations (50%)",value:W(l.sec_80g_50_percent)}),e.jsx(X,{label:"80EEA Home Loan Interest",value:W(l.sec_80eea_home_loan_interest)}),e.jsx(X,{label:"80TTA Savings Interest",value:W(l.sec_80tta_savings_interest)}),e.jsx(X,{label:"80U Disability",value:W(l.sec_80u_disability)}),e.jsx(X,{label:"80DD Dependent Disability",value:W(l.sec_80dd_dependent_disability)})]}),e.jsx(D,{className:"my-4"}),e.jsxs(K,{title:"Home Loan & HRA",children:[e.jsx(X,{label:"Sec 24 Home Loan Interest",value:W(l.sec_24_home_loan_interest)}),e.jsx(X,{label:"Property Type",value:null==(c=l.property_type)?void 0:c.replace("_"," ")}),e.jsx(X,{label:"Annual Rent Paid",value:W(l.rent_paid_annual)}),e.jsx(X,{label:"Metro City",value:l.is_metro_city?"Yes":"No"}),e.jsx(X,{label:"Loss from House Property",value:W(l.loss_from_house_property)})]})]}),e.jsx(D,{className:"my-4"}),e.jsxs(K,{title:"NPS Contributions (Both Regimes)",children:[e.jsx(X,{label:"80CCD(1B) Self NPS",value:W(l.sec_80ccd_1b_nps)}),e.jsx(X,{label:"80CCD(2) Employer NPS",value:W(l.sec_80ccd_2_employer_nps)})]}),"new"===l.tax_regime&&e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"my-4"}),e.jsxs(K,{title:"New Regime Specific",children:[e.jsx(X,{label:"Family Pension Deduction",value:W(l.family_pension_deduction)}),e.jsx(X,{label:"80JJAA New Employment",value:W(l.sec_80jjaa_new_employment)}),e.jsx(X,{label:"80CCH Agniveer",value:W(l.sec_80cch_agniveer)}),e.jsx(X,{label:"Transport Allowance (Disabled)",value:W(l.transport_allowance_disabled)}),e.jsx(X,{label:"Conveyance Allowance",value:W(l.conveyance_allowance)})]})]}),l.hr_verified_at&&e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"my-4"}),e.jsxs(K,{title:"Verification Details",children:[e.jsx(X,{label:"Verified At",value:new Date(l.hr_verified_at).toLocaleDateString()}),e.jsx(X,{label:"Remarks",value:l.hr_remarks})]})]})]})]})})}const ee=e=>null==e?"₹0":`₹${e.toLocaleString("en-IN")}`;function ae(){var i,t,n,r,c,W,K,X,ae,se,le;const ie=a(),{user:te}=o(),ne=N({}),[re,ce]=s.useState(1),[oe]=s.useState(10),[de,xe]=s.useState(""),[me,ue]=s.useState((()=>{const e=new Date,a=e.getFullYear();return e.getMonth()+1>=4?`${a}-${(a+1).toString().slice(-2)}`:`${a-1}-${a.toString().slice(-2)}`})()),[je,ve]=s.useState("all"),[_e,he]=s.useState("all"),[pe,fe]=s.useState(null),[ge,be]=s.useState(!1),[ye,Ne]=s.useState(!1),[we,Se]=s.useState(!1),[De,ke]=s.useState(""),[Ce,Ae]=s.useState("approved"),Pe=(null==te?void 0:te.ulbId)||localStorage.getItem("ulbId"),Te=w({api:`${x.getAllTaxDeclarations}?page=${re}&limit=${oe}&q=${de}&financial_year=${me}&ulb_id=${Pe}${"all"!==je?`&verification_status=${je}`:""}${"all"!==_e?`&tax_regime=${_e}`:""}`,key:"getAllTaxDeclarations",value:[re,oe,me,je,_e,Pe],options:{enabled:!!Pe}});return e.jsxs("main",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50",children:[e.jsx(Z,{open:ge,setOpen:be,declaration:pe}),e.jsx(L,{open:ye,onOpenChange:Ne,children:e.jsxs(I,{children:[e.jsxs(E,{children:[e.jsxs(O,{children:["approved"===Ce?"Approve":"Reject"," Tax Declaration"]}),e.jsx(V,{children:"approved"===Ce?`Approve investment declaration for ${null==pe?void 0:pe.employee_name}? This will allow the employee to upload investment proofs.`:`Reject investment declaration for ${null==pe?void 0:pe.employee_name}? The employee will need to resubmit.`})]}),e.jsxs("div",{className:"my-4",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Remarks"," ","rejected"===Ce?"(Required)":"(Optional)"]}),e.jsx(M,{value:De,onChange:e=>ke(e.target.value),placeholder:"rejected"===Ce?"Enter reason for rejection...":"Enter remarks...",className:"mt-2"})]}),e.jsxs(z,{children:[e.jsx(H,{children:"Cancel"}),e.jsx(Y,{onClick:async()=>{var e,a,s;if(pe)try{const i=await ne.mutateAsync({api:`${x.verifyTaxDeclaration}/${pe.id}/verify`,data:{verification_status:Ce,verification_remarks:De}});(null==(e=null==i?void 0:i.data)?void 0:e.success)?(Te.refetch(),l.success((null==(a=null==i?void 0:i.data)?void 0:a.message)||"Declaration verified successfully"),Ne(!1)):l.error((null==(s=i.data)?void 0:s.message)||"Failed to verify declaration")}catch(i){l.error(m(i))}},className:"rejected"===Ce?"bg-destructive hover:bg-destructive/90":"",disabled:"rejected"===Ce&&!De.trim(),children:"approved"===Ce?"Approve":"Reject"})]})]})}),e.jsx(L,{open:we,onOpenChange:Se,children:e.jsxs(I,{children:[e.jsxs(E,{children:[e.jsx(O,{children:"Lock Tax Declaration"}),e.jsxs(V,{children:["Lock declaration for"," ",e.jsx("strong",{children:null==pe?void 0:pe.employee_name}),"?",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{className:"text-destructive",children:"Warning:"})," Once locked, it cannot be modified."]})]}),e.jsxs(z,{children:[e.jsx(H,{children:"Cancel"}),e.jsx(Y,{onClick:async()=>{var e,a,s;if(pe)try{const i=await ne.mutateAsync({api:`${x.lockTaxDeclaration}/${pe.id}/lock`,data:{}});(null==(e=null==i?void 0:i.data)?void 0:e.success)?(Te.refetch(),l.success((null==(a=null==i?void 0:i.data)?void 0:a.message)||"Declaration locked successfully"),Se(!1)):l.error((null==(s=i.data)?void 0:s.message)||"Failed to lock declaration")}catch(i){l.error(m(i))}},className:"bg-destructive",children:"Lock Declaration"})]})]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs(u,{className:"border border-gray-200 bg-white shadow-lg",children:[e.jsx(j,{className:"rounded-t-lg bg-gradient-to-r from-blue-600 to-indigo-600 text-white",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"h-6 w-6"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Tax Declarations"}),e.jsxs(v,{className:"mt-1 text-blue-100",children:["Total Declarations:"," ",(null==(t=null==(i=null==Te?void 0:Te.data)?void 0:i.pagination)?void 0:t.total)||0]})]})]})})}),e.jsxs(_,{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(k,{search:de,setSearch:xe,refetch:Te.refetch,isFetching:null==Te?void 0:Te.isLoading})}),e.jsxs(P,{value:me,onValueChange:ue,children:[e.jsx(T,{className:"w-[140px]",children:e.jsx($,{placeholder:"Financial Year"})}),e.jsxs(R,{children:[e.jsx(F,{value:"2025-26",children:"2025-26"}),e.jsx(F,{value:"2024-25",children:"2024-25"}),e.jsx(F,{value:"2023-24",children:"2023-24"})]})]}),e.jsxs(P,{value:je,onValueChange:ve,children:[e.jsx(T,{className:"w-[160px]",children:e.jsx($,{placeholder:"Status"})}),e.jsxs(R,{children:[e.jsx(F,{value:"all",children:"All Status"}),e.jsx(F,{value:"pending",children:"Pending Approval"}),e.jsx(F,{value:"approved",children:"Approved"}),e.jsx(F,{value:"partially_verified",children:"Partially Verified"}),e.jsx(F,{value:"verified",children:"Fully Verified"}),e.jsx(F,{value:"rejected",children:"Rejected"})]})]}),e.jsxs(P,{value:_e,onValueChange:he,children:[e.jsx(T,{className:"w-[130px]",children:e.jsx($,{placeholder:"Regime"})}),e.jsxs(R,{children:[e.jsx(F,{value:"all",children:"All Regimes"}),e.jsx(F,{value:"old",children:"Old Regime"}),e.jsx(F,{value:"new",children:"New Regime"})]})]})]})}),e.jsx(D,{className:"my-6"}),(null==Te?void 0:Te.isLoading)?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(C,{})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-200",children:e.jsxs(h,{children:[e.jsx(p,{children:e.jsxs(f,{className:"bg-gray-50 hover:bg-gray-50",children:[e.jsx(g,{className:"w-16 font-semibold text-gray-700",children:"#"}),e.jsx(g,{className:"font-semibold text-gray-700",children:"Employee"}),e.jsx(g,{className:"font-semibold text-gray-700",children:"Department"}),e.jsx(g,{className:"font-semibold text-gray-700",children:"FY"}),e.jsx(g,{className:"font-semibold text-gray-700",children:"Regime"}),e.jsx(g,{className:"font-semibold text-gray-700",children:"80C Total"}),e.jsx(g,{className:"font-semibold text-gray-700",children:"80D Total"}),e.jsx(g,{className:"font-semibold text-gray-700",children:"Status"}),e.jsx(g,{className:"text-center font-semibold text-gray-700",children:"Actions"})]})}),e.jsx(b,{children:((null==(r=null==(n=null==Te?void 0:Te.data)?void 0:n.data)?void 0:r.length)??0)>0?null==(c=null==Te?void 0:Te.data)?void 0:c.data.map((a,s)=>{const l=(e=>{switch(e){case"pending":return{variant:"secondary",label:"Pending Approval"};case"approved":return{variant:"default",label:"Approved"};case"partially_verified":return{variant:"outline",label:"Partially Verified"};case"verified":return{variant:"default",label:"Verified"};case"rejected":return{variant:"destructive",label:"Rejected"};default:return{variant:"secondary",label:e}}})(a.verification_status||"pending");return e.jsxs(f,{className:"transition-colors duration-150 hover:bg-blue-50/50",children:[e.jsx(y,{className:"font-medium text-gray-600",children:(re-1)*oe+s+1}),e.jsxs(y,{children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.employee_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.employee_code})]}),e.jsx(y,{className:"text-gray-700",children:a.department_name||"-"}),e.jsx(y,{className:"font-medium text-gray-900",children:a.financial_year}),e.jsx(y,{children:e.jsx(A,{variant:"new"===a.tax_regime?"default":"secondary",children:"new"===a.tax_regime?"New":"Old"})}),e.jsx(y,{className:"font-medium",children:ee((i=a,(i.sec_80c_ppf||0)+(i.sec_80c_epf||0)+(i.sec_80c_elss||0)+(i.sec_80c_life_insurance||0)+(i.sec_80c_nsc||0)+(i.sec_80c_tuition_fees||0)+(i.sec_80c_housing_loan_principal||0)+(i.sec_80c_sukanya_samriddhi||0)+(i.sec_80c_tax_saver_fd||0)+(i.sec_80c_ulip||0)+(i.sec_80c_other||0)))}),e.jsx(y,{className:"font-medium",children:ee((a.sec_80d_self_family||0)+(a.sec_80d_parents||0))}),e.jsx(y,{children:e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsx(A,{variant:l.variant,className:"w-fit",children:l.label}),a.declaration_locked&&e.jsxs(A,{variant:"destructive",className:"w-fit text-xs",children:[e.jsx(q,{className:"mr-1 h-3 w-3"})," Locked"]})]})}),e.jsx(y,{children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(d,{variant:"outline",size:"icon",title:"View Details",onClick:()=>(fe(a),void be(!0)),children:e.jsx(U,{className:"h-4 w-4"})}),"pending"===a.verification_status&&!a.declaration_locked&&e.jsxs(e.Fragment,{children:[e.jsx(d,{variant:"outline",size:"icon",title:"Approve Declaration",onClick:()=>(fe(a),Ae("approved"),ke(""),void Ne(!0)),children:e.jsx(G,{className:"h-4 w-4 text-green-600"})}),e.jsx(d,{variant:"outline",size:"icon",title:"Reject Declaration",onClick:()=>(fe(a),Ae("rejected"),ke(""),void Ne(!0)),children:e.jsx(J,{className:"h-4 w-4 text-destructive"})})]}),["approved","partially_verified","verified"].includes(a.verification_status||"")&&!a.declaration_locked&&e.jsx(d,{variant:"outline",size:"icon",title:"Lock Declaration",onClick:()=>(fe(a),void Se(!0)),children:e.jsx(q,{className:"h-4 w-4 text-orange-500"})}),["approved","partially_verified","verified"].includes(a.verification_status||"")&&e.jsx(d,{variant:"outline",size:"icon",title:"View Investment Proofs",onClick:()=>ie(`/hrms/dashboard/payroll/investment-proofs/${a.id}`),children:e.jsx(Q,{className:"h-4 w-4"})})]})})]},a.id??`tax-declaration-${s}`);var i}):e.jsx(f,{children:e.jsx(y,{colSpan:9,className:"py-8 text-center text-gray-500",children:"No Tax Declarations found"})})})]})}),e.jsxs("div",{className:"mt-6 flex items-center justify-between rounded-lg border border-gray-200 bg-gray-50 p-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",(re-1)*oe+1," to"," ",Math.min(re*oe,(null==(K=null==(W=null==Te?void 0:Te.data)?void 0:W.pagination)?void 0:K.total)||0)," ","of ",(null==(ae=null==(X=null==Te?void 0:Te.data)?void 0:X.pagination)?void 0:ae.total)||0," ","entries"]}),e.jsx(S,{page:re,setPage:ce,limit:oe,totalPages:(null==(le=null==(se=null==Te?void 0:Te.data)?void 0:se.pagination)?void 0:le.totalPages)||1})]})]})]})]})})]})}function se(){return e.jsx(c,{title:"Tax Declarations",subTitle:"Review and approve employee tax declarations",children:e.jsx(ae,{})})}export{se as default};
