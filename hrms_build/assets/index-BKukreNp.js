import{h as e,f as s,r as i,j as a,z as t,B as r}from"./index-UYY99J9q.js";import{P as l}from"./index-Dj741qwl.js";import{h as n}from"./moment-CBOc1lqT.js";import{C as d,a as o,b as c,c as m}from"./card-CtI_IPLF.js";import{T as u,a as v,b as x,c as f,d as p,e as j}from"./table-CS0u2e-w.js";import{u as h,b as g}from"./useCustomQuery-Dp3AX7R2.js";import{P as _}from"./index-914tDITV.js";import{S as D}from"./separator-BrVypJ4m.js";import{S as b}from"./index-UiGf0NcE.js";import{S as N}from"./Spinner-CjaIOVSb.js";import{a as y,o as A,c as Y,b as S,f as R}from"./yup-jtZe4Tk8.js";import{F as M}from"./datetime-picker-CgwSorNf.js";import{R as E}from"./RHFTextField-BtYg5IGX.js";import{R as P}from"./RHFTextArea-twp-JmnQ.js";import{B as C}from"./ButtonLoading-C1bL9ixh.js";import"./select-CcbMZzqU.js";import"./input-qBPs6xkH.js";import"./switch-CnTLVnvq.js";import"./checkbox-D8MNaO54.js";import"./label-DVj88vWk.js";import{D as O}from"./index-D5PwM2eu.js";import{B as q}from"./badge-B68rjZDB.js";import"./calendar-ddNksXQs.js";import"./format-BkNqQ0tt.js";import"./chevron-right-BO4a-O50.js";import"./clock-CXHA5hGN.js";import"./check-B5JmqH3y.js";const F=Y().shape({pay_commission_id:R().nullable().typeError("Pay Commission must be a number").transform((e,s)=>""===s||null===s?null:e),da_percentage:R().typeError("DA Percentage must be a number").required("DA Percentage is required").min(0,"DA Percentage must be greater than or equal to 0").max(100,"DA Percentage cannot exceed 100"),effective_from:S().required("Effective From date is required"),effective_to:S().nullable().transform((e,s)=>""===s?null:e),government_order_no:S().required("Government Order Number is required"),government_order_date:S().required("Government Order Date is required"),description:S().required("Description is required")});function $({open:r,setOpen:l,title:d,id:o,edit:c,setEdit:m,refetch:u}){var v,x;const f=h({}),{data:p,isFetching:j}=g({api:`${null==(v=e)?void 0:v.getDARevisionById}?id=${s(String(o))}`,key:"getDARevisionById",options:{enabled:!!o&&!!c}}),{data:_}=g({api:`${null==(x=e)?void 0:x.getAllPayCommissions}`,key:"getAllPayCommissions",options:{enabled:!0}}),b=i.useMemo(()=>{var e,s,i,a,t,r,l;return{pay_commission_id:(null==(e=null==p?void 0:p.data)?void 0:e.pay_commission_id)||null,da_percentage:(null==(s=null==p?void 0:p.data)?void 0:s.da_percentage)?Number(p.data.da_percentage):0,effective_from:(null==(i=null==p?void 0:p.data)?void 0:i.effective_from)?n(p.data.effective_from).format("YYYY-MM-DD"):"",effective_to:(null==(a=null==p?void 0:p.data)?void 0:a.effective_to)?n(p.data.effective_to).format("YYYY-MM-DD"):"",government_order_no:(null==(t=null==p?void 0:p.data)?void 0:t.government_order_no)||"",government_order_date:(null==(r=null==p?void 0:p.data)?void 0:r.government_order_date)?n(p.data.government_order_date).format("YYYY-MM-DD"):"",description:(null==(l=null==p?void 0:p.data)?void 0:l.description)||""}},[p]),N=y({defaultValues:b,resolver:A(F)});return i.useEffect(()=>{c&&p&&N.reset(b)},[b,c]),a.jsx(O,{open:r,setOpen:l,title:d,setEdit:m,edit:c,isLoading:j,children:a.jsx(M,{methods:N,onSubmit:N.handleSubmit(async s=>{var i,a,r,n,d,v,x,p;try{const j={...s,pay_commission_id:s.pay_commission_id||null,effective_to:s.effective_to||null};if(c&&o){const s=await f.mutateAsync({api:`${null==(i=e)?void 0:i.updateDARevision}`,data:{id:o,...j}});(null==(a=s.data)?void 0:a.success)?t.success(null==(r=null==s?void 0:s.data)?void 0:r.message):t.error((null==(n=s.data)?void 0:n.message)||"DA Revision not updated successfully")}else{const s=await f.mutateAsync({api:null==(d=e)?void 0:d.createDARevision,data:j});(null==(v=s.data)?void 0:v.success)?t.success(null==(x=null==s?void 0:s.data)?void 0:x.message):t.error((null==(p=s.data)?void 0:p.message)||"DA Revision not created successfully")}N.reset(),l(!1),m(!1),u()}catch(j){}}),children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Basic Information"}),a.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:a.jsx(E,{name:"da_percentage",label:"DA Percentage (%)",placeholder:"e.g., 50",type:"number",inputValidation:["decimal"]})})]}),a.jsx("div",{children:a.jsx(P,{name:"description",label:"Description",placeholder:"Brief description of this DA revision...",inputValidation:["removeSpecialCharacterExceptSpace"]})})]}),a.jsx(D,{}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Effective Period"}),a.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[a.jsx(E,{name:"effective_from",label:"Effective From",type:"date"}),a.jsx(E,{name:"effective_to",label:"Effective To (Optional)",type:"date"})]})]}),a.jsx(D,{}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Government Order Details"}),a.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[a.jsx(E,{name:"government_order_no",label:"Government Order Number",placeholder:"e.g., DA/2025/001",inputValidation:["removeSpecialCharacterExceptSpace"]}),a.jsx(E,{name:"government_order_date",label:"Government Order Date",type:"date"})]})]}),a.jsx(D,{className:"my-6"}),a.jsx("div",{className:"pt-2",children:a.jsx(C,{isLoading:N.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:c?"Update DA Revision":"Create DA Revision"})})]})})})}function k(){var s,t,l,y,A,Y,S;h({});const[R,M]=i.useState(1),[E,P]=i.useState(10),[C,O]=i.useState(""),[F,k]=i.useState(!1),[w,B]=i.useState(""),[L,G]=i.useState(!1),[T,V]=i.useState(null),I=g({api:`${e.getAllDARevisions}?page=${R}&limit=${E}&q=${C}`,key:"getAllDARevisions",value:[R,E,C],options:{enabled:!0}}),{data:U}=g({api:`${null==(s=e)?void 0:s.getCurrentDA}`,key:"getCurrentDA",options:{enabled:!0}});return a.jsxs("main",{className:"grid items-start",children:[a.jsx($,{open:F,setOpen:k,title:L?"Edit DA Revision":"Add DA Revision",id:w,edit:L,setEdit:G,refetch:I.refetch}),a.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[(null==U?void 0:U.data)&&a.jsxs(d,{className:"border-primary/20 bg-primary/5",children:[a.jsx(o,{className:"px-7",children:a.jsx(c,{className:"text-lg font-semibold text-primary",children:"Current DA Rate"})}),a.jsx(m,{children:a.jsxs("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"DA Percentage"}),a.jsxs("p",{className:"text-2xl font-bold text-primary",children:[U.data.da_percentage,"%"]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Effective From"}),a.jsx("p",{className:"font-semibold",children:n(U.data.effective_from).format("DD-MM-YYYY")})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Government Order No"}),a.jsx("p",{className:"font-semibold",children:U.data.government_order_no})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Order Date"}),a.jsx("p",{className:"font-semibold",children:n(U.data.government_order_date).format("DD-MM-YYYY")})]})]})})]}),a.jsxs("div",{className:"flex w-full justify-between gap-2",children:[a.jsx("div",{children:a.jsx(b,{search:C,setSearch:O,refetch:I.refetch,isFetching:null==I?void 0:I.isLoading})}),a.jsx("div",{children:a.jsx(r,{className:"flex items-center gap-2",onClick:()=>k(!0),children:"Update DA Revision"})})]}),a.jsxs(d,{children:[a.jsx(o,{className:"px-7",children:a.jsxs(c,{children:["DA Revision List (",(null==(l=null==(t=null==I?void 0:I.data)?void 0:t.data)?void 0:l.length)||0,")"]})}),a.jsx(m,{children:I.isLoading?a.jsx("div",{className:"flex h-32 items-center justify-center",children:a.jsx(N,{})}):a.jsxs(a.Fragment,{children:[a.jsxs(u,{children:[a.jsx(v,{children:a.jsxs(x,{children:[a.jsx(f,{className:"",children:"#"}),a.jsx(f,{className:"",children:"DA Percentage"}),a.jsx(f,{className:"",children:"Effective From"}),a.jsx(f,{className:"",children:"Effective To"}),a.jsx(f,{className:"",children:"Government Order No"}),a.jsx(f,{className:"",children:"Order Date"}),a.jsx(f,{className:"",children:"Description"}),a.jsx(f,{className:"",children:"Created at"}),a.jsx(f,{className:"",children:"Status"})]})}),a.jsx(p,{children:null==(A=null==(y=null==I?void 0:I.data)?void 0:y.data)?void 0:A.map((e,s)=>a.jsxs(x,{children:[a.jsx(j,{children:s+1}),a.jsx(j,{children:a.jsxs(q,{variant:"default",className:"text-base font-semibold",children:[null==e?void 0:e.da_percentage,"%"]})}),a.jsx(j,{children:n(null==e?void 0:e.effective_from).format("DD-MM-YYYY")}),a.jsx(j,{children:(null==e?void 0:e.effective_to)?n(null==e?void 0:e.effective_to).format("DD-MM-YYYY"):"-"}),a.jsx(j,{children:null==e?void 0:e.government_order_no}),a.jsx(j,{children:n(null==e?void 0:e.government_order_date).format("DD-MM-YYYY")}),a.jsx(j,{className:"max-w-xs truncate",children:null==e?void 0:e.description}),a.jsx(j,{children:n(null==e?void 0:e.created_at).format("DD-MM-YYYY")}),a.jsx(j,{children:a.jsx(q,{variant:1===(null==e?void 0:e.status)?"default":"secondary",children:1===(null==e?void 0:e.status)?"Active":"Inactive"})})]},null==e?void 0:e.id))})]}),a.jsx(D,{className:"mb-2 mt-4"}),a.jsx("div",{className:"flex w-full justify-end",children:a.jsx(_,{page:R,limit:E,totalPages:Math.ceil(((null==(S=null==(Y=null==I?void 0:I.data)?void 0:Y.data)?void 0:S.length)||0)/E),setPage:M,setLimit:P})})]})})]})]})]})}function w(){return a.jsx(l,{title:"DA Revision List",subTitle:"Manage all the DA Revisions here",children:a.jsx("div",{className:"py-12",children:a.jsx(k,{})})})}export{w as default};
