import{aA as e,r as s,j as a,aB as i,al as r}from"./vendor-RyuIgj66.js";import{P as t}from"./index-DFF4_m_G.js";import{h as n}from"./moment-CBOc1lqT.js";import{h as l,u as o,B as d}from"./index-ey2GEmQz.js";import{C as c,c as m,a as u,b as v}from"./card-u7M7FP5y.js";import{T as x,a as j,b as h,c as p,d as g,e as f}from"./table-B_npepsp.js";import{u as y,b}from"./useCustomQuery-DTB6aAiD.js";import{S as N}from"./Spinner-BwGzvoRj.js";import{c as _,a as w,e as S}from"./yup-CH6wvET8.js";import{F as R}from"./datetime-picker-dN6E5dqy.js";import{R as A}from"./RHFTextField-BSZ_cEI3.js";import{R as L}from"./RHFTextArea-DpBxMoiQ.js";import{B as E}from"./ButtonLoading-DDalXO-W.js";import"./select-8PAfYjod.js";import{I as P}from"./input-DlX9dTT0.js";import"./switch-Cssv6fnZ.js";import"./checkbox-DFFItNXW.js";import"./label-BcY3kv5U.js";import{S as W}from"./separator-BQijJEjG.js";import{D as z}from"./index-B2ia16z0.js";import{B as I}from"./badge-DbWnzWn2.js";import{a2 as O,aD as M}from"./icons-CxCh8mm_.js";import"./ui-B3c1eQmf.js";import"./query-BH9sOW2X.js";import"./axios-Dos3PyFQ.js";import"./zustand-C1rkr5lV.js";const B=_().shape({waive_amount:S().required("Waive amount is required").positive("Amount must be positive"),waive_reason:w().required("Reason for waiving is required"),authorized_by:w().nullable()});function C({open:t,setOpen:n,title:o,recovery:d,refetch:u}){var v,x,j,h,p;const g=y({}),f=e({defaultValues:{waive_amount:void 0,waive_reason:"",authorized_by:""},resolver:i(B)});s.useEffect(()=>{d&&f.reset({waive_amount:d.pending_amount,waive_reason:"",authorized_by:""})},[d,f]);return a.jsxs(z,{open:t,setOpen:n,title:o,setEdit:()=>(f.reset(),void n(!1)),children:[d&&a.jsx(c,{className:"mb-4 bg-slate-50",children:a.jsx(m,{className:"pt-4",children:a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-slate-500",children:"Original Amount:"}),a.jsxs("span",{className:"ml-2 font-semibold",children:["₹",null==(v=d.original_amount)?void 0:v.toLocaleString()]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-slate-500",children:"Pending Amount:"}),a.jsxs("span",{className:"ml-2 font-semibold text-red-600",children:["₹",null==(x=d.pending_amount)?void 0:x.toLocaleString()]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-slate-500",children:"Already Recovered:"}),a.jsxs("span",{className:"ml-2 font-semibold text-green-600",children:["₹",(null==(j=d.recovered_amount)?void 0:j.toLocaleString())||0]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-slate-500",children:"Already Waived:"}),a.jsxs("span",{className:"ml-2 font-semibold",children:["₹",(null==(h=d.waiver_amount)?void 0:h.toLocaleString())||0]})]})]})})}),a.jsx(R,{methods:f,onSubmit:f.handleSubmit(async e=>{var s,a,i,t;if(d)if(e.waive_amount>d.pending_amount)r.error(`Waive amount cannot exceed pending amount (₹${d.pending_amount})`);else try{const o=await g.mutateAsync({api:null==(s=l)?void 0:s.waiveRecovery,data:{recovery_id:d.id,...e}});(null==(a=o.data)?void 0:a.success)?(r.success((null==(i=null==o?void 0:o.data)?void 0:i.message)||"Recovery waived successfully"),f.reset(),n(!1),null==u||u()):r.error((null==(t=o.data)?void 0:t.message)||"Failed to waive recovery")}catch(o){r.error("Failed to waive recovery")}}),children:a.jsxs("div",{className:"grid grid-cols-1 gap-x-4 gap-y-4",children:[a.jsxs("div",{children:[a.jsx(A,{label:"Amount to Waive (₹)",name:"waive_amount",placeholder:"Enter amount to waive",type:"number"}),d&&a.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["Maximum: ₹",null==(p=d.pending_amount)?void 0:p.toLocaleString()]})]}),a.jsx("div",{children:a.jsx(L,{label:"Reason for Waiving",name:"waive_reason",placeholder:"Enter reason for waiving this recovery"})}),a.jsx("div",{children:a.jsx(A,{label:"Authorized By (Optional)",name:"authorized_by",placeholder:"Enter authorizing officer name"})}),a.jsxs("div",{children:[a.jsx(W,{className:"my-2"}),a.jsx(E,{isLoading:f.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Waive Recovery"})]})]})})]})}function D(){var e,i,r,t,y,_,w,S,R,A,L;const{user:E}=o(),[W,z]=s.useState(!1),[B,D]=s.useState(""),[F,T]=s.useState(""),[$,k]=s.useState(null),q=b({api:`${l.getPendingRecovery}?emp_id=${F}&ulb_id=${null==E?void 0:E.ulbId}`,key:"getPendingRecovery",value:[F,null==E?void 0:E.ulbId],options:{enabled:!!F&&!!(null==E?void 0:E.ulbId)}}),H=e=>{switch(e){case"pending":return a.jsx(I,{variant:"outline",className:"bg-yellow-100 text-yellow-700",children:"Pending"});case"partial":return a.jsx(I,{variant:"outline",className:"bg-blue-100 text-blue-700",children:"Partial"});case"completed":return a.jsx(I,{variant:"outline",className:"bg-green-100 text-green-700",children:"Completed"});case"waived":return a.jsx(I,{variant:"outline",className:"bg-gray-100 text-gray-700",children:"Waived"});default:return a.jsx(I,{variant:"outline",children:e})}};return a.jsxs("main",{className:"grid items-start",children:[a.jsx(C,{open:W,setOpen:z,title:"Waive Recovery",recovery:$,refetch:q.refetch}),a.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[a.jsx("div",{className:"flex w-full flex-col gap-4 sm:flex-row sm:justify-between",children:a.jsxs("div",{className:"flex gap-2",children:[a.jsx(P,{placeholder:"Enter Employee ID",value:B,onChange:e=>D(e.target.value),className:"w-48"}),a.jsxs(d,{onClick:()=>{B&&T(B)},variant:"outline",children:[a.jsx(O,{className:"mr-2 h-4 w-4"}),"Search"]})]})}),F&&void 0!==(null==(i=null==(e=null==q?void 0:q.data)?void 0:e.data)?void 0:i.total_pending)&&a.jsx(c,{className:"bg-gradient-to-r from-red-50 to-orange-50",children:a.jsx(m,{className:"pt-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(M,{className:"h-5 w-5 text-red-500"}),a.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Total Pending Recovery"})]}),a.jsxs("span",{className:"text-xl font-bold text-red-700",children:["₹",(null==(y=null==(t=null==(r=null==q?void 0:q.data)?void 0:r.data)?void 0:t.total_pending)?void 0:y.toLocaleString())||0]})]})})}),a.jsxs(c,{children:[a.jsx(u,{children:a.jsx(v,{children:F?`Pending Recovery for Employee ID: ${F}`:"Enter Employee ID to view pending recovery"})}),a.jsx(m,{children:F?(null==q?void 0:q.isLoading)?a.jsx("div",{className:"flex items-center justify-center",children:a.jsx(N,{})}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(x,{children:[a.jsx(j,{children:a.jsxs(h,{children:[a.jsx(p,{children:"Type"}),a.jsx(p,{children:"Original Amount"}),a.jsx(p,{children:"Pending Amount"}),a.jsx(p,{children:"Recovered"}),a.jsx(p,{children:"Waived"}),a.jsx(p,{children:"Source Month"}),a.jsx(p,{children:"Status"}),a.jsx(p,{children:"Actions"})]})}),a.jsx(g,{children:(null==(w=null==(_=null==q?void 0:q.data)?void 0:_.data)?void 0:w.recovery)&&(null==(R=null==(S=null==q?void 0:q.data)?void 0:S.data)?void 0:R.recovery.length)>0?null==(L=null==(A=null==q?void 0:q.data)?void 0:A.data)?void 0:L.recovery.map(e=>{var s,i,r,t;return a.jsxs(h,{children:[a.jsx(f,{className:"font-medium",children:e.recovery_type||"Overpayment"}),a.jsxs(f,{children:["₹",null==(s=e.original_amount)?void 0:s.toLocaleString()]}),a.jsxs(f,{className:"font-semibold text-red-600",children:["₹",null==(i=e.pending_amount)?void 0:i.toLocaleString()]}),a.jsxs(f,{className:"text-green-600",children:["₹",(null==(r=e.recovered_amount)?void 0:r.toLocaleString())||0]}),a.jsxs(f,{className:"text-gray-600",children:["₹",(null==(t=e.waiver_amount)?void 0:t.toLocaleString())||0]}),a.jsxs(f,{children:[n().month(e.source_month-1).format("MMM")," ",e.source_year]}),a.jsx(f,{children:H(e.recovery_status)}),a.jsx(f,{children:("pending"===e.recovery_status||"partial"===e.recovery_status)&&a.jsx(d,{variant:"outline",size:"sm",onClick:()=>(k(e),void z(!0)),children:"Waive"})})]},e.id)}):a.jsx(h,{children:a.jsx(f,{colSpan:8,className:"text-center",children:"No pending recovery found"})})})]})}):a.jsx("div",{className:"flex items-center justify-center py-8 text-slate-500",children:"Please enter an Employee ID to search for recovery records"})})]})]})]})}function F(){return a.jsx(t,{title:"Recovery Management",subTitle:"Manage Employee Recovery/Overpayments",children:a.jsx("div",{className:"py-12",children:a.jsx(D,{})})})}export{F as default};
