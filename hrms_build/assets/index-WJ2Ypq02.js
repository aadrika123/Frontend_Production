import{u as e,r as s,h as l,j as a,B as t,z as i}from"./index-UYY99J9q.js";import{P as r}from"./index-Dj741qwl.js";import{C as c,a as n,d,b as o,c as x}from"./card-CtI_IPLF.js";import{T as m,a as h,b as j,c as u,d as f,e as p}from"./table-CS0u2e-w.js";import{u as N,b as g}from"./useCustomQuery-Dp3AX7R2.js";import{S as v}from"./Spinner-CjaIOVSb.js";import{S as b,a as y,b as S,c as T,d as w}from"./select-CcbMZzqU.js";import{B as D}from"./badge-B68rjZDB.js";import{T as R,a as _,b as F,c as k}from"./tabs-cT8NCL-f.js";import{R as Y}from"./refresh-cw-C-bnmyXW.js";import{T as C}from"./triangle-alert-DjEcOefH.js";import{C as L}from"./circle-check-big-COIXu31i.js";import"./check-B5JmqH3y.js";function E(){var r,E,I,$,A;const{user:B}=e(),P=N({}),[V,z]=s.useState(""),[O,Q]=s.useState(""),U=(()=>{const e=[],s=(new Date).getFullYear();for(let l=0;l<6;l++){const a=s-l;e.push(`${a}-${(a+1).toString().slice(-2)}`)}return e})(),Z=g({api:`${l.getTdsShortfallReport}?financial_year=${O}&ulb_id=${null==B?void 0:B.ulbId}`,key:"getTdsShortfallReport",value:[O,null==B?void 0:B.ulbId],options:{enabled:!!O&&!!(null==B?void 0:B.ulbId)}}),q=null==(r=null==Z?void 0:Z.data)?void 0:r.data;return a.jsxs("main",{className:"grid items-start gap-4",children:[a.jsxs(c,{children:[a.jsxs(n,{children:[a.jsxs(d,{className:"flex items-center gap-2",children:[a.jsx(Y,{className:"h-5 w-5"}),"TDS Reconciliation"]}),a.jsx(o,{children:"View TDS shortfall report and reconcile tax deductions"})]}),a.jsx(x,{children:a.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-end",children:[a.jsxs("div",{children:[a.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-600",children:"Financial Year"}),a.jsxs(b,{value:V,onValueChange:z,children:[a.jsx(y,{className:"w-48",children:a.jsx(S,{placeholder:"Select Financial Year"})}),a.jsx(T,{children:U.map(e=>a.jsxs(w,{value:e,children:["FY ",e]},e))})]})]}),a.jsx(t,{onClick:()=>{V&&Q(V)},variant:"outline",children:"Load Report"}),O&&a.jsx(t,{onClick:async()=>{var e,s,a;if(O)try{const t=await P.mutateAsync({api:l.bulkReconcileTds,data:{financial_year:O}});(null==(e=t.data)?void 0:e.success)?(i.success((null==(s=null==t?void 0:t.data)?void 0:s.message)||"TDS reconciliation completed"),Z.refetch()):i.error((null==(a=t.data)?void 0:a.message)||"Failed to reconcile TDS")}catch(t){i.error("Failed to reconcile TDS")}else i.error("Please select a financial year first")},disabled:P.isPending,className:"bg-blue-600 hover:bg-blue-700",children:P.isPending?a.jsxs(a.Fragment,{children:[a.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),"Reconciling..."]}):a.jsxs(a.Fragment,{children:[a.jsx(Y,{className:"mr-2 h-4 w-4"}),"Bulk Reconcile"]})})]})})]}),O&&(null==Z?void 0:Z.isLoading)&&a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx(v,{})}),q&&a.jsxs(R,{defaultValue:"shortfall",children:[a.jsxs(_,{className:"grid w-full grid-cols-2",children:[a.jsxs(F,{value:"shortfall",children:[a.jsx(C,{className:"mr-2 h-4 w-4"}),"Shortfall Report"]}),a.jsxs(F,{value:"summary",children:[a.jsx(L,{className:"mr-2 h-4 w-4"}),"Summary"]})]}),a.jsx(k,{value:"shortfall",children:a.jsxs(c,{children:[a.jsx(n,{className:"bg-gradient-to-r from-red-50 to-orange-50",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs(d,{className:"text-red-700",children:["TDS Shortfall Report - FY ",O]}),a.jsx(o,{children:"Employees with pending TDS to be collected"})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-sm text-slate-600",children:"Total Shortfall"}),a.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["₹",(null==(E=q.total_shortfall)?void 0:E.toLocaleString())||0]})]})]})}),a.jsx(x,{className:"pt-4",children:(null==(I=q.shortfall_employees)?void 0:I.length)>0?a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(m,{children:[a.jsx(h,{children:a.jsxs(j,{children:[a.jsx(u,{children:"Employee ID"}),a.jsx(u,{children:"Employee Code"}),a.jsx(u,{children:"Employee Name"}),a.jsx(u,{className:"text-right",children:"Tax Computed"}),a.jsx(u,{className:"text-right",children:"Tax Deducted"}),a.jsx(u,{className:"text-right",children:"Shortfall"})]})}),a.jsx(f,{children:q.shortfall_employees.map(e=>{var s,l,t;return a.jsxs(j,{children:[a.jsx(p,{children:e.emp_id}),a.jsx(p,{children:a.jsx(D,{variant:"outline",children:e.emp_code})}),a.jsx(p,{className:"font-medium",children:e.emp_name}),a.jsxs(p,{className:"text-right",children:["₹",null==(s=e.tax_computed)?void 0:s.toLocaleString()]}),a.jsxs(p,{className:"text-right",children:["₹",null==(l=e.tax_deducted)?void 0:l.toLocaleString()]}),a.jsxs(p,{className:"text-right font-semibold text-red-600",children:["₹",null==(t=e.shortfall)?void 0:t.toLocaleString()]})]},e.emp_id)})})]})}):a.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[a.jsx(L,{className:"h-12 w-12 text-green-500"}),a.jsx("p",{className:"mt-2 text-lg font-medium text-green-700",children:"No TDS shortfall found!"}),a.jsx("p",{className:"text-sm text-slate-500",children:"All employees have their TDS fully deducted."})]})})]})}),a.jsx(k,{value:"summary",children:a.jsxs(c,{children:[a.jsxs(n,{className:"bg-gradient-to-r from-blue-50 to-indigo-50",children:[a.jsxs(d,{className:"text-blue-700",children:["Reconciliation Summary - FY ",O]}),a.jsx(o,{children:"Overview of TDS status for the financial year"})]}),a.jsxs(x,{className:"pt-4",children:[a.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[a.jsx(c,{className:"bg-slate-50",children:a.jsx(x,{className:"pt-4",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-sm text-slate-600",children:"Total Employees with Shortfall"}),a.jsx("div",{className:"text-3xl font-bold text-slate-700",children:(null==($=q.shortfall_employees)?void 0:$.length)||0})]})})}),a.jsx(c,{className:"bg-red-50",children:a.jsx(x,{className:"pt-4",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-sm text-red-600",children:"Total Shortfall Amount"}),a.jsxs("div",{className:"text-3xl font-bold text-red-700",children:["₹",(null==(A=q.total_shortfall)?void 0:A.toLocaleString())||0]})]})})}),a.jsx(c,{className:"bg-green-50",children:a.jsx(x,{className:"pt-4",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-sm text-green-600",children:"Financial Year"}),a.jsx("div",{className:"text-3xl font-bold text-green-700",children:O})]})})})]}),a.jsxs("div",{className:"mt-6 rounded-lg bg-amber-50 p-4",children:[a.jsxs("h4",{className:"flex items-center gap-2 font-medium text-amber-700",children:[a.jsx(C,{className:"h-5 w-5"}),"Important Notes"]}),a.jsxs("ul",{className:"mt-2 list-inside list-disc text-sm text-amber-600",children:[a.jsx("li",{children:"TDS shortfall will be adjusted in the next salary cycle"}),a.jsx("li",{children:"Bulk reconciliation updates all pending TDS calculations"}),a.jsx("li",{children:"Ensure all attendance and salary data is finalized before reconciliation"})]})]})]})]})})]}),O&&!(null==Z?void 0:Z.isLoading)&&!q&&a.jsx(c,{className:"border-yellow-200 bg-yellow-50",children:a.jsx(x,{className:"flex items-center justify-center py-8",children:a.jsxs("div",{className:"text-center",children:[a.jsx(C,{className:"mx-auto h-10 w-10 text-yellow-500"}),a.jsxs("p",{className:"mt-2 text-yellow-700",children:["No TDS data found for FY ",O]})]})})})]})}function I(){return a.jsx(r,{title:"TDS Reconciliation",subTitle:"Reconcile TDS and View Shortfall Reports",children:a.jsx("div",{className:"py-12",children:a.jsx(E,{})})})}export{I as default};
