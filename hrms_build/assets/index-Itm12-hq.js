import{h as e,f as a,r as l,j as t,z as s,B as o,e as i}from"./index-CaGgFSeq.js";import{P as r}from"./index-_Ebnz7ZO.js";import{h as n}from"./moment-CBOc1lqT.js";import{C as d,a as c,b as m,c as u}from"./card-DpoqoWLt.js";import{T as f,a as h,b as x,c as p,d as v,e as j}from"./table-Cx7GlPK-.js";import{u as _,b as y}from"./useCustomQuery-kAcgaiYY.js";import{P as b}from"./index-DPZPUd0B.js";import{S as g}from"./separator-BjkNEWW3.js";import{S}from"./index-BTP_FOeW.js";import{S as N}from"./Spinner-qexXCl2s.js";import{a as T,o as P,c as C,f as A,b as E}from"./yup-CKEuqCyz.js";import{F as w}from"./datetime-picker-BtprqcV1.js";import{R as F}from"./RHFTextField-DnsEykRH.js";import{B as k}from"./ButtonLoading-B22z2lRV.js";import"./select-CIf9vlQt.js";import{I as q}from"./input-D-UmUPn3.js";import"./switch-Dzwmyki0.js";import"./checkbox-BzF0hRJq.js";import{L as M}from"./label-CInbbuF8.js";import{R as L}from"./DateAndTimePicker-BSsRf7i2.js";import{D as $}from"./index-atwvxgXU.js";import{X as D}from"./x-Bm40Pj86.js";import{P as H}from"./plus-CDHvFTH0.js";import"./calendar-B5etLz2h.js";import"./format-BkNqQ0tt.js";import"./chevron-right-CSfpr0N3.js";import"./clock-B2whL4Nd.js";import"./check-DrWmecxK.js";const O=C().shape({state_code:E().required("State Code is required").max(2),salary_from:A().required("Salary From is required").min(0),salary_to:A().nullable().min(0).optional(),monthly_tax:A().required("Monthly Tax is required").min(0),applicable_month:E().nullable().optional(),effective_from:E().required("Effective From date is required"),effective_to:E().nullable().optional(),status:A().optional()});function J({open:o,setOpen:i,title:r,id:n,edit:d,setEdit:c,ptSlabListData:m}){var u,f,h,x,p;const v=_({}),{data:j,isFetching:b}=y({api:`${null==(u=e)?void 0:u.getPTSlabById}?id=${a(String(n))}`,key:"getPTSlabById",options:{enabled:d&&!!n}}),S=(null==m?void 0:m.data)&&(null==(h=null==(f=null==m?void 0:m.data)?void 0:f.data)?void 0:h.length)>0?Math.max(...null==(p=null==(x=null==m?void 0:m.data)?void 0:x.data)?void 0:p.map(e=>(null==e?void 0:e.salary_to)||0))+1:0,N=T({defaultValues:{state_code:"JH",salary_from:0,salary_to:0,monthly_tax:0,applicable_month:"",effective_from:"",effective_to:"",status:1},resolver:P(O)});return l.useEffect(()=>{var e,a,l,t,s,o,i,r,n;d&&j?N.reset({state_code:(null==(e=null==j?void 0:j.data)?void 0:e.state_code)||"",salary_from:Number(null==(a=null==j?void 0:j.data)?void 0:a.salary_from)||0,salary_to:(null==(l=null==j?void 0:j.data)?void 0:l.salary_to)?Number(null==(t=null==j?void 0:j.data)?void 0:t.salary_to):0,monthly_tax:Number(null==(s=null==j?void 0:j.data)?void 0:s.monthly_tax)||0,applicable_month:(null==(o=null==j?void 0:j.data)?void 0:o.applicable_month)||"",effective_from:(null==(i=null==j?void 0:j.data)?void 0:i.effective_from)||"",effective_to:(null==(r=null==j?void 0:j.data)?void 0:r.effective_to)||"",status:(null==(n=null==j?void 0:j.data)?void 0:n.status)||1}):N.reset({state_code:"JH",salary_from:S||0,salary_to:0,monthly_tax:0,applicable_month:"",effective_from:"",effective_to:"",status:1})},[d,j,N,S]),t.jsx($,{open:o,setOpen:i,title:r,setEdit:c,edit:d,isLoading:b,children:t.jsx(w,{methods:N,onSubmit:N.handleSubmit(async a=>{var l,t,o,r,u,f,h,x,p;try{if(d&&n){const i=await v.mutateAsync({api:null==(l=e)?void 0:l.updatePTSlab,data:{id:Number(n),...a}});(null==(t=i.data)?void 0:t.success)?s.success((null==(o=null==i?void 0:i.data)?void 0:o.message)||"Professional Tax Slab updated successfully"):s.error((null==(r=i.data)?void 0:r.message)||"Professional Tax Slab not updated successfully")}else{const l=await v.mutateAsync({api:null==(u=e)?void 0:u.createPTSlab,data:a});(null==(f=l.data)?void 0:f.success)?s.success((null==(h=null==l?void 0:l.data)?void 0:h.message)||"Professional Tax Slab created successfully"):s.error((null==(x=l.data)?void 0:x.message)||"Professional Tax Slab not created successfully")}N.reset({state_code:"",salary_from:0,salary_to:0,monthly_tax:0,applicable_month:"",effective_from:"",effective_to:"",status:1}),i(!1),null==c||c(!1),null==(p=m.refetch)||p.call(m)}catch(j){}}),children:t.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[t.jsx("div",{children:t.jsx(F,{label:"State Code",name:"state_code",placeholder:"Enter State Code (e.g., JH)",type:"text",maxLength:2})}),t.jsx("div",{children:t.jsx(F,{label:"Salary From",name:"salary_from",placeholder:"Enter Salary From",type:"number",step:"1"})}),t.jsx("div",{children:t.jsx(F,{label:"Salary To (Optional)",name:"salary_to",placeholder:"Enter Salary To (Leave empty for unlimited)",type:"number",step:"1"})}),t.jsx("div",{children:t.jsx(F,{label:"Monthly Tax",name:"monthly_tax",placeholder:"Enter Monthly Tax Amount",type:"number",step:"1"})}),t.jsx("div",{children:t.jsx(F,{label:"Applicable Month (Optional)",name:"applicable_month",placeholder:"Enter Applicable Month",type:"text"})}),t.jsx("div",{children:t.jsx(L,{name:"effective_from",label:"Effective From",placeholder:"Select effective from date"})}),t.jsx("div",{children:t.jsx(L,{name:"effective_to",label:"Effective To (Optional)",placeholder:"Select effective to date"})}),t.jsx(g,{}),t.jsx("div",{children:t.jsx(k,{isLoading:N.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}const Y={state_code:"JH",salary_from:0,salary_to:"",monthly_tax:0,applicable_month:"",effective_from:"2024-01-01"},B=[{state_code:"JH",salary_from:0,salary_to:25e3,monthly_tax:0,applicable_month:"",effective_from:"2024-01-01"},{state_code:"JH",salary_from:25001,salary_to:41666,monthly_tax:100,applicable_month:"",effective_from:"2024-01-01"},{state_code:"JH",salary_from:41667,salary_to:66666,monthly_tax:150,applicable_month:"",effective_from:"2024-01-01"},{state_code:"JH",salary_from:66667,salary_to:83333,monthly_tax:175,applicable_month:"",effective_from:"2024-01-01"},{state_code:"JH",salary_from:83334,salary_to:"",monthly_tax:200,applicable_month:"",effective_from:"2024-01-01"}];function U({open:a,setOpen:i,refetch:r}){const[n,c]=l.useState(B),[m,u]=l.useState(!1),f=_({});l.useEffect(()=>{a&&c(B)},[a]);const h=(e,a,l)=>{const t=[...n];t[e]={...t[e],[a]:l},c(t)};return t.jsx($,{open:a,setOpen:i,title:"Bulk Upload Professional Tax Slabs",edit:!1,setEdit:()=>{},children:t.jsx("form",{onSubmit:async a=>{var l,t,o,d;a.preventDefault(),u(!0);try{for(let e=0;e<n.length;e++){const a=n[e];if(!a.state_code||!a.effective_from)return s.error(`Slab ${e+1}: State Code and Effective From are required`),void u(!1);if(""===a.salary_from||""===a.monthly_tax)return s.error(`Slab ${e+1}: Salary From and Monthly Tax are required`),void u(!1)}const a=n.map(e=>({state_code:e.state_code,salary_from:Number(e.salary_from),salary_to:""===e.salary_to||null===e.salary_to?null:Number(e.salary_to),monthly_tax:Number(e.monthly_tax),applicable_month:""===e.applicable_month?null:e.applicable_month,effective_from:e.effective_from})),m=await f.mutateAsync({api:null==(l=e)?void 0:l.bulkCreatePTSlab,data:{slabs:a}});(null==(t=m.data)?void 0:t.success)?(s.success((null==(o=null==m?void 0:m.data)?void 0:o.message)||"Professional Tax Slabs created successfully"),i(!1),c(B),null==r||r()):s.error((null==(d=m.data)?void 0:d.message)||"Failed to create Professional Tax Slabs")}catch(m){s.error("An error occurred while uploading slabs")}finally{u(!1)}},children:t.jsxs("div",{className:"grid gap-4",children:[t.jsx("div",{className:"max-h-[500px] space-y-4 overflow-y-auto pr-2",children:n.map((e,a)=>t.jsxs(d,{className:"relative p-4",children:[t.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[t.jsxs("h4",{className:"text-sm font-semibold",children:["Slab ",a+1]}),t.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{n.length>1?c(n.filter((a,l)=>l!==e)):s.error("At least one slab is required")})(a),className:"h-8 w-8 p-0",children:t.jsx(D,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx(M,{className:"text-xs",children:"State Code*"}),t.jsx(q,{type:"text",value:e.state_code,onChange:e=>h(a,"state_code",e.target.value.toUpperCase()),maxLength:2,placeholder:"JH",className:"h-9",required:!0})]}),t.jsxs("div",{children:[t.jsx(M,{className:"text-xs",children:"Salary From*"}),t.jsx(q,{type:"number",value:e.salary_from,onChange:e=>h(a,"salary_from",e.target.value),placeholder:"0",className:"h-9",required:!0})]}),t.jsxs("div",{children:[t.jsx(M,{className:"text-xs",children:"Salary To"}),t.jsx(q,{type:"number",value:null===e.salary_to?"":e.salary_to,onChange:e=>h(a,"salary_to",e.target.value),placeholder:"Leave empty for unlimited",className:"h-9"})]}),t.jsxs("div",{children:[t.jsx(M,{className:"text-xs",children:"Monthly Tax*"}),t.jsx(q,{type:"number",value:e.monthly_tax,onChange:e=>h(a,"monthly_tax",e.target.value),placeholder:"0",className:"h-9",required:!0})]}),t.jsxs("div",{children:[t.jsx(M,{className:"text-xs",children:"Applicable Month"}),t.jsx(q,{type:"text",value:e.applicable_month||"",onChange:e=>h(a,"applicable_month",e.target.value),placeholder:"Optional",className:"h-9"})]}),t.jsxs("div",{children:[t.jsx(M,{className:"text-xs",children:"Effective From*"}),t.jsx(q,{type:"date",value:e.effective_from,onChange:e=>h(a,"effective_from",e.target.value),className:"h-9",required:!0})]})]})]},a))}),t.jsxs(o,{type:"button",variant:"outline",onClick:()=>{c([...n,{...Y}])},className:"w-full",children:[t.jsx(H,{className:"mr-2 h-4 w-4"}),"Add Another Slab"]}),t.jsx("div",{className:"flex gap-2",children:t.jsx(o,{type:"button",variant:"outline",onClick:()=>{c(B)},className:"flex-1",children:"Reset to Default"})}),t.jsx(g,{}),t.jsx(o,{type:"submit",disabled:m,className:"h-11 w-full rounded-xl",children:m?"Uploading...":`Upload ${n.length} Slab${n.length>1?"s":""}`})]})})})}function R(){var a,r,T,P,C,A;const E=_({}),[w,F]=l.useState(1),[k]=l.useState(10),[q,M]=l.useState(""),[L,$]=l.useState(!1),[D,H]=l.useState(!1),[O,Y]=l.useState(""),[B,R]=l.useState(!1),z=y({api:`${e.getAllPTSlabs}?page=${w}&limit=${k}&q=${q}`,key:"getAllPTSlabs",value:[w,k,q],options:{enabled:!0}});return t.jsxs("main",{className:"grid items-start",children:[t.jsx(J,{open:L,setOpen:$,title:B?"Edit Professional Tax Slab":"Add Professional Tax Slab",id:O,edit:B,setEdit:R,ptSlabListData:z}),t.jsx(U,{open:D,setOpen:H,refetch:z.refetch}),t.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[t.jsxs("div",{className:"flex w-full justify-between gap-2",children:[t.jsx("div",{children:t.jsx(S,{search:q,setSearch:M,refetch:z.refetch,isFetching:null==z?void 0:z.isLoading})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(o,{variant:"outline",className:"flex items-center gap-2",onClick:()=>H(!0),children:"Bulk Upload"}),t.jsx(o,{className:"flex items-center gap-2",onClick:()=>$(!0),children:"Add New"})]})]}),t.jsx(g,{}),t.jsxs(d,{children:[t.jsx(c,{children:t.jsx(m,{children:"Professional Tax Slabs"})}),t.jsx(u,{children:(null==z?void 0:z.isLoading)?t.jsx("div",{className:"flex items-center justify-center",children:t.jsx(N,{})}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs(f,{children:[t.jsx(h,{children:t.jsxs(x,{children:[t.jsx(p,{children:"State Code"}),t.jsx(p,{children:"Salary From"}),t.jsx(p,{children:"Salary To"}),t.jsx(p,{children:"Monthly Tax"}),t.jsx(p,{children:"Applicable Month"}),t.jsx(p,{children:"Effective From"}),t.jsx(p,{children:"Effective To"}),t.jsx(p,{children:"Status"}),t.jsx(p,{children:"Actions"})]})}),t.jsx(v,{children:(null==(a=null==z?void 0:z.data)?void 0:a.data)&&(null==(r=null==z?void 0:z.data)?void 0:r.data.length)>0?null==(T=null==z?void 0:z.data)?void 0:T.data.map(a=>t.jsxs(x,{children:[t.jsx(j,{className:"font-medium",children:a.state_code}),t.jsxs(j,{children:["₹",a.salary_from.toLocaleString()]}),t.jsx(j,{children:a.salary_to?`₹${a.salary_to.toLocaleString()}`:"Above"}),t.jsxs(j,{children:["₹",a.monthly_tax]}),t.jsx(j,{children:a.applicable_month||"-"}),t.jsx(j,{children:n(a.effective_from).format("DD/MM/YYYY")}),t.jsx(j,{children:a.effective_to?n(a.effective_to).format("DD/MM/YYYY"):"-"}),t.jsx(j,{children:t.jsx("span",{className:"rounded-full px-3 py-1 text-xs font-semibold "+(1===a.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:1===a.status?"Active":"Inactive"})}),t.jsxs(j,{className:"flex gap-2",children:[t.jsx(o,{variant:"outline",size:"sm",onClick:()=>{return e=String(a.id),R(!0),$(!0),void Y(e);var e},children:"Edit"}),t.jsx(o,{variant:"destructive",size:"sm",onClick:()=>(async a=>{var l,t,o,r;try{const i=await E.mutateAsync({api:null==(l=e)?void 0:l.deletePTSlab,data:{id:Number(a)}});(null==(t=null==i?void 0:i.data)?void 0:t.success)?(z.refetch(),s.success((null==(o=null==i?void 0:i.data)?void 0:o.message)||"Professional Tax Slab deleted successfully")):s.error((null==(r=i.data)?void 0:r.message)||"Failed to delete Professional Tax Slab")}catch(n){s.error(i(n))}})(String(a.id)),children:"Delete"})]})]},a.id)):t.jsx(x,{children:t.jsx(j,{colSpan:9,className:"text-center",children:"No Professional Tax Slabs found"})})})]})})})]}),(null==(P=null==z?void 0:z.data)?void 0:P.pagination)&&t.jsx(b,{page:w,setPage:F,limit:k,totalPages:(null==(A=null==(C=null==z?void 0:z.data)?void 0:C.pagination)?void 0:A.totalPages)||1})]})]})}function z(){return t.jsx(r,{title:"Professional Slab",subTitle:"Manage Professional Slabs",children:t.jsx("div",{className:"py-12",children:t.jsx(R,{})})})}export{z as default};
