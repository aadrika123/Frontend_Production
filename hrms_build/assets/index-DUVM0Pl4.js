import{k as e,j as a,q as s,w as l,r as i,B as t,A as n,z as r,e as c}from"./index-C0dR7KKl.js";import{D as d,e as o,f as x,h as m,P as u}from"./index-DLwgcCrU.js";import{C as j,a as v,b as _,c as h}from"./card-dfHK731x.js";import{T as p,a as f,b as g,c as b,d as y,e as N}from"./table-DGsqq0wP.js";import{u as w,b as S}from"./useCustomQuery-DfubPPhS.js";import{P as k}from"./index-CtQoh3RB.js";import{S as D}from"./separator-DK9wbIss.js";import{S as C}from"./index-DxKRME66.js";import{S as A}from"./Spinner-Bh5S-NfG.js";import{B as T}from"./badge-ssHwjf40.js";import{S as P,a as $,b as L,c as R,d as F}from"./select-PSqof_An.js";import{A as I,a as E,b as O,c as V,d as z,e as H,f as M,g as Y}from"./alert-dialog-CJcnA0U7.js";import{T as q}from"./textarea-D4e9uoe5.js";import{L as B}from"./lock-2B7619Dw.js";import{E as U}from"./eye-CUs8EANW.js";import{T as G}from"./thumbs-up-DUbFOZ2Q.js";import{C as J}from"./circle-x-BSdROGAg.js";import{F as Q}from"./file-text-BD6EF3bc.js";import"./input-5m-sj67D.js";import"./check-DJnOI1b1.js";
/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=e("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]),Z=e=>null==e||0===e?"-":`₹${e.toLocaleString("en-IN")}`,K=({title:e,children:s})=>a.jsxs("div",{className:"mb-4",children:[a.jsx("h4",{className:"mb-2 font-semibold text-primary",children:e}),a.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:s})]}),X=({label:e,value:s})=>a.jsxs(a.Fragment,{children:[a.jsxs("span",{className:"text-muted-foreground",children:[e,":"]}),a.jsx("span",{className:"font-medium",children:s||"-"})]});function ee({open:e,setOpen:s,declaration:l}){var i;if(!l)return null;const t=()=>(l.sec_80c_ppf||0)+(l.sec_80c_epf||0)+(l.sec_80c_elss||0)+(l.sec_80c_life_insurance||0)+(l.sec_80c_nsc||0)+(l.sec_80c_tuition_fees||0)+(l.sec_80c_housing_loan_principal||0)+(l.sec_80c_sukanya_samriddhi||0)+(l.sec_80c_tax_saver_fd||0)+(l.sec_80c_ulip||0)+(l.sec_80c_other||0);return a.jsx(d,{open:e,onOpenChange:s,children:a.jsxs(o,{className:"max-w-2xl",children:[a.jsx(x,{children:a.jsxs(m,{className:"flex items-center gap-2",children:["Tax Declaration Details",a.jsx(T,{variant:"new"===l.tax_regime?"default":"secondary",children:"new"===l.tax_regime?"New Regime":"Old Regime"}),a.jsx(T,{variant:l.declaration_locked?"destructive":"approved"===l.verification_status?"default":"rejected"===l.verification_status?"destructive":"outline",children:l.declaration_locked?"Locked":l.verification_status?l.verification_status.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase()):"Pending"})]})}),a.jsxs("div",{className:"max-h-[70vh] pr-4",children:[a.jsxs(K,{title:"Employee Information",children:[a.jsx(X,{label:"Name",value:l.employee_name}),a.jsx(X,{label:"Code",value:l.employee_code}),a.jsx(X,{label:"Department",value:l.department_name}),a.jsx(X,{label:"Financial Year",value:l.financial_year})]}),a.jsx(D,{className:"my-4"}),"old"===l.tax_regime&&a.jsxs(a.Fragment,{children:[a.jsxs(K,{title:"Section 80C Investments (Max ₹1,50,000)",children:[a.jsx(X,{label:"PPF",value:Z(l.sec_80c_ppf)}),a.jsx(X,{label:"EPF",value:Z(l.sec_80c_epf)}),a.jsx(X,{label:"ELSS",value:Z(l.sec_80c_elss)}),a.jsx(X,{label:"Life Insurance",value:Z(l.sec_80c_life_insurance)}),a.jsx(X,{label:"NSC",value:Z(l.sec_80c_nsc)}),a.jsx(X,{label:"Tuition Fees",value:Z(l.sec_80c_tuition_fees)}),a.jsx(X,{label:"Housing Loan Principal",value:Z(l.sec_80c_housing_loan_principal)}),a.jsx(X,{label:"Sukanya Samriddhi",value:Z(l.sec_80c_sukanya_samriddhi)}),a.jsx(X,{label:"Tax Saver FD",value:Z(l.sec_80c_tax_saver_fd)}),a.jsx(X,{label:"ULIP",value:Z(l.sec_80c_ulip)}),a.jsx(X,{label:"Other",value:Z(l.sec_80c_other)}),a.jsxs("div",{className:"col-span-2 mt-2 rounded bg-muted p-2",children:[a.jsxs("strong",{children:["Total 80C:"," ",Z(Math.min(t(),15e4))]}),t()>15e4&&a.jsx("span",{className:"ml-2 text-xs text-destructive",children:"(Capped at ₹1,50,000)"})]})]}),a.jsx(D,{className:"my-4"}),a.jsxs(K,{title:"Section 80D - Health Insurance",children:[a.jsx(X,{label:"Self & Family",value:Z(l.sec_80d_self_family)}),a.jsx(X,{label:"Parents",value:Z(l.sec_80d_parents)}),a.jsx(X,{label:"Preventive Checkup",value:Z(l.sec_80d_preventive_checkup)}),a.jsx(X,{label:"Self Senior Citizen",value:l.sec_80d_self_senior_citizen?"Yes":"No"}),a.jsx(X,{label:"Parents Senior Citizen",value:l.sec_80d_parents_senior_citizen?"Yes":"No"}),a.jsx("div",{className:"col-span-2 mt-2 rounded bg-muted p-2",children:a.jsxs("strong",{children:["Total 80D: ",Z((l.sec_80d_self_family||0)+(l.sec_80d_parents||0)+(l.sec_80d_preventive_checkup||0))]})})]}),a.jsx(D,{className:"my-4"}),a.jsxs(K,{title:"Other Deductions",children:[a.jsx(X,{label:"80E Education Loan Interest",value:Z(l.sec_80e_education_loan_interest)}),a.jsx(X,{label:"80G Donations (100%)",value:Z(l.sec_80g_100_percent)}),a.jsx(X,{label:"80G Donations (50%)",value:Z(l.sec_80g_50_percent)}),a.jsx(X,{label:"80EEA Home Loan Interest",value:Z(l.sec_80eea_home_loan_interest)}),a.jsx(X,{label:"80TTA Savings Interest",value:Z(l.sec_80tta_savings_interest)}),a.jsx(X,{label:"80U Disability",value:Z(l.sec_80u_disability)}),a.jsx(X,{label:"80DD Dependent Disability",value:Z(l.sec_80dd_dependent_disability)})]}),a.jsx(D,{className:"my-4"}),a.jsxs(K,{title:"Home Loan & HRA",children:[a.jsx(X,{label:"Sec 24 Home Loan Interest",value:Z(l.sec_24_home_loan_interest)}),a.jsx(X,{label:"Property Type",value:null==(i=l.property_type)?void 0:i.replace("_"," ")}),a.jsx(X,{label:"Annual Rent Paid",value:Z(l.rent_paid_annual)}),a.jsx(X,{label:"Metro City",value:l.is_metro_city?"Yes":"No"}),a.jsx(X,{label:"Loss from House Property",value:Z(l.loss_from_house_property)})]})]}),a.jsx(D,{className:"my-4"}),a.jsxs(K,{title:"NPS Contributions (Both Regimes)",children:[a.jsx(X,{label:"80CCD(1B) Self NPS",value:Z(l.sec_80ccd_1b_nps)}),a.jsx(X,{label:"80CCD(2) Employer NPS",value:Z(l.sec_80ccd_2_employer_nps)})]}),"new"===l.tax_regime&&a.jsxs(a.Fragment,{children:[a.jsx(D,{className:"my-4"}),a.jsxs(K,{title:"New Regime Specific",children:[a.jsx(X,{label:"Family Pension Deduction",value:Z(l.family_pension_deduction)}),a.jsx(X,{label:"80JJAA New Employment",value:Z(l.sec_80jjaa_new_employment)}),a.jsx(X,{label:"80CCH Agniveer",value:Z(l.sec_80cch_agniveer)}),a.jsx(X,{label:"Transport Allowance (Disabled)",value:Z(l.transport_allowance_disabled)}),a.jsx(X,{label:"Conveyance Allowance",value:Z(l.conveyance_allowance)})]})]}),l.hr_verified_at&&a.jsxs(a.Fragment,{children:[a.jsx(D,{className:"my-4"}),a.jsxs(K,{title:"Verification Details",children:[a.jsx(X,{label:"Verified At",value:new Date(l.hr_verified_at).toLocaleDateString()}),a.jsx(X,{label:"Remarks",value:l.hr_remarks})]})]})]})]})})}const ae=e=>null==e?"₹0":`₹${e.toLocaleString("en-IN")}`;function se(){var e,d,o,x,m,u,Z,K,X,se,le;const ie=s(),{user:te}=l(),ne=w({}),[re,ce]=i.useState(1),[de]=i.useState(10),[oe,xe]=i.useState(""),[me,ue]=i.useState((()=>{const e=new Date,a=e.getFullYear();return e.getMonth()+1>=4?`${a}-${(a+1).toString().slice(-2)}`:`${a-1}-${a.toString().slice(-2)}`})()),[je,ve]=i.useState("all"),[_e,he]=i.useState("all"),[pe,fe]=i.useState(null),[ge,be]=i.useState(!1),[ye,Ne]=i.useState(!1),[we,Se]=i.useState(!1),[ke,De]=i.useState(""),[Ce,Ae]=i.useState("approved"),Te=(null==te?void 0:te.ulbId)||localStorage.getItem("ulbId"),Pe=S({api:`${n.getAllTaxDeclarations}?page=${re}&limit=${de}&q=${oe}&financial_year=${me}&ulb_id=${Te}${"all"!==je?`&verification_status=${je}`:""}${"all"!==_e?`&tax_regime=${_e}`:""}`,key:"getAllTaxDeclarations",value:[re,de,me,je,_e,Te],options:{enabled:!!Te}});return a.jsxs("main",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50",children:[a.jsx(ee,{open:ge,setOpen:be,declaration:pe}),a.jsx(I,{open:ye,onOpenChange:Ne,children:a.jsxs(E,{children:[a.jsxs(O,{children:[a.jsxs(V,{children:["approved"===Ce?"Approve":"Reject"," Tax Declaration"]}),a.jsx(z,{children:"approved"===Ce?`Approve investment declaration for ${null==pe?void 0:pe.employee_name}? This will allow the employee to upload investment proofs.`:`Reject investment declaration for ${null==pe?void 0:pe.employee_name}? The employee will need to resubmit.`})]}),a.jsxs("div",{className:"my-4",children:[a.jsxs("label",{className:"text-sm font-medium",children:["Remarks"," ","rejected"===Ce?"(Required)":"(Optional)"]}),a.jsx(q,{value:ke,onChange:e=>De(e.target.value),placeholder:"rejected"===Ce?"Enter reason for rejection...":"Enter remarks...",className:"mt-2"})]}),a.jsxs(H,{children:[a.jsx(M,{children:"Cancel"}),a.jsx(Y,{onClick:async()=>{var e,a,s;if(pe)try{const l=await ne.mutateAsync({api:`${n.verifyTaxDeclaration}/${pe.id}/verify`,data:{verification_status:Ce,verification_remarks:ke}});(null==(e=null==l?void 0:l.data)?void 0:e.success)?(Pe.refetch(),r.success((null==(a=null==l?void 0:l.data)?void 0:a.message)||"Declaration verified successfully"),Ne(!1)):r.error((null==(s=l.data)?void 0:s.message)||"Failed to verify declaration")}catch(l){r.error(c(l))}},className:"rejected"===Ce?"bg-destructive hover:bg-destructive/90":"",disabled:"rejected"===Ce&&!ke.trim(),children:"approved"===Ce?"Approve":"Reject"})]})]})}),a.jsx(I,{open:we,onOpenChange:Se,children:a.jsxs(E,{children:[a.jsxs(O,{children:[a.jsx(V,{children:"Lock Tax Declaration"}),a.jsxs(z,{children:["Lock declaration for"," ",a.jsx("strong",{children:null==pe?void 0:pe.employee_name}),"?",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{className:"text-destructive",children:"Warning:"})," Once locked, it cannot be modified."]})]}),a.jsxs(H,{children:[a.jsx(M,{children:"Cancel"}),a.jsx(Y,{onClick:async()=>{var e,a,s;if(pe)try{const l=await ne.mutateAsync({api:`${n.lockTaxDeclaration}/${pe.id}/lock`,data:{}});(null==(e=null==l?void 0:l.data)?void 0:e.success)?(Pe.refetch(),r.success((null==(a=null==l?void 0:l.data)?void 0:a.message)||"Declaration locked successfully"),Se(!1)):r.error((null==(s=l.data)?void 0:s.message)||"Failed to lock declaration")}catch(l){r.error(c(l))}},className:"bg-destructive",children:"Lock Declaration"})]})]})}),a.jsx("div",{className:"space-y-6",children:a.jsxs(j,{className:"border border-gray-200 bg-white shadow-lg",children:[a.jsx(v,{className:"rounded-t-lg bg-gradient-to-r from-blue-600 to-indigo-600 text-white",children:a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(W,{className:"h-6 w-6"}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Tax Declarations"}),a.jsxs(_,{className:"mt-1 text-blue-100",children:["Total Declarations:"," ",(null==(d=null==(e=null==Pe?void 0:Pe.data)?void 0:e.pagination)?void 0:d.total)||0]})]})]})})}),a.jsxs(h,{className:"p-6",children:[a.jsx("div",{className:"mb-6",children:a.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[a.jsx("div",{className:"flex-1",children:a.jsx(C,{search:oe,setSearch:xe,refetch:Pe.refetch,isFetching:null==Pe?void 0:Pe.isLoading})}),a.jsxs(P,{value:me,onValueChange:ue,children:[a.jsx($,{className:"w-[140px]",children:a.jsx(L,{placeholder:"Financial Year"})}),a.jsxs(R,{children:[a.jsx(F,{value:"2025-26",children:"2025-26"}),a.jsx(F,{value:"2024-25",children:"2024-25"}),a.jsx(F,{value:"2023-24",children:"2023-24"})]})]}),a.jsxs(P,{value:je,onValueChange:ve,children:[a.jsx($,{className:"w-[160px]",children:a.jsx(L,{placeholder:"Status"})}),a.jsxs(R,{children:[a.jsx(F,{value:"all",children:"All Status"}),a.jsx(F,{value:"pending",children:"Pending Approval"}),a.jsx(F,{value:"approved",children:"Approved"}),a.jsx(F,{value:"partially_verified",children:"Partially Verified"}),a.jsx(F,{value:"verified",children:"Fully Verified"}),a.jsx(F,{value:"rejected",children:"Rejected"})]})]}),a.jsxs(P,{value:_e,onValueChange:he,children:[a.jsx($,{className:"w-[130px]",children:a.jsx(L,{placeholder:"Regime"})}),a.jsxs(R,{children:[a.jsx(F,{value:"all",children:"All Regimes"}),a.jsx(F,{value:"old",children:"Old Regime"}),a.jsx(F,{value:"new",children:"New Regime"})]})]})]})}),a.jsx(D,{className:"my-6"}),(null==Pe?void 0:Pe.isLoading)?a.jsx("div",{className:"flex items-center justify-center py-20",children:a.jsx(A,{})}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-200",children:a.jsxs(p,{children:[a.jsx(f,{children:a.jsxs(g,{className:"bg-gray-50 hover:bg-gray-50",children:[a.jsx(b,{className:"w-16 font-semibold text-gray-700",children:"#"}),a.jsx(b,{className:"font-semibold text-gray-700",children:"Employee"}),a.jsx(b,{className:"font-semibold text-gray-700",children:"Department"}),a.jsx(b,{className:"font-semibold text-gray-700",children:"FY"}),a.jsx(b,{className:"font-semibold text-gray-700",children:"Regime"}),a.jsx(b,{className:"font-semibold text-gray-700",children:"80C Total"}),a.jsx(b,{className:"font-semibold text-gray-700",children:"80D Total"}),a.jsx(b,{className:"font-semibold text-gray-700",children:"Status"}),a.jsx(b,{className:"text-center font-semibold text-gray-700",children:"Actions"})]})}),a.jsx(y,{children:((null==(x=null==(o=null==Pe?void 0:Pe.data)?void 0:o.data)?void 0:x.length)??0)>0?null==(m=null==Pe?void 0:Pe.data)?void 0:m.data.map((e,s)=>{const l=(e=>{switch(e){case"pending":return{variant:"secondary",label:"Pending Approval"};case"approved":return{variant:"default",label:"Approved"};case"partially_verified":return{variant:"outline",label:"Partially Verified"};case"verified":return{variant:"default",label:"Verified"};case"rejected":return{variant:"destructive",label:"Rejected"};default:return{variant:"secondary",label:e}}})(e.verification_status||"pending");return a.jsxs(g,{className:"transition-colors duration-150 hover:bg-blue-50/50",children:[a.jsx(N,{className:"font-medium text-gray-600",children:(re-1)*de+s+1}),a.jsxs(N,{children:[a.jsx("div",{className:"font-medium text-gray-900",children:e.employee_name}),a.jsx("div",{className:"text-xs text-muted-foreground",children:e.employee_code})]}),a.jsx(N,{className:"text-gray-700",children:e.department_name||"-"}),a.jsx(N,{className:"font-medium text-gray-900",children:e.financial_year}),a.jsx(N,{children:a.jsx(T,{variant:"new"===e.tax_regime?"default":"secondary",children:"new"===e.tax_regime?"New":"Old"})}),a.jsx(N,{className:"font-medium",children:ae((i=e,(i.sec_80c_ppf||0)+(i.sec_80c_epf||0)+(i.sec_80c_elss||0)+(i.sec_80c_life_insurance||0)+(i.sec_80c_nsc||0)+(i.sec_80c_tuition_fees||0)+(i.sec_80c_housing_loan_principal||0)+(i.sec_80c_sukanya_samriddhi||0)+(i.sec_80c_tax_saver_fd||0)+(i.sec_80c_ulip||0)+(i.sec_80c_other||0)))}),a.jsx(N,{className:"font-medium",children:ae((e.sec_80d_self_family||0)+(e.sec_80d_parents||0))}),a.jsx(N,{children:a.jsxs("div",{className:"flex flex-col items-start gap-1",children:[a.jsx(T,{variant:l.variant,className:"w-fit",children:l.label}),e.declaration_locked&&a.jsxs(T,{variant:"destructive",className:"w-fit text-xs",children:[a.jsx(B,{className:"mr-1 h-3 w-3"})," Locked"]})]})}),a.jsx(N,{children:a.jsxs("div",{className:"flex items-center justify-center gap-1",children:[a.jsx(t,{variant:"outline",size:"icon",title:"View Details",onClick:()=>(fe(e),void be(!0)),children:a.jsx(U,{className:"h-4 w-4"})}),"pending"===e.verification_status&&!e.declaration_locked&&a.jsxs(a.Fragment,{children:[a.jsx(t,{variant:"outline",size:"icon",title:"Approve Declaration",onClick:()=>(fe(e),Ae("approved"),De(""),void Ne(!0)),children:a.jsx(G,{className:"h-4 w-4 text-green-600"})}),a.jsx(t,{variant:"outline",size:"icon",title:"Reject Declaration",onClick:()=>(fe(e),Ae("rejected"),De(""),void Ne(!0)),children:a.jsx(J,{className:"h-4 w-4 text-destructive"})})]}),["approved","partially_verified","verified"].includes(e.verification_status||"")&&!e.declaration_locked&&a.jsx(t,{variant:"outline",size:"icon",title:"Lock Declaration",onClick:()=>(fe(e),void Se(!0)),children:a.jsx(B,{className:"h-4 w-4 text-orange-500"})}),["approved","partially_verified","verified"].includes(e.verification_status||"")&&a.jsx(t,{variant:"outline",size:"icon",title:"View Investment Proofs",onClick:()=>ie(`/hrms/dashboard/payroll/investment-proofs/${e.id}`),children:a.jsx(Q,{className:"h-4 w-4"})})]})})]},e.id??`tax-declaration-${s}`);var i}):a.jsx(g,{children:a.jsx(N,{colSpan:9,className:"py-8 text-center text-gray-500",children:"No Tax Declarations found"})})})]})}),a.jsxs("div",{className:"mt-6 flex items-center justify-between rounded-lg border border-gray-200 bg-gray-50 p-4",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",(re-1)*de+1," to"," ",Math.min(re*de,(null==(Z=null==(u=null==Pe?void 0:Pe.data)?void 0:u.pagination)?void 0:Z.total)||0)," ","of ",(null==(X=null==(K=null==Pe?void 0:Pe.data)?void 0:K.pagination)?void 0:X.total)||0," ","entries"]}),a.jsx(k,{page:re,setPage:ce,limit:de,totalPages:(null==(le=null==(se=null==Pe?void 0:Pe.data)?void 0:se.pagination)?void 0:le.totalPages)||1})]})]})]})]})})]})}function le(){return a.jsx(u,{title:"Tax Declarations",subTitle:"Review and approve employee tax declarations",children:a.jsx(se,{})})}export{le as default};
