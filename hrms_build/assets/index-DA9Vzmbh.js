import{w as e,r as s,A as a,j as i,B as n,z as c,e as r,l}from"./index-pqP14EhS.js";import{P as t}from"./index-DZYVnpiZ.js";import{a as _,o as d,c as o,d as m,f as x,b as u}from"./yup-C8lOt6vX.js";import{u as p,b as h}from"./useCustomQuery-CzEWxvyG.js";import{C as j,a as f,d as g,b as v,c as b}from"./card-Bs59ZPbY.js";import{I as y}from"./input-BT6hWnw8.js";import{L as N}from"./label-xKekv9dA.js";import{S as w}from"./switch-CvZERcdR.js";import{S,a as C,b as k,c as D,d as P}from"./select-B4keucJT.js";import{T as M,a as T,b as A,c as F}from"./tabs-BXBC0wvu.js";import{B as z}from"./badge-DeVTySeZ.js";import{A as L,b as R,a as I}from"./alert-5yvvhmHd.js";import{S as O}from"./separator-DjchR5HV.js";import{S as V}from"./Spinner-CJE7r9W9.js";import{L as E}from"./lock-D6BA8s4N.js";import{C as H}from"./calculator-DJ0_neMv.js";import{C as Y}from"./circle-alert-B7J-58O5.js";import{C as $}from"./circle-x-6Y3mmM73.js";import{C as U}from"./circle-check-big-BiAG3xNy.js";import{A as q}from"./arrow-right-D1ACRGva.js";import{F as B}from"./file-check-B4TFGHLB.js";import{C as G}from"./clock-Dx15zlBS.js";import{I as K}from"./info-qKsat57S.js";import"./check-BQY2iuAn.js";const Q=()=>{const e=new Date,s=e.getFullYear();return e.getMonth()+1>=4?`${s}-${(s+1).toString().slice(-2)}`:`${s-1}-${s.toString().slice(-2)}`},Z=o().shape({financial_year:u().required("Financial year is required"),tax_regime:u().oneOf(["old","new"]).required("Tax regime is required"),sec_80c_ppf:x().nullable().min(0).max(15e4),sec_80c_epf:x().nullable().min(0).max(15e4),sec_80c_elss:x().nullable().min(0).max(15e4),sec_80c_life_insurance:x().nullable().min(0).max(15e4),sec_80c_nsc:x().nullable().min(0).max(15e4),sec_80c_tuition_fees:x().nullable().min(0).max(15e4),sec_80c_housing_loan_principal:x().nullable().min(0).max(15e4),sec_80c_sukanya_samriddhi:x().nullable().min(0).max(15e4),sec_80c_tax_saver_fd:x().nullable().min(0).max(15e4),sec_80c_ulip:x().nullable().min(0).max(15e4),sec_80c_other:x().nullable().min(0).max(15e4),sec_80ccd_1b_nps:x().nullable().min(0).max(5e4),sec_80ccd_2_employer_nps:x().nullable().min(0),sec_80d_self_family:x().nullable().min(0).max(1e5),sec_80d_parents:x().nullable().min(0).max(1e5),sec_80d_preventive_checkup:x().nullable().min(0).max(5e3),sec_80d_self_senior_citizen:m(),sec_80d_parents_senior_citizen:m(),sec_80e_education_loan_interest:x().nullable().min(0),sec_80g_100_percent:x().nullable().min(0),sec_80g_50_percent:x().nullable().min(0),sec_80eea_home_loan_interest:x().nullable().min(0).max(5e4),sec_80tta_savings_interest:x().nullable().min(0).max(1e4),sec_24_home_loan_interest:x().nullable().min(0).max(2e5),property_type:u().oneOf(["self_occupied","let_out","none"]).nullable(),rent_paid_annual:x().nullable().min(0),is_metro_city:m()}),J=e=>e?`₹${e.toLocaleString("en-IN")}`:"₹0",W=({label:e,name:s,register:a,max:n,info:c,disabled:r})=>i.jsxs("div",{className:"space-y-1",children:[i.jsxs(N,{className:"flex items-center gap-1",children:[e,c&&i.jsx(K,{className:"h-3 w-3 text-muted-foreground"})]}),i.jsx(y,{type:"number",...a(s,{valueAsNumber:!0}),placeholder:"0",min:0,max:n,disabled:r,className:r?"cursor-not-allowed bg-muted":""}),n&&i.jsxs("span",{className:"text-xs text-muted-foreground",children:["Max: ",J(n)]})]});function X(){const{user:t}=e(),o=p({}),[m,x]=s.useState("new"),{data:u,isLoading:y}=h({api:`${a.getTaxDeclaration}/me?financial_year=${Q()}`,key:"getMyTaxDeclaration",options:{enabled:!!t}}),{register:K,handleSubmit:X,watch:ee,setValue:se,reset:ae,formState:{errors:ie,isSubmitting:ne}}=_({resolver:d(Z),defaultValues:{financial_year:Q(),tax_regime:"new",sec_80c_ppf:0,sec_80c_epf:0,sec_80c_elss:0,sec_80c_life_insurance:0,sec_80c_nsc:0,sec_80c_tuition_fees:0,sec_80c_housing_loan_principal:0,sec_80c_sukanya_samriddhi:0,sec_80c_tax_saver_fd:0,sec_80c_ulip:0,sec_80c_other:0,sec_80ccd_1b_nps:0,sec_80ccd_2_employer_nps:0,sec_80d_self_family:0,sec_80d_parents:0,sec_80d_preventive_checkup:0,sec_80d_self_senior_citizen:!1,sec_80d_parents_senior_citizen:!1,sec_80e_education_loan_interest:0,sec_80g_100_percent:0,sec_80g_50_percent:0,sec_80eea_home_loan_interest:0,sec_80tta_savings_interest:0,sec_24_home_loan_interest:0,is_metro_city:!1,property_type:"none",rent_paid_annual:0}});s.useEffect(()=>{Object.keys(ie).length},[ie]),s.useEffect(()=>{se("financial_year",Q()),se("tax_regime","new")},[se]),s.useEffect(()=>{var e;const s=(null==(e=null==u?void 0:u.data)?void 0:e.declaration)||(null==u?void 0:u.data);if(null==s?void 0:s.financial_year){const e=s;ae({financial_year:e.financial_year,tax_regime:e.tax_regime,sec_80c_ppf:Math.min(e.sec_80c_ppf||0,15e4),sec_80c_epf:Math.min(e.sec_80c_epf||0,15e4),sec_80c_elss:Math.min(e.sec_80c_elss||0,15e4),sec_80c_life_insurance:Math.min(e.sec_80c_life_insurance||0,15e4),sec_80c_nsc:Math.min(e.sec_80c_nsc||0,15e4),sec_80c_tuition_fees:Math.min(e.sec_80c_tuition_fees||0,15e4),sec_80c_housing_loan_principal:Math.min(e.sec_80c_housing_loan_principal||0,15e4),sec_80c_sukanya_samriddhi:Math.min(e.sec_80c_sukanya_samriddhi||0,15e4),sec_80c_tax_saver_fd:Math.min(e.sec_80c_tax_saver_fd||0,15e4),sec_80c_ulip:Math.min(e.sec_80c_ulip||0,15e4),sec_80c_other:Math.min(e.sec_80c_other||0,15e4),sec_80ccd_1b_nps:Math.min(e.sec_80ccd_1b_nps||0,5e4),sec_80ccd_2_employer_nps:e.sec_80ccd_2_employer_nps||0,sec_80d_self_family:Math.min(e.sec_80d_self_family||0,1e5),sec_80d_parents:Math.min(e.sec_80d_parents||0,1e5),sec_80d_preventive_checkup:Math.min(e.sec_80d_preventive_checkup||0,5e3),sec_80d_self_senior_citizen:e.sec_80d_self_senior_citizen||!1,sec_80d_parents_senior_citizen:e.sec_80d_parents_senior_citizen||!1,sec_80e_education_loan_interest:e.sec_80e_education_loan_interest||0,sec_80g_100_percent:e.sec_80g_100_percent||0,sec_80g_50_percent:e.sec_80g_50_percent||0,sec_80eea_home_loan_interest:Math.min(e.sec_80eea_home_loan_interest||0,5e4),sec_80tta_savings_interest:Math.min(e.sec_80tta_savings_interest||0,1e4),sec_24_home_loan_interest:Math.min(e.sec_24_home_loan_interest||0,2e5),property_type:e.property_type||"none",rent_paid_annual:e.rent_paid_annual||0,is_metro_city:e.is_metro_city||!1}),x(e.tax_regime||"new")}},[u,ae]);const ce=ee(),re=(null==(le=null==u?void 0:u.data)?void 0:le.declaration)||(null==u?void 0:u.data);var le;const te=null==re?void 0:re.declaration_locked,_e=(ce.sec_80c_ppf||0)+(ce.sec_80c_epf||0)+(ce.sec_80c_elss||0)+(ce.sec_80c_life_insurance||0)+(ce.sec_80c_nsc||0)+(ce.sec_80c_tuition_fees||0)+(ce.sec_80c_housing_loan_principal||0)+(ce.sec_80c_sukanya_samriddhi||0)+(ce.sec_80c_tax_saver_fd||0)+(ce.sec_80c_ulip||0)+(ce.sec_80c_other||0),de=(ce.sec_80d_self_family||0)+(ce.sec_80d_parents||0)+(ce.sec_80d_preventive_checkup||0);if(y)return i.jsx("div",{className:"flex items-center justify-center py-12",children:i.jsx(V,{})});if(te)return i.jsxs(L,{variant:"destructive",children:[i.jsx(E,{className:"h-4 w-4"}),i.jsx(R,{children:"Declaration Locked"}),i.jsxs(I,{children:["Your tax declaration for FY ",null==re?void 0:re.financial_year," has been locked and cannot be modified."]})]});const oe=null==re?void 0:re.verification_status,me=!re||!oe||"draft"===oe||"rejected"===oe;return i.jsx("form",{onSubmit:X(async e=>{var s,i,n;try{const r=await o.mutateAsync({api:a.submitTaxDeclaration,data:{...e,declaration_type:"provisional"}});(null==(s=null==r?void 0:r.data)?void 0:s.success)?c.success((null==(i=null==r?void 0:r.data)?void 0:i.message)||"Declaration submitted successfully"):c.error((null==(n=r.data)?void 0:n.message)||"Failed to submit declaration")}catch(l){c.error(r(l))}},e=>{c.error("Please fix the form errors before submitting")}),children:i.jsxs("div",{className:"space-y-6",children:[(()=>{if(!re)return null;switch(oe){case"pending":return i.jsxs(L,{children:[i.jsx(G,{className:"h-4 w-4"}),i.jsx(R,{children:"Pending HR Approval"}),i.jsx(I,{children:"Your declaration has been submitted and is waiting for HR approval. Once approved, you can upload investment proofs."})]});case"approved":return i.jsxs(L,{className:"border-green-500 bg-green-50",children:[i.jsx(U,{className:"h-4 w-4 text-green-600"}),i.jsx(R,{className:"text-green-800",children:"Declaration Approved"}),i.jsxs(I,{className:"text-green-700",children:["Your declaration has been approved! You can now upload investment proofs.",i.jsxs(l,{to:"/hrms/employee/investment-proofs",className:"mt-2 flex items-center gap-1 font-medium text-green-800 hover:underline",children:["Upload Investment Proofs ",i.jsx(q,{className:"h-4 w-4"})]})]})]});case"partially_verified":return i.jsxs(L,{className:"border-blue-500 bg-blue-50",children:[i.jsx(B,{className:"h-4 w-4 text-blue-600"}),i.jsx(R,{className:"text-blue-800",children:"Partially Verified"}),i.jsxs(I,{className:"text-blue-700",children:["Some of your proofs have been verified. Continue uploading remaining proofs.",i.jsxs(l,{to:"/hrms/employee/investment-proofs",className:"mt-2 flex items-center gap-1 font-medium text-blue-800 hover:underline",children:["View & Upload Proofs ",i.jsx(q,{className:"h-4 w-4"})]})]})]});case"verified":return i.jsxs(L,{className:"border-green-500 bg-green-50",children:[i.jsx(U,{className:"h-4 w-4 text-green-600"}),i.jsx(R,{className:"text-green-800",children:"Fully Verified"}),i.jsxs(I,{className:"text-green-700",children:["All your investment proofs have been verified. Your TDS will be calculated accordingly.",i.jsxs(l,{to:"/hrms/employee/investment-proofs",className:"mt-2 flex items-center gap-1 font-medium text-green-800 hover:underline",children:["View Verification Status ",i.jsx(q,{className:"h-4 w-4"})]})]})]});case"rejected":return i.jsxs(L,{variant:"destructive",children:[i.jsx($,{className:"h-4 w-4"}),i.jsx(R,{children:"Declaration Rejected"}),i.jsx(I,{children:(null==re?void 0:re.verification_remarks)||"Your declaration was rejected. Please update and resubmit."})]});default:return null}})(),i.jsxs(j,{children:[i.jsx(f,{children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsxs(g,{className:"flex items-center gap-2",children:[i.jsx(H,{className:"h-5 w-5"}),"Tax Declaration Form"]}),i.jsxs(v,{children:["FY ",Q()]})]}),oe&&i.jsx(z,{variant:"verified"===oe||"approved"===oe?"default":"rejected"===oe?"destructive":"secondary",children:"pending"===oe?"Pending Approval":"approved"===oe?"Approved":"partially_verified"===oe?"Partially Verified":"verified"===oe?"Verified":"rejected"===oe?"Rejected":oe})]})}),i.jsxs(b,{children:[i.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:i.jsxs("div",{children:[i.jsx(N,{children:"Tax Regime"}),i.jsxs(S,{value:m,onValueChange:e=>{x(e),se("tax_regime",e)},disabled:!me,children:[i.jsx(C,{className:me?"":"cursor-not-allowed bg-muted",children:i.jsx(k,{placeholder:"Select Tax Regime",children:"new"===m?"New Tax Regime (Default)":"Old Tax Regime"})}),i.jsxs(D,{children:[i.jsx(P,{value:"new",children:"New Tax Regime (Default)"}),i.jsx(P,{value:"old",children:"Old Tax Regime"})]})]})]})}),"new"===m&&i.jsxs(L,{className:"mt-4",children:[i.jsx(Y,{className:"h-4 w-4"}),i.jsx(R,{children:"New Tax Regime"}),i.jsx(I,{children:"Under the new regime, most deductions are not available. Only NPS contributions (80CCD) are allowed."})]})]})]}),i.jsxs(M,{defaultValue:"new"===m?"nps":"80c",className:"w-full",children:[i.jsxs(T,{className:"grid w-full "+("new"===m?"grid-cols-1":"grid-cols-5"),children:["old"===m&&i.jsxs(i.Fragment,{children:[i.jsx(A,{value:"80c",children:"Section 80C"}),i.jsx(A,{value:"80d",children:"Section 80D"})]}),i.jsx(A,{value:"nps",children:"NPS (80CCD)"}),"old"===m&&i.jsxs(i.Fragment,{children:[i.jsx(A,{value:"other",children:"Other Deductions"}),i.jsx(A,{value:"hra",children:"HRA & Home Loan"})]})]}),"old"===m&&i.jsx(F,{value:"80c",children:i.jsxs(j,{children:[i.jsxs(f,{children:[i.jsx(g,{children:"Section 80C Investments (Max ₹1,50,000)"}),i.jsxs(v,{children:["Total: ",J(Math.min(_e,15e4))," ",_e>15e4&&"(Capped)"]})]}),i.jsx(b,{children:i.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[i.jsx(W,{label:"PPF",name:"sec_80c_ppf",register:K,max:15e4}),i.jsx(W,{label:"EPF (Employee)",name:"sec_80c_epf",register:K,max:15e4}),i.jsx(W,{label:"ELSS Mutual Funds",name:"sec_80c_elss",register:K,max:15e4}),i.jsx(W,{label:"Life Insurance Premium",name:"sec_80c_life_insurance",register:K,max:15e4}),i.jsx(W,{label:"NSC",name:"sec_80c_nsc",register:K,max:15e4}),i.jsx(W,{label:"Tuition Fees (2 children)",name:"sec_80c_tuition_fees",register:K,max:15e4}),i.jsx(W,{label:"Housing Loan Principal",name:"sec_80c_housing_loan_principal",register:K,max:15e4}),i.jsx(W,{label:"Sukanya Samriddhi",name:"sec_80c_sukanya_samriddhi",register:K,max:15e4}),i.jsx(W,{label:"Tax Saver FD",name:"sec_80c_tax_saver_fd",register:K,max:15e4}),i.jsx(W,{label:"ULIP",name:"sec_80c_ulip",register:K,max:15e4}),i.jsx(W,{label:"Other 80C",name:"sec_80c_other",register:K,max:15e4})]})})]})}),"old"===m&&i.jsx(F,{value:"80d",children:i.jsxs(j,{children:[i.jsxs(f,{children:[i.jsx(g,{children:"Section 80D - Health Insurance"}),i.jsxs(v,{children:["Total: ",J(de)]})]}),i.jsxs(b,{children:[i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(W,{label:"Self & Family Premium",name:"sec_80d_self_family",register:K,max:1e5}),i.jsx(W,{label:"Parents Premium",name:"sec_80d_parents",register:K,max:1e5}),i.jsx(W,{label:"Preventive Health Checkup",name:"sec_80d_preventive_checkup",register:K,max:5e3})]}),i.jsx(O,{className:"my-4"}),i.jsxs("div",{className:"flex flex-wrap gap-6",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(w,{checked:ce.sec_80d_self_senior_citizen,onCheckedChange:e=>se("sec_80d_self_senior_citizen",e)}),i.jsx(N,{children:"Self/Spouse is Senior Citizen (60+)"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(w,{checked:ce.sec_80d_parents_senior_citizen,onCheckedChange:e=>se("sec_80d_parents_senior_citizen",e)}),i.jsx(N,{children:"Parents are Senior Citizens (60+)"})]})]})]})]})}),i.jsx(F,{value:"nps",children:i.jsxs(j,{children:[i.jsxs(f,{children:[i.jsx(g,{children:"NPS Contributions (80CCD)"}),i.jsx(v,{children:"Available in both old and new tax regimes"})]}),i.jsx(b,{children:i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(W,{label:"80CCD(1B) - Self NPS (Additional)",name:"sec_80ccd_1b_nps",register:K,max:5e4,info:"Over and above 80C limit",disabled:!me}),i.jsx(W,{label:"80CCD(2) - Employer NPS",name:"sec_80ccd_2_employer_nps",register:K,info:"Up to 14% of basic for govt employees",disabled:!me})]})})]})}),"old"===m&&i.jsx(F,{value:"other",children:i.jsxs(j,{children:[i.jsx(f,{children:i.jsx(g,{children:"Other Deductions"})}),i.jsx(b,{children:i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(W,{label:"80E - Education Loan Interest",name:"sec_80e_education_loan_interest",register:K,info:"No upper limit"}),i.jsx(W,{label:"80G - Donations (100% deduction)",name:"sec_80g_100_percent",register:K}),i.jsx(W,{label:"80G - Donations (50% deduction)",name:"sec_80g_50_percent",register:K}),i.jsx(W,{label:"80EEA - Home Loan Interest (First time)",name:"sec_80eea_home_loan_interest",register:K,max:5e4}),i.jsx(W,{label:"80TTA - Savings Interest",name:"sec_80tta_savings_interest",register:K,max:1e4})]})})]})}),"old"===m&&i.jsx(F,{value:"hra",children:i.jsxs(j,{children:[i.jsx(f,{children:i.jsx(g,{children:"HRA Exemption & Home Loan"})}),i.jsxs(b,{children:[i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(W,{label:"Annual Rent Paid",name:"rent_paid_annual",register:K,disabled:!me}),i.jsxs("div",{className:"flex items-center gap-2 pt-6",children:[i.jsx(w,{checked:ce.is_metro_city,onCheckedChange:e=>se("is_metro_city",e),disabled:!me}),i.jsx(N,{children:"Metro City (Delhi, Mumbai, Chennai, Kolkata)"})]})]}),i.jsx(O,{className:"my-4"}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(W,{label:"Section 24 - Home Loan Interest",name:"sec_24_home_loan_interest",register:K,max:2e5}),i.jsxs("div",{children:[i.jsx(N,{children:"Property Type"}),i.jsxs(S,{value:ce.property_type||"none",onValueChange:e=>se("property_type",e),children:[i.jsx(C,{children:i.jsx(k,{})}),i.jsxs(D,{children:[i.jsx(P,{value:"none",children:"Not Applicable"}),i.jsx(P,{value:"self_occupied",children:"Self Occupied"}),i.jsx(P,{value:"let_out",children:"Let Out"})]})]})]})]})]})]})})]},m),me&&i.jsxs("div",{className:"flex justify-end gap-4",children:[i.jsx(n,{type:"button",variant:"outline",onClick:async()=>{var e,s;const i=ce;try{const n=await o.mutateAsync({api:a.submitTaxDeclaration,data:{...i,declaration_type:"provisional"}});(null==(e=null==n?void 0:n.data)?void 0:e.success)?c.success("Draft saved successfully"):c.error((null==(s=n.data)?void 0:s.message)||"Failed to save draft")}catch(n){c.error(r(n))}},disabled:ne,children:"Save as Draft"}),i.jsx(n,{type:"submit",disabled:ne,children:ne?"Submitting...":"Submit Declaration"})]})]})})}function ee(){return i.jsx(t,{title:"Tax Declaration",subTitle:"Submit your tax saving investments declaration",children:i.jsx("div",{className:"py-6",children:i.jsx(X,{})})})}export{ee as default};
