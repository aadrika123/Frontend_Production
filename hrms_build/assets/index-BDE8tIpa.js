import{r as e,aA as a,j as l,aB as s,al as t}from"./vendor-RyuIgj66.js";import{P as i}from"./index-DFF4_m_G.js";import{j as r,e as d,g as n,B as p}from"./index-ey2GEmQz.js";import{C as o,a as c,d as m,b as u,c as x}from"./card-u7M7FP5y.js";import{T as h,a as y,b as f,c as j,d as g,e as b}from"./table-B_npepsp.js";import{u as _,b as v}from"./useCustomQuery-DTB6aAiD.js";import{S as N}from"./separator-BQijJEjG.js";import{S as k}from"./Spinner-BwGzvoRj.js";import{c as w,b as S,e as E,a as M}from"./yup-CH6wvET8.js";import{F as T}from"./datetime-picker-dN6E5dqy.js";import{R as F}from"./RHFTextField-BSZ_cEI3.js";import{B as A}from"./ButtonLoading-DDalXO-W.js";import{R as C}from"./RHFSelectField-oISAIiMK.js";import"./input-DlX9dTT0.js";import"./switch-Cssv6fnZ.js";import{R as P}from"./RHFCheckbox-BZ4qq51l.js";import{D}from"./index-B2ia16z0.js";import{L as R}from"./label-BcY3kv5U.js";import{E as I}from"./employeeTypes-BSpBpKLh.js";import{ao as O,F as B,U as H,aw as L}from"./icons-CxCh8mm_.js";import{B as $}from"./badge-DbWnzWn2.js";import"./ui-B3c1eQmf.js";import"./query-BH9sOW2X.js";import"./axios-Dos3PyFQ.js";import"./zustand-C1rkr5lV.js";import"./select-8PAfYjod.js";import"./checkbox-DFFItNXW.js";const q=[{value:"daily",label:"Daily Wage",description:"Calculate salary based on daily rate and working days"},{value:"contractual",label:"Contractual",description:"Fixed consolidated salary, simpler calculation"},{value:"monthly",label:"Monthly (Regular)",description:"Full salary structure with DA, HRA, and all allowances"}],W={daily:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",contractual:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",monthly:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"},z=w().shape({emp_type:M().required("Employee type is required").oneOf(["permanent","contractual","daily_wage","consultant"],"Invalid employee type"),salary_mode:M().required("Salary mode is required").oneOf(["daily","contractual","monthly"],"Invalid salary mode"),default_tds_type:M().oneOf(["slab","flat"]).default("slab"),default_flat_tds_rate:E().default(10),default_pf_applicable:S().default(!0),default_esi_applicable:S().default(!0),default_pt_applicable:S().default(!0),description:M().nullable(),priority:E().default(10),is_active:S().default(!0)});function U({open:i,setOpen:p,title:o,id:c,edit:m,setEdit:u,refetch:x}){const h=_({}),{data:y,isFetching:f}=v({api:`${r.getEmpTypeSalaryMapping}?id=${d(String(c))}`,key:"getEmpTypeMappingById",value:[c],options:{enabled:m&&null!==c}}),j=(null==y?void 0:y.data)&&y.data.length>0?y.data[0]:null,g=e.useMemo(()=>({emp_type:(null==j?void 0:j.emp_type)||"permanent",salary_mode:(null==j?void 0:j.salary_mode)||"monthly",default_tds_type:(null==j?void 0:j.default_tds_type)||"slab",default_flat_tds_rate:Number(null==j?void 0:j.default_flat_tds_rate)||10,default_pf_applicable:(null==j?void 0:j.default_pf_applicable)??!0,default_esi_applicable:(null==j?void 0:j.default_esi_applicable)??!0,default_pt_applicable:(null==j?void 0:j.default_pt_applicable)??!0,description:(null==j?void 0:j.description)||"",priority:(null==j?void 0:j.priority)||10,is_active:1===(null==j?void 0:j.status)}),[j]),b=a({defaultValues:g,resolver:s(z)}),k=b.watch("salary_mode");e.useEffect(()=>{b.reset(g)},[g,b]);const w=q.find(e=>e.value===k);return l.jsx(D,{open:i,setOpen:p,title:o,setEdit:u,edit:m,isLoading:f,children:l.jsx(T,{methods:b,onSubmit:b.handleSubmit(async e=>{var a,l,s;try{const i=await h.mutateAsync({api:r.upsertEmpTypeSalaryMapping,data:{...m&&c?{id:Number(c)}:{},emp_type:e.emp_type,salary_mode:e.salary_mode,default_tds_type:e.default_tds_type,default_flat_tds_rate:e.default_flat_tds_rate,default_pf_applicable:e.default_pf_applicable,default_esi_applicable:e.default_esi_applicable,default_pt_applicable:e.default_pt_applicable,description:e.description||null,priority:e.priority,status:e.is_active?1:0}});(null==(a=i.data)?void 0:a.success)?(t.success((null==(l=null==i?void 0:i.data)?void 0:l.message)||`Employee type mapping ${m?"updated":"created"} successfully`),p(!1),null==u||u(!1),null==x||x(),b.reset({emp_type:"permanent",salary_mode:"monthly",default_tds_type:"slab",default_flat_tds_rate:10,default_pf_applicable:!0,default_esi_applicable:!0,default_pt_applicable:!0,description:"",priority:10,is_active:!0})):t.error((null==(s=i.data)?void 0:s.message)||"Failed to save mapping")}catch(i){t.error(n(i))}}),children:l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx(R,{className:"mb-3 block text-base font-semibold",children:"Employee Type"}),l.jsx("p",{className:"mb-4 text-sm text-muted-foreground",children:"Select the employee type to configure"}),l.jsx("div",{className:"grid grid-cols-1 gap-x-4 gap-y-4",children:l.jsx("div",{children:l.jsx(C,{name:"emp_type",label:"Employee Type",data:I})})})]}),l.jsx(N,{}),l.jsxs("div",{children:[l.jsx(R,{className:"flex items-center gap-2 text-base font-semibold",children:"Salary Calculation Mode"}),l.jsx("p",{className:"mb-4 mt-1 text-sm text-muted-foreground",children:"Choose how salary should be calculated for this employee type"}),l.jsx("div",{className:"grid grid-cols-1 gap-3",children:q.map(e=>l.jsxs("label",{className:`\n                    flex cursor-pointer items-start gap-3 rounded-lg border-2 p-4 transition-all\n                    ${k===e.value?"border-primary bg-primary/5":"border-border hover:border-primary/50"}\n                  `,children:[l.jsx("input",{type:"radio",value:e.value,checked:k===e.value,onChange:e=>b.setValue("salary_mode",e.target.value),className:"mt-1"}),l.jsxs("div",{className:"flex-1",children:[l.jsx("div",{className:"font-medium",children:e.label}),l.jsx("div",{className:"text-sm text-muted-foreground",children:e.description})]})]},e.value))})]}),w&&l.jsxs("div",{className:"flex items-start gap-2 rounded-lg bg-blue-50 p-3 dark:bg-blue-950",children:[l.jsx(O,{className:"mt-0.5 h-4 w-4 text-blue-600"}),l.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:["daily"===k&&l.jsxs(l.Fragment,{children:[l.jsx("strong",{children:"Daily Wage:"})," Salary = (Daily Rate × Working Days). Limited allowances apply. Simpler tax calculations."]}),"contractual"===k&&l.jsxs(l.Fragment,{children:[l.jsx("strong",{children:"Contractual:"})," Fixed consolidated salary per month. Pro-rated for partial months. Minimal deductions."]}),"monthly"===k&&l.jsxs(l.Fragment,{children:[l.jsx("strong",{children:"Monthly:"})," Full salary structure with Basic + Grade Pay + DA + HRA + all applicable allowances. Complete PF/NPS, ESI, and IT deductions apply."]})]})]}),l.jsx(N,{}),l.jsxs("div",{children:[l.jsx(R,{className:"mb-3 block text-base font-semibold",children:"Default Statutory Deductions"}),l.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[l.jsx(P,{name:"default_pf_applicable",label:"PF Applicable"}),l.jsx(P,{name:"default_esi_applicable",label:"ESI Applicable"}),l.jsx(P,{name:"default_pt_applicable",label:"PT Applicable"})]})]}),l.jsx(N,{}),l.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[l.jsx("div",{children:l.jsx(F,{name:"priority",label:"Priority",type:"number",placeholder:"Higher = checked first"})}),l.jsx("div",{children:l.jsx(F,{name:"description",label:"Description",placeholder:"Optional notes"})}),l.jsx("div",{className:"flex items-end",children:l.jsx(P,{name:"is_active",label:"Active"})})]}),m&&l.jsxs("div",{className:"flex items-start gap-2 rounded-lg bg-amber-50 p-3 dark:bg-amber-950",children:[l.jsx(B,{className:"mt-0.5 h-4 w-4 text-amber-600"}),l.jsxs("div",{className:"text-sm text-amber-800 dark:text-amber-200",children:[l.jsx("strong",{children:"Warning:"})," Changing the salary mode for an existing employee type will affect salary calculations for all employees of this type."]})]}),l.jsx("div",{className:"flex justify-end",children:l.jsx(A,{type:"submit",isLoading:h.isPending,children:m?"Update Mapping":"Add Mapping"})})]})})})}function V(){var a,s,t,i,d;const[n,_]=e.useState(!1),[w,S]=e.useState(null),[E,M]=e.useState(!1),T=v({api:r.getAllEmpTypeSalaryMappings,key:"getAllEmpTypeSalaryMappings",options:{enabled:!0}}),F=()=>{M(!1),S(null),_(!0)},A=null==(s=null==(a=T.data)?void 0:a.data)?void 0:s.reduce((e,a)=>{const l=a.salary_mode;return e[l]||(e[l]=[]),e[l].push(a),e},{});return l.jsxs("main",{className:"grid items-start",children:[l.jsx(U,{open:n,setOpen:_,title:E?"Edit Employee Type Mapping":"Add Employee Type Mapping",id:w,edit:E,setEdit:M,refetch:T.refetch}),l.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[l.jsxs("div",{className:"flex w-full flex-wrap justify-between gap-4",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(H,{className:"h-5 w-5 text-muted-foreground"}),l.jsxs("span",{className:"text-lg font-medium",children:[(null==(i=null==(t=T.data)?void 0:t.data)?void 0:i.length)||0," Employee Types Configured"]})]}),l.jsxs(p,{className:"flex items-center gap-2",onClick:F,children:[l.jsx(L,{className:"h-4 w-4"}),"Add Mapping"]})]}),l.jsx(N,{}),l.jsxs("div",{className:"flex items-start gap-2 rounded-lg border border-amber-200 bg-amber-50 p-3 dark:border-amber-800 dark:bg-amber-950",children:[l.jsx(O,{className:"mt-0.5 h-5 w-5 text-amber-600"}),l.jsxs("div",{className:"text-sm text-amber-800 dark:text-amber-200",children:[l.jsx("strong",{children:"Important:"})," This mapping determines which salary calculation formula and allowance set is used for each employee type. Changing this affects how salaries are computed for all employees of that type."]})]}),A&&Object.keys(A).length>0&&l.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:q.map(e=>{var a,s;const t=(null==(a=A[e.value])?void 0:a.length)||0;return l.jsxs(o,{className:"relative overflow-hidden",children:[l.jsx("div",{className:`absolute left-0 top-0 h-full w-1 ${null==(s=W[e.value])?void 0:s.split(" ")[0]}`}),l.jsxs(c,{className:"pb-2",children:[l.jsx(m,{className:"text-lg",children:e.label}),l.jsx(u,{className:"text-xs",children:e.description})]}),l.jsxs(x,{children:[l.jsx("div",{className:"text-3xl font-bold",children:t}),l.jsxs("p",{className:"text-xs text-muted-foreground",children:["employee type",1!==t?"s":""]})]})]},e.value)})}),l.jsxs(o,{children:[l.jsxs(c,{children:[l.jsxs(m,{className:"flex items-center gap-2",children:[l.jsx(L,{className:"h-5 w-5"}),"Employee Type to Salary Mode Mappings"]}),l.jsx(u,{children:"Map each employee type to its corresponding salary calculation mode"})]}),l.jsx(x,{children:(null==T?void 0:T.isLoading)?l.jsx("div",{className:"flex items-center justify-center py-8",children:l.jsx(k,{})}):l.jsx("div",{className:"overflow-x-auto",children:l.jsxs(h,{children:[l.jsx(y,{children:l.jsxs(f,{children:[l.jsx(j,{className:"w-[60px]",children:"Priority"}),l.jsx(j,{children:"Employee Type / Pattern"}),l.jsx(j,{children:"Salary Mode"}),l.jsx(j,{children:"PF"}),l.jsx(j,{children:"ESI"}),l.jsx(j,{children:"PT"}),l.jsx(j,{children:"Status"}),l.jsx(j,{children:"Actions"})]})}),l.jsx(g,{children:(null==(d=null==T?void 0:T.data)?void 0:d.data)&&T.data.data.length>0?T.data.data.map(e=>{return l.jsxs(f,{children:[l.jsx(b,{className:"font-mono text-sm",children:e.priority}),l.jsx(b,{className:"font-medium",children:e.emp_type_label||e.emp_type}),l.jsx(b,{children:l.jsx($,{className:W[e.salary_mode]||"bg-gray-100 text-gray-800",children:(a=e.salary_mode,(null==(s=q.find(e=>e.value===a))?void 0:s.label)||a)})}),l.jsx(b,{children:l.jsx("span",{className:e.default_pf_applicable?"text-green-600":"text-red-600",children:e.default_pf_applicable?"✓":"✗"})}),l.jsx(b,{children:l.jsx("span",{className:e.default_esi_applicable?"text-green-600":"text-red-600",children:e.default_esi_applicable?"✓":"✗"})}),l.jsx(b,{children:l.jsx("span",{className:e.default_pt_applicable?"text-green-600":"text-red-600",children:e.default_pt_applicable?"✓":"✗"})}),l.jsx(b,{children:l.jsx("span",{className:"rounded-full px-3 py-1 text-xs font-semibold "+(1===e.status?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300"),children:1===e.status?"Active":"Inactive"})}),l.jsx(b,{children:l.jsx(p,{variant:"outline",size:"sm",onClick:()=>{return a=e.id,M(!0),S(a),void _(!0);var a},children:"Edit"})})]},e.id);var a,s}):l.jsx(f,{children:l.jsx(b,{colSpan:8,className:"py-8 text-center",children:l.jsxs("div",{className:"flex flex-col items-center gap-2",children:[l.jsx("p",{className:"text-muted-foreground",children:"No employee type mappings configured"}),l.jsx(p,{variant:"outline",size:"sm",onClick:F,children:"Add First Mapping"})]})})})})]})})})]})]})]})}function G(){return l.jsx(i,{title:"Employee Type Salary Mapping",subTitle:"Configure how each employee type maps to salary calculation mode",children:l.jsx("div",{className:"py-12",children:l.jsx(V,{})})})}export{G as default};
