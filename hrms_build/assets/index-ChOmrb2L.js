import{h as e,f as a,r as l,j as i,z as t,B as s,e as n}from"./index-BJ2Di0BB.js";import{P as d}from"./index-L2kacWh6.js";import{h as r}from"./moment-CBOc1lqT.js";import{C as o,a as c,b as u,c as m}from"./card-CrOEotWM.js";import{S as p,T as x,a as h,b as v,c as j,d as b,e as y}from"./index-BxKGIMG5.js";import{u as _,b as f}from"./useCustomQuery-DkqDqiry.js";import{P as g}from"./index-DZvdNKxy.js";import{S as N}from"./separator-BtSn9EpY.js";import{S}from"./Spinner-DjUjMlqR.js";import{a as D,o as C,c as E,b as T,f as w,d as A}from"./yup-BTlf5Wf5.js";import{F}from"./datetime-picker-cKnQNXMD.js";import{R as L}from"./RHFTextField-BK1QXo_s.js";import{R as V}from"./RHFTextArea-CtK9XJcE.js";import{B as q}from"./ButtonLoading-B5GmY3N3.js";import{R as B}from"./RHFSelectField-CxYg0t7R.js";import"./select-4D5dQM-6.js";import{R as P}from"./RHFCheckbox-gxPdkAtn.js";import{D as R}from"./index-ClKtlEeL.js";import{B as k}from"./badge-DufY8Gpx.js";import{L as M}from"./loader-circle--1riX2Rm.js";import{T as $}from"./trash-2-DvAODSCO.js";import"./calendar-B99NsLtP.js";import"./clock-PqgEqIzL.js";import"./check-DiqtQ1XW.js";const H=E().shape({deduction_code:T().required("Deduction Code is required"),deduction_name:T().required("Deduction Name is required"),calculation_type:T().required("Calculation Type is required"),default_value:w().typeError("Default Value must be a number").required("Default Value is required").min(0,"Default Value must be greater than or equal to 0"),calculation_base:T().nullable(),max_limit:w().typeError("Max Limit must be a number").nullable().transform((e,a)=>""===a?null:e),is_employer_contribution:A(),employer_contribution_rate:w().typeError("Employer Contribution Rate must be a number").nullable().transform((e,a)=>""===a?null:e),description:T().required("Description is required")});function I({open:s,setOpen:n,title:d,id:r,edit:o,setEdit:c,refetch:u}){var m;const p=_({}),{data:x,isFetching:h}=f({api:`${null==(m=e)?void 0:m.getDeductionById}?id=${a(String(r))}`,key:"getDeductionById",options:{enabled:o&&!!r}}),v=D({defaultValues:{deduction_code:"",deduction_name:"",calculation_type:"",default_value:0,calculation_base:null,max_limit:null,is_employer_contribution:!1,employer_contribution_rate:null,description:""},resolver:C(H)}),j=v.watch("calculation_type"),b=v.watch("is_employer_contribution");return l.useEffect(()=>{var e,a,l,i,t,s,n,d,r,c,u;o&&(null==x?void 0:x.data)?v.reset({deduction_code:(null==(e=null==x?void 0:x.data)?void 0:e.deduction_code)||"",deduction_name:(null==(a=null==x?void 0:x.data)?void 0:a.deduction_name)||"",calculation_type:(null==(l=null==x?void 0:x.data)?void 0:l.calculation_type)||"",default_value:Number(null==(i=null==x?void 0:x.data)?void 0:i.default_value)||0,calculation_base:(null==(t=null==x?void 0:x.data)?void 0:t.calculation_base)||null,max_limit:(null==(s=null==x?void 0:x.data)?void 0:s.max_limit)?Number(null==(n=null==x?void 0:x.data)?void 0:n.max_limit):null,is_employer_contribution:(null==(d=null==x?void 0:x.data)?void 0:d.is_employer_contribution)||!1,employer_contribution_rate:(null==(r=null==x?void 0:x.data)?void 0:r.employer_contribution_rate)?Number(null==(c=null==x?void 0:x.data)?void 0:c.employer_contribution_rate):null,description:(null==(u=null==x?void 0:x.data)?void 0:u.description)||""}):v.reset({deduction_code:"",deduction_name:"",calculation_type:"",default_value:0,calculation_base:null,max_limit:null,is_employer_contribution:!1,employer_contribution_rate:null,description:""})},[o,x]),l.useEffect(()=>{(null==v?void 0:v.watch("calculation_type"))&&v.setValue("default_value",0)},[j]),i.jsx(R,{open:s,setOpen:n,title:d,setEdit:c,edit:o,isLoading:h,children:i.jsx(F,{methods:v,onSubmit:v.handleSubmit(async a=>{var l,i,s,d,m,x,h,j;try{if(o&&r){const n=await p.mutateAsync({api:`${null==(l=e)?void 0:l.updateDeduction}`,data:{id:Number(r),...a}});(null==(i=n.data)?void 0:i.success)?t.success(null==(s=null==n?void 0:n.data)?void 0:s.message):t.error((null==(d=n.data)?void 0:d.message)||"Deduction Type not updated successfully")}else{const l=await p.mutateAsync({api:null==(m=e)?void 0:m.createDeduction,data:a});(null==(x=l.data)?void 0:x.success)?t.success(null==(h=null==l?void 0:l.data)?void 0:h.message):t.error((null==(j=l.data)?void 0:j.message)||"Deduction Type not created successfully")}v.reset(),n(!1),c(!1),u()}catch(b){}}),children:i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Basic Information"}),i.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[i.jsx(L,{name:"deduction_code",label:"Deduction Code",placeholder:"e.g., EPF, TAX, INS",inputValidation:["removeSpecialCharacterExceptSpace"]}),i.jsx(L,{name:"deduction_name",label:"Deduction Name",placeholder:"e.g., Provident Fund",inputValidation:["removeSpecialCharacterExceptSpace"]})]})]}),i.jsx("div",{children:i.jsx(V,{name:"description",label:"Description",placeholder:"Brief description of this deduction type...",inputValidation:["removeSpecialCharacterExceptSpace"]})})]}),i.jsx(N,{}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Calculation Method"}),i.jsxs("div",{className:"space-y-4",children:[i.jsx(B,{label:"How to Calculate",name:"calculation_type",data:[{label:"Fixed Amount",value:"fixed"},{label:"Percentage of Salary",value:"percentage"}]}),"fixed"===j&&i.jsx("div",{children:i.jsx(L,{name:"default_value",label:"Amount",placeholder:"e.g., 5000",type:"number",inputValidation:["number"]})}),"percentage"===j&&i.jsxs("div",{className:"space-y-4",children:[i.jsx(L,{name:"default_value",label:"Percentage (%)",placeholder:"e.g., 12",type:"number",inputValidation:"percentage"==j?["number","maxTwoDecimalPlaces"]:["number"],maxLength:2}),i.jsxs("div",{className:"space-y-4 rounded-lg border border-blue-200 bg-blue-50 p-4",children:[i.jsx("p",{className:"text-xs font-medium text-blue-700",children:"Additional Settings for Percentage Calculation"}),i.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[i.jsx(B,{name:"calculation_base",label:"Calculate Based On",data:[{label:"Basic Salary",value:"basic"},{label:"Gross Salary",value:"gross"},{label:"Net Salary",value:"net"}]}),i.jsx(L,{name:"max_limit",label:"Maximum Limit (Optional)",placeholder:"e.g., 15000",type:"number",inputValidation:["number"]})]}),i.jsx("p",{className:"text-xs italic text-gray-600",children:"Maximum limit caps the deduction amount regardless of the calculated percentage"})]})]})]})]}),i.jsx(N,{}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Employer Contribution"}),i.jsxs("div",{className:"space-y-4 rounded-lg border border-gray-200 bg-gray-50 p-4",children:[i.jsx("div",{className:"flex items-start gap-3",children:i.jsx(P,{name:"is_employer_contribution",label:"Employer also contributes to this deduction"})}),i.jsx("p",{className:"text-xs italic text-gray-600",children:"Check this if your organization contributes an amount in addition to the employee's deduction"}),b&&i.jsxs("div",{className:"mt-4 border-t border-gray-300 pt-4",children:[i.jsx(L,{name:"employer_contribution_rate",label:"Employer Contribution Rate (%)",placeholder:"e.g., 13",type:"number",inputValidation:["number"]}),i.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"This is the percentage or amount that the employer will contribute"})]})]})]})}),i.jsx(N,{className:"my-6"}),i.jsx("div",{className:"pt-2",children:i.jsx(q,{isLoading:v.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:o?"Update Deduction Type":"Create Deduction Type"})})]})})})}function O(){var a,d,D,C,E,T;const w=_({}),[A,F]=l.useState(1),[L,V]=l.useState(10),[q,B]=l.useState(""),[P,R]=l.useState(!1),[H,O]=l.useState(""),[Y,z]=l.useState(!1),[G,X]=l.useState(null),J=f({api:`${e.getAllDeductions}?page=${A}&limit=${L}&q=${q}`,key:"getAllDeductions",value:[A,L,q],options:{enabled:!0}});return i.jsxs("main",{className:"grid items-start",children:[i.jsx(I,{open:P,setOpen:R,title:Y?"Edit Deduction Type":"Add Deduction Type",id:H,edit:Y,setEdit:z,refetch:J.refetch}),i.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[i.jsxs("div",{className:"flex w-full justify-between gap-2",children:[i.jsx("div",{children:i.jsx(p,{search:q,setSearch:B,refetch:J.refetch,isFetching:null==J?void 0:J.isLoading})}),i.jsx("div",{children:i.jsx(s,{className:"flex items-center gap-2",onClick:()=>R(!0),children:"Add New"})})]}),i.jsxs(o,{children:[i.jsx(c,{className:"px-7",children:i.jsxs(u,{children:["Deduction Type List (",(null==(d=null==(a=null==J?void 0:J.data)?void 0:a.data)?void 0:d.length)||0,")"]})}),i.jsx(m,{children:J.isLoading?i.jsx("div",{className:"flex h-32 items-center justify-center",children:i.jsx(S,{})}):i.jsxs(i.Fragment,{children:[i.jsxs(x,{children:[i.jsx(h,{children:i.jsxs(v,{children:[i.jsx(j,{className:"",children:"#"}),i.jsx(j,{className:"",children:"Code"}),i.jsx(j,{className:"",children:"Name"}),i.jsx(j,{className:"",children:"Type"}),i.jsx(j,{className:"",children:"Default Value"}),i.jsx(j,{className:"",children:"Base"}),i.jsx(j,{className:"",children:"Max Limit"}),i.jsx(j,{className:"",children:"Employer Contribution"}),i.jsx(j,{className:"",children:"Description"}),i.jsx(j,{className:"",children:"Created at"}),i.jsx(j,{className:"",children:"Status"}),i.jsx(j,{children:"Action"})]})}),i.jsx(b,{children:null==(C=null==(D=null==J?void 0:J.data)?void 0:D.data)?void 0:C.map((a,l)=>i.jsxs(v,{children:[i.jsx(y,{children:l+1}),i.jsx(y,{children:null==a?void 0:a.deduction_code}),i.jsx(y,{children:null==a?void 0:a.deduction_name}),i.jsx(y,{children:i.jsx(k,{variant:"outline",className:"capitalize",children:null==a?void 0:a.calculation_type})}),i.jsxs(y,{children:[null==a?void 0:a.default_value,"percentage"===(null==a?void 0:a.calculation_type)&&"%"]}),i.jsx(y,{children:(null==a?void 0:a.calculation_base)||"-"}),i.jsx(y,{children:(null==a?void 0:a.max_limit)||"-"}),i.jsx(y,{children:i.jsxs(k,{variant:(null==a?void 0:a.is_employer_contribution)?"default":"secondary",children:[(null==a?void 0:a.is_employer_contribution)?"Yes":"No",(null==a?void 0:a.is_employer_contribution)&&(null==a?void 0:a.employer_contribution_rate)&&` (${null==a?void 0:a.employer_contribution_rate}%)`]})}),i.jsx(y,{className:"max-w-xs truncate",children:null==a?void 0:a.description}),i.jsx(y,{children:r(null==a?void 0:a.created_at).format("DD-MM-YYYY")}),i.jsx(y,{children:i.jsx(k,{variant:1===(null==a?void 0:a.status)?"default":"secondary",children:1===(null==a?void 0:a.status)?"Active":"Inactive"})}),i.jsx(y,{children:i.jsxs("div",{className:"flex gap-2",children:[i.jsx(s,{className:"bg-primary",onClick:()=>{return e=String(null==a?void 0:a.id),z(!0),R(!0),void O(e);var e},children:"Edit"}),i.jsx(s,{variant:"destructive",onClick:()=>(async a=>{var l,i,s,d;X(a);try{const n=await w.mutateAsync({api:`${null==(l=e)?void 0:l.deleteDeduction}`,data:{id:Number(a)}});(null==(i=null==n?void 0:n.data)?void 0:i.success)?(J.refetch(),t.success((null==(s=null==n?void 0:n.data)?void 0:s.message)||"Deduction deleted successfully")):t.error((null==(d=n.data)?void 0:d.message)||"Failed to delete deduction")}catch(r){t.error(n(r))}finally{X(null)}})(String(null==a?void 0:a.id)),disabled:G===String(null==a?void 0:a.id),children:G===String(null==a?void 0:a.id)?i.jsx(M,{className:"h-4 w-4 animate-spin"}):i.jsx($,{className:"h-4 w-4"})})]})})]},null==a?void 0:a.id))})]}),i.jsx(N,{className:"mb-2 mt-4"}),i.jsx("div",{className:"flex w-full justify-end",children:i.jsx(g,{page:A,limit:L,totalPages:Math.ceil(((null==(T=null==(E=null==J?void 0:J.data)?void 0:E.data)?void 0:T.length)||0)/L),setPage:F,setLimit:V})})]})})]})]})]})}function Y(){return i.jsx(d,{title:"Deduction Type List",subTitle:"Manage all the Deduction Types here",children:i.jsx("div",{className:"py-12",children:i.jsx(O,{})})})}export{Y as default};
