import{aA as e,j as r,aB as a,al as s,r as l}from"./vendor-RyuIgj66.js";import{P as t}from"./index-DFF4_m_G.js";import{h as i}from"./moment-CBOc1lqT.js";import{h as n,u as d,B as o}from"./index-ey2GEmQz.js";import{C as m,c,a as u,b as p}from"./card-u7M7FP5y.js";import{T as x,a as j,b as h,c as v,d as f,e as b}from"./table-B_npepsp.js";import{u as y,b as g}from"./useCustomQuery-DTB6aAiD.js";import{S as _}from"./Spinner-BwGzvoRj.js";import{c as A,a as N,e as P}from"./yup-CH6wvET8.js";import{F as D}from"./datetime-picker-dN6E5dqy.js";import{R as S}from"./RHFTextField-BSZ_cEI3.js";import{B as w}from"./ButtonLoading-DDalXO-W.js";import{R as q}from"./RHFSelectField-oISAIiMK.js";import{I as E}from"./input-DlX9dTT0.js";import"./switch-Cssv6fnZ.js";import"./checkbox-DFFItNXW.js";import"./label-BcY3kv5U.js";import{R as M}from"./DateAndTimePicker-CtTdRVKm.js";import{S as Y}from"./separator-BQijJEjG.js";import{D as k}from"./index-B2ia16z0.js";import{B as I}from"./badge-DbWnzWn2.js";import{a2 as R}from"./icons-CxCh8mm_.js";import"./ui-B3c1eQmf.js";import"./query-BH9sOW2X.js";import"./axios-Dos3PyFQ.js";import"./zustand-C1rkr5lV.js";import"./select-8PAfYjod.js";const F=A().shape({emp_id:P().required("Employee ID is required").positive(),arrear_type:N().required("Arrear type is required"),arrear_amount:P().required("Arrear amount is required").positive(),for_period_start:N().required("Period start date is required"),for_period_end:N().required("Period end date is required"),payment_month:P().required("Payment month is required").min(1).max(12),payment_year:P().required("Payment year is required").min(2020).max(2100),remarks:N().nullable()}),T=[{value:"da_revision",label:"DA Revision"},{value:"increment_arrear",label:"Increment Arrear"},{value:"promotion_arrear",label:"Promotion Arrear"},{value:"pay_revision",label:"Pay Revision"},{value:"other",label:"Other"}],C=[{value:"1",label:"January"},{value:"2",label:"February"},{value:"3",label:"March"},{value:"4",label:"April"},{value:"5",label:"May"},{value:"6",label:"June"},{value:"7",label:"July"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"October"},{value:"11",label:"November"},{value:"12",label:"December"}];function L({open:l,setOpen:t,title:i,refetch:d}){const o=y({}),m=e({defaultValues:{emp_id:void 0,arrear_type:"",arrear_amount:void 0,for_period_start:"",for_period_end:"",payment_month:(new Date).getMonth()+1,payment_year:(new Date).getFullYear(),remarks:""},resolver:a(F)});return r.jsx(k,{open:l,setOpen:t,title:i,setEdit:()=>(m.reset(),void t(!1)),children:r.jsx(D,{methods:m,onSubmit:m.handleSubmit(async e=>{var r,a,l,i;try{const c=await o.mutateAsync({api:null==(r=n)?void 0:r.addArrears,data:e});(null==(a=c.data)?void 0:a.success)?(s.success((null==(l=null==c?void 0:c.data)?void 0:l.message)||"Arrears added successfully"),m.reset(),t(!1),null==d||d()):s.error((null==(i=c.data)?void 0:i.message)||"Failed to add arrears")}catch(c){s.error("Failed to add arrears")}}),children:r.jsxs("div",{className:"grid grid-cols-1 gap-x-4 gap-y-4 md:grid-cols-2",children:[r.jsx("div",{children:r.jsx(S,{label:"Employee ID",name:"emp_id",placeholder:"Enter Employee ID",type:"number"})}),r.jsx("div",{children:r.jsx(q,{label:"Arrear Type",name:"arrear_type",data:T})}),r.jsx("div",{children:r.jsx(S,{label:"Arrear Amount (₹)",name:"arrear_amount",placeholder:"Enter Arrear Amount",type:"number"})}),r.jsx("div",{children:r.jsx(M,{name:"for_period_start",label:"Period Start Date",placeholder:"Select start date"})}),r.jsx("div",{children:r.jsx(M,{name:"for_period_end",label:"Period End Date",placeholder:"Select end date"})}),r.jsx("div",{children:r.jsx(q,{label:"Payment Month",name:"payment_month",data:C})}),r.jsx("div",{children:r.jsx(S,{label:"Payment Year",name:"payment_year",placeholder:"Enter Year",type:"number"})}),r.jsx("div",{className:"md:col-span-2",children:r.jsx(S,{label:"Remarks",name:"remarks",placeholder:"Enter remarks (optional)"})}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsx(Y,{className:"my-2"}),r.jsx(w,{isLoading:m.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Add Arrears"})]})]})})})}function O(){var e,a,s,t,y,A,N,P,D,S,w;const{user:q}=d(),[M,Y]=l.useState(!1),[k,F]=l.useState(""),[T,C]=l.useState(""),O=g({api:`${n.getPendingArrears}?emp_id=${T}&ulb_id=${null==q?void 0:q.ulbId}`,key:"getPendingArrears",value:[T,null==q?void 0:q.ulbId],options:{enabled:!!T&&!!(null==q?void 0:q.ulbId)}}),B=e=>{switch(e){case"pending":return r.jsx(I,{variant:"outline",className:"bg-yellow-100 text-yellow-700",children:"Pending"});case"partial":return r.jsx(I,{variant:"outline",className:"bg-blue-100 text-blue-700",children:"Partial"});case"paid":return r.jsx(I,{variant:"outline",className:"bg-green-100 text-green-700",children:"Paid"});default:return r.jsx(I,{variant:"outline",children:e})}};return r.jsxs("main",{className:"grid items-start",children:[r.jsx(L,{open:M,setOpen:Y,title:"Add Arrears",refetch:O.refetch}),r.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[r.jsxs("div",{className:"flex w-full flex-col gap-4 sm:flex-row sm:justify-between",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsx(E,{placeholder:"Enter Employee ID",value:k,onChange:e=>F(e.target.value),className:"w-48"}),r.jsxs(o,{onClick:()=>{k&&C(k)},variant:"outline",children:[r.jsx(R,{className:"mr-2 h-4 w-4"}),"Search"]})]}),r.jsx("div",{children:r.jsx(o,{className:"flex items-center gap-2",onClick:()=>Y(!0),children:"Add Arrears"})})]}),T&&void 0!==(null==(a=null==(e=null==O?void 0:O.data)?void 0:e.data)?void 0:a.total_pending)&&r.jsx(m,{className:"bg-gradient-to-r from-blue-50 to-indigo-50",children:r.jsx(c,{className:"pt-4",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Total Pending Arrears"}),r.jsxs("span",{className:"text-xl font-bold text-blue-700",children:["₹",(null==(y=null==(t=null==(s=null==O?void 0:O.data)?void 0:s.data)?void 0:t.total_pending)?void 0:y.toLocaleString())||0]})]})})}),r.jsxs(m,{children:[r.jsx(u,{children:r.jsx(p,{children:T?`Pending Arrears for Employee ID: ${T}`:"Enter Employee ID to view pending arrears"})}),r.jsx(c,{children:T?(null==O?void 0:O.isLoading)?r.jsx("div",{className:"flex items-center justify-center",children:r.jsx(_,{})}):r.jsx("div",{className:"overflow-x-auto",children:r.jsxs(x,{children:[r.jsx(j,{children:r.jsxs(h,{children:[r.jsx(v,{children:"Type"}),r.jsx(v,{children:"Arrear Amount"}),r.jsx(v,{children:"Pending Amount"}),r.jsx(v,{children:"Period"}),r.jsx(v,{children:"Payment Month"}),r.jsx(v,{children:"Status"}),r.jsx(v,{children:"Remarks"}),r.jsx(v,{children:"Created At"})]})}),r.jsx(f,{children:(null==(N=null==(A=null==O?void 0:O.data)?void 0:A.data)?void 0:N.arrears)&&(null==(D=null==(P=null==O?void 0:O.data)?void 0:P.data)?void 0:D.arrears.length)>0?null==(w=null==(S=null==O?void 0:O.data)?void 0:S.data)?void 0:w.arrears.map(e=>{var a,s,l;return r.jsxs(h,{children:[r.jsx(b,{className:"font-medium",children:(l=e.arrear_type,{da_revision:"DA Revision",increment_arrear:"Increment Arrear",promotion_arrear:"Promotion Arrear",pay_revision:"Pay Revision",other:"Other"}[l]||l)}),r.jsxs(b,{children:["₹",null==(a=e.arrear_amount)?void 0:a.toLocaleString()]}),r.jsxs(b,{className:"font-semibold text-blue-600",children:["₹",null==(s=e.pending_amount)?void 0:s.toLocaleString()]}),r.jsxs(b,{children:[i(e.for_period_start).format("DD/MM/YYYY")," ","- ",i(e.for_period_end).format("DD/MM/YYYY")]}),r.jsxs(b,{children:[i().month(e.payment_month-1).format("MMM")," ",e.payment_year]}),r.jsx(b,{children:B(e.status)}),r.jsx(b,{className:"max-w-xs truncate",children:e.remarks||"-"}),r.jsx(b,{children:i(e.created_at).format("DD/MM/YYYY")})]},e.id)}):r.jsx(h,{children:r.jsx(b,{colSpan:8,className:"text-center",children:"No pending arrears found"})})})]})}):r.jsx("div",{className:"flex items-center justify-center py-8 text-slate-500",children:"Please enter an Employee ID to search for arrears"})})]})]})]})}function B(){return r.jsx(t,{title:"Arrears Management",subTitle:"Manage Employee Arrears",children:r.jsx("div",{className:"py-12",children:r.jsx(O,{})})})}export{B as default};
