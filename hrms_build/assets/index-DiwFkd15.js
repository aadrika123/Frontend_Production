import{i as te,j as e,h as H,z as $,r as i,B as he,e as be}from"./index-SDtq6APg.js";import{g as fe,P as ye}from"./index-CrjMXZHz.js";import{u as se,b as je}from"./useCustomQuery-DuxI2f1A.js";import{u as Ne,C as ve,a as we,o as Se,c as _e,b as q}from"./yup-V-kjDK18.js";import{D as ke,F as Ae,B as Ce,a as Fe}from"./datetime-picker-iopySnZ3.js";import"./select-C_Ik7Cfg.js";import{R as Pe}from"./RHFSelectField-DGuw7Cq7.js";import{S as Te}from"./Spinner-thyyrLKV.js";import{D as Ie}from"./index-CchGxI1X.js";import{C as Q,S as Le}from"./search-BMFf4966.js";import{C as B}from"./calendar-C_1_1UGM.js";import{B as W}from"./briefcase-BBt0KU2d.js";import{U as Me}from"./users-BFnbM8vY.js";import{a as De,C as Re}from"./clock-Cy8xExlC.js";import"./check-CsPaHRb5.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=te("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=te("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);function ee({name:r,label:m,hourCycle:g=24,isRequired:f,disabled:y,granularity:j,placeholder:N,className:x}){const{control:v}=Ne();return e.jsx(ve,{name:r,control:v,render:({field:{value:o,onChange:w,...l},fieldState:{error:u}})=>e.jsxs("div",{className:x,children:[m&&e.jsxs("h1",{className:"mb-1 text-sm text-gray-700 dark:text-gray-200",children:[m," ",f&&e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx(ke,{...l,hourCycle:g,value:o,onChange:w,disabled:y,granularity:j,placeholder:N}),u&&e.jsx("span",{className:"text-xs text-red-400",children:u.message})]})})}const qe=_e().shape({attendance_status:q().required("Attendance status is required"),emp_in_time:q().when("attendance_status",{is:r=>r==="1"||r==="2",then:r=>r.required("In Time is required for Present or Half Day"),otherwise:r=>r.notRequired()}),emp_out_time:q().when("attendance_status",{is:r=>r==="1"||r==="2",then:r=>r.required("Out Time is required for Present or Half Day"),otherwise:r=>r.notRequired()})});function Be({open:r,setOpen:m,title:g,id:f,edit:y,setEdit:j,refetch:N}){const x=se({}),v=new Date,o=we({defaultValues:{attendance_status:"",emp_in_time:"",emp_out_time:""},resolver:Se(qe)}),w=async l=>{var u,d,k,p;try{const c=await x.mutateAsync({api:(u=H)==null?void 0:u.createAttendance,data:{emp_id:f,date:v.toISOString().split("T")[0],attendance_status:l.attendance_status,...l.emp_in_time&&{emp_in_time:l.emp_in_time},...l.emp_out_time&&{emp_out_time:l.emp_out_time}}});(d=c.data)!=null&&d.success?($.success(((k=c==null?void 0:c.data)==null?void 0:k.message)||"Attendance created successfully"),m(!1),N()):$.error(((p=c.data)==null?void 0:p.message)||"Failed to create attendance")}catch(c){console.log(c),$.error("An error occurred while creating attendance")}};return e.jsx(Ie,{open:r,setOpen:m,title:g,edit:y,setEdit:j,children:e.jsx(Ae,{methods:o,onSubmit:o.handleSubmit(w),children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-2 gap-y-4",children:[e.jsx("div",{className:"col-span-2",children:e.jsx(Pe,{name:"attendance_status",label:"Attendance Status",data:[{label:"Absent",value:"0"},{label:"Present",value:"1"},{label:"Half Day",value:"2"},{label:"Leave",value:"3"}]})}),e.jsx("div",{children:e.jsx(ee,{label:"In Time",name:"emp_in_time",placeholder:"Enter In Time"})}),e.jsx("div",{children:e.jsx(ee,{label:"Out Time",name:"emp_out_time",placeholder:"Enter Out Time"})}),e.jsx(Te,{className:"col-span-2 my-2"}),e.jsx("div",{className:"col-span-2 flex justify-end",children:e.jsx(Ce,{isLoading:o.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}const He=()=>{var z,U,J,V,X,G;const r=new Date,[m,g]=i.useState(!1),[f,y]=i.useState(!1),[j,N]=i.useState(""),[x,v]=i.useState(r.toLocaleString("en-IN",{month:"long"})),[o,w]=i.useState(r.getFullYear()),[l,u]=i.useState(1),[d,k]=i.useState(20),[p,c]=i.useState(r.toISOString().split("T")[0]),ae=se({}),[A,re]=i.useState(""),[C,le]=i.useState(""),[F,ne]=i.useState("all"),[Ee,E]=i.useState({present:0,absent:0,halfDay:0,leave:0,total:0}),[S,O]=i.useState(null),L=fe(),ie=()=>{const t=new URLSearchParams;return x&&t.append("month",x),o&&t.append("year",o.toString()),p&&t.append("date",p),A&&t.append("department_id",be(String(A))),C&&t.append("q",C),F!=="all"&&t.append("status",F.toString()),t.append("page",l.toString()),t.append("limit",d.toString()),t.toString()},s=je({api:`${(z=H)==null?void 0:z.getAllAttendance}?${ie()}`,value:[l,d,x,o,p,A,C,F],options:{enabled:!0}});i.useEffect(()=>{oe()},[s==null?void 0:s.data]);const oe=()=>{var n;if(!((n=s==null?void 0:s.data)!=null&&n.data)){E({present:0,absent:0,halfDay:0,leave:0,total:0});return}const t=s.data.data.reduce((a,b)=>{switch(b.attendance_status){case 1:a.present++;break;case 0:a.absent++;break;case 2:a.halfDay++;break;case 3:a.leave++;break}return a},{present:0,absent:0,halfDay:0,leave:0,total:s.data.data.length});E(t)},P=async(t,n)=>{var a,b,I,K;try{const _=await ae.mutateAsync({api:(a=H)==null?void 0:a.createAttendance,data:{emp_id:t,date:p||r.toISOString().split("T")[0],attendance_status:n}});(b=_.data)!=null&&b.success?(M("success",((I=_.data)==null?void 0:I.message)||"Status updated successfully"),s.refetch()):M("error",((K=_.data)==null?void 0:K.message)||"Failed to update status")}catch(_){console.log(_),M("error","An error occurred while updating status")}},M=(t,n)=>{O({type:t,text:n}),setTimeout(()=>O(null),3e3)},de=t=>{const a={1:{label:"Present",color:"bg-emerald-500",icon:Z},0:{label:"Absent",color:"bg-red-500",icon:Q},2:{label:"Half Day",color:"bg-amber-500",icon:Re},3:{label:"Leave",color:"bg-blue-500",icon:W}}[t];return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:`${a==null?void 0:a.color} h-2 w-2 rounded-full`}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:a==null?void 0:a.label})]})},T=({status:t,currentStatus:n,onClick:a,label:b,color:I})=>e.jsx("button",{onClick:a,className:`rounded-lg px-3 py-1.5 text-xs font-medium transition-all duration-200 ${n===t?`${I} text-white shadow-sm`:"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:b}),ce=["January","February","March","April","May","June","July","August","September","October","November","December"],me=Array.from({length:10},(t,n)=>r.getFullYear()-n),Y=(s==null?void 0:s.isLoading)||(s==null?void 0:s.isFetching),D=((J=(U=s==null?void 0:s.data)==null?void 0:U.pagination)==null?void 0:J.total)||0,h=Math.ceil(D/d),xe=(l-1)*d+1,ue=Math.min(l*d,D),R=t=>{u(t)},pe=t=>{k(t),u(1)},ge=t=>{N(t),g(!m)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[e.jsx(Be,{setOpen:g,open:m,id:j,setEdit:y,edit:f,title:"Create Attendance",refetch:s==null?void 0:s.refetch}),S&&e.jsxs("div",{className:`mb-6 flex items-center gap-3 rounded-xl p-4 ${S.type==="success"?"border border-emerald-200 bg-emerald-50":"border border-red-200 bg-red-50"} duration-300 animate-in fade-in slide-in-from-top-2`,children:[S.type==="success"?e.jsx(Z,{className:"h-5 w-5 text-emerald-600"}):e.jsx(Q,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:`text-sm font-medium ${S.type==="success"?"text-emerald-800":"text-red-800"}`,children:S.text})]}),e.jsx("div",{className:"mb-6 rounded-xl border border-gray-200 bg-white p-5 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Select Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsx("input",{type:"date",value:p,onChange:t=>c(t.target.value),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Select Month"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsx("select",{value:x,onChange:t=>v(t.target.value),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:ce.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Select Year"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsx("select",{value:o,onChange:t=>w(parseInt(t.target.value)),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:me.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Department"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsxs("select",{value:A,onChange:t=>re(t.target.value),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"All Departments"}),(X=(V=L==null?void 0:L.data)==null?void 0:V.data)==null?void 0:X.map(t=>e.jsx("option",{value:t.id,children:t.department_name},t.id))]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Search Employee"}),e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Name, code...",value:C,onChange:t=>le(t.target.value),className:"w-full rounded-lg border border-gray-300 py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-gray-600",children:"Filter by Status"}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-gray-400"}),e.jsxs("select",{value:F,onChange:t=>ne(t.target.value==="all"?"all":parseInt(t.target.value)),className:"w-full appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-11 pr-4 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"0",children:"Absent"}),e.jsx("option",{value:"1",children:"Present"}),e.jsx("option",{value:"2",children:"Half Day"}),e.jsx("option",{value:"3",children:"Leave"})]})]})]})]})}),e.jsx("div",{className:"overflow-hidden rounded-xl border border-gray-200 bg-white shadow-sm",children:Y?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"mb-4 h-12 w-12 animate-spin rounded-full border-4 border-indigo-200 border-t-indigo-600"}),e.jsx("p",{className:"font-medium text-gray-500",children:"Loading attendance data..."})]}):!((G=s==null?void 0:s.data)!=null&&G.data)||s.data.data.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(Me,{className:"mb-4 h-16 w-16 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium text-gray-400",children:"No records found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-400",children:"Try adjusting your filters"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gradient-to-r from-indigo-50 to-purple-50",children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Employee"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Department"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Check In"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Check Out"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Hours"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Actions"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700",children:"Mark Attendance"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:s.data.data.map(t=>e.jsxs("tr",{className:"transition-colors hover:bg-indigo-50/50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800",children:t.emp_name}),e.jsx("div",{className:"text-xs text-gray-500",children:t.emp_code})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex items-center rounded-md bg-gray-100 px-2.5 py-1 text-xs font-medium text-gray-700",children:t.department_name})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:t.emp_in_time?e.jsx("span",{className:"font-medium",children:new Date(t.emp_in_time).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})}):e.jsx("span",{className:"text-gray-400",children:"--:--"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:t.emp_out_time?e.jsx("span",{className:"font-medium",children:new Date(t.emp_out_time).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})}):e.jsx("span",{className:"text-gray-400",children:"--:--"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"inline-flex items-center rounded-md bg-indigo-50 px-2.5 py-1 text-sm font-bold text-indigo-700",children:[t==null?void 0:t.total_working_hours,"h"]})}),e.jsx("td",{className:"px-6 py-4",children:de(t.attendance_status)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{status:1,currentStatus:t.attendance_status,onClick:()=>P(t.emp_id,1),label:"Present",color:"bg-emerald-500"}),e.jsx(T,{status:0,currentStatus:t.attendance_status,onClick:()=>P(t.emp_id,0),label:"Absent",color:"bg-red-500"}),e.jsx(T,{status:2,currentStatus:t.attendance_status,onClick:()=>P(t.emp_id,2),label:"Half Day",color:"bg-amber-500"}),e.jsx(T,{status:3,currentStatus:t.attendance_status,onClick:()=>P(t.emp_id,3),label:"Leave",color:"bg-blue-500"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(he,{variant:"outline",size:"sm",className:`border-indigo-500 text-indigo-600 hover:border-indigo-600 hover:bg-indigo-50 \r
                        hover:text-indigo-700 \r
                        `,onClick:()=>ge(String(t.emp_id)),children:"Mark Attendance"})})]},t.id))})]})})}),e.jsx("div",{className:"mt-6 rounded-xl border border-gray-200 bg-white p-4 shadow-sm",children:e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Rows per page:"}),e.jsxs("select",{value:d,onChange:t=>pe(parseInt(t.target.value)),className:"rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 transition-all focus:border-transparent focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Showing"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:xe})," ","to"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:ue})," ","of"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:D})," ","entries"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>R(l-1),disabled:l===1||Y,className:"flex items-center gap-1 rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 transition-all hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,h)},(t,n)=>{let a;return h<=5||l<=3?a=n+1:l>=h-2?a=h-4+n:a=l-2+n,e.jsx("button",{onClick:()=>R(a),disabled:s==null?void 0:s.isFetching,className:`h-8 w-8 rounded-lg text-sm font-medium transition-all disabled:cursor-not-allowed ${l===a?"bg-indigo-600 text-white shadow-sm":"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"}`,children:a},a)})}),e.jsxs("button",{onClick:()=>R(l+1),disabled:l===h||(s==null?void 0:s.isFetching),className:"flex items-center gap-1 rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 transition-all hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50",children:["Next",e.jsx(De,{className:"h-4 w-4"})]})]})]})]})}),e.jsx("div",{className:"mt-4 rounded-xl border border-gray-200 bg-white p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Page ",e.jsx("span",{className:"font-semibold text-gray-800",children:l})," of"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:h})]}),e.jsxs("span",{className:"text-gray-500",children:["Last updated: ",new Date().toLocaleTimeString("en-IN")]})]})})]})};function at(){return e.jsx(ye,{title:"Attendance List",subTitle:"Manage all the Attendance here",children:e.jsx(He,{})})}export{at as default};
