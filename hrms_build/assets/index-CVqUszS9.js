import{h as E,e as G,r as d,j as e,z as v,B as q}from"./index-Df4ChAN-.js";import{P as U}from"./index-DjNjGvXo.js";import{C as X,a as J,b as K,c as Q,h as W}from"./card-CW8LZ2r1.js";import{S as Z,T as ee,a as ae,b as I,c as n,d as le,e as c}from"./index-Tosm5l2v.js";import{u as z,b as O}from"./useCustomQuery-BBKf_waA.js";import{g as re}from"./services-KQnp_8oA.js";import{P as te}from"./index-CRGyM8Pm.js";import{S as A,a as ne}from"./Spinner-CyN74T25.js";import{a as ce,o as se,c as ie,b as T,f as M,d as oe}from"./yup-pPl0eVQc.js";import{F as de,B as ue}from"./datetime-picker-EqBIIAIP.js";import{R as C}from"./RHFTextField-C5PfVKXx.js";import{R as pe}from"./RHFTextArea-bqK8EsA9.js";import{R as Y}from"./RHFSelectField-Cy0QtYHL.js";import"./select-DZKz6XPY.js";import{R as xe}from"./RHFCheckbox-DRpCJmEz.js";import{D as me}from"./index-D4JNSpYb.js";import{B as R}from"./badge-D696_yJG.js";import{L as he}from"./loader-circle-DH4IlwT9.js";import{T as be}from"./trash-2-DOuI6ik9.js";import"./calendar-CMNTAmai.js";import"./clock-BxgzxCOp.js";import"./check-BzewUJFq.js";const ye=ie().shape({deduction_code:T().required("Deduction Code is required"),deduction_name:T().required("Deduction Name is required"),calculation_type:T().required("Calculation Type is required"),default_value:M().typeError("Default Value must be a number").required("Default Value is required").min(0,"Default Value must be greater than or equal to 0"),calculation_base:T().nullable(),max_limit:M().typeError("Max Limit must be a number").nullable().transform((j,s)=>s===""?null:j),is_employer_contribution:oe(),employer_contribution_rate:M().typeError("Employer Contribution Rate must be a number").nullable().transform((j,s)=>s===""?null:j),description:T().required("Description is required")});function je({open:j,setOpen:s,title:B,id:i,edit:u,setEdit:S,refetch:V}){var D;const w=z({}),{data:l,isFetching:$}=O({api:`${(D=E)==null?void 0:D.getDeductionById}?id=${G(String(i))}`,key:"getDeductionById",options:{enabled:u&&!!i}}),t=ce({defaultValues:{deduction_code:"",deduction_name:"",calculation_type:"",default_value:0,calculation_base:null,max_limit:null,is_employer_contribution:!1,employer_contribution_rate:null,description:""},resolver:se(ye)}),g=t.watch("calculation_type"),P=t.watch("is_employer_contribution"),F=async r=>{var f,_,p,x,m,h,b,y;try{if(u&&i){const a=await w.mutateAsync({api:`${(f=E)==null?void 0:f.updateDeduction}`,data:{id:Number(i),...r}});(_=a.data)!=null&&_.success?v.success((p=a==null?void 0:a.data)==null?void 0:p.message):v.error(((x=a.data)==null?void 0:x.message)||"Deduction Type not updated successfully")}else{const a=await w.mutateAsync({api:(m=E)==null?void 0:m.createDeduction,data:r});(h=a.data)!=null&&h.success?v.success((b=a==null?void 0:a.data)==null?void 0:b.message):v.error(((y=a.data)==null?void 0:y.message)||"Deduction Type not created successfully")}t.reset(),s(!1),S(!1),V()}catch(a){console.log(a)}};return d.useEffect(()=>{var r,f,_,p,x,m,h,b,y,a,N;u&&(l!=null&&l.data)?t.reset({deduction_code:((r=l==null?void 0:l.data)==null?void 0:r.deduction_code)||"",deduction_name:((f=l==null?void 0:l.data)==null?void 0:f.deduction_name)||"",calculation_type:((_=l==null?void 0:l.data)==null?void 0:_.calculation_type)||"",default_value:Number((p=l==null?void 0:l.data)==null?void 0:p.default_value)||0,calculation_base:((x=l==null?void 0:l.data)==null?void 0:x.calculation_base)||null,max_limit:(m=l==null?void 0:l.data)!=null&&m.max_limit?Number((h=l==null?void 0:l.data)==null?void 0:h.max_limit):null,is_employer_contribution:((b=l==null?void 0:l.data)==null?void 0:b.is_employer_contribution)||!1,employer_contribution_rate:(y=l==null?void 0:l.data)!=null&&y.employer_contribution_rate?Number((a=l==null?void 0:l.data)==null?void 0:a.employer_contribution_rate):null,description:((N=l==null?void 0:l.data)==null?void 0:N.description)||""}):t.reset({deduction_code:"",deduction_name:"",calculation_type:"",default_value:0,calculation_base:null,max_limit:null,is_employer_contribution:!1,employer_contribution_rate:null,description:""})},[u,l]),d.useEffect(()=>{t!=null&&t.watch("calculation_type")&&t.setValue("default_value",0)},[g]),e.jsx(me,{open:j,setOpen:s,title:B,setEdit:S,edit:u,isLoading:$,children:e.jsx(de,{methods:t,onSubmit:t.handleSubmit(F),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(C,{name:"deduction_code",label:"Deduction Code",placeholder:"e.g., EPF, TAX, INS",inputValidation:["removeSpecialCharacterExceptSpace"]}),e.jsx(C,{name:"deduction_name",label:"Deduction Name",placeholder:"e.g., Provident Fund",inputValidation:["removeSpecialCharacterExceptSpace"]})]})]}),e.jsx("div",{children:e.jsx(pe,{name:"description",label:"Description",placeholder:"Brief description of this deduction type...",inputValidation:["removeSpecialCharacterExceptSpace"]})})]}),e.jsx(A,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Calculation Method"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Y,{label:"How to Calculate",name:"calculation_type",data:[{label:"Fixed Amount",value:"fixed"},{label:"Percentage of Salary",value:"percentage"}]}),g==="fixed"&&e.jsx("div",{children:e.jsx(C,{name:"default_value",label:"Amount",placeholder:"e.g., 5000",type:"number",inputValidation:["number"]})}),g==="percentage"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(C,{name:"default_value",label:"Percentage (%)",placeholder:"e.g., 12",type:"number",inputValidation:g=="percentage"?["number","maxTwoDecimalPlaces"]:["number"],maxLength:2}),e.jsxs("div",{className:"space-y-4 rounded-lg border border-blue-200 bg-blue-50 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-blue-700",children:"Additional Settings for Percentage Calculation"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(Y,{name:"calculation_base",label:"Calculate Based On",data:[{label:"Basic Salary",value:"basic"},{label:"Gross Salary",value:"gross"},{label:"Net Salary",value:"net"}]}),e.jsx(C,{name:"max_limit",label:"Maximum Limit (Optional)",placeholder:"e.g., 15000",type:"number",inputValidation:["number"]})]}),e.jsx("p",{className:"text-xs italic text-gray-600",children:"Maximum limit caps the deduction amount regardless of the calculated percentage"})]})]})]})]}),e.jsx(A,{}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Employer Contribution"}),e.jsxs("div",{className:"space-y-4 rounded-lg border border-gray-200 bg-gray-50 p-4",children:[e.jsx("div",{className:"flex items-start gap-3",children:e.jsx(xe,{name:"is_employer_contribution",label:"Employer also contributes to this deduction"})}),e.jsx("p",{className:"text-xs italic text-gray-600",children:"Check this if your organization contributes an amount in addition to the employee's deduction"}),P&&e.jsxs("div",{className:"mt-4 border-t border-gray-300 pt-4",children:[e.jsx(C,{name:"employer_contribution_rate",label:"Employer Contribution Rate (%)",placeholder:"e.g., 13",type:"number",inputValidation:["number"]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"This is the percentage or amount that the employer will contribute"})]})]})]})}),e.jsx(A,{className:"my-6"}),e.jsx("div",{className:"pt-2",children:e.jsx(ue,{isLoading:t.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:u?"Update Deduction Type":"Create Deduction Type"})})]})})})}function ge(){var p,x,m,h,b,y;const j=z({}),[s,B]=d.useState(1),[i,u]=d.useState(10),[S,V]=d.useState(""),[w,l]=d.useState(!1),[$,t]=d.useState(""),[g,P]=d.useState(!1),[F,D]=d.useState(null),r=O({api:`${E.getAllDeductions}?page=${s}&limit=${i}&q=${S}`,key:"getAllDeductions",value:[s,i,S],options:{enabled:!0}}),f=a=>{P(!0),l(!0),t(a)},_=async a=>{var N,k,H,L;D(a);try{const o=await j.mutateAsync({api:`${(N=E)==null?void 0:N.deleteDeduction}`,data:{id:Number(a)}});(k=o==null?void 0:o.data)!=null&&k.success?(r.refetch(),v.success(((H=o==null?void 0:o.data)==null?void 0:H.message)||"Deduction deleted successfully")):v.error(((L=o.data)==null?void 0:L.message)||"Failed to delete deduction")}catch(o){v.error(re(o))}finally{D(null)}};return e.jsxs("main",{className:"grid items-start",children:[e.jsx(je,{open:w,setOpen:l,title:g?"Edit Deduction Type":"Add Deduction Type",id:$,edit:g,setEdit:P,refetch:r.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(Z,{search:S,setSearch:V,refetch:r.refetch,isFetching:r==null?void 0:r.isLoading})}),e.jsx("div",{children:e.jsx(q,{className:"flex items-center gap-2",onClick:()=>l(!0),children:"Add New"})})]}),e.jsxs(X,{children:[e.jsx(J,{className:"px-7",children:e.jsxs(K,{children:["Deduction Type List (",((x=(p=r==null?void 0:r.data)==null?void 0:p.data)==null?void 0:x.length)||0,")"]})}),e.jsx(Q,{children:r.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(ne,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(ee,{children:[e.jsx(ae,{children:e.jsxs(I,{children:[e.jsx(n,{className:"",children:"#"}),e.jsx(n,{className:"",children:"Code"}),e.jsx(n,{className:"",children:"Name"}),e.jsx(n,{className:"",children:"Type"}),e.jsx(n,{className:"",children:"Default Value"}),e.jsx(n,{className:"",children:"Base"}),e.jsx(n,{className:"",children:"Max Limit"}),e.jsx(n,{className:"",children:"Employer Contribution"}),e.jsx(n,{className:"",children:"Description"}),e.jsx(n,{className:"",children:"Created at"}),e.jsx(n,{className:"",children:"Status"}),e.jsx(n,{children:"Action"})]})}),e.jsx(le,{children:(h=(m=r==null?void 0:r.data)==null?void 0:m.data)==null?void 0:h.map((a,N)=>e.jsxs(I,{children:[e.jsx(c,{children:N+1}),e.jsx(c,{children:a==null?void 0:a.deduction_code}),e.jsx(c,{children:a==null?void 0:a.deduction_name}),e.jsx(c,{children:e.jsx(R,{variant:"outline",className:"capitalize",children:a==null?void 0:a.calculation_type})}),e.jsxs(c,{children:[a==null?void 0:a.default_value,(a==null?void 0:a.calculation_type)==="percentage"&&"%"]}),e.jsx(c,{children:(a==null?void 0:a.calculation_base)||"-"}),e.jsx(c,{children:(a==null?void 0:a.max_limit)||"-"}),e.jsx(c,{children:e.jsxs(R,{variant:a!=null&&a.is_employer_contribution?"default":"secondary",children:[a!=null&&a.is_employer_contribution?"Yes":"No",(a==null?void 0:a.is_employer_contribution)&&(a==null?void 0:a.employer_contribution_rate)&&` (${a==null?void 0:a.employer_contribution_rate}%)`]})}),e.jsx(c,{className:"max-w-xs truncate",children:a==null?void 0:a.description}),e.jsx(c,{children:W(a==null?void 0:a.created_at).format("DD-MM-YYYY")}),e.jsx(c,{children:e.jsx(R,{variant:(a==null?void 0:a.status)===1?"default":"secondary",children:(a==null?void 0:a.status)===1?"Active":"Inactive"})}),e.jsx(c,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{className:"bg-primary",onClick:()=>f(String(a==null?void 0:a.id)),children:"Edit"}),e.jsx(q,{variant:"destructive",onClick:()=>_(String(a==null?void 0:a.id)),disabled:F===String(a==null?void 0:a.id),children:F===String(a==null?void 0:a.id)?e.jsx(he,{className:"h-4 w-4 animate-spin"}):e.jsx(be,{className:"h-4 w-4"})})]})})]},a==null?void 0:a.id))})]}),e.jsx(A,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(te,{page:s,limit:i,totalPages:Math.ceil((((y=(b=r==null?void 0:r.data)==null?void 0:b.data)==null?void 0:y.length)||0)/i),setPage:B,setLimit:u})})]})})]})]})]})}function Ie(){return e.jsx(U,{title:"Deduction Type List",subTitle:"Manage all the Deduction Types here",children:e.jsx("div",{className:"py-12",children:e.jsx(ge,{})})})}export{Ie as default};
