import{w as e,f as s,r as a,h as l,j as t,B as r,z as n}from"./index-pqP14EhS.js";import{P as i,D as d,b as c,c as o,e as m,f as x,h,i as j,j as p}from"./index-DZYVnpiZ.js";import{C as u,a as v,d as g,c as f}from"./card-Bs59ZPbY.js";import{B as y}from"./badge-DeVTySeZ.js";import{T as N,a as b,b as w,c as _,d as C,e as D}from"./table-CRgXbpGI.js";import{S as k,a as M,b as S,c as L,d as A}from"./select-B4keucJT.js";import{T as F}from"./textarea-Yhd8dF4-.js";import{I as T}from"./input-BT6hWnw8.js";import{L as B}from"./label-xKekv9dA.js";import{C as $}from"./checkbox-xsP6xrIs.js";import{u as P,b as R}from"./useCustomQuery-CzEWxvyG.js";import{n as z,d as H,f as Y}from"./format-BkNqQ0tt.js";import{R as E}from"./refresh-cw-BHVB2cpM.js";import{P as O}from"./plus-DLYguytq.js";import{C as U}from"./calendar-days-BCbQZtvL.js";import{C as V}from"./calendar-By15l6FD.js";import{C as q}from"./clock-Dx15zlBS.js";import{C as I}from"./circle-check-big-BiAG3xNy.js";import{C as Q}from"./circle-alert-B7J-58O5.js";import{B as W}from"./ban-DRBKuyx3.js";import{C as X}from"./circle-x-6Y3mmM73.js";import"./check-BQY2iuAn.js";function Z(e,s){const a=e.getFullYear()-s.getFullYear()||e.getMonth()-s.getMonth()||e.getDate()-s.getDate()||e.getHours()-s.getHours()||e.getMinutes()-s.getMinutes()||e.getSeconds()-s.getSeconds()||e.getMilliseconds()-s.getMilliseconds();return a<0?-1:a>0?1:a}const G=()=>{var G,J;const{user:K}=e(),ee=s(String(null==K?void 0:K._id)),se=(new Date).getFullYear(),[ae,le]=a.useState(!1),[te,re]=a.useState(""),[ne,ie]=a.useState(""),[de,ce]=a.useState(""),[oe,me]=a.useState(""),[xe,he]=a.useState(!1),je=P({}),{data:pe,refetch:ue}=R({api:`${l.getLeaveBalances}?emp_id=${ee}&year=${se}`,key:"leaveBalances",options:{enabled:!!ee}}),{data:ve,refetch:ge}=R({api:`${l.getLeaveApplications}?emp_id=${ee}&year=${se}`,key:"leaveApplications",options:{enabled:!!ee}}),{data:fe}=R({api:l.getLeaveTypesForApplication,key:"leaveTypes",options:{enabled:!0}}),ye=(null==(G=null==pe?void 0:pe.data)?void 0:G.balances)||[],Ne=(null==(J=null==pe?void 0:pe.data)?void 0:J.summary)||{total_allocated:0,total_taken:0,total_remaining:0},be=(null==ve?void 0:ve.data)||[],we=(null==fe?void 0:fe.data)||[],_e=a.useMemo(()=>{if(!ne||!de)return 0;const e=function(e,s,a){const[l,t]=z(null==a?void 0:a.in,e,s),r=Z(l,t),n=Math.abs(H(l,t));l.setDate(l.getDate()-r*n);const i=r*(n-Number(Z(l,t)===-r));return 0===i?0:i}(new Date(de),new Date(ne))+1;return xe&&1===e?.5:e},[ne,de,xe]),Ce=()=>{re(""),ie(""),ce(""),me(""),he(!1)},De=e=>{switch(e){case 0:return t.jsxs(y,{variant:"outline",className:"border-yellow-200 bg-yellow-50 text-yellow-700",children:[t.jsx(q,{className:"mr-1 h-3 w-3"})," Pending"]});case 1:return t.jsxs(y,{variant:"outline",className:"border-green-200 bg-green-50 text-green-700",children:[t.jsx(I,{className:"mr-1 h-3 w-3"})," Approved"]});case 2:return t.jsxs(y,{variant:"outline",className:"border-red-200 bg-red-50 text-red-700",children:[t.jsx(X,{className:"mr-1 h-3 w-3"})," Rejected"]});case 3:return t.jsxs(y,{variant:"outline",className:"border-gray-200 bg-gray-50 text-gray-700",children:[t.jsx(W,{className:"mr-1 h-3 w-3"})," Cancelled"]});default:return t.jsx(y,{variant:"outline",children:"Unknown"})}};return t.jsx(i,{title:"Leave Management",children:t.jsxs("div",{className:"container mx-auto space-y-6 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Leave Management"}),t.jsx("p",{className:"text-muted-foreground",children:"Apply for leaves and track your leave balance"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(r,{variant:"outline",size:"sm",onClick:()=>{ue(),ge()},children:[t.jsx(E,{className:"mr-2 h-4 w-4"}),"Refresh"]}),t.jsxs(d,{open:ae,onOpenChange:le,children:[t.jsx(c,{asChild:!0,children:t.jsxs(r,{children:[t.jsx(O,{className:"mr-2 h-4 w-4"}),"Apply Leave"]})}),t.jsxs(o,{className:"sm:max-w-[500px]",children:[t.jsxs(m,{children:[t.jsx(x,{children:"Apply for Leave"}),t.jsx(h,{children:"Submit a new leave application for approval"})]}),t.jsxs("div",{className:"grid gap-4 py-4",children:[t.jsxs("div",{className:"grid gap-2",children:[t.jsx(B,{htmlFor:"leaveType",children:"Leave Type *"}),t.jsxs(k,{value:te,onValueChange:re,children:[t.jsx(M,{children:t.jsx(S,{placeholder:"Select leave type"})}),t.jsx(L,{children:we.map(e=>t.jsxs(A,{value:e.leave_type_name,children:[e.leave_type_name," (",e.leave_code,")"]},e.id))})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"grid gap-2",children:[t.jsx(B,{htmlFor:"startDate",children:"Start Date *"}),t.jsx(T,{id:"startDate",type:"date",value:ne,onChange:e=>ie(e.target.value)})]}),t.jsxs("div",{className:"grid gap-2",children:[t.jsx(B,{htmlFor:"endDate",children:"End Date *"}),t.jsx(T,{id:"endDate",type:"date",value:de,min:ne,onChange:e=>ce(e.target.value)})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx($,{id:"halfDay",checked:xe,onCheckedChange:e=>he(e),disabled:_e>1}),t.jsx(B,{htmlFor:"halfDay",className:"text-sm",children:"Half day leave (only for single day)"})]}),_e>0&&t.jsx("div",{className:"rounded-lg bg-blue-50 p-3",children:t.jsxs("p",{className:"text-sm text-blue-700",children:[t.jsx(U,{className:"mr-1 inline h-4 w-4"}),"Total days: ",t.jsx("strong",{children:_e})]})}),t.jsxs("div",{className:"grid gap-2",children:[t.jsx(B,{htmlFor:"reason",children:"Reason"}),t.jsx(F,{id:"reason",placeholder:"Enter reason for leave...",value:oe,onChange:e=>me(e.target.value),rows:3})]})]}),t.jsxs(j,{children:[t.jsx(p,{asChild:!0,children:t.jsx(r,{variant:"outline",children:"Cancel"})}),t.jsx(r,{onClick:async()=>{var e,s,a,t;if(te&&ne&&de)try{const a=await je.mutateAsync({api:l.applyLeave,data:{emp_id:ee,leave_type:te,start_date:ne,end_date:de,reason:oe,is_half_day:xe}});(null==(e=null==a?void 0:a.data)?void 0:e.success)?(n.success(a.data.message||"Leave application submitted"),le(!1),Ce(),ue(),ge()):n.error((null==(s=null==a?void 0:a.data)?void 0:s.message)||"Failed to submit leave application")}catch(r){n.error((null==(t=null==(a=null==r?void 0:r.response)?void 0:a.data)?void 0:t.message)||"Failed to submit leave application")}else n.error("Please fill all required fields")},disabled:je.isPending,children:je.isPending?"Submitting...":"Submit Application"})]})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[t.jsxs(u,{children:[t.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(g,{className:"text-sm font-medium",children:"Total Allocated"}),t.jsx(V,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsxs(f,{children:[t.jsx("div",{className:"text-2xl font-bold",children:Ne.total_allocated}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:["Days allocated for ",se]})]})]}),t.jsxs(u,{children:[t.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(g,{className:"text-sm font-medium",children:"Leaves Taken"}),t.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsxs(f,{children:[t.jsx("div",{className:"text-2xl font-bold text-orange-600",children:Ne.total_taken}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Days utilized"})]})]}),t.jsxs(u,{children:[t.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(g,{className:"text-sm font-medium",children:"Balance Remaining"}),t.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsxs(f,{children:[t.jsx("div",{className:"text-2xl font-bold text-green-600",children:Ne.total_remaining}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Days available"})]})]})]}),t.jsxs(u,{children:[t.jsx(v,{children:t.jsxs(g,{className:"flex items-center gap-2",children:[t.jsx(U,{className:"h-5 w-5"}),"Leave Balance by Type"]})}),t.jsx(f,{children:0===ye.length?t.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[t.jsx(Q,{className:"mx-auto mb-4 h-12 w-12 opacity-50"}),t.jsx("p",{children:"No leave balances found for this year"})]}):t.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:ye.map((e,s)=>t.jsxs("div",{className:"rounded-lg border bg-gradient-to-r from-gray-50 to-white p-4",children:[t.jsxs("div",{className:"mb-2 flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold",children:e.leave_type_name}),t.jsx("p",{className:"text-xs text-muted-foreground",children:e.leave_code})]}),t.jsxs(y,{variant:"outline",className:"bg-green-50 text-green-700",children:[e.leaves_remaining," left"]})]}),t.jsxs("div",{className:"mt-3 space-y-1 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-muted-foreground",children:"Allocated:"}),t.jsx("span",{children:e.total_allocated})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-muted-foreground",children:"Carried:"}),t.jsx("span",{children:e.carried_forward})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-muted-foreground",children:"Taken:"}),t.jsx("span",{className:"text-orange-600",children:e.leaves_taken})]})]})]},s))})})]}),t.jsxs(u,{children:[t.jsx(v,{children:t.jsx(g,{children:"Leave Applications"})}),t.jsx(f,{children:0===be.length?t.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[t.jsx(V,{className:"mx-auto mb-4 h-12 w-12 opacity-50"}),t.jsx("p",{children:"No leave applications found"}),t.jsx("p",{className:"text-sm",children:"Apply for a leave to get started"})]}):t.jsxs(N,{children:[t.jsx(b,{children:t.jsxs(w,{children:[t.jsx(_,{children:"Leave Type"}),t.jsx(_,{children:"Start Date"}),t.jsx(_,{children:"End Date"}),t.jsx(_,{children:"Days"}),t.jsx(_,{children:"Status"}),t.jsx(_,{children:"Applied On"}),t.jsx(_,{children:"Actions"})]})}),t.jsx(C,{children:be.map(e=>t.jsxs(w,{children:[t.jsxs(D,{className:"font-medium",children:[e.leave_type,e.is_half_day&&t.jsx("span",{className:"ml-1 text-xs text-muted-foreground",children:"(Half day)"})]}),t.jsx(D,{children:Y(new Date(e.start_date),"dd MMM yyyy")}),t.jsx(D,{children:Y(new Date(e.end_date),"dd MMM yyyy")}),t.jsx(D,{children:e.total_days}),t.jsx(D,{children:De(e.approval_status)}),t.jsx(D,{children:Y(new Date(e.created_at),"dd MMM yyyy")}),t.jsx(D,{children:0===e.approval_status&&t.jsx(r,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700",onClick:()=>(async e=>{var s,a,t,r;try{const t=await je.mutateAsync({api:l.cancelLeave,data:{leave_id:e,emp_id:ee}});(null==(s=null==t?void 0:t.data)?void 0:s.success)?(n.success(t.data.message||"Leave application cancelled"),ge()):n.error((null==(a=null==t?void 0:t.data)?void 0:a.message)||"Failed to cancel leave")}catch(i){n.error((null==(r=null==(t=null==i?void 0:i.response)?void 0:t.data)?void 0:r.message)||"Failed to cancel leave")}})(e.id),children:"Cancel"})})]},e.id))})]})})]})]})})};export{G as default};
