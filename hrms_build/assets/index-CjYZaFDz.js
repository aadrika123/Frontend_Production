import{j as e,an as a,r as s,al as l}from"./vendor-RyuIgj66.js";import{D as i,c as n,e as t,f as r,P as c}from"./index-DFF4_m_G.js";import{c as d,B as o,t as x,g as u}from"./index-ey2GEmQz.js";import{C as j,a as m,b as _,c as v}from"./card-u7M7FP5y.js";import{T as p,a as h,b as f,c as g,d as b,e as y}from"./table-B_npepsp.js";import{u as N,b as S}from"./useCustomQuery-DTB6aAiD.js";import{P as w}from"./index-BHR1l08i.js";import{S as D}from"./separator-BQijJEjG.js";import{S as k}from"./index-CUStUwt1.js";import{S as C}from"./Spinner-BwGzvoRj.js";import{B as A}from"./badge-DbWnzWn2.js";import{S as P,a as T,b as $,c as L,d as R}from"./select-8PAfYjod.js";import{A as F,a as E,b as I,c as O,d as V,e as z,f as H,g as Y}from"./alert-dialog-DDS3Mbsz.js";import{T as M}from"./textarea-CIMcDPG7.js";import{aj as B,E as q,ak as U,$ as G,N as J}from"./icons-CxCh8mm_.js";import"./ui-B3c1eQmf.js";import"./query-BH9sOW2X.js";import"./axios-Dos3PyFQ.js";import"./zustand-C1rkr5lV.js";import"./input-DlX9dTT0.js";const Q=e=>null==e||0===e?"-":`₹${e.toLocaleString("en-IN")}`,W=({title:a,children:s})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"mb-2 font-semibold text-primary",children:a}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:s})]}),K=({label:a,value:s})=>e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-muted-foreground",children:[a,":"]}),e.jsx("span",{className:"font-medium",children:s||"-"})]});function X({open:a,setOpen:s,declaration:l}){var c;if(!l)return null;const d=()=>(l.sec_80c_ppf||0)+(l.sec_80c_epf||0)+(l.sec_80c_elss||0)+(l.sec_80c_life_insurance||0)+(l.sec_80c_nsc||0)+(l.sec_80c_tuition_fees||0)+(l.sec_80c_housing_loan_principal||0)+(l.sec_80c_sukanya_samriddhi||0)+(l.sec_80c_tax_saver_fd||0)+(l.sec_80c_ulip||0)+(l.sec_80c_other||0);return e.jsx(i,{open:a,onOpenChange:s,children:e.jsxs(n,{className:"max-w-2xl",children:[e.jsx(t,{children:e.jsxs(r,{className:"flex items-center gap-2",children:["Tax Declaration Details",e.jsx(A,{variant:"new"===l.tax_regime?"default":"secondary",children:"new"===l.tax_regime?"New Regime":"Old Regime"}),e.jsx(A,{variant:l.declaration_locked?"destructive":"approved"===l.verification_status?"default":"rejected"===l.verification_status?"destructive":"outline",children:l.declaration_locked?"Locked":l.verification_status?l.verification_status.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase()):"Pending"})]})}),e.jsxs("div",{className:"max-h-[70vh] pr-4",children:[e.jsxs(W,{title:"Employee Information",children:[e.jsx(K,{label:"Name",value:l.employee_name}),e.jsx(K,{label:"Code",value:l.employee_code}),e.jsx(K,{label:"Department",value:l.department_name}),e.jsx(K,{label:"Financial Year",value:l.financial_year})]}),e.jsx(D,{className:"my-4"}),"old"===l.tax_regime&&e.jsxs(e.Fragment,{children:[e.jsxs(W,{title:"Section 80C Investments (Max ₹1,50,000)",children:[e.jsx(K,{label:"PPF",value:Q(l.sec_80c_ppf)}),e.jsx(K,{label:"EPF",value:Q(l.sec_80c_epf)}),e.jsx(K,{label:"ELSS",value:Q(l.sec_80c_elss)}),e.jsx(K,{label:"Life Insurance",value:Q(l.sec_80c_life_insurance)}),e.jsx(K,{label:"NSC",value:Q(l.sec_80c_nsc)}),e.jsx(K,{label:"Tuition Fees",value:Q(l.sec_80c_tuition_fees)}),e.jsx(K,{label:"Housing Loan Principal",value:Q(l.sec_80c_housing_loan_principal)}),e.jsx(K,{label:"Sukanya Samriddhi",value:Q(l.sec_80c_sukanya_samriddhi)}),e.jsx(K,{label:"Tax Saver FD",value:Q(l.sec_80c_tax_saver_fd)}),e.jsx(K,{label:"ULIP",value:Q(l.sec_80c_ulip)}),e.jsx(K,{label:"Other",value:Q(l.sec_80c_other)}),e.jsxs("div",{className:"col-span-2 mt-2 rounded bg-muted p-2",children:[e.jsxs("strong",{children:["Total 80C:"," ",Q(Math.min(d(),15e4))]}),d()>15e4&&e.jsx("span",{className:"ml-2 text-xs text-destructive",children:"(Capped at ₹1,50,000)"})]})]}),e.jsx(D,{className:"my-4"}),e.jsxs(W,{title:"Section 80D - Health Insurance",children:[e.jsx(K,{label:"Self & Family",value:Q(l.sec_80d_self_family)}),e.jsx(K,{label:"Parents",value:Q(l.sec_80d_parents)}),e.jsx(K,{label:"Preventive Checkup",value:Q(l.sec_80d_preventive_checkup)}),e.jsx(K,{label:"Self Senior Citizen",value:l.sec_80d_self_senior_citizen?"Yes":"No"}),e.jsx(K,{label:"Parents Senior Citizen",value:l.sec_80d_parents_senior_citizen?"Yes":"No"}),e.jsx("div",{className:"col-span-2 mt-2 rounded bg-muted p-2",children:e.jsxs("strong",{children:["Total 80D: ",Q((l.sec_80d_self_family||0)+(l.sec_80d_parents||0)+(l.sec_80d_preventive_checkup||0))]})})]}),e.jsx(D,{className:"my-4"}),e.jsxs(W,{title:"Other Deductions",children:[e.jsx(K,{label:"80E Education Loan Interest",value:Q(l.sec_80e_education_loan_interest)}),e.jsx(K,{label:"80G Donations (100%)",value:Q(l.sec_80g_100_percent)}),e.jsx(K,{label:"80G Donations (50%)",value:Q(l.sec_80g_50_percent)}),e.jsx(K,{label:"80EEA Home Loan Interest",value:Q(l.sec_80eea_home_loan_interest)}),e.jsx(K,{label:"80TTA Savings Interest",value:Q(l.sec_80tta_savings_interest)}),e.jsx(K,{label:"80U Disability",value:Q(l.sec_80u_disability)}),e.jsx(K,{label:"80DD Dependent Disability",value:Q(l.sec_80dd_dependent_disability)})]}),e.jsx(D,{className:"my-4"}),e.jsxs(W,{title:"Home Loan & HRA",children:[e.jsx(K,{label:"Sec 24 Home Loan Interest",value:Q(l.sec_24_home_loan_interest)}),e.jsx(K,{label:"Property Type",value:null==(c=l.property_type)?void 0:c.replace("_"," ")}),e.jsx(K,{label:"Annual Rent Paid",value:Q(l.rent_paid_annual)}),e.jsx(K,{label:"Metro City",value:l.is_metro_city?"Yes":"No"}),e.jsx(K,{label:"Loss from House Property",value:Q(l.loss_from_house_property)})]})]}),e.jsx(D,{className:"my-4"}),e.jsxs(W,{title:"NPS Contributions (Both Regimes)",children:[e.jsx(K,{label:"80CCD(1B) Self NPS",value:Q(l.sec_80ccd_1b_nps)}),e.jsx(K,{label:"80CCD(2) Employer NPS",value:Q(l.sec_80ccd_2_employer_nps)})]}),"new"===l.tax_regime&&e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"my-4"}),e.jsxs(W,{title:"New Regime Specific",children:[e.jsx(K,{label:"Family Pension Deduction",value:Q(l.family_pension_deduction)}),e.jsx(K,{label:"80JJAA New Employment",value:Q(l.sec_80jjaa_new_employment)}),e.jsx(K,{label:"80CCH Agniveer",value:Q(l.sec_80cch_agniveer)}),e.jsx(K,{label:"Transport Allowance (Disabled)",value:Q(l.transport_allowance_disabled)}),e.jsx(K,{label:"Conveyance Allowance",value:Q(l.conveyance_allowance)})]})]}),l.hr_verified_at&&e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"my-4"}),e.jsxs(W,{title:"Verification Details",children:[e.jsx(K,{label:"Verified At",value:new Date(l.hr_verified_at).toLocaleDateString()}),e.jsx(K,{label:"Remarks",value:l.hr_remarks})]})]})]})]})})}const Z=e=>null==e?"₹0":`₹${e.toLocaleString("en-IN")}`;function ee(){var i,n,t,r,c,Q,W,K;const ee=a(),{user:ae}=d(),se=N({}),[le,ie]=s.useState(1),[ne]=s.useState(10),[te,re]=s.useState(""),[ce,de]=s.useState((()=>{const e=new Date,a=e.getFullYear();return e.getMonth()+1>=4?`${a}-${(a+1).toString().slice(-2)}`:`${a-1}-${a.toString().slice(-2)}`})()),[oe,xe]=s.useState("all"),[ue,je]=s.useState("all"),[me,_e]=s.useState(null),[ve,pe]=s.useState(!1),[he,fe]=s.useState(!1),[ge,be]=s.useState(!1),[ye,Ne]=s.useState(""),[Se,we]=s.useState("approved"),De=S({api:`${x.getAllTaxDeclarations}?page=${le}&limit=${ne}&q=${te}&financial_year=${ce}${"all"!==oe?`&verification_status=${oe}`:""}${"all"!==ue?`&tax_regime=${ue}`:""}`,key:"getAllTaxDeclarations",value:[le,ne,te,ce,oe,ue],options:{enabled:!0}});return e.jsxs("main",{className:"grid items-start",children:[e.jsx(X,{open:ve,setOpen:pe,declaration:me}),e.jsx(F,{open:he,onOpenChange:fe,children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(O,{children:["approved"===Se?"Approve":"Reject"," Tax Declaration"]}),e.jsx(V,{children:"approved"===Se?`Approve investment declaration for ${null==me?void 0:me.employee_name}? This will allow the employee to upload investment proofs.`:`Reject investment declaration for ${null==me?void 0:me.employee_name}? The employee will need to resubmit.`})]}),e.jsxs("div",{className:"my-4",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Remarks"," ","rejected"===Se?"(Required)":"(Optional)"]}),e.jsx(M,{value:ye,onChange:e=>Ne(e.target.value),placeholder:"rejected"===Se?"Enter reason for rejection...":"Enter remarks...",className:"mt-2"})]}),e.jsxs(z,{children:[e.jsx(H,{children:"Cancel"}),e.jsx(Y,{onClick:async()=>{var e,a,s;if(me)try{const i=await se.mutateAsync({api:`${x.verifyTaxDeclaration}/${me.id}/verify`,data:{verification_status:Se,verification_remarks:ye,verified_by:null==ae?void 0:ae._id}});(null==(e=null==i?void 0:i.data)?void 0:e.success)?(De.refetch(),l.success((null==(a=null==i?void 0:i.data)?void 0:a.message)||"Declaration verified successfully"),fe(!1)):l.error((null==(s=i.data)?void 0:s.message)||"Failed to verify declaration")}catch(i){l.error(u(i))}},className:"rejected"===Se?"bg-destructive hover:bg-destructive/90":"",disabled:"rejected"===Se&&!ye.trim(),children:"approved"===Se?"Approve":"Reject"})]})]})}),e.jsx(F,{open:ge,onOpenChange:be,children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(O,{children:"Lock Tax Declaration"}),e.jsxs(V,{children:["Lock declaration for"," ",e.jsx("strong",{children:null==me?void 0:me.employee_name}),"?",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{className:"text-destructive",children:"Warning:"})," Once locked, it cannot be modified."]})]}),e.jsxs(z,{children:[e.jsx(H,{children:"Cancel"}),e.jsx(Y,{onClick:async()=>{var e,a,s;if(me)try{const i=await se.mutateAsync({api:`${x.lockTaxDeclaration}/${me.id}/lock`,data:{}});(null==(e=null==i?void 0:i.data)?void 0:e.success)?(De.refetch(),l.success((null==(a=null==i?void 0:i.data)?void 0:a.message)||"Declaration locked successfully"),be(!1)):l.error((null==(s=i.data)?void 0:s.message)||"Failed to lock declaration")}catch(i){l.error(u(i))}},className:"bg-destructive",children:"Lock Declaration"})]})]})}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsx("div",{className:"flex w-full flex-wrap items-center justify-between gap-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(k,{search:te,setSearch:re,refetch:De.refetch,isFetching:null==De?void 0:De.isLoading}),e.jsxs(P,{value:ce,onValueChange:de,children:[e.jsx(T,{className:"w-[140px]",children:e.jsx($,{placeholder:"Financial Year"})}),e.jsxs(L,{children:[e.jsx(R,{value:"2025-26",children:"2025-26"}),e.jsx(R,{value:"2024-25",children:"2024-25"}),e.jsx(R,{value:"2023-24",children:"2023-24"})]})]}),e.jsxs(P,{value:oe,onValueChange:xe,children:[e.jsx(T,{className:"w-[160px]",children:e.jsx($,{placeholder:"Status"})}),e.jsxs(L,{children:[e.jsx(R,{value:"all",children:"All Status"}),e.jsx(R,{value:"pending",children:"Pending Approval"}),e.jsx(R,{value:"approved",children:"Approved"}),e.jsx(R,{value:"partially_verified",children:"Partially Verified"}),e.jsx(R,{value:"verified",children:"Fully Verified"}),e.jsx(R,{value:"rejected",children:"Rejected"})]})]}),e.jsxs(P,{value:ue,onValueChange:je,children:[e.jsx(T,{className:"w-[130px]",children:e.jsx($,{placeholder:"Regime"})}),e.jsxs(L,{children:[e.jsx(R,{value:"all",children:"All Regimes"}),e.jsx(R,{value:"old",children:"Old Regime"}),e.jsx(R,{value:"new",children:"New Regime"})]})]})]})}),e.jsx(D,{}),e.jsxs(j,{children:[e.jsx(m,{children:e.jsxs(_,{children:["Tax Declarations (",(null==(n=null==(i=null==De?void 0:De.data)?void 0:i.pagination)?void 0:n.total)||0,")"]})}),e.jsx(v,{children:(null==De?void 0:De.isLoading)?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(C,{})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(p,{children:[e.jsx(h,{children:e.jsxs(f,{children:[e.jsx(g,{children:"#"}),e.jsx(g,{children:"Employee"}),e.jsx(g,{children:"Department"}),e.jsx(g,{children:"FY"}),e.jsx(g,{children:"Regime"}),e.jsx(g,{children:"80C Total"}),e.jsx(g,{children:"80D Total"}),e.jsx(g,{children:"Status"}),e.jsx(g,{children:"Actions"})]})}),e.jsx(b,{children:((null==(r=null==(t=null==De?void 0:De.data)?void 0:t.data)?void 0:r.length)??0)>0?null==(c=null==De?void 0:De.data)?void 0:c.data.map((a,s)=>{const l=(e=>{switch(e){case"pending":return{variant:"secondary",label:"Pending Approval"};case"approved":return{variant:"default",label:"Approved"};case"partially_verified":return{variant:"outline",label:"Partially Verified"};case"verified":return{variant:"default",label:"Verified"};case"rejected":return{variant:"destructive",label:"Rejected"};default:return{variant:"secondary",label:e}}})(a.verification_status||"pending");return e.jsxs(f,{children:[e.jsx(y,{children:(le-1)*ne+s+1}),e.jsxs(y,{children:[e.jsx("div",{className:"font-medium",children:a.employee_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.employee_code})]}),e.jsx(y,{children:a.department_name||"-"}),e.jsx(y,{className:"font-medium",children:a.financial_year}),e.jsx(y,{children:e.jsx(A,{variant:"new"===a.tax_regime?"default":"secondary",children:"new"===a.tax_regime?"New":"Old"})}),e.jsx(y,{children:Z((i=a,(i.sec_80c_ppf||0)+(i.sec_80c_epf||0)+(i.sec_80c_elss||0)+(i.sec_80c_life_insurance||0)+(i.sec_80c_nsc||0)+(i.sec_80c_tuition_fees||0)+(i.sec_80c_housing_loan_principal||0)+(i.sec_80c_sukanya_samriddhi||0)+(i.sec_80c_tax_saver_fd||0)+(i.sec_80c_ulip||0)+(i.sec_80c_other||0)))}),e.jsx(y,{children:Z((a.sec_80d_self_family||0)+(a.sec_80d_parents||0))}),e.jsx(y,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(A,{variant:l.variant,children:l.label}),a.declaration_locked&&e.jsxs(A,{variant:"destructive",className:"text-xs",children:[e.jsx(B,{className:"mr-1 h-3 w-3"})," Locked"]})]})}),e.jsx(y,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{variant:"outline",size:"icon",title:"View Details",onClick:()=>(_e(a),void pe(!0)),children:e.jsx(q,{className:"h-4 w-4"})}),"pending"===a.verification_status&&!a.declaration_locked&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",size:"icon",title:"Approve Declaration",onClick:()=>(_e(a),we("approved"),Ne(""),void fe(!0)),children:e.jsx(U,{className:"h-4 w-4 text-green-600"})}),e.jsx(o,{variant:"outline",size:"icon",title:"Reject Declaration",onClick:()=>(_e(a),we("rejected"),Ne(""),void fe(!0)),children:e.jsx(G,{className:"h-4 w-4 text-destructive"})})]}),["approved","partially_verified","verified"].includes(a.verification_status||"")&&!a.declaration_locked&&e.jsx(o,{variant:"outline",size:"icon",title:"Lock Declaration",onClick:()=>(_e(a),void be(!0)),children:e.jsx(B,{className:"h-4 w-4 text-orange-500"})}),["approved","partially_verified","verified"].includes(a.verification_status||"")&&e.jsx(o,{variant:"outline",size:"icon",title:"View Investment Proofs",onClick:()=>ee(`/hrms/dashboard/payroll-masters/investment-proofs/${a.id}`),children:e.jsx(J,{className:"h-4 w-4"})})]})})]},a.id);var i}):e.jsx(f,{children:e.jsx(y,{colSpan:9,className:"text-center",children:"No Tax Declarations found"})})})]})})})]}),(null==(Q=null==De?void 0:De.data)?void 0:Q.pagination)&&e.jsx(w,{page:le,setPage:ie,limit:ne,totalPages:(null==(K=null==(W=null==De?void 0:De.data)?void 0:W.pagination)?void 0:K.totalPages)||1})]})]})}function ae(){return e.jsx(c,{title:"Tax Declarations",subTitle:"Manage Employee Tax Declarations",children:e.jsx("div",{className:"py-12",children:e.jsx(ee,{})})})}export{ae as default};
