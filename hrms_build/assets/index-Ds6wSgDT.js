import{j as e,r as s,aA as a,aK as t,aL as l,aM as r,aN as n,aB as i,ao as d}from"./vendor-RyuIgj66.js";import{C as c,c as m,a as o,d as x,b as p}from"./card-u7M7FP5y.js";import{T as h,a as u,b,c as j}from"./tabs-BzFjL9ks.js";import{u as _,b as N}from"./useCustomQuery-DTB6aAiD.js";import{B as v,d as g,h as y,f}from"./index-ey2GEmQz.js";import{B as w}from"./badge-DbWnzWn2.js";import{A as P,a as I}from"./alert-CtVSl8Dx.js";import{q as C,F as S,v as E,s as D,ai as A,aa as F,ad as T,aJ as B}from"./icons-CxCh8mm_.js";import{C as L}from"./checkbox-DFFItNXW.js";import{L as O}from"./label-BcY3kv5U.js";import{F as R}from"./datetime-picker-dN6E5dqy.js";import{R as $}from"./RHFTextField-BSZ_cEI3.js";import{R as k}from"./RHFSelectField-oISAIiMK.js";import"./input-DlX9dTT0.js";import"./switch-Cssv6fnZ.js";import{c as M}from"./query-BH9sOW2X.js";import{c as q,a as V,b as G}from"./yup-CH6wvET8.js";import{d as K,P as Q}from"./index-DFF4_m_G.js";import"./ui-B3c1eQmf.js";import"./axios-Dos3PyFQ.js";import"./zustand-C1rkr5lV.js";import"./select-8PAfYjod.js";function H({incrementData:s,promotionData:a}){var t,l,r,n;if(s.isLoading)return e.jsx(c,{className:"border-slate-200 bg-white",children:e.jsxs(m,{className:"flex items-center justify-center py-12",children:[e.jsx(C,{className:"h-8 w-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-slate-600",children:"Loading increment preview..."})]})});if(s.error||!(null==(t=s.data)?void 0:t.success))return e.jsxs(P,{className:"border-red-200 bg-red-50",children:[e.jsx(S,{className:"h-4 w-4 text-red-600"}),e.jsx(I,{className:"text-red-700",children:"Failed to load increment preview. Please try again."})]});const i=null==(l=null==s?void 0:s.data)?void 0:l.data,d=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e),h=e=>e?new Date(e).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"Not set";return e.jsx("div",{className:"space-y-6",children:e.jsxs(c,{className:"border-slate-200 bg-white",children:[e.jsxs(o,{className:"border-b border-slate-100 bg-gradient-to-r from-slate-50 to-white pb-4",children:[e.jsxs(x,{className:"flex items-center gap-2 text-lg",children:[e.jsx(E,{className:"h-5 w-5 text-blue-600"}),"Increment Preview"]}),e.jsx(p,{children:"Current pay details and upcoming increment calculation"})]}),e.jsxs(m,{className:"pt-6",children:[e.jsxs("div",{className:"mb-6 grid grid-cols-2 gap-4 rounded-lg bg-slate-50 p-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Employee"}),e.jsx("p",{className:"font-semibold text-slate-900",children:i.emp_name}),e.jsx("p",{className:"text-sm text-slate-600",children:i.emp_code})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Pay Commission"}),e.jsx("p",{className:"font-semibold text-slate-900",children:null==(n=null==(r=null==a?void 0:a.data)?void 0:r.data)?void 0:n.pay_commission})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Current Level"}),e.jsx("p",{className:"font-semibold text-slate-900",children:i.current_level}),i.current_cell&&e.jsxs("p",{className:"text-sm text-slate-600",children:["Cell ",i.current_cell]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Current Basic Pay"}),e.jsx("p",{className:"text-lg font-bold text-emerald-600",children:d(i.current_basic_pay)})]})]}),e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-slate-200 bg-white p-4",children:[e.jsx(D,{className:"h-5 w-5 text-slate-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Last Increment"}),e.jsx("p",{className:"font-semibold text-slate-900",children:h(i.last_increment_date)})]})]}),e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-slate-200 bg-white p-4",children:[e.jsx(D,{className:"h-5 w-5 text-slate-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Next Increment Due"}),e.jsx("p",{className:"font-semibold text-slate-900",children:h(i.next_increment_date)})]}),i.is_increment_due&&e.jsx(w,{className:"ml-auto bg-emerald-100 text-emerald-700",children:"Due"}),!1===i.is_increment_due&&e.jsx(w,{className:"ml-auto bg-amber-100 text-amber-700",children:"Not Due"})]})]}),i.can_increment?e.jsxs(e.Fragment,{children:[e.jsxs(P,{className:"mb-6 border-emerald-200 bg-emerald-50",children:[e.jsx(A,{className:"h-4 w-4 text-emerald-600"}),e.jsxs(I,{className:"text-emerald-700",children:[e.jsx("span",{className:"font-semibold",children:"Increment Available"})," - Employee is eligible for annual increment"]})]}),i.preview&&e.jsxs(c,{className:"border-blue-200 bg-gradient-to-br from-blue-50 to-white",children:[e.jsx(o,{className:"pb-3",children:e.jsxs(x,{className:"text-base text-blue-900",children:["Increment Calculation"," ",e.jsx(w,{variant:"outline",className:"ml-2",children:"7th_cpc_matrix"===i.increment_type?"7th CPC Matrix":"6th CPC Grade Pay"})]})}),e.jsx(m,{children:"7th_cpc_matrix"===i.increment_type?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-4 text-center",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Current Cell"}),e.jsx("p",{className:"text-2xl font-bold text-slate-700",children:i.current_cell}),e.jsx("p",{className:"text-sm text-slate-600",children:d(i.current_basic_pay)})]}),e.jsx(F,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{className:"rounded-lg border-2 border-emerald-300 bg-emerald-50 p-4 text-center",children:[e.jsx("p",{className:"text-xs text-emerald-600",children:"New Cell"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-700",children:i.preview.new_cell}),e.jsx("p",{className:"text-sm text-emerald-600",children:d(i.preview.new_basic_pay)})]})]}),e.jsx("div",{className:"rounded-lg bg-emerald-100 p-3 text-center",children:e.jsxs("p",{className:"text-sm text-emerald-700",children:["Increment:"," ",e.jsx("span",{className:"font-bold",children:d(i.preview.increment_amount)})," ","(",i.preview.increment_percentage,"%)"]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Increment Rate"}),e.jsx("p",{className:"text-lg font-bold text-slate-700",children:i.preview.increment_rate})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Increment Base"}),e.jsx("p",{className:"text-lg font-bold text-slate-700",children:d(i.preview.increment_base||0)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Current Pay Band Pay"}),e.jsx("p",{className:"font-semibold text-slate-700",children:d(i.preview.current_pay_band_pay||0)})]}),e.jsxs("div",{className:"rounded-lg border-2 border-emerald-300 bg-emerald-50 p-3",children:[e.jsx("p",{className:"text-xs text-emerald-600",children:"New Pay Band Pay"}),e.jsx("p",{className:"font-semibold text-emerald-700",children:d(i.preview.new_pay_band_pay||0)})]})]}),e.jsx("div",{className:"rounded-lg bg-slate-100 p-3",children:e.jsxs("p",{className:"text-sm text-slate-600",children:["Grade Pay:"," ",e.jsx("span",{className:"font-semibold",children:d(i.preview.grade_pay||0)})," ","(unchanged)"]})}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-4 text-center",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Current Basic"}),e.jsx("p",{className:"text-xl font-bold text-slate-700",children:d(i.current_basic_pay)})]}),e.jsx(F,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{className:"rounded-lg border-2 border-emerald-300 bg-emerald-50 p-4 text-center",children:[e.jsx("p",{className:"text-xs text-emerald-600",children:"New Basic"}),e.jsx("p",{className:"text-xl font-bold text-emerald-700",children:d(i.preview.new_basic_pay)})]})]}),e.jsx("div",{className:"rounded-lg bg-emerald-100 p-3 text-center",children:e.jsxs("p",{className:"text-sm text-emerald-700",children:["Increment:"," ",e.jsx("span",{className:"font-bold",children:d(i.preview.increment_amount)})," ","(",i.preview.increment_percentage,"%)"]})})]})})]})]}):e.jsxs(P,{className:"border-amber-200 bg-amber-50",children:[e.jsx(S,{className:"h-4 w-4 text-amber-600"}),e.jsx(I,{className:"text-amber-700",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-semibold",children:"Increment Not Available"}),e.jsx("p",{children:i.reason}),i.recommendation&&e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Recommendation:"})," ",i.recommendation]})]})})]})]})]})})}let U=0;const z=new Map,J=e=>{if(z.has(e))return;const s=setTimeout(()=>{z.delete(e),W({type:"REMOVE_TOAST",toastId:e})},1e6);z.set(e,s)},X=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===s.toast.id?{...e,...s.toast}:e)};case"DISMISS_TOAST":{const{toastId:a}=s;return a?J(a):e.toasts.forEach(e=>{J(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":return void 0===s.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(e=>e.id!==s.toastId)}}},Y=[];let Z={toasts:[]};function W(e){Z=X(Z,e),Y.forEach(e=>{e(Z)})}function ee({...e}){const s=(U=(U+1)%Number.MAX_SAFE_INTEGER,U.toString()),a=()=>W({type:"DISMISS_TOAST",toastId:s});return W({type:"ADD_TOAST",toast:{...e,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>W({type:"UPDATE_TOAST",toast:{...e,id:s}})}}const se=l({effective_date:r().min(1,"Effective date is required"),vide_order_no:r().optional(),vide_order_date:r().optional(),increment_type:n(["percentage","amount","direct"]).optional(),increment_percentage:r().optional(),increment_amount:r().optional(),new_basic_pay:r().optional()});function ae({empId:l,canIncrement:r,isIncrementDue:n,commissionType:i,onSuccess:d}){const[h,u]=s.useState(!1),[b,j]=s.useState(null),N=M(),f=_({}),F=a({resolver:t(se),defaultValues:{effective_date:(new Date).toISOString().split("T")[0],vide_order_no:"",vide_order_date:"",increment_type:"percentage",increment_percentage:"3",increment_amount:"",new_basic_pay:""}}),{handleSubmit:T,reset:B,watch:q}=F,V=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e);return b?e.jsxs(c,{className:"border-emerald-200 bg-gradient-to-br from-emerald-50 to-white",children:[e.jsx(o,{className:"pb-3",children:e.jsxs(x,{className:"flex items-center gap-2 text-emerald-700",children:[e.jsx(A,{className:"h-5 w-5"}),"Increment Processed Successfully"]})}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"rounded-lg bg-white p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Increment Type"}),e.jsx("p",{className:"font-semibold text-slate-900",children:"7th_cpc_matrix"===b.increment_type?"7th CPC Matrix":"custom_commission"===b.increment_type?"Custom Commission":"6th CPC Grade Pay"})]}),e.jsxs("div",{className:"rounded-lg bg-white p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Previous Basic"}),e.jsx("p",{className:"font-semibold text-slate-900",children:V(b.previous_basic)})]}),e.jsxs("div",{className:"rounded-lg bg-emerald-100 p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-emerald-600",children:"New Basic"}),e.jsx("p",{className:"font-bold text-emerald-700",children:V(b.new_basic)})]}),e.jsxs("div",{className:"rounded-lg bg-blue-100 p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-blue-600",children:"Increment Amount"}),e.jsxs("p",{className:"font-bold text-blue-700",children:["+",V(b.increment_amount)," (",b.increment_percentage,"%)"]})]})]}),"7th_cpc_matrix"===b.increment_type&&e.jsx("div",{className:"rounded-lg bg-slate-100 p-3",children:e.jsxs("p",{className:"text-sm text-slate-600",children:["Cell moved from"," ",e.jsx(w,{variant:"outline",children:b.previous_cell})," to"," ",e.jsx(w,{className:"bg-emerald-100 text-emerald-700",children:b.new_cell})]})}),e.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-blue-50 p-3",children:[e.jsx(D,{className:"h-4 w-4 text-blue-600"}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Effective: ",e.jsx("strong",{children:b.effective_date})," | Next Increment: ",e.jsx("strong",{children:b.next_increment_date})]})]}),e.jsx(v,{onClick:()=>{j(null),B(),u(!1)},variant:"outline",className:"w-full",children:"Process Another Increment"})]})})]}):e.jsxs(c,{className:"border-slate-200 bg-white",children:[e.jsxs(o,{className:"border-b border-slate-100 pb-4",children:[e.jsxs(x,{className:"flex items-center gap-2 text-lg",children:[e.jsx(E,{className:"h-5 w-5 text-blue-600"}),"Process Annual Increment"]}),e.jsx(p,{children:"Apply annual increment to employee's pay configuration"})]}),e.jsxs(m,{className:"pt-6",children:[!r&&e.jsxs(P,{className:"mb-6 border-red-200 bg-red-50",children:[e.jsx(S,{className:"h-4 w-4 text-red-600"}),e.jsx(I,{className:"text-red-700",children:"Employee is not eligible for increment. They may have reached maximum cell/pay band. Consider processing a promotion instead."})]}),r&&!n&&e.jsxs(P,{className:"mb-6 border-amber-200 bg-amber-50",children:[e.jsx(S,{className:"h-4 w-4 text-amber-600"}),e.jsxs(I,{className:"text-amber-700",children:[e.jsx("p",{className:"font-semibold",children:"Increment Not Yet Due"}),e.jsx("p",{className:"text-sm",children:'The next increment date has not arrived. Enable "Force Processing" below to process anyway.'})]})]}),e.jsx(R,{methods:F,onSubmit:T(async e=>{var s,a;if(r)try{const s=g(String(l)),a={emp_id:Number(s),effective_date:e.effective_date,vide_order_no:e.vide_order_no||null,vide_order_date:e.vide_order_date||null,force:h,..."custom"===i&&"percentage"===e.increment_type&&{increment_percentage:Number(e.increment_percentage)},..."custom"===i&&"amount"===e.increment_type&&{increment_amount:Number(e.increment_amount)},..."custom"===i&&"direct"===e.increment_type&&{new_basic_pay:Number(e.new_basic_pay)}},t=await f.mutateAsync({api:y.processIncrement,data:a});t.data.success&&(j(t.data.data),ee({title:"Increment Processed Successfully",description:`Annual increment applied. New basic pay: ₹${t.data.data.new_basic}`}),N.invalidateQueries({queryKey:[`incrementPreview-${l}`]}),N.invalidateQueries({queryKey:[`getEmployeeSalary-${l}`]}),d&&d(t.data))}catch(t){ee({title:"Failed to Process Increment",description:(null==(a=null==(s=null==t?void 0:t.response)?void 0:s.data)?void 0:a.message)||"An error occurred. Please try again.",variant:"destructive"})}else ee({title:"Cannot Process Increment",description:"Employee is not eligible for increment at this time. Consider promotion.",variant:"destructive"})}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx($,{name:"effective_date",label:"Effective Date *",type:"date"}),e.jsx($,{name:"vide_order_date",label:"Order Date",type:"date"})]}),e.jsx($,{name:"vide_order_no",label:"Order Number",placeholder:"e.g., INC/2025/001"}),"custom"===i&&e.jsxs("div",{className:"space-y-4 rounded-lg border border-blue-200 bg-blue-50 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-700",children:"Custom Commission Increment Options"}),e.jsx(k,{name:"increment_type",label:"Increment Method",data:[{label:"Percentage of Basic Pay",value:"percentage"},{label:"Fixed Amount",value:"amount"},{label:"Direct New Basic Pay",value:"direct"}]}),"percentage"===F.watch("increment_type")&&e.jsx($,{name:"increment_percentage",label:"Increment Percentage (%)",type:"number",placeholder:"e.g., 3"}),"amount"===F.watch("increment_type")&&e.jsx($,{name:"increment_amount",label:"Increment Amount (₹)",type:"number",placeholder:"e.g., 5000"}),"direct"===F.watch("increment_type")&&e.jsx($,{name:"new_basic_pay",label:"New Basic Pay (₹)",type:"number",placeholder:"Enter new basic pay"})]}),r&&!n&&e.jsxs("div",{className:"flex items-center space-x-2 rounded-lg border border-amber-200 bg-amber-50 p-4",children:[e.jsx(L,{id:"force",checked:h,onCheckedChange:e=>u(e)}),e.jsx(O,{htmlFor:"force",className:"cursor-pointer text-sm text-amber-700",children:"Force Processing - Process increment before due date"})]}),e.jsx(v,{type:"submit",disabled:(null==f?void 0:f.isPending)||!r,className:"w-full bg-blue-600 hover:bg-blue-700",children:(null==f?void 0:f.isPending)?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing Increment..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Process Increment"]})})]})})]})]})}function te({onSelectLevel:a,promotionData:t}){var l,r,n,i;const[d,h]=s.useState(null);if(t.isLoading)return e.jsx(c,{className:"border-slate-200 bg-white",children:e.jsxs(m,{className:"flex items-center justify-center py-12",children:[e.jsx(C,{className:"h-8 w-8 animate-spin text-purple-600"}),e.jsx("span",{className:"ml-3 text-slate-600",children:"Loading promotion preview..."})]})});if(t.error||!(null==(l=t.data)?void 0:l.success))return e.jsxs(P,{className:"border-red-200 bg-red-50",children:[e.jsx(S,{className:"h-4 w-4 text-red-600"}),e.jsx(I,{className:"text-red-700",children:"Failed to load promotion preview. Please try again."})]});const u=t.data.data,b=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e),j=(e,s)=>{h(e),a&&a(e,s)};return e.jsx("div",{className:"space-y-6",children:e.jsxs(c,{className:"border-slate-200 bg-white",children:[e.jsxs(o,{className:"border-b border-slate-100 bg-gradient-to-r from-slate-50 to-white pb-4",children:[e.jsxs(x,{className:"flex items-center gap-2 text-lg",children:[e.jsx(T,{className:"h-5 w-5 text-purple-600"}),"Promotion Preview"]}),e.jsx(p,{children:"View eligible promotion levels with pay fitment analysis"})]}),e.jsxs(m,{className:"pt-6",children:[e.jsxs("div",{className:"mb-6 grid grid-cols-2 gap-4 rounded-lg bg-slate-50 p-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Employee"}),e.jsx("p",{className:"font-semibold text-slate-900",children:u.emp_name}),e.jsx("p",{className:"text-sm text-slate-600",children:u.emp_code})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Pay Commission"}),e.jsx("p",{className:"font-semibold text-slate-900",children:u.pay_commission}),e.jsx(w,{variant:"outline",className:"mt-1",children:u.is_matrix_based?"7th CPC Matrix":"6th CPC GP"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Current Level"}),e.jsx("p",{className:"font-semibold text-slate-900",children:u.current_level_name}),u.is_matrix_based&&u.current_cell&&e.jsxs("p",{className:"text-sm text-slate-600",children:["Cell ",u.current_cell]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500",children:"Current Basic Pay"}),e.jsx("p",{className:"text-lg font-bold text-emerald-600",children:b(u.current_basic_pay)})]})]}),u.can_promote?e.jsxs(e.Fragment,{children:[(null==u?void 0:u.recommended_promotion)&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"mb-3 flex items-center gap-2 text-sm font-semibold text-purple-700",children:[e.jsx(B,{className:"h-4 w-4"}),"Recommended Promotion"]}),e.jsx(c,{className:"cursor-pointer border-2 transition-all "+(d===u.recommended_promotion.pay_level_id?"border-purple-500 bg-purple-50":"border-purple-200 bg-gradient-to-r from-purple-50 to-white hover:border-purple-400"),onClick:()=>j(u.recommended_promotion.pay_level_id,u.recommended_promotion),children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-purple-900",children:u.recommended_promotion.level_name}),u.is_matrix_based&&u.recommended_promotion.recommended_cell&&e.jsxs("p",{className:"text-sm text-purple-600",children:["Recommended Cell:"," ",u.recommended_promotion.recommended_cell]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-emerald-600",children:b(u.recommended_promotion.new_basic_pay)}),e.jsxs(w,{className:"bg-emerald-100 text-emerald-700",children:["+",b(u.recommended_promotion.increment_amount)]})]})]})})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"mb-3 text-sm font-semibold text-slate-700",children:["All Eligible Promotion Levels (",u.eligible_levels.length,")"]}),e.jsx("div",{className:"grid-rows-auto grid grid-cols-1 gap-4 md:grid-cols-2",children:(null==u?void 0:u.is_matrix_based)?null==(n=null==u?void 0:u.eligible_levels)?void 0:n.map(s=>e.jsx(c,{className:"cursor-pointer border transition-all "+(d===s.pay_level_id?"border-purple-500 bg-purple-50":"border-slate-200 hover:border-purple-300 hover:bg-slate-50"),onClick:()=>j(s.pay_level_id,s),children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-slate-900",children:s.level_name}),e.jsxs(w,{variant:"outline",children:["Level ",s.level]}),s.fitment_required&&e.jsx(w,{className:"bg-amber-100 text-amber-700",children:"Fitment Required"})]}),e.jsxs("p",{className:"mt-1 text-sm text-slate-500",children:["Range: ",b(s.min_basic_pay)," -"," ",b(s.max_basic_pay)]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xs text-slate-500",children:["Entry Cell (",s.entry_cell.cell_index,")"]}),e.jsx("p",{className:"font-semibold "+(s.entry_cell.would_result_in_pay_cut?"text-red-600":"text-slate-700"),children:b(s.entry_cell.basic_pay)}),s.entry_cell.would_result_in_pay_cut&&e.jsx("p",{className:"text-xs text-red-500",children:"Pay cut!"})]}),s.recommended_cell&&e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"h-4 w-4 text-slate-400"}),e.jsxs("div",{className:"rounded-lg bg-emerald-50 p-2 text-center",children:[e.jsxs("p",{className:"text-xs text-emerald-600",children:["Fitted Cell (",s.recommended_cell.cell_index,")"]}),e.jsx("p",{className:"font-bold text-emerald-700",children:b(s.recommended_cell.basic_pay)}),e.jsxs("p",{className:"text-xs text-emerald-600",children:["+",b(s.recommended_cell.increment_amount)," ","(",s.recommended_cell.increment_percentage,"%)"]})]})]})]}),d===s.pay_level_id&&e.jsx(A,{className:"h-5 w-5 text-purple-600"})]})})},s.pay_level_id)):null==(i=null==u?void 0:u.eligible_levels)?void 0:i.map(s=>e.jsx(c,{className:"cursor-pointer border transition-all "+(d===s.pay_level_id?"border-purple-500 bg-purple-50":"border-slate-200 hover:border-purple-300 hover:bg-slate-50"),onClick:()=>j(s.pay_level_id,s),children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-slate-900",children:s.level_name}),e.jsxs(w,{variant:"outline",children:["GP ₹",s.new_grade_pay]}),s.pay_band_changed&&e.jsx(w,{className:"bg-blue-100 text-blue-700",children:"Pay Band Change"}),s.fitment_applied&&e.jsx(w,{className:"bg-amber-100 text-amber-700",children:"Fitment Applied"})]}),e.jsxs("p",{className:"mt-1 text-sm text-slate-500",children:[s.pay_band_name," (",b(s.pay_band_min)," -"," ",b(s.pay_band_max),")"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"New Pay Band Pay"}),e.jsx("p",{className:"font-semibold text-slate-700",children:b(s.new_pay_band_pay)})]}),e.jsxs("div",{className:"rounded-lg bg-emerald-50 p-2 text-center",children:[e.jsx("p",{className:"text-xs text-emerald-600",children:"New Basic"}),e.jsx("p",{className:"font-bold text-emerald-700",children:b(s.new_basic_pay)}),e.jsxs("p",{className:"text-xs text-emerald-600",children:["+",b(s.increment_amount)," (",s.increment_percentage,"%)"]})]}),d===s.pay_level_id&&e.jsx(A,{className:"h-5 w-5 text-purple-600"})]})]})})},s.pay_level_id))})]})]}):e.jsxs(P,{className:"border-amber-200 bg-amber-50",children:[e.jsx(S,{className:"h-4 w-4 text-amber-600"}),e.jsxs(I,{className:"text-amber-700",children:[e.jsx("p",{className:"font-semibold",children:"No Promotion Levels Available"}),e.jsx("p",{children:null==(r=null==t?void 0:t.data)?void 0:r.message})]})]})]})]})})}const le=q({new_pay_level_id:V().optional(),new_designation_id:V().optional(),is_matrix_based:G().optional(),cell_index:V().optional(),new_pay_band_pay:V().optional(),new_basic_pay:V().optional(),effective_date:V().min(1,"Effective date is required"),vide_order_no:V().optional(),vide_order_date:V().optional(),promotion_reason:V().optional()});function re({empId:t,selectedLevel:l,canPromote:r,onSuccess:n,onReset:d,isMatrixBased:h,commissionType:u,getEmpData:b}){var j,_,N,E,F;const[B,L]=s.useState(!1),[O,q]=s.useState(null),V=M(),{data:G}=K(),Q=a({resolver:i(le),defaultValues:{new_pay_level_id:"",new_designation_id:"",cell_index:"1",is_matrix_based:!1,new_pay_band_pay:"",new_basic_pay:"",effective_date:(new Date).toISOString().split("T")[0],vide_order_no:"",vide_order_date:"",promotion_reason:""}}),{handleSubmit:H,reset:U,setValue:z,watch:J}=Q;s.useEffect(()=>{var e,s;(null==b?void 0:b.data)&&(null==Q||Q.reset({...Q.getValues(),new_designation_id:String((null==(s=null==(e=null==b?void 0:b.data)?void 0:e.data)?void 0:s.designation_id)||"")}))},[b,Q]),s.useEffect(()=>{var e;l&&(z("new_pay_level_id",String(l.pay_level_id)),h?z("cell_index",String(null==(e=l.recommended_cell)?void 0:e.cell_index)):z("new_pay_band_pay",String(null==l?void 0:l.new_pay_band_pay)))},[l,z]);const X=J("new_pay_level_id"),Y=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e),Z=(null==(j=null==G?void 0:G.data)?void 0:j.map(e=>({label:e.designation_name,value:String(e.id)})))||[];return O?e.jsxs(c,{className:"border-purple-200 bg-gradient-to-br from-purple-50 to-white",children:[e.jsx(o,{className:"pb-3",children:e.jsxs(x,{className:"flex items-center gap-2 text-purple-700",children:[e.jsx(A,{className:"h-5 w-5"}),"Promotion Processed Successfully"]})}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg bg-white p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Previous Level"}),e.jsx("p",{className:"font-semibold text-slate-900",children:O.previous_level_name}),O.previous_cell&&e.jsxs("p",{className:"text-sm text-slate-600",children:["Cell ",O.previous_cell]})]}),e.jsxs("div",{className:"rounded-lg bg-purple-100 p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-purple-600",children:"New Level"}),e.jsx("p",{className:"font-bold text-purple-700",children:O.new_level_name}),O.new_cell&&e.jsxs("p",{className:"text-sm text-purple-600",children:["Cell ",O.new_cell]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg bg-white p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Previous Basic"}),e.jsx("p",{className:"font-semibold text-slate-900",children:Y(O.previous_basic)})]}),e.jsxs("div",{className:"rounded-lg bg-emerald-100 p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-emerald-600",children:"New Basic"}),e.jsx("p",{className:"font-bold text-emerald-700",children:Y(O.new_basic)})]}),e.jsxs("div",{className:"rounded-lg bg-blue-100 p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-blue-600",children:"Increment"}),e.jsxs("p",{className:"font-bold text-blue-700",children:["+",Y(O.increment_amount)]})]})]}),O.fitment_applied&&e.jsxs(P,{className:"border-amber-200 bg-amber-50",children:[e.jsx(S,{className:"h-4 w-4 text-amber-600"}),e.jsxs(I,{className:"text-amber-700",children:[e.jsx("strong",{children:"Fitment Applied:"})," Cell adjusted from"," ",O.requested_cell," to ",O.new_cell," to maintain pay protection."]})]}),e.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-blue-50 p-3",children:[e.jsx(D,{className:"h-4 w-4 text-blue-600"}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Effective: ",e.jsx("strong",{children:O.effective_date})," | Next Increment: ",e.jsx("strong",{children:O.next_increment_date})]})]}),e.jsx(v,{onClick:()=>{q(null),U(),null==d||d()},variant:"outline",className:"w-full",children:"Process Another Promotion"})]})})]}):e.jsxs(c,{className:"border-slate-200 bg-white",children:[e.jsxs(o,{className:"border-b border-slate-100 pb-4",children:[e.jsxs(x,{className:"flex items-center gap-2 text-lg",children:[e.jsx(T,{className:"h-5 w-5 text-purple-600"}),"Process Promotion"]}),e.jsx(p,{children:"Promote employee to a higher pay level"})]}),e.jsxs(m,{className:"pt-6",children:[!r&&e.jsxs(P,{className:"mb-6 border-red-200 bg-red-50",children:[e.jsx(S,{className:"h-4 w-4 text-red-600"}),e.jsx(I,{className:"text-red-700",children:"Employee is not eligible for promotion. They may already be at the highest level."})]}),!l&&r&&e.jsxs(P,{className:"mb-6 border-blue-200 bg-blue-50",children:[e.jsx(S,{className:"h-4 w-4 text-blue-600"}),e.jsx(I,{className:"text-blue-700",children:"Please select a promotion level from the preview above to proceed."})]}),l&&e.jsxs("div",{className:"mb-6 rounded-lg border-2 border-purple-200 bg-purple-50 p-4",children:[e.jsx("p",{className:"text-sm font-medium text-purple-700",children:"Selected Level"}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-purple-900",children:l.level_name}),l.level&&e.jsxs(w,{variant:"outline",children:["Level ",l.level]})]}),(null==(_=null==l?void 0:l.recommended_cell)?void 0:_.basic_pay)&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-emerald-600",children:Y(null==(N=null==l?void 0:l.recommended_cell)?void 0:N.basic_pay)}),(null==(E=l.recommended_cell)?void 0:E.increment_amount)&&e.jsxs("p",{className:"text-sm text-emerald-600",children:["+",Y((null==(F=l.recommended_cell)?void 0:F.increment_amount)||0)," "]})]})]})]}),e.jsx(R,{methods:Q,onSubmit:H(async e=>{var s,a;if(r)if(e.new_pay_level_id){L(!0);try{const s=g(String(t)),a=parseInt(e.cell_index||"1",10),l=isNaN(a)||a<1?1:a,r={emp_id:Number(s),...e.new_pay_level_id&&{new_pay_level_id:Number(e.new_pay_level_id)},new_designation_id:e.new_designation_id?Number(e.new_designation_id):null,..."custom"===u&&{new_basic_pay:Number(e.new_basic_pay)},...h&&"custom"!==u&&{cell_index:l},...!h&&"custom"!==u&&{new_pay_band_pay:Number(e.new_pay_band_pay)},effective_date:e.effective_date,vide_order_no:e.vide_order_no||null,vide_order_date:e.vide_order_date||null,promotion_reason:e.promotion_reason||null},i=await f.post(y.processPromotion,r);i.data.success&&(q(i.data.data),ee({title:"Promotion Processed Successfully",description:`Promoted to ${i.data.data.new_level_name}. New basic pay: ₹${i.data.data.new_basic}`}),V.invalidateQueries({queryKey:[`promotionPreview-${t}`]}),V.invalidateQueries({queryKey:[`incrementPreview-${t}`]}),V.invalidateQueries({queryKey:[`getEmployeeSalary-${t}`]}),n&&n(i.data))}catch(l){ee({title:"Failed to Process Promotion",description:(null==(a=null==(s=null==l?void 0:l.response)?void 0:s.data)?void 0:a.message)||"An error occurred. Please try again.",variant:"destructive"})}finally{L(!1)}}else ee({title:"Select a Level",description:"Please select a promotion level from the preview above.",variant:"destructive"});else ee({title:"Cannot Process Promotion",description:"Employee is not eligible for promotion at this time.",variant:"destructive"})}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("input",{type:"hidden",...Q.register("new_pay_level_id")}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx($,{name:"effective_date",label:"Effective Date *",type:"date"}),"custom"===u&&e.jsx($,{name:"new_basic_pay",label:"New Basic Pay *",type:"number",placeholder:"Enter new basic pay"}),h&&"custom"!==u&&e.jsx($,{disabled:!0,name:"cell_index",label:"Cell Index",inputValidation:["number"]}),!h&&"custom"!==u&&e.jsx($,{disabled:!0,name:"new_pay_band_pay",label:"New Pay Band Pay",inputValidation:["number"]})]}),e.jsx(k,{name:"new_designation_id",label:"New Designation (Optional)",data:Z,isSearch:!0}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx($,{name:"vide_order_no",label:"Order Number",placeholder:"e.g., PROM/2025/001"}),e.jsx($,{name:"vide_order_date",label:"Order Date",type:"date"})]}),e.jsx($,{name:"promotion_reason",label:"Promotion Reason (Optional)",placeholder:"e.g., Promotion based on annual performance review"}),e.jsx(v,{type:"submit",disabled:B||!r||!X,className:"w-full bg-purple-600 hover:bg-purple-700",children:B?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing Promotion..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Process Promotion"]})})]})})]})]})}function ne({onBack:a}){var t,l,r,n,i,o,x,p,_,v,g,f,w,P,I,S,D;const{id:F}=d(),B=F||"",[L,O]=s.useState("increment"),[R,$]=s.useState(null),k=N({api:`${null==(t=y)?void 0:t.getEmployeeById}?id=${F}`,key:`${null==(l=y)?void 0:l.getEmployeeById}-${F}`,value:[F],options:{enabled:Boolean(F)}}),M=N({api:`${y.getIncrementPreview}?emp_id=${B}`,key:`incrementPreview-${B}`,value:[B],options:{enabled:!!B}}),q=N({api:`${y.getPromotionPreview}?emp_id=${B}`,key:`promotionPreview-${B}`,value:[B],options:{enabled:!!B}}),V=(null==(n=null==(r=null==M?void 0:M.data)?void 0:r.data)?void 0:n.can_increment)??!1,G=(null==(o=null==(i=null==M?void 0:M.data)?void 0:i.data)?void 0:o.is_increment_due)??!0,K=(null==(p=null==(x=null==q?void 0:q.data)?void 0:x.data)?void 0:p.can_promote)??!1;return M.isLoading||q.isLoading?e.jsx("div",{className:"flex h-screen w-full items-center justify-center",children:e.jsx(C,{className:"h-8 w-8 animate-spin text-blue-600"})}):e.jsx(Q,{title:"Increment & Promotion",subTitle:"Process annual increment or promotion for employee",name:null==(v=null==(_=null==q?void 0:q.data)?void 0:_.data)?void 0:v.emp_name,code:null==(f=null==(g=null==q?void 0:q.data)?void 0:g.data)?void 0:f.emp_code,description:"Manage and process employee increments and promotions efficiently.",children:e.jsxs("div",{className:"min-h-screen space-y-6 bg-gradient-to-br from-slate-50 via-blue-50/30 to-slate-50",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(c,{className:"cursor-pointer border-2 transition-all "+("increment"===L?"border-blue-500 bg-blue-50":"border-slate-200 hover:border-blue-300"),onClick:()=>O("increment"),children:e.jsxs(m,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"rounded-full p-3 "+(V?"bg-emerald-100":"bg-amber-100"),children:e.jsx(E,{className:"h-6 w-6 "+(V?"text-emerald-600":"text-amber-600")})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900",children:"Annual Increment"}),e.jsx("p",{className:"text-sm text-slate-600",children:V?e.jsxs("span",{className:"flex items-center gap-1 text-emerald-600",children:[e.jsx(A,{className:"h-3 w-3"})," Eligible",G?" - Due now":" - Not yet due"]}):e.jsx("span",{className:"text-amber-600",children:"Not eligible - Promotion required"})})]})]})}),e.jsx(c,{className:"cursor-pointer border-2 transition-all "+("promotion"===L?"border-purple-500 bg-purple-50":"border-slate-200 hover:border-purple-300"),onClick:()=>O("promotion"),children:e.jsxs(m,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"rounded-full p-3 "+(K?"bg-emerald-100":"bg-amber-100"),children:e.jsx(T,{className:"h-6 w-6 "+(K?"text-emerald-600":"text-amber-600")})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900",children:"Promotion"}),e.jsx("p",{className:"text-sm text-slate-600",children:K?e.jsxs("span",{className:"flex items-center gap-1 text-emerald-600",children:[e.jsx(A,{className:"h-3 w-3"})," ",(null==(I=null==(P=null==(w=null==q?void 0:q.data)?void 0:w.data)?void 0:P.eligible_levels)?void 0:I.length)||0," ","levels available"]}):e.jsx("span",{className:"text-amber-600",children:"Already at highest level"})})]})]})})]}),e.jsx(c,{className:"border-slate-200 bg-white shadow-lg",children:e.jsx(m,{className:"p-0",children:e.jsxs(h,{value:L,onValueChange:O,className:"w-full",children:[e.jsxs(u,{className:"grid h-auto w-full grid-cols-2 gap-0 rounded-none rounded-t-lg border-b bg-slate-100 p-0",children:[e.jsxs(b,{value:"increment",className:"flex items-center gap-2 rounded-none rounded-tl-lg py-4 data-[state=active]:bg-white data-[state=active]:shadow-none",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{children:"Annual Increment"})]}),e.jsxs(b,{value:"promotion",className:"flex items-center gap-2 rounded-none rounded-tr-lg py-4 data-[state=active]:bg-white data-[state=active]:shadow-none",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{children:"Promotion"})]})]}),e.jsx(j,{value:"increment",className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e.jsx(H,{incrementData:M,promotionData:q}),e.jsx(ae,{empId:B,canIncrement:V,isIncrementDue:G})]})}),e.jsx(j,{value:"promotion",className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{onSelectLevel:(e,s)=>{$(s)},promotionData:q}),e.jsx(re,{empId:B,selectedLevel:R,canPromote:K,onReset:()=>$(null),isMatrixBased:(null==(D=null==(S=null==q?void 0:q.data)?void 0:S.data)?void 0:D.is_matrix_based)||!1,getEmpData:k})]})})]})})})]})})}export{ne as default};
