import{m as O,h as P,e as Q,r as i,j as e,z as v,l as W,B as z}from"./index-Df4ChAN-.js";import{P as X}from"./index-DjNjGvXo.js";import{C as Z,a as T,b as L,c as D,h as ee}from"./card-CW8LZ2r1.js";import{S as ae,T as se,a as le,b as V,c as h,d as re,e as g}from"./index-Tosm5l2v.js";import{u as J,b as A}from"./useCustomQuery-BBKf_waA.js";import{S as K,a as ce}from"./Spinner-CyN74T25.js";import{a as ne,o as de,c as ie,f as U}from"./yup-pPl0eVQc.js";import{F as te,B as oe}from"./datetime-picker-EqBIIAIP.js";import{R as G}from"./RHFTextField-C5PfVKXx.js";import"./select-DZKz6XPY.js";import{D as xe}from"./index-D4JNSpYb.js";import"./calendar-CMNTAmai.js";import"./clock-BxgzxCOp.js";import"./check-BzewUJFq.js";const ue=ie().shape({cell_index:U().required("Cell Index is required").positive("Cell Index must be positive"),basic_pay:U().required("Basic Pay is required").positive("Basic Pay must be positive")});function he({open:C,setOpen:x,title:M,id:B,edit:d,setEdit:E,empTypeListData:s,payLevelId:t}){var N,y,_,b,m,a;const p=J({}),j=O(String(t)),{data:o,isFetching:I}=A({api:`${(N=P)==null?void 0:N.getPayMatrixById}?id=${Q(String(B))}`,key:"getPayMatrixById",options:{enabled:!!d}}),f=s!=null&&s.data&&((_=(y=s==null?void 0:s.data)==null?void 0:y.data)==null?void 0:_.length)>0?Math.max(...(m=(b=s==null?void 0:s.data)==null?void 0:b.data)==null?void 0:m.map(r=>r==null?void 0:r.cell_index))+1:1,u=A({api:`${(a=P)==null?void 0:a.getPayLevelById}?id=${t}`,key:"getPayLevelById",value:[t],options:{enabled:!!t}});console.log("data in paymatrixlist",u==null?void 0:u.data);const S={pay_level_id:Number(j)||0,cell_index:0,basic_pay:0},n=ne({defaultValues:S,resolver:de(ue)}),l=async r=>{var F,$,w,k,q,H,R,Y;try{if(d&&r){const c=await p.mutateAsync({api:`${(F=P)==null?void 0:F.updatePayMatrix}`,data:{id:B,pay_level_id:r.pay_level_id,cell_index:r.cell_index,basic_pay:r.basic_pay}});($=c.data)!=null&&$.success?v.success((w=c==null?void 0:c.data)==null?void 0:w.message):v.error(((k=c.data)==null?void 0:k.message)||"Pay Level Cell not updated successfully")}else{const c=await p.mutateAsync({api:(q=P)==null?void 0:q.createPayMatrix,data:{pay_level_id:r.pay_level_id,cell_index:r.cell_index,basic_pay:r.basic_pay}});(H=c.data)!=null&&H.success?v.success((R=c==null?void 0:c.data)==null?void 0:R.message):v.error(((Y=c.data)==null?void 0:Y.message)||"Pay Level Cell not created successfully"),n.reset(S)}x(!1),E(!1),s==null||s.refetch()}catch(c){console.log(c),v.error("An error occurred. Please try again.")}};return i.useEffect(()=>{d&&(o!=null&&o.data)?n.reset(o.data):n.reset(S)},[d,o,n]),i.useEffect(()=>{s!=null&&s.data&&!d&&n.setValue("cell_index",f)},[s,d,f,n]),e.jsx(xe,{open:C,setOpen:x,title:M,setEdit:E,edit:d,isLoading:I,children:e.jsx(te,{methods:n,onSubmit:n.handleSubmit(l),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[e.jsx("input",{type:"hidden",...n.register("pay_level_id"),value:t||""}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-2",children:[e.jsx(G,{type:"number",name:"cell_index",placeholder:"Enter Cell Index"}),e.jsx(G,{type:"number",name:"basic_pay",placeholder:"Enter Basic Pay"})]}),e.jsx(K,{}),e.jsx("div",{children:e.jsx(oe,{isLoading:n.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function ge(){var y,_,b,m;const[C]=W(),x=C.get("pay_level_id");J({});const[M,B]=i.useState(1),[d,E]=i.useState(10),[s,t]=i.useState(""),[p,j]=i.useState(!1),[o,I]=i.useState(""),[f,u]=i.useState(!1),[S,n]=i.useState(null),l=A({api:`${P.getAllPayMatrix}?pay_level_id=${x}`,key:"getAllPayMatrix",value:[M,d],options:{enabled:!!x}}),N=a=>{u(!0),j(!0),I(a)};return e.jsxs("main",{className:"grid items-start",children:[e.jsx(he,{open:p,setOpen:j,title:f?"Edit Employee Type":"Add Employee Type",id:o,edit:f,setEdit:u,empTypeListData:l,payLevelId:x||void 0}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(ae,{search:s,setSearch:t,refetch:l.refetch,isFetching:l==null?void 0:l.isLoading})}),e.jsx("div",{children:e.jsx(z,{className:"flex items-center gap-2",onClick:()=>j(!0),children:"Add New"})})]}),e.jsxs(Z,{children:[e.jsx(T,{className:"px-7",children:e.jsxs(L,{children:["Employee Type List (",((_=(y=l==null?void 0:l.data)==null?void 0:y.data)==null?void 0:_.length)||0,")"]})}),e.jsx(D,{children:l.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(ce,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(se,{children:[e.jsx(le,{children:e.jsxs(V,{children:[e.jsx(h,{className:"",children:"#"}),e.jsx(h,{className:"",children:"Level ID"}),e.jsx(h,{className:"",children:"Cell Index"}),e.jsx(h,{className:"",children:"Basic Pay"}),e.jsx(h,{className:"",children:"Created at"}),e.jsx(h,{children:"Action"})]})}),e.jsx(re,{children:(m=(b=l==null?void 0:l.data)==null?void 0:b.data)==null?void 0:m.map((a,r)=>e.jsxs(V,{children:[e.jsx(g,{children:r+1}),e.jsx(g,{children:a==null?void 0:a.pay_level_id}),e.jsx(g,{children:a==null?void 0:a.cell_index}),e.jsx(g,{children:a==null?void 0:a.basic_pay}),e.jsx(g,{children:ee(a==null?void 0:a.created_at).format("DD-MM-YYYY")}),e.jsx(g,{children:e.jsx(z,{className:"bg-primary",onClick:()=>N(String(a==null?void 0:a.id)),children:"Edit"})})]},a==null?void 0:a.id))})]}),e.jsx(K,{className:"mb-2 mt-4"})]})})]})]})]})}function Ee(){return e.jsx(X,{title:"Pay Matrix",subTitle:"Manage all the Pay Matrices here",children:e.jsx("div",{className:"py-12",children:e.jsx(ge,{})})})}export{Ee as default};
