import{h as e,f as a,r as l,j as t,z as s,B as i,e as o}from"./index-BJ2Di0BB.js";import{P as r}from"./index-L2kacWh6.js";import{h as n}from"./moment-CBOc1lqT.js";import{C as d,a as c,b as m,c as u}from"./card-CrOEotWM.js";import{S as f,T as x,a as h,b as p,c as v,d as j,e as y}from"./index-BxKGIMG5.js";import{u as _,b}from"./useCustomQuery-DkqDqiry.js";import{P as g}from"./index-DZvdNKxy.js";import{S}from"./separator-BtSn9EpY.js";import{S as N}from"./Spinner-DjUjMlqR.js";import{a as T,o as P,c as C,f as A,b as E}from"./yup-BTlf5Wf5.js";import{F,L as w}from"./datetime-picker-cKnQNXMD.js";import{R as k}from"./RHFTextField-BK1QXo_s.js";import{B as M}from"./ButtonLoading-B5GmY3N3.js";import{I as q}from"./select-4D5dQM-6.js";import{R as L}from"./DateAndTimePicker-Bmu_5TYR.js";import{D}from"./index-ClKtlEeL.js";import{X as H}from"./x-B3gpsSJM.js";import{P as J}from"./plus-UbJrlwP1.js";import"./calendar-B99NsLtP.js";import"./clock-PqgEqIzL.js";import"./check-DiqtQ1XW.js";const $=C().shape({state_code:E().required("State Code is required").max(2),salary_from:A().required("Salary From is required").min(0),salary_to:A().nullable().min(0).optional(),monthly_tax:A().required("Monthly Tax is required").min(0),applicable_month:E().nullable().optional(),effective_from:E().required("Effective From date is required"),effective_to:E().nullable().optional(),status:A().optional()});function O({open:i,setOpen:o,title:r,id:n,edit:d,setEdit:c,ptSlabListData:m}){var u,f,x,h,p;const v=_({}),{data:j,isFetching:y}=b({api:`${null==(u=e)?void 0:u.getPTSlabById}?id=${a(String(n))}`,key:"getPTSlabById",options:{enabled:d&&!!n}}),g=(null==m?void 0:m.data)&&(null==(x=null==(f=null==m?void 0:m.data)?void 0:f.data)?void 0:x.length)>0?Math.max(...null==(p=null==(h=null==m?void 0:m.data)?void 0:h.data)?void 0:p.map(e=>(null==e?void 0:e.salary_to)||0))+1:0,N=T({defaultValues:{state_code:"JH",salary_from:0,salary_to:0,monthly_tax:0,applicable_month:"",effective_from:"",effective_to:"",status:1},resolver:P($)});return l.useEffect(()=>{var e,a,l,t,s,i,o,r,n;d&&j?N.reset({state_code:(null==(e=null==j?void 0:j.data)?void 0:e.state_code)||"",salary_from:Number(null==(a=null==j?void 0:j.data)?void 0:a.salary_from)||0,salary_to:(null==(l=null==j?void 0:j.data)?void 0:l.salary_to)?Number(null==(t=null==j?void 0:j.data)?void 0:t.salary_to):0,monthly_tax:Number(null==(s=null==j?void 0:j.data)?void 0:s.monthly_tax)||0,applicable_month:(null==(i=null==j?void 0:j.data)?void 0:i.applicable_month)||"",effective_from:(null==(o=null==j?void 0:j.data)?void 0:o.effective_from)||"",effective_to:(null==(r=null==j?void 0:j.data)?void 0:r.effective_to)||"",status:(null==(n=null==j?void 0:j.data)?void 0:n.status)||1}):N.reset({state_code:"JH",salary_from:g||0,salary_to:0,monthly_tax:0,applicable_month:"",effective_from:"",effective_to:"",status:1})},[d,j,N,g]),t.jsx(D,{open:i,setOpen:o,title:r,setEdit:c,edit:d,isLoading:y,children:t.jsx(F,{methods:N,onSubmit:N.handleSubmit(async a=>{var l,t,i,r,u,f,x,h,p;try{if(d&&n){const o=await v.mutateAsync({api:null==(l=e)?void 0:l.updatePTSlab,data:{id:Number(n),...a}});(null==(t=o.data)?void 0:t.success)?s.success((null==(i=null==o?void 0:o.data)?void 0:i.message)||"Professional Tax Slab updated successfully"):s.error((null==(r=o.data)?void 0:r.message)||"Professional Tax Slab not updated successfully")}else{const l=await v.mutateAsync({api:null==(u=e)?void 0:u.createPTSlab,data:a});(null==(f=l.data)?void 0:f.success)?s.success((null==(x=null==l?void 0:l.data)?void 0:x.message)||"Professional Tax Slab created successfully"):s.error((null==(h=l.data)?void 0:h.message)||"Professional Tax Slab not created successfully")}N.reset({state_code:"",salary_from:0,salary_to:0,monthly_tax:0,applicable_month:"",effective_from:"",effective_to:"",status:1}),o(!1),null==c||c(!1),null==(p=m.refetch)||p.call(m)}catch(j){}}),children:t.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[t.jsx("div",{children:t.jsx(k,{label:"State Code",name:"state_code",placeholder:"Enter State Code (e.g., JH)",type:"text",maxLength:2})}),t.jsx("div",{children:t.jsx(k,{label:"Salary From",name:"salary_from",placeholder:"Enter Salary From",type:"number",step:"1"})}),t.jsx("div",{children:t.jsx(k,{label:"Salary To (Optional)",name:"salary_to",placeholder:"Enter Salary To (Leave empty for unlimited)",type:"number",step:"1"})}),t.jsx("div",{children:t.jsx(k,{label:"Monthly Tax",name:"monthly_tax",placeholder:"Enter Monthly Tax Amount",type:"number",step:"1"})}),t.jsx("div",{children:t.jsx(k,{label:"Applicable Month (Optional)",name:"applicable_month",placeholder:"Enter Applicable Month",type:"text"})}),t.jsx("div",{children:t.jsx(L,{name:"effective_from",label:"Effective From",placeholder:"Select effective from date"})}),t.jsx("div",{children:t.jsx(L,{name:"effective_to",label:"Effective To (Optional)",placeholder:"Select effective to date"})}),t.jsx(S,{}),t.jsx("div",{children:t.jsx(M,{isLoading:N.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}const B={state_code:"JH",salary_from:0,salary_to:"",monthly_tax:0,applicable_month:"",effective_from:"2024-01-01"},Y=[{state_code:"JH",salary_from:0,salary_to:25e3,monthly_tax:0,applicable_month:"",effective_from:"2024-01-01"},{state_code:"JH",salary_from:25001,salary_to:41666,monthly_tax:100,applicable_month:"",effective_from:"2024-01-01"},{state_code:"JH",salary_from:41667,salary_to:66666,monthly_tax:150,applicable_month:"",effective_from:"2024-01-01"},{state_code:"JH",salary_from:66667,salary_to:83333,monthly_tax:175,applicable_month:"",effective_from:"2024-01-01"},{state_code:"JH",salary_from:83334,salary_to:"",monthly_tax:200,applicable_month:"",effective_from:"2024-01-01"}];function z({open:a,setOpen:o,refetch:r}){const[n,c]=l.useState(Y),[m,u]=l.useState(!1),f=_({});l.useEffect(()=>{a&&c(Y)},[a]);const x=(e,a,l)=>{const t=[...n];t[e]={...t[e],[a]:l},c(t)};return t.jsx(D,{open:a,setOpen:o,title:"Bulk Upload Professional Tax Slabs",edit:!1,setEdit:()=>{},children:t.jsx("form",{onSubmit:async a=>{var l,t,i,d;a.preventDefault(),u(!0);try{for(let e=0;e<n.length;e++){const a=n[e];if(!a.state_code||!a.effective_from)return s.error(`Slab ${e+1}: State Code and Effective From are required`),void u(!1);if(""===a.salary_from||""===a.monthly_tax)return s.error(`Slab ${e+1}: Salary From and Monthly Tax are required`),void u(!1)}const a=n.map(e=>({state_code:e.state_code,salary_from:Number(e.salary_from),salary_to:""===e.salary_to||null===e.salary_to?null:Number(e.salary_to),monthly_tax:Number(e.monthly_tax),applicable_month:""===e.applicable_month?null:e.applicable_month,effective_from:e.effective_from})),m=await f.mutateAsync({api:null==(l=e)?void 0:l.bulkCreatePTSlab,data:{slabs:a}});(null==(t=m.data)?void 0:t.success)?(s.success((null==(i=null==m?void 0:m.data)?void 0:i.message)||"Professional Tax Slabs created successfully"),o(!1),c(Y),null==r||r()):s.error((null==(d=m.data)?void 0:d.message)||"Failed to create Professional Tax Slabs")}catch(m){s.error("An error occurred while uploading slabs")}finally{u(!1)}},children:t.jsxs("div",{className:"grid gap-4",children:[t.jsx("div",{className:"max-h-[500px] space-y-4 overflow-y-auto pr-2",children:n.map((e,a)=>t.jsxs(d,{className:"relative p-4",children:[t.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[t.jsxs("h4",{className:"text-sm font-semibold",children:["Slab ",a+1]}),t.jsx(i,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{n.length>1?c(n.filter((a,l)=>l!==e)):s.error("At least one slab is required")})(a),className:"h-8 w-8 p-0",children:t.jsx(H,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx(w,{className:"text-xs",children:"State Code*"}),t.jsx(q,{type:"text",value:e.state_code,onChange:e=>x(a,"state_code",e.target.value.toUpperCase()),maxLength:2,placeholder:"JH",className:"h-9",required:!0})]}),t.jsxs("div",{children:[t.jsx(w,{className:"text-xs",children:"Salary From*"}),t.jsx(q,{type:"number",value:e.salary_from,onChange:e=>x(a,"salary_from",e.target.value),placeholder:"0",className:"h-9",required:!0})]}),t.jsxs("div",{children:[t.jsx(w,{className:"text-xs",children:"Salary To"}),t.jsx(q,{type:"number",value:null===e.salary_to?"":e.salary_to,onChange:e=>x(a,"salary_to",e.target.value),placeholder:"Leave empty for unlimited",className:"h-9"})]}),t.jsxs("div",{children:[t.jsx(w,{className:"text-xs",children:"Monthly Tax*"}),t.jsx(q,{type:"number",value:e.monthly_tax,onChange:e=>x(a,"monthly_tax",e.target.value),placeholder:"0",className:"h-9",required:!0})]}),t.jsxs("div",{children:[t.jsx(w,{className:"text-xs",children:"Applicable Month"}),t.jsx(q,{type:"text",value:e.applicable_month||"",onChange:e=>x(a,"applicable_month",e.target.value),placeholder:"Optional",className:"h-9"})]}),t.jsxs("div",{children:[t.jsx(w,{className:"text-xs",children:"Effective From*"}),t.jsx(q,{type:"date",value:e.effective_from,onChange:e=>x(a,"effective_from",e.target.value),className:"h-9",required:!0})]})]})]},a))}),t.jsxs(i,{type:"button",variant:"outline",onClick:()=>{c([...n,{...B}])},className:"w-full",children:[t.jsx(J,{className:"mr-2 h-4 w-4"}),"Add Another Slab"]}),t.jsx("div",{className:"flex gap-2",children:t.jsx(i,{type:"button",variant:"outline",onClick:()=>{c(Y)},className:"flex-1",children:"Reset to Default"})}),t.jsx(S,{}),t.jsx(i,{type:"submit",disabled:m,className:"h-11 w-full rounded-xl",children:m?"Uploading...":`Upload ${n.length} Slab${n.length>1?"s":""}`})]})})})}function I(){var a,r,T,P,C,A;const E=_({}),[F,w]=l.useState(1),[k]=l.useState(10),[M,q]=l.useState(""),[L,D]=l.useState(!1),[H,J]=l.useState(!1),[$,B]=l.useState(""),[Y,I]=l.useState(!1),U=b({api:`${e.getAllPTSlabs}?page=${F}&limit=${k}&q=${M}`,key:"getAllPTSlabs",value:[F,k,M],options:{enabled:!0}});return t.jsxs("main",{className:"grid items-start",children:[t.jsx(O,{open:L,setOpen:D,title:Y?"Edit Professional Tax Slab":"Add Professional Tax Slab",id:$,edit:Y,setEdit:I,ptSlabListData:U}),t.jsx(z,{open:H,setOpen:J,refetch:U.refetch}),t.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[t.jsxs("div",{className:"flex w-full justify-between gap-2",children:[t.jsx("div",{children:t.jsx(f,{search:M,setSearch:q,refetch:U.refetch,isFetching:null==U?void 0:U.isLoading})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(i,{variant:"outline",className:"flex items-center gap-2",onClick:()=>J(!0),children:"Bulk Upload"}),t.jsx(i,{className:"flex items-center gap-2",onClick:()=>D(!0),children:"Add New"})]})]}),t.jsx(S,{}),t.jsxs(d,{children:[t.jsx(c,{children:t.jsx(m,{children:"Professional Tax Slabs"})}),t.jsx(u,{children:(null==U?void 0:U.isLoading)?t.jsx("div",{className:"flex items-center justify-center",children:t.jsx(N,{})}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs(x,{children:[t.jsx(h,{children:t.jsxs(p,{children:[t.jsx(v,{children:"State Code"}),t.jsx(v,{children:"Salary From"}),t.jsx(v,{children:"Salary To"}),t.jsx(v,{children:"Monthly Tax"}),t.jsx(v,{children:"Applicable Month"}),t.jsx(v,{children:"Effective From"}),t.jsx(v,{children:"Effective To"}),t.jsx(v,{children:"Status"}),t.jsx(v,{children:"Actions"})]})}),t.jsx(j,{children:(null==(a=null==U?void 0:U.data)?void 0:a.data)&&(null==(r=null==U?void 0:U.data)?void 0:r.data.length)>0?null==(T=null==U?void 0:U.data)?void 0:T.data.map(a=>t.jsxs(p,{children:[t.jsx(y,{className:"font-medium",children:a.state_code}),t.jsxs(y,{children:["₹",a.salary_from.toLocaleString()]}),t.jsx(y,{children:a.salary_to?`₹${a.salary_to.toLocaleString()}`:"Above"}),t.jsxs(y,{children:["₹",a.monthly_tax]}),t.jsx(y,{children:a.applicable_month||"-"}),t.jsx(y,{children:n(a.effective_from).format("DD/MM/YYYY")}),t.jsx(y,{children:a.effective_to?n(a.effective_to).format("DD/MM/YYYY"):"-"}),t.jsx(y,{children:t.jsx("span",{className:"rounded-full px-3 py-1 text-xs font-semibold "+(1===a.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:1===a.status?"Active":"Inactive"})}),t.jsxs(y,{className:"flex gap-2",children:[t.jsx(i,{variant:"outline",size:"sm",onClick:()=>{return e=String(a.id),I(!0),D(!0),void B(e);var e},children:"Edit"}),t.jsx(i,{variant:"destructive",size:"sm",onClick:()=>(async a=>{var l,t,i,r;try{const o=await E.mutateAsync({api:null==(l=e)?void 0:l.deletePTSlab,data:{id:Number(a)}});(null==(t=null==o?void 0:o.data)?void 0:t.success)?(U.refetch(),s.success((null==(i=null==o?void 0:o.data)?void 0:i.message)||"Professional Tax Slab deleted successfully")):s.error((null==(r=o.data)?void 0:r.message)||"Failed to delete Professional Tax Slab")}catch(n){s.error(o(n))}})(String(a.id)),children:"Delete"})]})]},a.id)):t.jsx(p,{children:t.jsx(y,{colSpan:9,className:"text-center",children:"No Professional Tax Slabs found"})})})]})})})]}),(null==(P=null==U?void 0:U.data)?void 0:P.pagination)&&t.jsx(g,{page:F,setPage:w,limit:k,totalPages:(null==(A=null==(C=null==U?void 0:U.data)?void 0:C.pagination)?void 0:A.totalPages)||1})]})]})}function U(){return t.jsx(r,{title:"Professional Slab",subTitle:"Manage Professional Slabs",children:t.jsx("div",{className:"py-12",children:t.jsx(I,{})})})}export{U as default};
