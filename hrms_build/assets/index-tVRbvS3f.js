import{k as e,C as a,f as l,r as s,j as i,y as n,z as t,e as r,B as o,T as d,D as c,F as m,G as x}from"./index-pqP14EhS.js";import{P as u}from"./index-DZYVnpiZ.js";import{C as _,a as p,d as h,b as g,c as j}from"./card-Bs59ZPbY.js";import{T as f,a as b,b as v,c as w,d as y,e as N}from"./table-CRgXbpGI.js";import{S as A,a as C,b as S,c as k,d as E}from"./select-B4keucJT.js";import{u as F,b as R}from"./useCustomQuery-CzEWxvyG.js";import{S as T}from"./separator-DjchR5HV.js";import{S as O}from"./Spinner-CJE7r9W9.js";import{a as L,o as P,c as Y,d as M,b as $,f as D}from"./yup-C8lOt6vX.js";import{F as q}from"./datetime-picker-z1_UvJZu.js";import{R as B}from"./RHFTextField-CcEXXXFB.js";import{B as I}from"./ButtonLoading-CHCIi82E.js";import{R as H}from"./RHFSelectField-Ohwh174t.js";import"./input-BT6hWnw8.js";import"./switch-CvZERcdR.js";import{R as V}from"./RHFCheckbox-C9wUO5H0.js";import{D as W}from"./index-j-XDzI77.js";import{L as z}from"./label-xKekv9dA.js";import{I as G}from"./info-qKsat57S.js";import{B as U}from"./badge-DeVTySeZ.js";import{P as Q}from"./plus-DLYguytq.js";import{C as X}from"./circle-x-6Y3mmM73.js";import{C as Z}from"./circle-check-big-BiAG3xNy.js";import"./check-BQY2iuAn.js";import"./calendar-By15l6FD.js";import"./format-BkNqQ0tt.js";import"./chevron-right-tcBAQR95.js";import"./clock-Dx15zlBS.js";import"./checkbox-xsP6xrIs.js";
/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=e("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),K=[{value:"BASIC_PAY",label:"Basic Pay"},{value:"GRADE_PAY",label:"Grade Pay"},{value:"DA",label:"Dearness Allowance"},{value:"HRA",label:"House Rent Allowance"},{value:"TA",label:"Transport Allowance"},{value:"MA",label:"Medical Allowance"},{value:"WA",label:"Washing Allowance"},{value:"CA",label:"Conveyance Allowance"},{value:"OTHER_ALLOWANCE",label:"Other Allowance"},{value:"SPECIAL_ALLOWANCE",label:"Special Allowance"},{value:"NPS_EMPLOYER",label:"NPS Employer Contribution"},{value:"PF_EMPLOYER",label:"PF Employer Contribution"},{value:"ESI_EMPLOYER",label:"ESI Employer Contribution"},{value:"BONUS",label:"Bonus"},{value:"ARREAR",label:"Arrear"},{value:"LTC",label:"Leave Travel Concession"}],ee=[{value:"daily_wage",label:"Daily Wage"},{value:"contractual",label:"Contractual"},{value:"monthly",label:"Monthly (Regular)"}],ae=Y().shape({allowance_code:$().required("Allowance code is required"),allowance_name:$().required("Allowance name is required"),allowance_short_name:$().nullable(),financial_year:$().required("Financial year is required"),applicable_salary_modes:$().required("Salary mode is required"),display_order:D().required("Display order is required").min(1,"Display order must be at least 1"),is_taxable_new_regime:M().default(!0),is_taxable_old_regime:M().default(!0),exempt_limit_new_regime:D().default(0),exempt_limit_old_regime:D().default(0),group_name:$().nullable(),description:$().nullable(),is_active:M().default(!0)});function le({open:e,setOpen:o,title:d,id:c,edit:m,setEdit:x,refetch:u,currentFY:_,currentSalaryMode:p}){const h=F({}),{data:g,isFetching:j}=R({api:`${a.getAllowanceConfigs}?id=${l(String(c))}`,key:"getAllowanceConfigById",value:[c],options:{enabled:m&&null!==c}}),f=(null==g?void 0:g.data)&&g.data.length>0?g.data[0]:null,b=s.useMemo(()=>({allowance_code:(null==f?void 0:f.allowance_code)||"",allowance_name:(null==f?void 0:f.allowance_name)||"",allowance_short_name:(null==f?void 0:f.allowance_short_name)||"",financial_year:(null==f?void 0:f.financial_year)||_||"2025-26",applicable_salary_modes:(null==f?void 0:f.applicable_salary_modes)||p||"monthly",display_order:(null==f?void 0:f.display_order)||1,is_taxable_new_regime:(null==f?void 0:f.is_taxable_new_regime)??!0,is_taxable_old_regime:(null==f?void 0:f.is_taxable_old_regime)??!0,exempt_limit_new_regime:(null==f?void 0:f.exempt_limit_new_regime)||0,exempt_limit_old_regime:(null==f?void 0:f.exempt_limit_old_regime)||0,group_name:(null==f?void 0:f.group_name)||"Other Allowances",description:(null==f?void 0:f.description)||"",is_active:1===(null==f?void 0:f.status)}),[f,_,p]),v=L({defaultValues:b,resolver:P(ae)}),w=v.watch("is_taxable_new_regime"),y=v.watch("is_taxable_old_regime"),N=v.watch("allowance_code");s.useEffect(()=>{if(N&&!m){const e=K.find(e=>e.value===N);e&&v.setValue("allowance_name",e.label)}},[N,m,v]),s.useEffect(()=>{v.reset(b)},[b,v]);return i.jsx(W,{open:e,setOpen:o,title:d,setEdit:x,edit:m,isLoading:j,children:i.jsx(q,{methods:v,onSubmit:v.handleSubmit(async e=>{var l,s,i;try{const n=await h.mutateAsync({api:a.upsertAllowanceConfig,data:{...m&&c?{id:Number(c)}:{},allowance_code:e.allowance_code,allowance_name:e.allowance_name,allowance_short_name:e.allowance_short_name||null,financial_year:e.financial_year,applicable_salary_modes:e.applicable_salary_modes,display_order:e.display_order,is_taxable_new_regime:e.is_taxable_new_regime,is_taxable_old_regime:e.is_taxable_old_regime,exempt_limit_new_regime:e.is_taxable_new_regime?0:e.exempt_limit_new_regime,exempt_limit_old_regime:e.is_taxable_old_regime?0:e.exempt_limit_old_regime,group_name:e.group_name||"Other Allowances",description:e.description||null,status:e.is_active?1:0}});(null==(l=n.data)?void 0:l.success)?(t.success((null==(s=null==n?void 0:n.data)?void 0:s.message)||`Allowance configuration ${m?"updated":"created"} successfully`),o(!1),null==x||x(!1),null==u||u(),v.reset({allowance_code:"",allowance_name:"",allowance_short_name:"",financial_year:_||"2025-26",applicable_salary_modes:p||"monthly",display_order:1,is_taxable_new_regime:!0,is_taxable_old_regime:!0,exempt_limit_new_regime:0,exempt_limit_old_regime:0,group_name:"Other Allowances",description:"",is_active:!0})):t.error((null==(i=n.data)?void 0:i.message)||"Failed to save configuration")}catch(n){t.error(r(n))}}),children:i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-4",children:[i.jsx("div",{children:i.jsx(H,{name:"allowance_code",label:"Allowance Code",data:K.map(e=>({label:`${e.value} - ${e.label}`,value:e.value}))})}),i.jsx("div",{children:i.jsx(B,{name:"allowance_name",label:"Allowance Name",placeholder:"e.g., House Rent Allowance"})}),i.jsx("div",{children:i.jsx(B,{name:"allowance_short_name",label:"Short Name",placeholder:"e.g., HRA"})}),i.jsx("div",{children:i.jsx(H,{name:"financial_year",label:"Financial Year",data:n.map(e=>({label:e,value:e}))})}),i.jsx("div",{children:i.jsx(H,{name:"applicable_salary_modes",label:"Applicable Salary Modes",data:[{label:"All Modes",value:"all"},...ee.map(e=>({label:e.label,value:e.value}))]})}),i.jsx("div",{children:i.jsx(B,{name:"display_order",label:"Display Order",type:"number"})}),i.jsx("div",{children:i.jsx(B,{name:"group_name",label:"UI Group",placeholder:"e.g., Other Allowances"})}),i.jsx("div",{className:"flex items-end",children:i.jsx(V,{name:"is_active",label:"Active"})})]}),i.jsx(T,{}),i.jsxs("div",{children:[i.jsxs(z,{className:"flex items-center gap-2 text-base font-semibold",children:["Tax Configuration",i.jsx(G,{className:"h-4 w-4 text-muted-foreground"})]}),i.jsx("p",{className:"mb-4 mt-1 text-sm text-muted-foreground",children:"Configure how this allowance is treated for income tax under each regime"}),i.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[i.jsxs("div",{className:"rounded-lg border bg-blue-50/50 p-4 dark:bg-blue-950/20",children:[i.jsx(z,{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"New Tax Regime"}),i.jsxs("div",{className:"mt-3 space-y-3",children:[i.jsx(V,{name:"is_taxable_new_regime",label:"Fully Taxable"}),!w&&i.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2",children:[i.jsx(B,{name:"exempt_limit_new_regime",label:"Exemption Limit (₹)",type:"number",placeholder:"0 for fully exempt"}),i.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Amount exempt from tax. 0 = fully exempt."})]})]})]}),i.jsxs("div",{className:"rounded-lg border bg-amber-50/50 p-4 dark:bg-amber-950/20",children:[i.jsx(z,{className:"text-sm font-medium text-amber-700 dark:text-amber-300",children:"Old Tax Regime"}),i.jsxs("div",{className:"mt-3 space-y-3",children:[i.jsx(V,{name:"is_taxable_old_regime",label:"Fully Taxable"}),!y&&i.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2",children:[i.jsx(B,{name:"exempt_limit_old_regime",label:"Exemption Limit (₹)",type:"number",placeholder:"0 for fully exempt"}),i.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Amount exempt from tax. 0 = fully exempt."})]})]})]})]})]}),i.jsx(T,{}),i.jsx("div",{children:i.jsx(B,{name:"description",label:"Description (Optional)",placeholder:"Add notes about this allowance configuration"})}),i.jsx("div",{className:"flex justify-end",children:i.jsx(I,{type:"submit",isLoading:h.isPending,children:m?"Update Configuration":"Add Configuration"})})]})})})}function se(){var e,l,u,L,P,Y;const M=F({}),[$,D]=s.useState("2025-26"),[q,B]=s.useState("monthly"),[I,H]=s.useState(!1),[V,W]=s.useState(null),[z,K]=s.useState(!1),[ae,se]=s.useState(!1),[ie,ne]=s.useState(""),te=R({api:`${a.getAllowanceConfigs}?financial_year=${$}&salary_mode=${q}`,key:"getAllowanceConfigs",value:[$,q],options:{enabled:!0}}),re=()=>{K(!1),W(null),H(!0)},oe=e=>null==e?"No Limit":`₹${e.toLocaleString("en-IN")}`,de=({taxable:e,limit:a})=>i.jsx(d,{children:i.jsxs(c,{children:[i.jsx(m,{children:i.jsx("div",{className:"flex items-center gap-1",children:e?i.jsxs(U,{variant:"destructive",className:"flex items-center gap-1",children:[i.jsx(X,{className:"h-3 w-3"}),"Taxable"]}):i.jsxs(U,{variant:"default",className:"flex items-center gap-1 bg-green-600",children:[i.jsx(Z,{className:"h-3 w-3"}),"Exempt"]})})}),i.jsx(x,{children:e?"Fully taxable":`Exempt up to ${oe(a)}`})]})});return i.jsxs("main",{className:"grid items-start",children:[i.jsx(le,{open:I,setOpen:H,title:z?"Edit Allowance Configuration":"Add Allowance Configuration",id:V,edit:z,setEdit:K,refetch:te.refetch,currentFY:$,currentSalaryMode:q}),ae&&i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:()=>se(!1),children:i.jsxs(_,{className:"w-[400px]",onClick:e=>e.stopPropagation(),children:[i.jsxs(p,{children:[i.jsxs(h,{className:"flex items-center gap-2",children:[i.jsx(J,{className:"h-5 w-5"}),"Copy Configuration to New FY"]}),i.jsxs(g,{children:["This will copy all ",(null==(l=null==(e=te.data)?void 0:e.data)?void 0:l.length)||0," ","allowance configurations from FY ",$," to the selected target year."]})]}),i.jsxs(j,{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Target Financial Year"}),i.jsxs(A,{value:ie,onValueChange:ne,children:[i.jsx(C,{children:i.jsx(S,{placeholder:"Select target FY"})}),i.jsx(k,{children:n.filter(e=>e!==$).map(e=>i.jsx(E,{value:e,children:e},e))})]})]}),i.jsxs("div",{className:"flex justify-end gap-2",children:[i.jsx(o,{variant:"outline",onClick:()=>se(!1),children:"Cancel"}),i.jsx(o,{onClick:async()=>{var e;if(!ie)return void t.error("Please select a target financial year");const l=(null==(e=te.data)?void 0:e.data)||[];if(0!==l.length)try{for(const e of l)await M.mutateAsync({api:a.upsertAllowanceConfig,data:{allowance_code:e.allowance_code,allowance_name:e.allowance_name,allowance_short_name:e.allowance_short_name,financial_year:ie,applicable_salary_modes:e.applicable_salary_modes,display_order:e.display_order,is_taxable_new_regime:e.is_taxable_new_regime,is_taxable_old_regime:e.is_taxable_old_regime,exempt_limit_new_regime:e.exempt_limit_new_regime,exempt_limit_old_regime:e.exempt_limit_old_regime,description:e.description,group_name:e.group_name,status:e.status}});t.success(`Copied ${l.length} configurations to FY ${ie}`),se(!1),ne(""),te.refetch()}catch(s){t.error(r(s))}else t.error("No configurations to copy")},disabled:M.isPending,children:M.isPending?"Copying...":"Copy Configuration"})]})]})]})}),i.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[i.jsxs("div",{className:"flex w-full flex-wrap justify-between gap-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("label",{className:"whitespace-nowrap text-sm font-medium",children:"Financial Year:"}),i.jsxs(A,{value:$,onValueChange:D,children:[i.jsx(C,{className:"w-[140px]",children:i.jsx(S,{})}),i.jsx(k,{children:n.map(e=>i.jsx(E,{value:e,children:e},e))})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("label",{className:"whitespace-nowrap text-sm font-medium",children:"Salary Mode:"}),i.jsxs(A,{value:q,onValueChange:B,children:[i.jsx(C,{className:"w-[160px]",children:i.jsx(S,{})}),i.jsx(k,{children:ee.map(e=>i.jsx(E,{value:e.value,children:e.label},e.value))})]})]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(o,{variant:"outline",className:"flex items-center gap-2",onClick:()=>se(!0),disabled:!(null==(L=null==(u=te.data)?void 0:u.data)?void 0:L.length),children:[i.jsx(J,{className:"h-4 w-4"}),"Copy to New FY"]}),i.jsxs(o,{className:"flex items-center gap-2",onClick:re,children:[i.jsx(Q,{className:"h-4 w-4"}),"Add New"]})]})]}),i.jsx(T,{}),i.jsxs("div",{className:"flex items-start gap-2 rounded-lg border border-blue-200 bg-blue-50 p-3 dark:border-blue-800 dark:bg-blue-950",children:[i.jsx(G,{className:"mt-0.5 h-5 w-5 text-blue-600"}),i.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:[i.jsx("strong",{children:"Note:"})," These configurations define the tax treatment of each allowance under New and Old tax regimes. Changes here will affect income tax calculations for employees under this financial year."]})]}),i.jsxs(_,{children:[i.jsxs(p,{children:[i.jsxs(h,{className:"flex items-center gap-2",children:["Allowance Tax Configurations",i.jsx(U,{variant:"outline",children:$}),i.jsx(U,{variant:"secondary",children:null==(P=ee.find(e=>e.value===q))?void 0:P.label})]}),i.jsx(g,{children:"Configure taxability and exemption limits for each allowance type"})]}),i.jsx(j,{children:(null==te?void 0:te.isLoading)?i.jsx("div",{className:"flex items-center justify-center py-8",children:i.jsx(O,{})}):i.jsx("div",{className:"overflow-x-auto",children:i.jsxs(f,{children:[i.jsx(b,{children:i.jsxs(v,{children:[i.jsx(w,{className:"w-[50px]",children:"#"}),i.jsx(w,{children:"Allowance"}),i.jsx(w,{children:"Code"}),i.jsx(w,{className:"text-center",children:i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsx("span",{children:"New Regime"}),i.jsx("span",{className:"text-xs text-muted-foreground",children:"Tax Status"})]})}),i.jsx(w,{className:"text-center",children:i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsx("span",{children:"Old Regime"}),i.jsx("span",{className:"text-xs text-muted-foreground",children:"Tax Status"})]})}),i.jsx(w,{children:"Exemption (New)"}),i.jsx(w,{children:"Exemption (Old)"}),i.jsx(w,{children:"Status"}),i.jsx(w,{children:"Actions"})]})}),i.jsx(y,{children:(null==(Y=null==te?void 0:te.data)?void 0:Y.data)&&te.data.data.length>0?te.data.data.map((e,a)=>i.jsxs(v,{children:[i.jsx(N,{children:e.display_order||a+1}),i.jsx(N,{className:"font-medium",children:e.allowance_name}),i.jsx(N,{children:i.jsx("code",{className:"rounded bg-muted px-1 py-0.5 text-xs",children:e.allowance_code})}),i.jsx(N,{className:"text-center",children:i.jsx(de,{taxable:e.is_taxable_new_regime,limit:e.exempt_limit_new_regime})}),i.jsx(N,{className:"text-center",children:i.jsx(de,{taxable:e.is_taxable_old_regime,limit:e.exempt_limit_old_regime})}),i.jsx(N,{children:e.is_taxable_new_regime?i.jsx("span",{className:"text-muted-foreground",children:"N/A"}):oe(e.exempt_limit_new_regime)}),i.jsx(N,{children:e.is_taxable_old_regime?i.jsx("span",{className:"text-muted-foreground",children:"N/A"}):oe(e.exempt_limit_old_regime)}),i.jsx(N,{children:i.jsx("span",{className:"rounded-full px-3 py-1 text-xs font-semibold "+(1===e.status?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300"),children:1===e.status?"Active":"Inactive"})}),i.jsx(N,{children:i.jsx(o,{variant:"outline",size:"sm",onClick:()=>{return a=e.id,K(!0),W(a),void H(!0);var a},children:"Edit"})})]},e.id)):i.jsx(v,{children:i.jsx(N,{colSpan:9,className:"py-8 text-center",children:i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsxs("p",{className:"text-muted-foreground",children:["No configurations found for FY ",$," (",q,")"]}),i.jsx(o,{variant:"outline",size:"sm",onClick:re,children:"Add First Configuration"})]})})})})]})})})]})]})]})}function ie(){return i.jsx(u,{title:"Allowance Tax Configuration",subTitle:"Manage allowance tax rules by financial year and regime",children:i.jsx("div",{className:"py-12",children:i.jsx(se,{})})})}export{ie as default};
