import{h as N,e as L,r as x,j as e,z as R,B as U}from"./index-Df4ChAN-.js";import{P as J}from"./index-DjNjGvXo.js";import{h as f,C as O,a as w,b as G,c as I}from"./card-CW8LZ2r1.js";import{S as K,T as Q,a as W,b as k,c as l,d as X,e as m}from"./index-Tosm5l2v.js";import{u as z,b as F}from"./useCustomQuery-BBKf_waA.js";import{P as Z}from"./index-CRGyM8Pm.js";import{S as E,a as ee}from"./Spinner-CyN74T25.js";import{a as se,o as ae,c as re,b as Y,f as H}from"./yup-pPl0eVQc.js";import{F as te,B as ne}from"./datetime-picker-EqBIIAIP.js";import{R as S}from"./RHFTextField-C5PfVKXx.js";import{R as oe}from"./RHFTextArea-bqK8EsA9.js";import"./select-DZKz6XPY.js";import{D as ie}from"./index-D4JNSpYb.js";import{B as V}from"./badge-D696_yJG.js";import"./calendar-CMNTAmai.js";import"./clock-BxgzxCOp.js";import"./check-BzewUJFq.js";const ce=re().shape({pay_commission_id:H().nullable().typeError("Pay Commission must be a number").transform((i,c)=>c===""||c===null?null:i),da_percentage:H().typeError("DA Percentage must be a number").required("DA Percentage is required").min(0,"DA Percentage must be greater than or equal to 0").max(100,"DA Percentage cannot exceed 100"),effective_from:Y().required("Effective From date is required"),effective_to:Y().nullable().transform((i,c)=>c===""?null:i),government_order_no:Y().required("Government Order Number is required"),government_order_date:Y().required("Government Order Date is required"),description:Y().required("Description is required")});function de({open:i,setOpen:c,title:_,id:b,edit:n,setEdit:M,refetch:B}){var r,o;const y=z({}),{data:a,isFetching:q}=F({api:`${(r=N)==null?void 0:r.getDARevisionById}?id=${L(String(b))}`,key:"getDARevisionById",options:{enabled:!!b&&!!n}}),{data:T}=F({api:`${(o=N)==null?void 0:o.getAllPayCommissions}`,key:"getAllPayCommissions",options:{enabled:!0}}),A=x.useMemo(()=>{var d,p,h,u,g,j,v;return{pay_commission_id:((d=a==null?void 0:a.data)==null?void 0:d.pay_commission_id)||null,da_percentage:(p=a==null?void 0:a.data)!=null&&p.da_percentage?Number(a.data.da_percentage):0,effective_from:(h=a==null?void 0:a.data)!=null&&h.effective_from?f(a.data.effective_from).format("YYYY-MM-DD"):"",effective_to:(u=a==null?void 0:a.data)!=null&&u.effective_to?f(a.data.effective_to).format("YYYY-MM-DD"):null,government_order_no:((g=a==null?void 0:a.data)==null?void 0:g.government_order_no)||"",government_order_date:(j=a==null?void 0:a.data)!=null&&j.government_order_date?f(a.data.government_order_date).format("YYYY-MM-DD"):"",description:((v=a==null?void 0:a.data)==null?void 0:v.description)||""}},[a]),D=se({defaultValues:A,resolver:ae(ce)}),$=async d=>{var p,h,u,g,j,v,s,P;try{const C={...d,pay_commission_id:d.pay_commission_id||null,effective_to:d.effective_to||null};if(n&&b){const t=await y.mutateAsync({api:`${(p=N)==null?void 0:p.updateDARevision}`,data:{id:b,...C}});(h=t.data)!=null&&h.success?R.success((u=t==null?void 0:t.data)==null?void 0:u.message):R.error(((g=t.data)==null?void 0:g.message)||"DA Revision not updated successfully")}else{const t=await y.mutateAsync({api:(j=N)==null?void 0:j.createDARevision,data:C});(v=t.data)!=null&&v.success?R.success((s=t==null?void 0:t.data)==null?void 0:s.message):R.error(((P=t.data)==null?void 0:P.message)||"DA Revision not created successfully")}D.reset(),c(!1),M(!1),B()}catch(C){console.log(C)}};return x.useEffect(()=>{n&&a&&D.reset(A)},[A,n]),e.jsx(ie,{open:i,setOpen:c,title:_,setEdit:M,edit:n,isLoading:q,children:e.jsx(te,{methods:D,onSubmit:D.handleSubmit($),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Basic Information"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:e.jsx(S,{name:"da_percentage",label:"DA Percentage (%)",placeholder:"e.g., 50",type:"number",inputValidation:["decimal"]})})]}),e.jsx("div",{children:e.jsx(oe,{name:"description",label:"Description",placeholder:"Brief description of this DA revision...",inputValidation:["removeSpecialCharacterExceptSpace"]})})]}),e.jsx(E,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Effective Period"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{name:"effective_from",label:"Effective From",type:"date"}),e.jsx(S,{name:"effective_to",label:"Effective To (Optional)",type:"date"})]})]}),e.jsx(E,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Government Order Details"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{name:"government_order_no",label:"Government Order Number",placeholder:"e.g., DA/2025/001",inputValidation:["removeSpecialCharacterExceptSpace"]}),e.jsx(S,{name:"government_order_date",label:"Government Order Date",type:"date"})]})]}),e.jsx(E,{className:"my-6"}),e.jsx("div",{className:"pt-2",children:e.jsx(ne,{isLoading:D.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:n?"Update DA Revision":"Create DA Revision"})})]})})})}function le(){var d,p,h,u,g,j,v;z({});const[i,c]=x.useState(1),[_,b]=x.useState(10),[n,M]=x.useState(""),[B,y]=x.useState(!1),[a,q]=x.useState(""),[T,A]=x.useState(!1),[D,$]=x.useState(null),r=F({api:`${N.getAllDARevisions}?page=${i}&limit=${_}&q=${n}`,key:"getAllDARevisions",value:[i,_,n],options:{enabled:!0}}),{data:o}=F({api:`${(d=N)==null?void 0:d.getCurrentDA}`,key:"getCurrentDA",options:{enabled:!0}});return e.jsxs("main",{className:"grid items-start",children:[e.jsx(de,{open:B,setOpen:y,title:T?"Edit DA Revision":"Add DA Revision",id:a,edit:T,setEdit:A,refetch:r.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[(o==null?void 0:o.data)&&e.jsxs(O,{className:"border-primary/20 bg-primary/5",children:[e.jsx(w,{className:"px-7",children:e.jsx(G,{className:"text-lg font-semibold text-primary",children:"Current DA Rate"})}),e.jsx(I,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"DA Percentage"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[o.data.da_percentage,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Effective From"}),e.jsx("p",{className:"font-semibold",children:f(o.data.effective_from).format("DD-MM-YYYY")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Government Order No"}),e.jsx("p",{className:"font-semibold",children:o.data.government_order_no})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Order Date"}),e.jsx("p",{className:"font-semibold",children:f(o.data.government_order_date).format("DD-MM-YYYY")})]})]})})]}),e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(K,{search:n,setSearch:M,refetch:r.refetch,isFetching:r==null?void 0:r.isLoading})}),e.jsx("div",{children:e.jsx(U,{className:"flex items-center gap-2",onClick:()=>y(!0),children:"Update DA Revision"})})]}),e.jsxs(O,{children:[e.jsx(w,{className:"px-7",children:e.jsxs(G,{children:["DA Revision List (",((h=(p=r==null?void 0:r.data)==null?void 0:p.data)==null?void 0:h.length)||0,")"]})}),e.jsx(I,{children:r.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(ee,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(Q,{children:[e.jsx(W,{children:e.jsxs(k,{children:[e.jsx(l,{className:"",children:"#"}),e.jsx(l,{className:"",children:"DA Percentage"}),e.jsx(l,{className:"",children:"Effective From"}),e.jsx(l,{className:"",children:"Effective To"}),e.jsx(l,{className:"",children:"Government Order No"}),e.jsx(l,{className:"",children:"Order Date"}),e.jsx(l,{className:"",children:"Description"}),e.jsx(l,{className:"",children:"Created at"}),e.jsx(l,{className:"",children:"Status"})]})}),e.jsx(X,{children:(g=(u=r==null?void 0:r.data)==null?void 0:u.data)==null?void 0:g.map((s,P)=>e.jsxs(k,{children:[e.jsx(m,{children:P+1}),e.jsx(m,{children:e.jsxs(V,{variant:"default",className:"text-base font-semibold",children:[s==null?void 0:s.da_percentage,"%"]})}),e.jsx(m,{children:f(s==null?void 0:s.effective_from).format("DD-MM-YYYY")}),e.jsx(m,{children:s!=null&&s.effective_to?f(s==null?void 0:s.effective_to).format("DD-MM-YYYY"):"-"}),e.jsx(m,{children:s==null?void 0:s.government_order_no}),e.jsx(m,{children:f(s==null?void 0:s.government_order_date).format("DD-MM-YYYY")}),e.jsx(m,{className:"max-w-xs truncate",children:s==null?void 0:s.description}),e.jsx(m,{children:f(s==null?void 0:s.created_at).format("DD-MM-YYYY")}),e.jsx(m,{children:e.jsx(V,{variant:(s==null?void 0:s.status)===1?"default":"secondary",children:(s==null?void 0:s.status)===1?"Active":"Inactive"})})]},s==null?void 0:s.id))})]}),e.jsx(E,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(Z,{page:i,limit:_,totalPages:Math.ceil((((v=(j=r==null?void 0:r.data)==null?void 0:j.data)==null?void 0:v.length)||0)/_),setPage:c,setLimit:b})})]})})]})]})]})}function Me(){return e.jsx(J,{title:"DA Revision List",subTitle:"Manage all the DA Revisions here",children:e.jsx("div",{className:"py-12",children:e.jsx(le,{})})})}export{Me as default};
