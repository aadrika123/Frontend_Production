import{r as o,u as ee,m as se,A as n,a as d,j as s,b as te}from"./index-db227e36.js";import{u as le}from"./formik.esm-243b4d91.js";import{c as ae,a as x}from"./index.esm-d7f7d69e.js";import{a as w}from"./PowerupFunctions-c7a4e16f.js";import{B as re}from"./BarLoader-92cd05ea.js";import{B as oe}from"./BottomErrorCard-f7652267.js";import{T as ie}from"./Tabs-21137408.js";import"./hoist-non-react-statics.cjs-6b598447.js";function pe(){const[I,M]=o.useState(!1),[S,E]=o.useState(null),[F,i]=o.useState(!1),[f,_]=o.useState([]),[b,C]=o.useState([]),[g,A]=o.useState([]),[h,T]=o.useState([]);o.useState([]);const[y,P]=o.useState(),[ce,L]=o.useState(),[p,V]=o.useState(),{api_getActiveExamTermData:B,api_getactiveClassData:D,api_finance_year:O,api_section_group_map:$,api_markstabulationCrudStore:q,api_getMarksEntryData:ne,api_marksEntrySection:R}=te(),j=ee(),{id:N}=se(),G=ae({classId:x().required("Select Class"),sectionId:x().required("Select Section"),termId:x().required("Select Term"),admissionNo:x().required("Enter admission no")}),t=le({initialValues:{classId:"",sectionId:"",termId:"",admissionNo:"",isMainSubject:!0,isOptionalSubject:!1,fullMarks:"",passMarks:"",totalMarks:0,totalObtainedMarks:0,percentage:0,marks:[]},onSubmit:(e,l)=>{console.log("at submit ",e),J(e)},validationSchema:G}),J=e=>{console.log("wow",e),i(!0);let l,r,m={admissionNo:e==null?void 0:e.admissionNo,tabulation:e.marks.map(a=>({fy:a==null?void 0:a.fy_name,admissionNo:a==null?void 0:a.admissionNo,termId:a==null?void 0:a.termId,classId:a==null?void 0:a.classId,sectionId:a==null?void 0:a.sectionId,marksEntryId:a==null?void 0:a.marks_entry_id,obtainedMarks:a==null?void 0:a.obtMarks}))};l=q,r=m,n.post(l,r,d()).then(function(a){var u,v,k;console.log("view discount group master..",(u=a==null?void 0:a.data)==null?void 0:u.data),(v=a==null?void 0:a.data)!=null&&v.status?j("/marks-tabulation"):c(!0,`${(k=a==null?void 0:a.data)==null?void 0:k.message}`),i(!1)}).catch(function(a){console.log("==2 error list...",a),c(!0,"Error occured in submitting form."),i(!1)})},U=()=>{i(!0),n.post(O,{},d()).then(function(e){e!=null&&e.data?(console.log(e==null?void 0:e.data),_(e==null?void 0:e.data)):c(!0,"Error occured while fetching data."),i(!1)}).catch(function(e){console.log("==2 error list...",e),c(!0,"Error occured while fetching data."),i(!1)})},Y=()=>{i(!0),n.post(D,{},d()).then(function(e){e!=null&&e.data?(console.log(e==null?void 0:e.data),C(e==null?void 0:e.data.data)):c(!0,"Error occured while fetching data."),i(!1)}).catch(function(e){console.log("==2 error list...",e),c(!0,"Error occured while fetching data."),i(!1)})},H=e=>{i(!0),n.post($,{classId:e},d()).then(function(l){l!=null&&l.data?(console.log(l==null?void 0:l.data),A(l==null?void 0:l.data.data)):c(!0,"Error occured while fetching data."),i(!1)}).catch(function(l){console.log("==2 error list...",l),c(!0,"Error occured while fetching data."),i(!1)})},K=()=>{i(!0),n.post(B,{},d()).then(function(e){e!=null&&e.data?(console.log(e==null?void 0:e.data),T(e==null?void 0:e.data.data)):c(!0,"Error occured while fetching data."),i(!1)}).catch(function(e){console.log("==2 error list...",e),c(!0,"Error occured while fetching data."),i(!1)})};console.log(t.values.fy);const z=()=>{i(!0),n.post(R,{classId:t.values.classId,sectionId:t.values.sectionId},d()).then(function(e){var l,r,m,a;(l=e==null?void 0:e.data)!=null&&l.status?(console.log((r=e==null?void 0:e.data)==null?void 0:r.data),t.setFieldValue("marks",(m=e==null?void 0:e.data)==null?void 0:m.data.map(u=>({...u,obtMarks:0,classId:t.values.classId,sectionId:t.values.sectionId,termId:t.values.termId,admissionNo:t.values.admissionNo})))):c(!0,`${(a=e==null?void 0:e.data)==null?void 0:a.message}`),i(!1)}).catch(function(e){console.log("==2 error list...",e),c(!0,"Error occured while fetching data.")})},Q=()=>{let e=t.values.marks.reduce((l,r)=>l+(r==null?void 0:r.full_marks),0);P(e)},W=()=>{let e=t.values.marks.reduce((l,r)=>parseInt(l)+parseInt(r==null?void 0:r.obtMarks),0);console.log(e),V(e)},X=(e,l)=>{t.setFieldValue(`marks.${l}.obtMarks`,e),console.log(l,e,`marks.${l}.obtMarks`),L(l)};console.log(t.values.marks),o.useEffect(()=>{W()},[t.values.marks]),o.useEffect(()=>{Q()},[t.values.marks]),o.useEffect(()=>{t.setFieldValue("totalMarks",y)},[y]),o.useEffect(()=>{U(),Y(),K()},[]),o.useEffect(()=>{t.values.classId&&H(t.values.classId)},[t.values.classId]),o.useEffect(()=>{t.values.classId&&t.values.sectionId&&z()},[t.values.classId,t.values.sectionId]),o.useEffect(()=>{let e=(p/t.values.totalMarks*100).toFixed(2);t.setFieldValue("percentage",e)},[p,t.values.totalMarks]);const Z=e=>{let l=e.target.name,r=e.target.value;l=="fullMarks"&&t.setFieldValue("fullMarks",w(r.trim(),t.values.fullMarks,3)),l=="passMarks"&&t.setFieldValue("passMarks",w(r.trim(),t.values.passMarks,3))},c=(e,l)=>{E(l),M(e)};return s.jsx(s.Fragment,{children:s.jsx("div",{className:"main-div",children:s.jsxs("div",{className:"main-inner-div",children:[F&&s.jsx(re,{}),I&&s.jsx(oe,{activateBottomErrorCard:c,errorTitle:S}),s.jsxs("div",{className:"main-sub-div",children:[s.jsx("div",{className:"main-sub-inner-div",children:s.jsxs("div",{className:"text-div",children:[s.jsx("div",{className:"big-text",children:"Marks Tabulation Master Form"}),s.jsx("div",{className:"common-header-smalltext",children:"Unlock Your Potential. Join Our Journey Of Education And Excellence"})]})}),N===void 0?s.jsx("div",{className:"tab-div",children:s.jsx("div",{className:"add-button-master-div",children:s.jsxs("button",{onClick:()=>j("/marks-tabulation-form"),type:"submit",className:" add-button-master bg-[#0F766E] hover:[#0F766E]",children:["Add"," "]})})}):null]}),s.jsx(ie,{listRoute:"/marks-tabulation",formRoute:"/marks-tabulation-form"}),s.jsx("div",{className:"details-div",children:s.jsx("span",{className:"detailes text-[#0F766E]",children:"Marks Tabulation Form"})}),s.jsx("div",{className:"form-div",children:s.jsx("form",{onSubmit:t.handleSubmit,onChange:Z,children:s.jsxs("div",{className:"form",children:[s.jsxs("div",{className:"col-span-4 grid grid-cols-12",children:[s.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-2 md:pr-4 relative",children:[s.jsxs("label",{className:"form-label inline-block mb-1 text-teal-900 text-sm font-semibold",children:["Financial Year",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),s.jsx("select",{...t.getFieldProps("fy"),type:"number",className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 h-10 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Select class",children:f==null?void 0:f.map((e,l)=>s.jsx("option",{value:e==null?void 0:e.fy,children:e==null?void 0:e.fy}))}),s.jsx("span",{className:"text-red-600 absolute text-xs",children:t.touched.fy&&t.errors.fy?t.errors.fy:null})]}),s.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-2 md:pr-4",children:[s.jsxs("label",{className:"form-label inline-block mb-1 text-teal-900 text-sm font-semibold",children:["Term",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),s.jsxs("select",{...t.getFieldProps("termId"),type:"text",className:"form-control bg-white h-10 block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Select Discount Group",children:[s.jsx("option",{value:"",children:"Select"}),h==null?void 0:h.map((e,l)=>s.jsx("option",{value:e==null?void 0:e.id,children:e==null?void 0:e.term_name}))]}),s.jsx("span",{className:"text-red-600  text-xs",children:t.touched.termId&&t.errors.termId?t.errors.termId:null})]}),s.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-2 md:pr-4",children:[s.jsxs("label",{className:"form-label inline-block mb-1 text-teal-900 text-sm font-semibold",children:["Admission no",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),s.jsx("input",{...t.getFieldProps("admissionNo"),type:"text",className:"form-control h-10 block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md",placeholder:"Enter admission no"}),s.jsx("span",{className:"text-red-600 text-xs",children:t.touched.admissionNo&&t.errors.admissionNo?t.errors.admissionNo:null})]}),s.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-2 md:pr-4",children:[s.jsxs("label",{className:"form-label inline-block mb-1 text-teal-900 text-sm font-semibold",children:["Class",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),s.jsxs("select",{...t.getFieldProps("classId"),type:"number",className:"form-control bg-white h-10 block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Select Class",children:[s.jsx("option",{value:"",children:"Select"}),b==null?void 0:b.map((e,l)=>s.jsx("option",{value:e==null?void 0:e.id,children:e==null?void 0:e.class_name}))]}),s.jsx("span",{className:"text-red-600  text-xs",children:t.touched.classId&&t.errors.classId?t.errors.classId:null})]}),s.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-2 md:pr-4",children:[s.jsxs("label",{className:"form-label inline-block mb-1 text-teal-900 text-sm font-semibold",children:["Section",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),s.jsxs("select",{...t.getFieldProps("sectionId"),type:"text",className:"form-control bg-white h-10 block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Select Discount Group",children:[s.jsx("option",{value:"",children:"Select"}),g==null?void 0:g.map((e,l)=>s.jsx("option",{value:e==null?void 0:e.id,children:e==null?void 0:e.section_name}))]}),s.jsx("span",{className:"text-red-600  text-xs",children:t.touched.sectionId&&t.errors.sectionId?t.errors.sectionId:null})]})]}),t.values.classId!==""&&t.values.sectionId!==""?s.jsxs("div",{className:"col-span-12 mt-4 ",children:[s.jsx("div",{className:"overflow-x-auto shadow-lg border",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200 max-[820px]:w-[820px]",children:[s.jsx("thead",{className:"bg-[#E7EFFC] ",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Subject"}),s.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Full Marks"}),s.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Passing Marks"}),s.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Obtained Marks"})]})}),t.values.marks&&t.values.marks.map((e,l)=>s.jsx("tbody",{className:" divide-y divide-gray-200 ",children:s.jsxs("tr",{children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e==null?void 0:e.subject_name}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e==null?void 0:e.full_marks}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e==null?void 0:e.pass_marks}),s.jsx("td",{className:"px-6 py-3 whitespace-nowrap",children:s.jsx("input",{...t.getFieldProps(`marks.${l}.obtMarks`),onChange:r=>X(r.target.value,l),onKeyDown:r=>["e","E","+","-"].includes(r.key)&&r.preventDefault(),className:"  text-center form-control h-10  w-1/2 px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md",type:"number"})})]})}))]})}),s.jsxs("div",{className:"mt-9",children:[" ",s.jsx("div",{className:"flex justify-start",children:s.jsxs("div",{className:"w-full grid-cols-12 col-span-12 grid mt-1 max-[464px]:grid-cols-6",children:[s.jsx("div",{className:"form-group mb-6 col-span-5 md:pr-4 flex justify-start max-[464px]:col-span-6",children:s.jsxs("label",{className:"form-check-label text-gray-800 ml-2 w-full",children:[" ",s.jsxs("span",{className:"inline text-gray-700",children:["Total Marks",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]})]})})," ",s.jsxs("div",{className:"form-group mb-6 col-span-2 md:pr-4 flex max-[464px]:col-span-6",children:[s.jsx("input",{...t.getFieldProps("totalMarks"),type:"number",disabled:!0,className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md ",placeholder:"0"}),s.jsx("span",{className:"text-red-600 absolute text-xs",children:t.touched.totalMarks&&t.errors.totalMarks?t.errors.totalMarks:null})]})]})}),s.jsx("div",{className:"flex justify-start",children:s.jsxs("div",{className:"w-full grid-cols-12 col-span-12 grid mt-1 max-[464px]:grid-cols-6",children:[s.jsx("div",{className:"form-group mb-6 col-span-5 md:pr-4 flex justify-start max-[464px]:col-span-6",children:s.jsxs("label",{className:"form-check-label text-gray-800 ml-2 w-full",children:[" ",s.jsxs("span",{className:"inline text-gray-700",children:["Obtained marks",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]})]})})," ",s.jsxs("div",{className:"form-group mb-6 col-span-2 md:pr-4 flex max-[464px]:col-span-6",children:[s.jsx("input",{...t.getFieldProps("totalObtainedMarks"),type:"number",disabled:!0,value:p,className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md ",placeholder:"0"}),s.jsx("span",{className:"text-red-600 absolute text-xs",children:t.touched.feeAmount&&t.errors.feeAmount?t.errors.feeAmount:null})]})]})}),s.jsx("div",{className:"flex justify-start",children:s.jsxs("div",{className:"w-full grid-cols-12 col-span-12 grid mt-1 max-[464px]:grid-cols-6",children:[s.jsx("div",{className:"form-group mb-6 col-span-5 md:pr-4 flex justify-start max-[464px]:col-span-6",children:s.jsxs("label",{className:"form-check-label text-gray-800 ml-2 w-full",children:[" ",s.jsxs("span",{className:"inline text-gray-700",children:["Percentage",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]})]})})," ",s.jsxs("div",{className:"form-group mb-6 col-span-2 md:pr-4 flex max-[464px]:col-span-6",children:[s.jsx("input",{...t.getFieldProps("percentage"),type:"number",disabled:!0,className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md ",placeholder:"0"}),s.jsx("span",{className:"text-red-600 absolute text-xs",children:t.touched.feeAmount&&t.errors.feeAmount?t.errors.feeAmount:null})]})]})})]})]}):null,s.jsxs("div",{className:"cancel-button-div",children:[s.jsx("div",{className:"    ",children:s.jsx("button",{onClick:()=>j("/marks-tabulation"),type:"button",className:"deactivate-button-master bg-red-500 text-white py-3",children:"Back to List"})}),s.jsx("div",{className:"submit-button-div",children:s.jsx("button",{type:"submit",className:"save-button",children:N!==void 0?"Update":"Save"})})]})]})})})]})})})}export{pe as default};
