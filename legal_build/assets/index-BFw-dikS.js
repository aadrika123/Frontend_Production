import{r as p,h as _e,u as Te,l as E,j as e,B as f,C as ce,i as ke,k as Ae,_ as w}from"./index-D4-zsVsW.js";import{a as Ee}from"./index-DbW1RPEu.js";import{h as g,S as Me}from"./Spinner-xhVpV9me.js";import{F as Ye,B as c,X as j,u as C,w as $e}from"./badge-BXKA2_VC.js";import{C as ie,b as oe,d as de,a as xe,S as Be}from"./separator-XsFdslJq.js";import{T as Fe,a as Ie,b as O,c as d,d as Oe,e as i}from"./table-DpAR7sM9.js";import{I as U,S as he,a as me,b as ue,c as pe,d as b}from"./select-HkHWvX3H.js";import{D as Ue,L as D,S as He}from"./label-DFZYQZ_2.js";import{u as Re,a as ze,b as qe}from"./useCustomQuery-DPQCasXN.js";import{g as Ve}from"./services-KQnp_8oA.js";import{S as Je,P as Le}from"./index-CmYdYB0c.js";import{L as je}from"./loader-circle-D-CL5k0e.js";import{C as We}from"./chevron-down-D7S60iLQ.js";import{R as Xe,E as Ge}from"./refresh-cw-Dqsvi8nh.js";import{C as fe}from"./calendar-CwD_si5S.js";import{S as M}from"./scale-DMVrPmS3.js";import{q as Ke}from"./switch-CEiBeJmO.js";function Qe(){var W,X,G,K,Q,Z,ee,ae,se,te,re,ne;const H=Re({}),[P,Y]=p.useState(1),[S,ge]=p.useState(10),[u,$]=p.useState(""),[R,z]=p.useState(null),[B,q]=p.useState(!1),[F,V]=p.useState(!1),[s,J]=p.useState({processType:"",fromDate:"",toDate:"",caseNatureParam:"",caseNoParam:""}),L=_e(),{user:h}=Te(),I=ze({api:`${E.getAllCaseNature}`,key:"getAllCaseNature",value:[],options:{enabled:!0}}),t=qe({api:`${E.getCaseByUserList}`,key:"getCaseByUserList",config:{userId:h==null?void 0:h._id,page:P,limit:S,search:u,processType:s.processType,fromDate:s.fromDate,toDate:s.toDate,caseNatureParam:s.caseNatureParam,caseNoParam:s.caseNoParam},value:[P,S,u,s],options:{enabled:!0}}),Ne=async a=>{var o,l,v,k,y,m;z(a);try{const r=await H.mutateAsync({api:`${(o=E)==null?void 0:o.updateCaseNatureStatus}`,data:{id:a}});(l=r==null?void 0:r.data)!=null&&l.success?(t.refetch(),w[((k=(v=r==null?void 0:r.data)==null?void 0:v.data)==null?void 0:k.status)==1?"success":"error"]((y=r==null?void 0:r.data)==null?void 0:y.message)):w.error((m=r.data)==null?void 0:m.message)}catch(r){w.error(Ve(r))}finally{z(null)}},ve=a=>({1:"Pending",2:"Disposed",3:"Dismissed",4:"Close"})[a]||"Unknown",ye=a=>a==1?"Judge":a==2?"Advocate":a==0?"Case Operator":"Unknown",we=a=>{const l={1:{label:"Pending",variant:"secondary"},2:{label:"Disposed",variant:"outline"},3:{label:"Dismissed",variant:"destructive"},4:{label:"Close",variant:"success"}}[a]||{label:"Unknown",variant:"secondary"};return e.jsx(c,{variant:l.variant,children:l.label})};function Ce(a){return a==1?e.jsxs(c,{variant:"default",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Judge"]}):a==2?e.jsxs(c,{variant:"success",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Advocate"]}):a==0?e.jsxs(c,{variant:"destructive",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Case Operator"]}):e.jsx(c,{variant:"secondary",children:e.jsx(M,{className:"w-3 h-3 mr-1"})})}const _=a=>a?g(a).format("DD MMM YYYY"):"-",T=a=>a?g(a).isBefore(g(),"day"):!1,x=(a,o)=>{J(l=>({...l,[a]:o})),Y(1)},be=()=>{t.refetch()},De=()=>{J({processType:"",fromDate:"",toDate:"",caseNatureParam:"",caseNoParam:""}),$(""),Y(1),setTimeout(()=>{t.refetch()},100)},N=()=>{let a=0;return u.trim()&&a++,s.processType&&a++,s.fromDate&&a++,s.toDate&&a++,s.caseNatureParam.trim()&&a++,s.caseNoParam.trim()&&a++,a},Pe=async()=>{var a,o;q(!0);try{const l=await H.mutateAsync({api:`${E.getCaseByUserList}`,data:{userId:h==null?void 0:h._id,page:1,limit:1e3,search:u,processType:s.processType,fromDate:s.fromDate,toDate:s.toDate,caseNatureParam:s.caseNatureParam,caseNoParam:s.caseNoParam}}),v=((a=l==null?void 0:l.data)==null?void 0:a.data)||((o=t==null?void 0:t.data)==null?void 0:o.data)||[],k=v.map((n,A)=>({"S.No":A+1,"Case No":n.case_no||"","Filed On":_(n.filed_on),"Next Hearing":_(n.next_hearing_date),"Hearing Status":T(n.next_hearing_date)?"Overdue":"Scheduled",Petitioner:n.petitioner_name||"",Respondent:n.respondent||"-",Court:n.court_location||"","Current Status":ye(n.application_status),"Case Status":ve(n.case_status),"Active Status":n.status===1?"Active":"Inactive"})),y=C.book_new(),m=C.json_to_sheet(k),r=[{wch:6},{wch:18},{wch:12},{wch:12},{wch:12},{wch:25},{wch:25},{wch:20},{wch:15},{wch:15},{wch:12}];m["!cols"]=r;const le=C.decode_range(m["!ref"]||"A1");for(let n=le.s.c;n<=le.e.c;n++){const A=C.encode_cell({r:0,c:n});m[A]&&(m[A].s={font:{bold:!0},fill:{fgColor:{rgb:"E2E8F0"}}})}C.book_append_sheet(y,m,"Cases Export");const Se=`legal_cases_${(h==null?void 0:h.name)||"user"}_${g().format("YYYY-MM-DD_HH-mm-ss")}.xlsx`;$e(y,Se),w.success(`Successfully exported ${v.length} cases!`)}catch(l){console.error("Export error:",l),w.error("Failed to export data. Please try again.")}finally{q(!1)}};return e.jsx("main",{className:"grid items-start px-4 pb-8",children:e.jsxs("div",{className:"grid auto-rows-max gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(f,{onClick:Pe,disabled:B||t.isLoading,className:"flex items-center gap-2",variant:"outline",children:[B?e.jsx(je,{className:"h-4 w-4 animate-spin"}):e.jsx(Ue,{className:"h-4 w-4"}),B?"Exporting...":"Export to Excel"]}),e.jsx(ce,{open:F,onOpenChange:V,children:e.jsx(ke,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-4 w-4"}),"Filters",N()>0&&e.jsx(c,{variant:"secondary",className:"ml-1 h-5 w-5 rounded-full p-0 text-xs",children:N()}),e.jsx(We,{className:`h-4 w-4 transition-transform ${F?"rotate-180":""}`})]})})})]}),e.jsx(Je,{search:u,setSearch:$,refetch:t.refetch,isFetching:t==null?void 0:t.isLoading})]}),e.jsx(ce,{open:F,onOpenChange:V,children:e.jsx(Ae,{children:e.jsxs(ie,{className:"border-dashed shadow-sm",children:[e.jsx(oe,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(de,{children:"Filter cases by various criteria"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{onClick:be,size:"sm",className:"flex items-center gap-1",children:[e.jsx(Xe,{className:"h-3 w-3"}),"Apply Filters"]}),e.jsxs(f,{onClick:De,variant:"outline",size:"sm",className:"flex items-center gap-1",children:[e.jsx(j,{className:"h-3 w-3"}),"Clear All"]})]})]})}),e.jsxs(xe,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"caseNoParam",children:"Case No"}),e.jsx(U,{id:"caseNoParam",type:"text",placeholder:"Enter case number",value:s.caseNoParam,onChange:a=>x("caseNoParam",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"processType",children:"Process Type"}),e.jsxs(he,{value:s.processType||"all",onValueChange:a=>x("processType",a==="all"?"":a),children:[e.jsx(me,{children:e.jsx(ue,{placeholder:"Select process type"})}),e.jsxs(pe,{children:[e.jsx(b,{value:"all",children:"All Process Types"}),e.jsx(b,{value:"Internal",children:"Internal"}),e.jsx(b,{value:"External",children:"External"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"caseNatureParam",children:"Case Nature"}),e.jsxs(he,{value:s.caseNatureParam||"all",onValueChange:a=>x("caseNatureParam",a==="all"?"":a),children:[e.jsx(me,{children:e.jsx(ue,{placeholder:"Select Nature of Case"})}),e.jsxs(pe,{children:[e.jsx(b,{value:"all",children:"All Natures"}),(X=(W=I==null?void 0:I.data)==null?void 0:W.data)==null?void 0:X.map(a=>e.jsx(b,{value:a.id.toString(),children:a.case_nature},a.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"fromDate",children:"From Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{id:"fromDate",type:"date",value:s.fromDate,onChange:a=>x("fromDate",a.target.value),max:s.toDate||void 0}),e.jsx(fe,{className:"pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 transform text-gray-400"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"toDate",children:"To Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{id:"toDate",type:"date",value:s.toDate,onChange:a=>x("toDate",a.target.value),min:s.fromDate||void 0}),e.jsx(fe,{className:"pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 transform text-gray-400"})]})]})]}),N()>0&&e.jsx("div",{className:"mt-4 border-t pt-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Active filters:"}),u.trim()&&e.jsxs(c,{variant:"outline",className:"flex items-center gap-1",children:["Search: ",u,e.jsx(j,{className:"h-3 w-3 cursor-pointer",onClick:()=>$("")})]}),s.caseNoParam.trim()&&e.jsxs(c,{variant:"outline",className:"flex items-center gap-1",children:["Case No: ",s.caseNoParam,e.jsx(j,{className:"h-3 w-3 cursor-pointer",onClick:()=>x("caseNoParam","")})]}),s.processType&&e.jsxs(c,{variant:"outline",className:"flex items-center gap-1",children:["Process: ",s.processType,e.jsx(j,{className:"h-3 w-3 cursor-pointer",onClick:()=>x("processType","")})]}),s.caseNatureParam&&e.jsxs(c,{variant:"outline",className:"flex items-center gap-1",children:["Nature: ",s.caseNatureParam,e.jsx(j,{className:"h-3 w-3 cursor-pointer",onClick:()=>x("caseNatureParam","")})]}),s.fromDate&&e.jsxs(c,{variant:"outline",className:"flex items-center gap-1",children:["From: ",g(s.fromDate).format("DD/MM/YYYY"),e.jsx(j,{className:"h-3 w-3 cursor-pointer",onClick:()=>x("fromDate","")})]}),s.toDate&&e.jsxs(c,{variant:"outline",className:"flex items-center gap-1",children:["To: ",g(s.toDate).format("DD/MM/YYYY"),e.jsx(j,{className:"h-3 w-3 cursor-pointer",onClick:()=>x("toDate","")})]})]})})]})]})})}),e.jsxs(ie,{className:"shadow-md",children:[e.jsx(oe,{className:"px-6 pt-6 pb-2",children:e.jsxs(de,{children:["Showing ",((K=(G=t==null?void 0:t.data)==null?void 0:G.data)==null?void 0:K.length)||0," of ",((Z=(Q=t==null?void 0:t.data)==null?void 0:Q.pagination)==null?void 0:Z.total)||0," cases",N()>0&&e.jsx("span",{className:"text-blue-600",children:" (filtered)"})]})}),e.jsx(xe,{className:"overflow-x-auto px-6",children:t.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(Me,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(Fe,{children:[e.jsx(Ie,{children:e.jsxs(O,{children:[e.jsx(d,{children:"#"}),e.jsx(d,{children:"Case No"}),e.jsx(d,{children:"Filed On"}),e.jsx(d,{children:"Next Hearing"}),e.jsx(d,{children:"Petitioner"}),e.jsx(d,{children:"Respondent"}),e.jsx(d,{children:"Court"}),e.jsx(d,{children:"Current Status"}),e.jsx(d,{children:"Case Status"}),e.jsx(d,{children:"Status"}),e.jsx(d,{className:"text-right",children:"Actions"})]})}),e.jsx(Oe,{children:((ae=(ee=t==null?void 0:t.data)==null?void 0:ee.data)==null?void 0:ae.length)===0?e.jsx(O,{children:e.jsx(i,{colSpan:11,className:"text-center py-8 text-muted-foreground",children:N()>0?"No cases found matching the selected filters.":"No cases found."})}):(te=(se=t==null?void 0:t.data)==null?void 0:se.data)==null?void 0:te.map((a,o)=>e.jsxs(O,{className:T(a.next_hearing_date)?"bg-red-50":"",children:[e.jsx(i,{children:(P-1)*S+o+1}),e.jsx(i,{className:"font-medium font-mono text-sm",children:a.case_no}),e.jsx(i,{children:_(a.filed_on)}),e.jsx(i,{children:e.jsxs("div",{className:`${T(a.next_hearing_date)?"text-red-600 font-medium":""}`,children:[_(a.next_hearing_date),T(a.next_hearing_date)&&e.jsx(c,{variant:"destructive",className:"ml-1 text-xs",children:"Overdue"})]})}),e.jsx(i,{children:e.jsx("div",{className:"max-w-[150px] truncate",title:a.petitioner_name,children:a.petitioner_name})}),e.jsx(i,{children:e.jsx("div",{className:"max-w-[150px] truncate",title:a.respondent??void 0,children:a.respondent||"-"})}),e.jsx(i,{children:e.jsx("div",{className:"max-w-[120px] truncate",title:a.court_location,children:a.court_location})}),e.jsx(i,{children:Ce(a.application_status)}),e.jsx(i,{children:we(a.case_status)}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Ke,{checked:a.status===1,onChange:()=>Ne(String(a.id)),disabled:R===String(a.id),className:`${a.status===1?"bg-green-600":"bg-gray-300"} relative inline-flex h-6 w-11 items-center rounded-full transition`,children:[e.jsx("span",{className:"sr-only",children:"Toggle status"}),e.jsx("span",{className:`${a.status===1?"translate-x-6":"translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white transition`})]}),R===String(a.id)&&e.jsx(je,{className:"h-4 w-4 animate-spin text-primary"})]})}),e.jsx(i,{className:"text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:()=>L(`/legal/dashboard/case-view-details/${a.id}`),children:e.jsx(Ge,{className:"h-4 w-4"})}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>L(`/legal/dashboard/edit-case-details/${a.id}`),children:e.jsx(He,{className:"h-4 w-4"})})]})})]},a.id))})]}),e.jsx(Be,{className:"my-4"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(Le,{page:P,limit:S,totalPages:(ne=(re=t==null?void 0:t.data)==null?void 0:re.pagination)==null?void 0:ne.totalPages,setPage:Y,setLimit:ge})})]})})]})]})})}function ja(){return e.jsx(Ee,{title:"Case by User List",subTitle:"Manage all the Case here",children:e.jsx("div",{children:e.jsx(Qe,{})})})}export{ja as default};
