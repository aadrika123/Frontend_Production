import{r as h,h as Ce,u as ye,l as A,j as e,B as u,C as K,k as we,m as be,_ as Q}from"./index-DBpSE5A9.js";import{a as De}from"./index-C8LWQ-0W.js";import{h as j,S as Pe}from"./Spinner-DQWR8pzB.js";import{F as Se,B as d,X as p,u as g,w as _e}from"./badge-B09ti8Y_.js";import{C as Z,a as ee,d as ae,c as se,S as Te}from"./separator-CJQiIHTX.js";import{T as ke,a as Ae,b as E,c as i,d as Ee,e as l}from"./table-BO4fmPJL.js";import{I as M,S as te,a as re,b as le,c as ne,d as v}from"./select-Bx10t-m2.js";import{D as Me,L as C,S as Ye}from"./label-Di4A7MPO.js";import{u as Fe,a as Be,b as Ie}from"./useCustomQuery-C_Q9Q78w.js";import{S as Oe,P as $e}from"./index-DLI2xdEP.js";import{L as He}from"./loader-circle-CasYusl-.js";import{C as Re}from"./chevron-down-DlRRQZ_W.js";import{R as Ue}from"./refresh-cw-CPQ-v7Rn.js";import{C as ce}from"./calendar-vBvp6Gfp.js";import{E as ze}from"./eye-BmiYdLLd.js";import{S as Le}from"./scale-_F4COQ56.js";function Ve(){var O,$,H,R,U,z,L,V,J,q;const ie=Fe({}),[y,P]=h.useState(1),[w,oe]=h.useState(10),[m,S]=h.useState("");h.useState(null);const[_,Y]=h.useState(!1),[T,F]=h.useState(!0),[s,B]=h.useState({processType:"",fromDate:"",toDate:"",caseNatureParam:"",caseNoParam:""}),I=Ce(),{user:o}=ye(),k=Be({api:`${A.getAllCaseNature}`,key:"getAllCaseNature",value:[],options:{enabled:!0}}),t=Ie({api:`${A.getCaseByUserList}`,key:"getCaseByUserList",config:{userId:o==null?void 0:o._id,page:y,limit:w,search:m,processType:s.processType,fromDate:s.fromDate,toDate:s.toDate,caseNatureParam:s.caseNatureParam,caseNoParam:s.caseNoParam},value:[y,w,m,s],options:{enabled:!0}}),de=a=>({1:"Pending",2:"Disposed",3:"Dismissed",4:"Close"})[a]||"Unknown",xe=a=>a==1?"Judge":a==2?"Advocate":a==0?"Case Operator":"Unknown",me=a=>{const c={1:{label:"Pending",variant:"secondary"},2:{label:"Disposed",variant:"outline"},3:{label:"Dismissed",variant:"destructive"},4:{label:"Close",variant:"success"}}[a]||{label:"Unknown",variant:"secondary"};return e.jsx(d,{variant:c.variant,children:c.label})};function he(a){return a==1?e.jsx("h1",{className:"text-blue-600 font-bold",children:"Judge"}):a==2?e.jsx("h1",{className:"text-green-600 font-bold",children:"Advocate"}):a==0?e.jsx("h1",{className:"text-red-600 font-bold",children:"Case Operator"}):e.jsx(d,{variant:"secondary",children:e.jsx(Le,{className:"mr-1 h-3 w-3"})})}const b=a=>a?j(a).format("DD MMM YYYY"):"-",pe=a=>a?j(a).isBefore(j(),"day"):!1,n=(a,x)=>{B(c=>({...c,[a]:x})),P(1)},ue=()=>{t.refetch()},je=()=>{B({processType:"",fromDate:"",toDate:"",caseNatureParam:"",caseNoParam:""}),S(""),P(1),setTimeout(()=>{t.refetch()},100)},f=()=>{let a=0;return m.trim()&&a++,s.processType&&a++,s.fromDate&&a++,s.toDate&&a++,s.caseNatureParam.trim()&&a++,s.caseNoParam.trim()&&a++,a},fe=async()=>{var a,x;Y(!0);try{const c=await ie.mutateAsync({api:`${A.getCaseByUserList}`,data:{userId:o==null?void 0:o._id,page:1,limit:1e3,search:m,processType:s.processType,fromDate:s.fromDate,toDate:s.toDate,caseNatureParam:s.caseNatureParam,caseNoParam:s.caseNoParam}}),W=((a=c==null?void 0:c.data)==null?void 0:a.data)||((x=t==null?void 0:t.data)==null?void 0:x.data)||[],Ne=W.map((r,D)=>({"S.No":D+1,"Case No":r.case_no||"","Filed On":b(r.filed_on),"Next Hearing":b(r.next_hearing_date),"Hearing Status":pe(r.next_hearing_date)?"Overdue":"Scheduled",Petitioner:r.petitioner_name||"",Respondent:r.respondent||"-",Court:r.court_location||"","Current Status":xe(r.application_status),"Case Status":de(r.case_status),"Active Status":r.status===1?"Active":"Inactive"})),X=g.book_new(),N=g.json_to_sheet(Ne),ge=[{wch:6},{wch:18},{wch:12},{wch:12},{wch:12},{wch:25},{wch:25},{wch:20},{wch:15},{wch:15},{wch:12}];N["!cols"]=ge;const G=g.decode_range(N["!ref"]||"A1");for(let r=G.s.c;r<=G.e.c;r++){const D=g.encode_cell({r:0,c:r});N[D]&&(N[D].s={font:{bold:!0},fill:{fgColor:{rgb:"E2E8F0"}}})}g.book_append_sheet(X,N,"Cases Export");const ve=`legal_cases_${(o==null?void 0:o.name)||"user"}_${j().format("YYYY-MM-DD_HH-mm-ss")}.xlsx`;_e(X,ve),Q.success(`Successfully exported ${W.length} cases!`)}catch(c){console.error("Export error:",c),Q.error("Failed to export data. Please try again.")}finally{Y(!1)}};return e.jsx("main",{className:"grid items-start px-4 pb-8",children:e.jsxs("div",{className:"grid auto-rows-max gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(u,{onClick:fe,disabled:_||t.isLoading,className:"flex items-center gap-2",variant:"outline",children:[_?e.jsx(He,{className:"h-4 w-4 animate-spin"}):e.jsx(Me,{className:"h-4 w-4"}),_?"Exporting...":"Export to Excel"]}),e.jsx(K,{open:T,onOpenChange:F,children:e.jsx(we,{asChild:!0,children:e.jsxs(u,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"Filters",f()>0&&e.jsx(d,{variant:"secondary",className:"ml-1 h-5 w-5 rounded-full p-0 text-xs",children:f()}),e.jsx(Re,{className:`h-4 w-4 transition-transform ${T?"rotate-180":""}`})]})})})]}),e.jsx(Oe,{search:m,setSearch:S,refetch:t.refetch,isFetching:t==null?void 0:t.isLoading})]}),e.jsx(K,{open:T,onOpenChange:F,children:e.jsx(be,{children:e.jsxs(Z,{className:"border-dashed shadow-sm",children:[e.jsx(ee,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ae,{children:"Filter cases by various criteria"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{onClick:ue,size:"sm",className:"flex items-center gap-1",children:[e.jsx(Ue,{className:"h-3 w-3"}),"Apply Filters"]}),e.jsxs(u,{onClick:je,variant:"outline",size:"sm",className:"flex items-center gap-1",children:[e.jsx(p,{className:"h-3 w-3"}),"Clear All"]})]})]})}),e.jsxs(se,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"caseNoParam",children:"Case No"}),e.jsx(M,{id:"caseNoParam",type:"text",placeholder:"Enter case number",value:s.caseNoParam,onChange:a=>n("caseNoParam",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"processType",children:"Process Type"}),e.jsxs(te,{value:s.processType||"all",onValueChange:a=>n("processType",a==="all"?"":a),children:[e.jsx(re,{children:e.jsx(le,{placeholder:"Select process type"})}),e.jsxs(ne,{children:[e.jsx(v,{value:"all",children:"All Process Types"}),e.jsx(v,{value:"Internal",children:"Internal"}),e.jsx(v,{value:"External",children:"External"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"caseNatureParam",children:"Case Nature"}),e.jsxs(te,{value:s.caseNatureParam||"all",onValueChange:a=>n("caseNatureParam",a==="all"?"":a),children:[e.jsx(re,{children:e.jsx(le,{placeholder:"Select Nature of Case"})}),e.jsxs(ne,{children:[e.jsx(v,{value:"all",children:"All Natures"}),($=(O=k==null?void 0:k.data)==null?void 0:O.data)==null?void 0:$.map(a=>e.jsx(v,{value:a.id.toString(),children:a.case_nature},a.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"fromDate",children:"From Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{id:"fromDate",type:"date",value:s.fromDate,onChange:a=>n("fromDate",a.target.value),max:s.toDate||void 0}),e.jsx(ce,{className:"pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 transform text-gray-400"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"toDate",children:"To Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{id:"toDate",type:"date",value:s.toDate,onChange:a=>n("toDate",a.target.value),min:s.fromDate||void 0}),e.jsx(ce,{className:"pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 transform text-gray-400"})]})]})]}),f()>0&&e.jsx("div",{className:"mt-4 border-t pt-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Active filters:"}),m.trim()&&e.jsxs(d,{variant:"outline",className:"flex items-center gap-1",children:["Search: ",m,e.jsx(p,{className:"h-3 w-3 cursor-pointer",onClick:()=>S("")})]}),s.caseNoParam.trim()&&e.jsxs(d,{variant:"outline",className:"flex items-center gap-1",children:["Case No: ",s.caseNoParam,e.jsx(p,{className:"h-3 w-3 cursor-pointer",onClick:()=>n("caseNoParam","")})]}),s.processType&&e.jsxs(d,{variant:"outline",className:"flex items-center gap-1",children:["Process: ",s.processType,e.jsx(p,{className:"h-3 w-3 cursor-pointer",onClick:()=>n("processType","")})]}),s.caseNatureParam&&e.jsxs(d,{variant:"outline",className:"flex items-center gap-1",children:["Nature: ",s.caseNatureParam,e.jsx(p,{className:"h-3 w-3 cursor-pointer",onClick:()=>n("caseNatureParam","")})]}),s.fromDate&&e.jsxs(d,{variant:"outline",className:"flex items-center gap-1",children:["From: ",j(s.fromDate).format("DD/MM/YYYY"),e.jsx(p,{className:"h-3 w-3 cursor-pointer",onClick:()=>n("fromDate","")})]}),s.toDate&&e.jsxs(d,{variant:"outline",className:"flex items-center gap-1",children:["To: ",j(s.toDate).format("DD/MM/YYYY"),e.jsx(p,{className:"h-3 w-3 cursor-pointer",onClick:()=>n("toDate","")})]})]})})]})]})})}),e.jsxs(Z,{className:"shadow-md",children:[e.jsx(ee,{className:"px-6 pt-6 pb-2",children:e.jsxs(ae,{children:["Total ",((R=(H=t==null?void 0:t.data)==null?void 0:H.data)==null?void 0:R.length)||0," cases",f()>0&&e.jsx("span",{className:"text-blue-600",children:" (filtered)"})]})}),e.jsx(se,{className:"overflow-x-auto px-6",children:t.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(Pe,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(ke,{children:[e.jsx(Ae,{children:e.jsxs(E,{children:[e.jsx(i,{children:"#"}),e.jsx(i,{children:"Case No"}),e.jsx(i,{children:"Filed On"}),e.jsx(i,{children:"Next Hearing"}),e.jsx(i,{children:"Petitioner"}),e.jsx(i,{children:"Respondent"}),e.jsx(i,{children:"Court"}),e.jsx(i,{children:"Current Status"}),e.jsx(i,{children:"Case Status"}),e.jsx(i,{className:"text-right",children:"Actions"})]})}),e.jsx(Ee,{children:((z=(U=t==null?void 0:t.data)==null?void 0:U.data)==null?void 0:z.length)===0?e.jsx(E,{children:e.jsx(l,{colSpan:11,className:"text-center py-8 text-muted-foreground",children:f()>0?"No cases found matching the selected filters.":"No cases found."})}):(V=(L=t==null?void 0:t.data)==null?void 0:L.data)==null?void 0:V.map((a,x)=>e.jsxs(E,{children:[e.jsx(l,{children:(y-1)*w+x+1}),e.jsx(l,{className:"font-medium font-mono text-sm",children:a.case_no}),e.jsx(l,{children:b(a.filed_on)}),e.jsx(l,{children:e.jsx("div",{className:"font-semibold",children:b(a.next_hearing_date)})}),e.jsx(l,{children:e.jsx("div",{className:"max-w-[150px] truncate",title:a.petitioner_name,children:a.petitioner_name})}),e.jsx(l,{children:e.jsx("div",{className:"max-w-[150px] truncate",title:a.respondent??void 0,children:a.respondent||"-"})}),e.jsx(l,{children:e.jsx("div",{className:"max-w-[120px] truncate",title:a.court_location,children:a.court_location})}),e.jsx(l,{children:he(a.application_status)}),e.jsx(l,{children:me(a.case_status)}),e.jsx(l,{className:"text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(u,{size:"sm",variant:"outline",onClick:()=>I(`/legal/dashboard/case-view-details/${a.id}`),children:e.jsx(ze,{className:"h-4 w-4"})}),e.jsx(u,{size:"sm",variant:"outline",onClick:()=>I(`/legal/dashboard/edit-case-details/${a.id}`),children:e.jsx(Ye,{className:"h-4 w-4"})})]})})]},a.id))})]}),e.jsx(Te,{className:"my-4"}),e.jsx("div",{className:"flex justify-end",children:e.jsx($e,{page:y,limit:w,totalPages:(q=(J=t==null?void 0:t.data)==null?void 0:J.pagination)==null?void 0:q.totalPages,setPage:P,setLimit:oe})})]})})]})]})})}function ia(){return e.jsx(De,{title:"Case by User List",subTitle:"Manage all the Case here",children:e.jsx("div",{children:e.jsx(Ve,{})})})}export{ia as default};
