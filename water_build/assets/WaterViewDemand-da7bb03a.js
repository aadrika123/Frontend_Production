import{r as d,k as K,w as Q,u as X,W as Z,n as F,o as ee,p as I,q as te,a,F as U,j as e,B as re,V as g,$ as se,f}from"./index-2ec607eb.js";import{h as i}from"./moment-fbc5633a.js";import{u as ae}from"./useSetTitle-ea2c1129.js";import{W as le}from"./WaterTopButtons-cabd5c53.js";function me(ne){var N,p,b,u,y,v,w,_,M,A,R,Y,D,S;const[k,m]=d.useState(!1),[r,C]=d.useState(),[s,P]=d.useState(),[T,E]=d.useState(),[W,L]=d.useState(0),{notify:x}=d.useContext(K),{id:c}=Q(),G=X();ae("Water Consumer Demand Details");const{api_waterApprovedApplicationDetails:$,api_waterListDemand:B,api_waterGenerateDemand:V,header:h}=Z(),q=t=>{const n={consumerId:c,demandUpto:t.demandUpto,finalRading:t.meterReading,meterImage:t.meterImage};console.log("Final Payload of Meter Reading",n),f.post(V,n,h).then(o=>{o.data.status?(L(J=>J+1),console.log("Demand Generate Date Saved",o),x("Demand Generated","success")):(x("Error in Demand Generated","error"),console.log("Error Demand Generate",o))}).catch(o=>{x("Something went wrong!","error"),console.log("Exception While going to generate Demand",o)})},j=F({meterReading:ee().required("Enter Meter Reading").min(((N=s==null?void 0:s.meterDetails)==null?void 0:N.final_meter_reading)+1,`Reading must be greater previous ${(p=s==null?void 0:s.meterDetails)==null?void 0:p.final_meter_reading}`),demandUpto:I().required("Select Upto Data"),meterImage:I().required("Select Image")}),l=te({enableReinitialize:!0,initialValues:{demandUpto:"",meterReading:"",meterImage:T},onSubmit:(t,{resetForm:n})=>{n(),q(t)},validationSchema:j}),z=t=>{let n=t.target.name,o=t.target.value;n=="meterReading"&&l.setFieldValue("meterReading",se(o,l.values.meterReading,20)),n=="meterImage"&&E(t.currentTarget.files[0])},H=()=>{m(!0),f.post($,{id:c},h).then(function(t){console.log("water Approved Application Details",t.data.data),C(t.data.data),m(!1)}).catch(function(t){console.log("Error : water Approved Application Details",t),m(!1)})},O=()=>{f.post(B,{ConsumerId:c},h).then(t=>{console.log("Fetched Water Demand List",t.data.data),P(t.data.data)}).catch(t=>{console.log("Exception while fetching Water Demand",t)})};return d.useEffect(()=>{O(),H()},[c,W]),a(U,{children:[k&&e(re,{}),e(le,{active:"demand",consumerNo:r==null?void 0:r.consumer_no}),e("div",{className:"grid grid-cols-1 md:grid-cols-12 lg:grid-cols-12 gap-2 container mx-auto w-full",children:e("div",{className:"col-span-12 rounded-lg p-4",children:a("div",{className:"p-4",children:[a("div",{className:"",children:[a("h1",{className:"px-1 font-semibold font-serif  text-gray-500",children:[e(g,{className:"inline"})," Basic Details"]}),e("div",{className:"py-6 mt-2 bg-white rounded-lg shadow-xl p-4",children:a("div",{className:"flex space-x-5 pl-4 ",children:[a("div",{className:"flex-1",children:[e("div",{className:"font-semibold text-sm",children:r!=null&&r.ulb_name?r==null?void 0:r.ulb_name:"N/A"}),e("div",{className:"text-gray-500 text-xs",children:"ULB Name"})]}),a("div",{className:"flex-1",children:[e("div",{className:"font-bold text-sm",children:r!=null&&r.ward_name?r==null?void 0:r.ward_name:"N/A"}),e("div",{className:"text-gray-500 text-xs",children:"Ward No."})]}),a("div",{className:"flex-1",children:[e("div",{className:"font-bold text-sm",children:r!=null&&r.consumer_no?r==null?void 0:r.consumer_no:"N/A"}),e("div",{className:"text-gray-500 text-xs",children:"Consumer No"})]}),a("div",{className:"flex-1",children:[e("div",{className:"font-bold text-sm",children:r!=null&&r.connection_through?r==null?void 0:r.connection_through:"N/A"}),e("div",{className:"text-gray-500 text-xs",children:"Connection Through"})]}),(r==null?void 0:r.connection_through)=="SAF"?a("div",{className:"flex-1",children:[e("div",{className:"font-semibold text-md",children:r!=null&&r.saf_no?r==null?void 0:r.saf_no:"N/A"}),e("div",{className:"text-gray-500 text-xs",children:"SAF No"})]}):a("div",{className:"flex-1",children:[e("div",{className:"font-semibold text-md",children:r!=null&&r.holding_no?r==null?void 0:r.holding_no:"N/A"}),e("div",{className:"text-gray-500 text-xs",children:"Holding No"})]}),a("div",{className:"flex-1",children:[e("div",{className:"font-semibold text-md",children:r!=null&&r.owner_char_type?r==null?void 0:r.owner_char_type:"N/A"}),e("div",{className:"text-gray-500 text-xs",children:"Ownership Type"})]})]})})]}),((b=s==null?void 0:s.consumerDemands)==null?void 0:b.length)!=0?a("div",{children:[a("div",{className:"flex flex-wrap w-full space-x-0 my-5",children:[a("div",{className:"grow",children:[e("span",{className:"text-sm",children:"Total Dues :"})," ",a("span",{className:"font-semibold text-gray-700 text-lg",children:["₹ ",s==null?void 0:s.totalSumDemand]})]}),a("div",{className:"grow",children:[e("span",{className:"text-sm",children:"Due From :"})," ",a("span",{className:"font-semibold text-gray-700 text-lg",children:[i((u=s==null?void 0:s.consumerDemands[0])==null?void 0:u.demand_from,"YYYY-MM-DD").format("DD-MMM-yy")," "]})]}),a("div",{className:"grow",children:[e("span",{className:"text-sm",children:"Due Upto :"})," ",a("span",{className:"font-semibold text-gray-700 text-lg",children:[i((v=(y=s==null?void 0:s.consumerDemands)==null?void 0:y.at(-1))==null?void 0:v.demand_upto,"YYYY-MM-DD").format("DD-MMM-yy")," "]})]}),a("div",{className:"grow",children:[e("span",{className:"text-sm",children:"Total Due Months :"})," ",e("span",{className:"font-semibold text-gray-700 text-lg",children:(w=s==null?void 0:s.consumerDemands)==null?void 0:w.length})]})]}),((_=s==null?void 0:s.consumerDemands)==null?void 0:_.length)!=0&&a("div",{className:"mt-6 mx-3 flex space-x-8",children:[a("div",{className:"float-left flex space-x-8",children:[e("p",{className:"text-gray-600 text-xl font-semibold",children:"Total Payable Amount"}),a("p",{className:"text-black text-2xl font-semibold",children:["₹ ",s==null?void 0:s.totalSumDemand]})]}),e("div",{className:"float-right",children:e("button",{onClick:()=>G(`//water-demand-payment/${c}`),className:"bg-indigo-700 hover:bg-indigo-600 px-4 py-2 rounded shadow-2xl text-white text-sm",children:"Pay Demand"})})]}),e("br",{}),a("div",{className:"mt-5",children:[a("h1",{className:"px-1 font-semibold font-serif text-gray-500",children:[e(g,{className:"inline"})," Demand Details"]}),a("table",{className:"min-w-full leading-normal mt-2 bg-white rounded-lg shadow-xl p-4",children:[e("thead",{className:"font-bold text-left text-sm border text-gray-800 bg-white",children:a("tr",{children:[e("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:"#"}),e("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:"Demand From"}),e("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:"Demand Upto"}),e("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:"Demand Amount"}),e("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:"Penalty"}),e("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:"Connection Type"}),e("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:"Payable Amount "})]})}),e("tbody",{className:"text-sm",children:e(U,{children:(M=s==null?void 0:s.consumerDemands)==null?void 0:M.map((t,n)=>a("tr",{className:"bg-white shadow-xl border-b border-gray-200",children:[e("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:n+1}),e("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:t!=null&&t.demand_from?i(t==null?void 0:t.demand_from,"YYYY-MM-DD").format("DD-MMM-yy"):"N/A"}),e("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:t!=null&&t.demand_upto?i(t==null?void 0:t.demand_upto,"YYYY-MM-DD").format("DD-MMM-yy"):"N/A"}),e("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:t!=null&&t.balance_amount?t==null?void 0:t.balance_amount:"N/A"}),e("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:t!=null&&t.penalty?t==null?void 0:t.penalty:"N/A"}),e("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:t!=null&&t.connection_type?t==null?void 0:t.connection_type:"N/A"}),e("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:t!=null&&t.amount?"₹ "+(t==null?void 0:t.amount):"N/A"})]}))})})]})]})]}):e("div",{className:"w-full mt-20 text-center",children:e("span",{className:"text-3xl text-red-500 border border-red-500 font-semibold px-4 py-2",children:"No Dues Found !"})}),a("div",{className:"mt-5",children:[a("h1",{className:"px-1 font-semibold font-serif  text-gray-500",children:[e(g,{className:"inline"})," Meter/Fixed Connection Details"]}),e("div",{className:"py-6 mt-2 bg-white rounded-lg shadow-xl p-4",children:a("div",{className:"flex space-x-5 pl-4 ",children:[a("div",{className:"flex-1",children:[e("div",{className:"font-semibold text-sm",children:(A=s==null?void 0:s.meterDetails)==null?void 0:A.connectionName}),e("div",{className:"text-gray-500 text-xs",children:"Connection Type"})]}),a("div",{className:"flex-1",children:[e("div",{className:"font-bold text-sm",children:(R=s==null?void 0:s.meterDetails)==null?void 0:R.meter_no}),e("div",{className:"text-gray-500 text-xs",children:"Meter No."})]}),a("div",{className:"flex-1",children:[e("div",{className:"font-bold text-sm",children:(Y=s==null?void 0:s.meterDetails)!=null&&Y.final_meter_reading?(D=s==null?void 0:s.meterDetails)==null?void 0:D.final_meter_reading:"N/A"}),e("div",{className:"text-gray-500 text-xs",children:"Last Meter Reading"})]}),a("div",{className:"flex-1",children:[a("div",{className:"font-semibold text-md",children:[i((S=s==null?void 0:s.meterDetails)==null?void 0:S.connection_date,"YYYY-MM-DD").format("DD-MMM-yy")," "]}),e("div",{className:"text-gray-500 text-xs",children:"Meter Connection Date"})]})]})}),e("div",{className:"py-6 mt-2 bg-white rounded-lg shadow-xl p-4",children:a("form",{onSubmit:l.handleSubmit,onChange:z,className:"p-4 relative",children:[a("div",{className:"flex space-x-5 pl-4 ",children:[e("div",{className:"flex-1",children:a("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[a("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:["Upload Meter Image ",e("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),e("input",{...l.getFieldProps("meterImage"),name:"meterImage",type:"file",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Enter Meter Reading"}),e("span",{className:"text-red-600 absolute text-xs",children:l.touched.meterImage&&l.errors.meterImage?l.errors.meterImage:null})]})}),e("div",{className:"flex-1",children:a("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[a("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:["Final Meter Reading ",e("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),e("input",{...l.getFieldProps("meterReading"),type:"text",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Enter Meter Reading"}),e("span",{className:"text-red-600 absolute text-xs",children:l.touched.meterReading&&l.errors.meterReading?l.errors.meterReading:null})]})}),e("div",{className:"flex-1",children:a("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[a("label",{className:"form-label inline-block mb-1 text-gray-900 text-sm font-semibold",children:["Demand Upto Date ",e("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),e("input",{...l.getFieldProps("demandUpto"),type:"date",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer"}),e("span",{className:"text-red-600 absolute text-xs",children:l.touched.demandUpto&&l.errors.demandUpto?l.errors.demandUpto:null})]})})]}),e("div",{className:"pl-8",children:e("button",{type:"submit",className:"bg-indigo-700 px-3 py-2 text-white rounded",children:"Generate Demand"})})]})})]}),e("div",{className:"mt-6",children:" "})]})})}),e("div",{className:"w-full h-60"})]})}export{me as default};
