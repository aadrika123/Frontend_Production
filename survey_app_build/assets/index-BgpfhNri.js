import{r as e,G as a,u as r,y as t,j as s,A as o,z as i}from"./vendor-DjMFFVJ_.js";import{c as d,b as l,a as n}from"./yup-BKjcD2fq.js";import{F as u,R as c,B as p}from"./datetime-picker-BQTbIkUG.js";import{a as m,R as g,b as v,r as h}from"./RHFUploadFiled-DbVd-CTQ.js";import"./select-B91RhF2U.js";import{g as x,a as y}from"./useMasters-BU9ErDsq.js";import{b,s as j}from"./index-C_-xi6VH.js";import{u as w,b as f}from"./useCustomQuery-BYW9vxGB.js";import"./ui-DVYpEl0w.js";import"./icons-s52UKVCb.js";import"./query-oBe9rdp7.js";import"./axios-Dos3PyFQ.js";import"./zustand-DfVD2jvE.js";const k=d({tagId:n().required("Tag ID is required"),ownerName:n().required("Owner Name is required"),address:n().required("Address is required"),wardNo:n().required("Ward No. is required"),zone:n().required("Zone is required"),propertyType:n().required("Property type is required"),usageType:n().required("Usage type is required"),wasteType:n().required("Type of waste is required"),binsAvailable:n().required("Availability of bins is required"),latitude:n().required("Latitude is required"),longitude:n().required("Longitude is required"),frontViewPhoto:l().nullable()}),N=({number:a,title:r,icon:t,children:o,defaultOpen:i=!0})=>{const[d,l]=e.useState(i);return s.jsxs("div",{className:"mb-4 overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-sm dark:border-gray-700 dark:bg-gray-900",children:[s.jsxs("button",{type:"button",onClick:()=>l(!d),className:"flex w-full items-center justify-between bg-gradient-to-r from-emerald-50 to-teal-50 px-5 py-4 dark:from-emerald-900/20 dark:to-teal-900/20",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-emerald-500 to-teal-600 text-white shadow-md",children:t}),s.jsxs("div",{className:"text-left",children:[s.jsxs("p",{className:"text-xs font-medium uppercase tracking-wide text-emerald-600 dark:text-emerald-400",children:["Section ",a]}),s.jsx("h2",{className:"text-base font-bold text-gray-800 dark:text-gray-200",children:r})]})]}),s.jsx("svg",{className:"h-5 w-5 transform text-gray-500 transition-transform duration-300 "+(d?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),s.jsx("div",{className:"transition-all duration-300 ease-in-out "+(d?"max-h-[2000px] opacity-100":"max-h-0 overflow-hidden opacity-0"),children:s.jsx("div",{className:"space-y-4 p-5",children:o})})]})};function S(){var d,l,n,S,L,W,q,M,_,T,z,A,C,B;const V=w({}),[P,F]=e.useState(!1),[H]=a(),{user:I}=b(),R=r(),E=x(Number(null==I?void 0:I._id)),D=y(),G=H.get("id"),U=f({api:`${null==(d=j)?void 0:d.getSwmSurveyById}/${G}`,key:"swm-survey-edit-data",value:[G],options:{enabled:!!G}}),O=e.useMemo(()=>{var e;if(null==(e=null==U?void 0:U.data)?void 0:e.data){const e=U.data.data;return{tagId:e.tag_id||"",ownerName:e.owner_name||"",address:e.address||"",wardNo:String(e.ward_no)||"",zone:String(e.zone)||"",propertyType:String(e.property_type)||"",usageType:String(e.usage_type)||"",wasteType:e.waste_type||"",binsAvailable:e.bins_available?"yes":"no",latitude:e.latitude||"",longitude:e.longitude||"",frontViewPhoto:null}}return{tagId:"",ownerName:"",address:"",wardNo:"",zone:"",propertyType:"",usageType:"",wasteType:"",binsAvailable:"",latitude:"",longitude:"",frontViewPhoto:null}},[null==(l=null==U?void 0:U.data)?void 0:l.data]),$=t({defaultValues:O,resolver:o(k)});e.useEffect(()=>{var e;(null==(e=null==U?void 0:U.data)?void 0:e.data)&&$.reset(O)},[null==(n=null==U?void 0:U.data)?void 0:n.data,$,O]),e.useEffect(()=>{const e=H.get("idHex");e&&$.setValue("tagId",e)},[H,$]);return s.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-gray-100 dark:from-gray-950 dark:to-gray-900",children:[s.jsx("header",{className:"sticky top-0 z-20 border-b border-gray-200 bg-white/95 shadow-sm backdrop-blur-sm dark:border-gray-800 dark:bg-gray-900/95",children:s.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[s.jsx("button",{onClick:()=>R(-1),className:"flex h-10 w-10 items-center justify-center rounded-xl bg-gray-100 text-gray-600 transition-colors hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-300",children:s.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-xl bg-gradient-to-br from-emerald-500 to-teal-600 shadow-lg",children:s.jsx("svg",{className:"h-6 w-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-lg font-bold text-gray-900 dark:text-white",children:G?"Edit SWM Survey":"SWM Survey"}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Solid Waste Management"})]})]})]})}),s.jsx("main",{className:"pb-28",children:s.jsxs(u,{methods:$,onSubmit:$.handleSubmit(async e=>{var a,r;try{const t=new FormData;if(t.append("tag_id",e.tagId),t.append("owner_name",e.ownerName),t.append("address",e.address),t.append("ward_no",e.wardNo),t.append("zone",e.zone),t.append("property_type",e.propertyType),t.append("usage_type",e.usageType),t.append("waste_type",e.wasteType),t.append("bins_available","yes"===e.binsAvailable?"true":"false"),t.append("latitude",e.latitude),t.append("longitude",e.longitude),e.frontViewPhoto&&t.append("front_view_photo",e.frontViewPhoto),G){t.append("id",String(G));const e=await V.mutateAsync({api:j.updateSwmSurvey,data:t});(null==(a=null==e?void 0:e.data)?void 0:a.status)?(i.success("SWM Survey updated successfully"),R("/survey-app/dashboard/swm-survey-list")):i.error("Failed to update survey")}else{const e=await V.mutateAsync({api:j.createSwmSurvey,data:t});(null==(r=null==e?void 0:e.data)?void 0:r.status)?(i.success("SWM Survey submitted successfully"),R("/survey-app/dashboard/swm-survey-list")):i.error("Failed to submit survey")}}catch(t){i.error("Failed to submit survey")}}),children:[s.jsxs("div",{className:"space-y-3 p-4",children:[s.jsxs(N,{number:1,title:"Property & Occupancy",icon:s.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),children:[s.jsx(c,{name:"tagId",label:"Tag ID (Hex)",isRequired:!0,placeholder:"Enter Tag ID (Hex)"}),s.jsx(c,{name:"ownerName",label:"Owner Name",isRequired:!0,placeholder:"Enter owner name"}),s.jsx(m,{name:"address",label:"Address",isRequired:!0,placeholder:"Enter complete address",rows:3}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(g,{name:"wardNo",label:"Ward No.",data:(null==(L=null==(S=null==E?void 0:E.data)?void 0:S.data)?void 0:L.map(e=>({value:String(null==e?void 0:e.id),label:String(null==e?void 0:e.ward_name)})))||[]}),s.jsx(g,{name:"zone",label:"Zone",data:(null==(M=null==(q=null==(W=null==D?void 0:D.data)?void 0:W.data)?void 0:q.zone_mstrs)?void 0:M.map(e=>({label:String(null==e?void 0:e.zone),value:String(null==e?void 0:e.id)})))||[]})]}),s.jsx(g,{name:"propertyType",label:"Property Type",data:(null==(z=null==(T=null==(_=null==D?void 0:D.data)?void 0:_.data)?void 0:T.property_type)?void 0:z.map(e=>({value:String(null==e?void 0:e.id),label:String(null==e?void 0:e.property_type)})))||[]}),s.jsx(g,{name:"usageType",label:"Usage Type",data:(null==(B=null==(C=null==(A=null==D?void 0:D.data)?void 0:A.data)?void 0:C.usage_type)?void 0:B.map(e=>({value:String(null==e?void 0:e.id),label:String(null==e?void 0:e.usage_type)})))||[]})]}),s.jsxs(N,{number:2,title:"Waste Management",icon:s.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),children:[s.jsx(g,{name:"wasteType",label:"Type of Waste",data:[{value:"biodegradable",label:"Biodegradable (Wet Waste)"},{value:"non_biodegradable",label:"Non-Biodegradable (Dry Waste)"},{value:"mixed",label:"Mixed Waste"},{value:"hazardous",label:"Hazardous Waste"},{value:"e_waste",label:"E-Waste"}]}),s.jsx(g,{name:"binsAvailable",label:"Availability of Bins",data:[{value:"yes",label:"Yes - Bins Available"},{value:"no",label:"No - No Bins Available"}]})]}),s.jsx(N,{number:3,title:"Geo Tagging",icon:s.jsxs("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),children:s.jsxs("div",{className:"rounded-xl border border-emerald-200 bg-gradient-to-r from-emerald-50 to-teal-50 p-4 dark:border-emerald-800 dark:from-emerald-900/20 dark:to-teal-900/20",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(c,{name:"latitude",label:"Latitude",isRequired:!0,placeholder:"Lat"}),s.jsx(c,{name:"longitude",label:"Longitude",isRequired:!0,placeholder:"Long"})]}),s.jsxs("button",{type:"button",onClick:()=>{navigator.geolocation?(F(!0),navigator.geolocation.getCurrentPosition(e=>{$.setValue("latitude",e.coords.latitude.toFixed(6)),$.setValue("longitude",e.coords.longitude.toFixed(6)),F(!1),i.success("Location captured successfully")},e=>{F(!1),i.error(`Unable to get location: ${e.message}`)},{enableHighAccuracy:!0,timeout:1e4})):i.error("Geolocation is not supported by your browser")},disabled:P,className:"mt-4 flex w-full items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-emerald-500 to-teal-600 px-4 py-3.5 font-semibold text-white shadow-lg transition-all hover:from-emerald-600 hover:to-teal-700 disabled:opacity-50",children:[P?s.jsxs("svg",{className:"h-5 w-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}):s.jsxs("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),P?"Getting Location...":"Capture GPS Location"]})]})}),s.jsx(N,{number:4,title:"Photograph",icon:s.jsxs("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),children:s.jsxs("div",{className:"rounded-xl border-2 border-dashed border-gray-300 bg-gray-50 p-5 dark:border-gray-600 dark:bg-gray-800",children:[s.jsx(v,{onChange:e=>(async(e,a)=>{var r;const t=null==(r=null==e?void 0:e.target)?void 0:r.files[0],s=await h(t),o=new File([s],null==t?void 0:t.name,{type:null==t?void 0:t.type});$.setValue(a,o)})(e,"frontViewPhoto"),label:"Front View with Timestamp",accept:"image/*",capture:"environment"}),s.jsx("p",{className:"mt-2 text-center text-xs text-gray-500",children:"Capture property front view with timestamp"})]})})]}),s.jsx("div",{className:"fixed bottom-0 left-0 right-0 border-t border-gray-200 bg-white/95 p-4 shadow-2xl backdrop-blur-sm dark:border-gray-800 dark:bg-gray-900/95",children:s.jsx(p,{type:"submit",isLoading:$.formState.isSubmitting||V.isPending,className:"h-14 w-full rounded-xl bg-gradient-to-r from-emerald-500 to-teal-600 text-lg font-bold shadow-lg hover:from-emerald-600 hover:to-teal-700",children:G?"Update SWM Survey":"Submit SWM Survey"})})]})})]})}export{S as default};
