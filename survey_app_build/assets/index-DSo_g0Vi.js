import{u as e,c as r,r as t,j as a,z as s}from"./vendor-CX7Sr6rY.js";import{b as d}from"./useCustomQuery-khXZmN5i.js";import{B as l,s as n}from"./index-BHHC9fLw.js";import{u as i,c as o,b as c,e as x}from"./useSurveyApi-BI6OzhtC.js";import{D as g,a as u,b as m,c as p,d as b,e as y}from"./dialog-BuwjdHGA.js";import{S as h,a as v,b as j,c as f,d as N}from"./select-Dh03lloP.js";import{T as k}from"./textarea-DmEaNQE7.js";import{P as w}from"./index-DrRBnKFM.js";import{x as _,_ as S,z as C,w as A,$,a0 as T,a1 as L,q as P,a2 as R,a3 as M,a4 as V,X as E,a5 as W,a6 as O}from"./icons--btW49PO.js";import"./query-D-Aji6U-.js";import"./ui-B_wVOan7.js";import"./axios-Dos3PyFQ.js";import"./zustand-DOMjtRnQ.js";import"./index-FFPzzKQg.js";const z=e=>{if(!e)return"Pending";const r=e.toLowerCase();return r.includes("approve")||r.includes("verified")?"Approved":r.includes("reject")?"Rejected":"Pending"};function D(){const D=e(),[I,q]=r.useState(""),[F,Y]=r.useState("all"),[U,B]=r.useState("all"),[G,J]=r.useState(!1),[Q,H]=r.useState(null),[K,X]=r.useState(!1),[Z,ee]=r.useState(null),[re,te]=r.useState(""),[ae,se]=r.useState(""),de={page:1,limit:100},le=d({api:n.appCount,key:"dashboardStats",options:{enabled:!0,staleTime:3e5}}),ne=i(de),ie=o(de),oe=c(),ce=x(),xe=t.useMemo(()=>{var e;return(null==(e=le.data)?void 0:e.data)||{}},[le.data]),ge=t.useMemo(()=>{var e,r,t,a;const s=(null==(r=null==(e=ne.data)?void 0:e.data)?void 0:r.surveys)||[],d=(null==(a=null==(t=ie.data)?void 0:t.data)?void 0:a.surveys)||[];return[...s.map(e=>({survey_no:e.tag_id||`SEPTIC-${e.id}`,tag_id:e.tag_id,survey_type:"Septic",name:e.owner_name||"N/A",owner_name:e.owner_name,ward:e.ward_no||"N/A",ward_no:e.ward_no,address:e.address||"N/A",status:z(e.verification_status),verification_status:e.verification_status,surveyor_name:e.submitted_by_name,submitted_by_name:e.submitted_by_name})),...d.map(e=>({survey_no:e.tag_id||`SWM-${e.id}`,tag_id:e.tag_id,survey_type:"SWM",name:e.owner_name||"N/A",owner_name:e.owner_name,ward:e.ward_no||"N/A",ward_no:e.ward_no,address:e.address||"N/A",status:z(e.verification_status),verification_status:e.verification_status,surveyor_name:e.submitted_by_name,submitted_by_name:e.submitted_by_name}))]},[ne.data,ie.data]),ue=t.useMemo(()=>[{id:"total",title:"TOTAL SURVEY ENTRY",value:(null==xe?void 0:xe.total_survey_entry)||0,subtext:`SWM ${(null==xe?void 0:xe.swm_count)||0} • Septic ${(null==xe?void 0:xe.septic_count)||0}`,icon:a.jsx(_,{className:"h-6 w-6"}),color:"from-indigo-500 to-indigo-600",bgColor:"bg-indigo-50 dark:bg-indigo-950/30",borderColor:"border-indigo-200 dark:border-indigo-800"},{id:"approved",title:"TOTAL APPROVED",value:(null==xe?void 0:xe.total_approved)||0,subtext:`SWM ${(null==xe?void 0:xe.approved_swm)||0} • Septic ${(null==xe?void 0:xe.approved_septic)||0}`,icon:a.jsx(S,{className:"h-6 w-6"}),color:"from-green-500 to-emerald-600",bgColor:"bg-green-50 dark:bg-green-950/30",borderColor:"border-green-200 dark:border-green-800"},{id:"rejected",title:"TOTAL REJECTED",value:(null==xe?void 0:xe.total_rejected)||0,subtext:`SWM ${(null==xe?void 0:xe.rejected_swm)||0} • Septic ${(null==xe?void 0:xe.rejected_septic)||0}`,icon:a.jsx(C,{className:"h-6 w-6"}),color:"from-red-500 to-rose-600",bgColor:"bg-red-50 dark:bg-red-950/30",borderColor:"border-red-200 dark:border-red-800"},{id:"pending",title:"TOTAL PENDING",value:(null==xe?void 0:xe.total_pending)||0,subtext:`SWM ${(null==xe?void 0:xe.pending_swm)||0} • Septic ${(null==xe?void 0:xe.pending_septic)||0}`,icon:a.jsx(A,{className:"h-6 w-6"}),color:"from-amber-500 to-yellow-600",bgColor:"bg-amber-50 dark:bg-amber-950/30",borderColor:"border-amber-200 dark:border-amber-800"},{id:"surveyors",title:"TOTAL SURVEYORS",value:(null==xe?void 0:xe.total_surveyors)||0,icon:a.jsx($,{className:"h-6 w-6"}),color:"from-teal-500 to-cyan-600",bgColor:"bg-teal-50 dark:bg-teal-950/30",borderColor:"border-teal-200 dark:border-teal-800"}],[xe]),me=t.useMemo(()=>ge.filter(e=>{var r,t,a;const s=(null==(r=e.survey_no)?void 0:r.toLowerCase().includes(I.toLowerCase()))||(null==(t=e.name)?void 0:t.toLowerCase().includes(I.toLowerCase()))||(null==(a=e.address)?void 0:a.toLowerCase().includes(I.toLowerCase())),d="all"===F||e.status===F,l="all"===U||e.survey_type===U;return s&&d&&l}),[ge,I,F,U]),pe=e=>{switch(e){case"Approved":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"Pending":return"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-300";case"Rejected":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300"}};return a.jsx(w,{title:"Admin Dashboard Overview",children:a.jsxs("div",{className:"min-h-screen rounded-xl bg-gradient-to-b from-slate-50 to-slate-100 p-4 dark:from-gray-950 dark:to-gray-900 md:p-8",children:[a.jsx("div",{className:"mb-8 grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-5",children:ue.map(e=>{var r;return a.jsxs("div",{className:`\n              relative overflow-hidden rounded-2xl border-2 ${e.borderColor}\n              bg-gradient-to-br ${e.color} p-6 text-white\n              shadow-lg transition-all hover:scale-105 hover:shadow-xl\n              dark:shadow-2xl\n            `,children:[a.jsx("div",{className:"absolute -right-8 -top-8 opacity-10",children:a.jsx("div",{className:"h-32 w-32 rounded-full bg-white"})}),a.jsxs("div",{className:"relative z-10",children:[a.jsx("div",{className:`${e.bgColor} mb-4 w-fit rounded-xl p-3`,children:a.jsx("div",{className:`text-${null==(r=e.color.match(/\w+/))?void 0:r[0]}`,children:e.icon})}),a.jsx("p",{className:"mb-1 text-sm font-medium text-white/80",children:e.title}),a.jsx("p",{className:"mb-2 text-4xl font-bold",children:e.value.toLocaleString()}),e.subtext&&a.jsx("p",{className:"text-xs text-white/70",children:e.subtext})]})]},e.id)})}),a.jsxs("div",{className:"overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-lg dark:border-gray-800 dark:bg-gray-900",children:[a.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-6 py-5 dark:border-gray-800",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Recent Surveys"}),a.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[me.length," entries found"]})]}),a.jsxs("div",{className:"border-b border-gray-200 bg-gray-50 px-6 py-4 dark:border-gray-800 dark:bg-gray-800/50",children:[a.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-4",children:[a.jsxs("div",{className:"relative md:col-span-2",children:[a.jsx(T,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),a.jsx("input",{type:"text",placeholder:"Search surveys...",value:I,onChange:e=>q(e.target.value),className:"w-full rounded-lg border border-gray-300 bg-white py-2.5 pl-10 pr-4 text-gray-900 placeholder-gray-500 outline-none focus:border-transparent focus:ring-2 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400"})]}),a.jsxs("div",{className:"relative",children:[a.jsx(L,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),a.jsxs("select",{value:F,onChange:e=>Y(e.target.value),className:"w-full cursor-pointer appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-10 pr-8 text-gray-900 outline-none focus:border-transparent focus:ring-2 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"all",children:"All Status"}),a.jsx("option",{value:"Approved",children:"Approved"}),a.jsx("option",{value:"Pending",children:"Pending"}),a.jsx("option",{value:"Rejected",children:"Rejected"})]}),a.jsx(P,{className:"pointer-events-none absolute right-2 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"})]}),a.jsxs("div",{className:"relative",children:[a.jsx(L,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),a.jsxs("select",{value:U,onChange:e=>B(e.target.value),className:"w-full cursor-pointer appearance-none rounded-lg border border-gray-300 bg-white py-2.5 pl-10 pr-8 text-gray-900 outline-none focus:border-transparent focus:ring-2 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"all",children:"All Types"}),a.jsx("option",{value:"SWM",children:"SWM"}),a.jsx("option",{value:"Septic",children:"Septic"})]}),a.jsx(P,{className:"pointer-events-none absolute right-2 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"})]})]}),a.jsx("div",{className:"mt-4 flex gap-3",children:a.jsxs("button",{onClick:()=>{J(!0),setTimeout(()=>J(!1),1e3)},disabled:G,className:"inline-flex items-center gap-2 rounded-lg bg-indigo-600 px-4 py-2 text-white transition-colors hover:bg-indigo-700 disabled:opacity-50",children:[a.jsx(R,{className:"h-4 w-4"}),a.jsx("span",{children:G?"Exporting...":"Export"})]})})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50 dark:border-gray-800 dark:bg-gray-800/50",children:[a.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300",children:"Survey No."}),a.jsx("th",{className:"hidden px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300 md:table-cell",children:"Type"}),a.jsx("th",{className:"hidden px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300 lg:table-cell",children:"Surveyor Name"}),a.jsx("th",{className:"hidden px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300 md:table-cell",children:"Ward"}),a.jsx("th",{className:"hidden px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300 lg:table-cell",children:"Address"}),a.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300",children:"Status"}),a.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300",children:"Actions"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-800",children:me.length>0?me.map((e,r)=>{return a.jsxs("tr",{className:"transition-colors hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[a.jsx("td",{className:"px-6 py-4 text-sm font-semibold text-indigo-600 dark:text-indigo-400",children:e.survey_no}),a.jsx("td",{className:"hidden px-6 py-4 text-sm text-gray-700 dark:text-gray-300 md:table-cell",children:a.jsx("span",{className:"inline-flex items-center rounded-full px-3 py-1 text-xs font-medium "+(t=e.survey_type,"SWM"===t?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300":"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300"),children:e.survey_type})}),a.jsx("td",{className:"hidden px-6 py-4 text-sm text-gray-700 dark:text-gray-300 lg:table-cell",children:e.name}),a.jsx("td",{className:"hidden px-6 py-4 text-sm text-gray-700 dark:text-gray-300 md:table-cell",children:e.ward}),a.jsx("td",{className:"hidden max-w-xs truncate px-6 py-4 text-sm text-gray-600 dark:text-gray-400 lg:table-cell",children:e.address}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${pe(e.status)}`,children:e.status})}),a.jsx("td",{className:"hidden px-6 py-4 text-center lg:table-cell",children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsxs("button",{onClick:()=>D(`/survey-app/admin/survey-details?type=${e.survey_type}&id=${e.tag_id||e.survey_no}`),className:"inline-flex items-center gap-1 rounded-lg bg-blue-100 px-3 py-1.5 text-xs font-medium text-blue-700 transition-colors hover:bg-blue-200 dark:bg-blue-900/30 dark:text-blue-300 dark:hover:bg-blue-900/50",title:"View Details",children:[a.jsx(M,{className:"h-3.5 w-3.5"}),a.jsx("span",{className:"hidden sm:inline",children:"View"})]}),"Pending"===e.status&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:()=>{ee(e),te("verified"),se(""),X(!0)},className:"inline-flex items-center gap-1 rounded-lg bg-green-100 px-3 py-1.5 text-xs font-medium text-green-700 transition-colors hover:bg-green-200 dark:bg-green-900/30 dark:text-green-300 dark:hover:bg-green-900/50",title:"Verify",children:[a.jsx(V,{className:"h-3.5 w-3.5"}),a.jsx("span",{className:"hidden sm:inline",children:"Verify"})]}),a.jsxs("button",{onClick:()=>{ee(e),te("rejected"),se(""),X(!0)},className:"inline-flex items-center gap-1 rounded-lg bg-red-100 px-3 py-1.5 text-xs font-medium text-red-700 transition-colors hover:bg-red-200 dark:bg-red-900/30 dark:text-red-300 dark:hover:bg-red-900/50",title:"Reject",children:[a.jsx(E,{className:"h-3.5 w-3.5"}),a.jsx("span",{className:"hidden sm:inline",children:"Reject"})]})]})]})}),a.jsxs("td",{className:"relative px-6 py-4 text-center lg:hidden",children:[a.jsx("button",{onClick:()=>H(Q===e.survey_no?null:e.survey_no),className:"inline-flex rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-gray-800",children:a.jsx(W,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})}),Q===e.survey_no&&a.jsxs("div",{className:"absolute right-0 top-full z-10 mt-2 w-40 overflow-hidden rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-900",onClick:e=>e.stopPropagation(),children:[a.jsxs("button",{onClick:()=>{D(`/survey-app/admin/survey-details?type=${e.survey_type}&id=${e.tag_id||e.survey_no}`),H(null)},className:"flex w-full items-center gap-2 px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800",children:[a.jsx(M,{className:"h-4 w-4"}),"View Details"]}),"Pending"===e.status&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:()=>{ee(e),te("verified"),se(""),X(!0),H(null)},className:"flex w-full items-center gap-2 px-4 py-2.5 text-sm text-green-700 hover:bg-green-50 dark:text-green-300 dark:hover:bg-green-900/20",children:[a.jsx(V,{className:"h-4 w-4"}),"Verify"]}),a.jsxs("button",{onClick:()=>{ee(e),te("rejected"),se(""),X(!0),H(null)},className:"flex w-full items-center gap-2 px-4 py-2.5 text-sm text-red-700 hover:bg-red-50 dark:text-red-300 dark:hover:bg-red-900/20",children:[a.jsx(E,{className:"h-4 w-4"}),"Reject"]})]})]})]})]},r);var t}):a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"px-6 py-8 text-center",children:a.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[a.jsx(O,{className:"h-12 w-12 text-gray-300 dark:text-gray-600"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No surveys found"})]})})})})]})}),a.jsx("div",{className:"flex items-center justify-between border-t border-gray-200 bg-gray-50 px-6 py-4 text-sm text-gray-600 dark:border-gray-800 dark:bg-gray-800/50 dark:text-gray-400",children:a.jsxs("span",{children:["Showing ",me.length," of ",ge.length," surveys"]})})]}),(le.isLoading||ne.isLoading||ie.isLoading)&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm",children:a.jsxs("div",{className:"flex flex-col items-center gap-4 rounded-2xl bg-white p-8 dark:bg-gray-900",children:[a.jsx("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-gray-300 border-t-indigo-600 dark:border-gray-700"}),a.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Loading dashboard..."})]})}),a.jsx(g,{open:K,onOpenChange:X,children:a.jsxs(u,{className:"max-w-md",children:[a.jsxs(m,{children:[a.jsx(p,{children:"verified"===re?"Verify Survey":"Reject Survey"}),a.jsx(b,{children:Z&&a.jsxs("span",{className:"text-sm",children:["Survey ID:"," ",Z.tag_id||Z.survey_no]})})]}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"Verification Status"}),a.jsxs(h,{value:re,onValueChange:e=>te(e),children:[a.jsx(v,{className:"w-full",children:a.jsx(j,{placeholder:"Select status"})}),a.jsxs(f,{children:[a.jsx(N,{value:"verified",children:"Verified"}),a.jsx(N,{value:"rejected",children:"Rejected"}),a.jsx(N,{value:"needs_correction",children:"Needs Correction"})]})]})]}),("rejected"===re||"needs_correction"===re)&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:["Correction Notes ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(k,{placeholder:"Enter correction notes...",value:ae,onChange:e=>se(e.target.value),rows:4,className:"w-full resize-none"})]})]}),a.jsxs(y,{children:[a.jsx(l,{variant:"outline",onClick:()=>{X(!1),ee(null),se("")},children:"Cancel"}),a.jsx(l,{onClick:async()=>{if(Z&&re)try{const e="Septic"===Z.survey_type?oe:ce,r=Z.tag_id||Z.survey_no,t=parseInt(r.replace(/[^0-9]/g,""),10);await e.mutateAsync({id:t,data:{verification_status:re,correction_notes:ae||void 0}}),s.success("Survey verification updated successfully"),X(!1),ee(null),te(""),se(""),ne.refetch(),ie.refetch(),le.refetch()}catch(e){s.error("Failed to verify survey")}},disabled:oe.isPending||ce.isPending||("rejected"===re||"needs_correction"===re)&&!ae.trim(),className:"min-w-[100px]",children:oe.isPending||ce.isPending?"Submitting...":"Submit"})]})]})})]})})}export{D as default};
