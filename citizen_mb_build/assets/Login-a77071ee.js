import{r as h,j as c,u as ft,f as gt,d as it,A as ot,F as lt,b as C,L as ht,P as wt}from"./index-fd80cd87.js";import{u as xt}from"./formik.esm-8fbc9cc2.js";import{c as vt,b as pt,a as ct}from"./index.esm-e92a03a9.js";/* empty css                */import{R as Ct}from"./Hourglass-e4a77f53.js";import{T as E,F as yt}from"./LoadingButton-6c2f4d68.js";import"./hoist-non-react-statics.cjs-2ca5db62.js";import"./ThemeStyle-994f51bc.js";import"./index.esm-a9cf170a.js";/*! js-cookie v3.0.5 | MIT */function y(a){for(var u=1;u<arguments.length;u++){var m=arguments[u];for(var d in m)a[d]=m[d]}return a}var St={read:function(a){return a[0]==='"'&&(a=a.slice(1,-1)),a.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(a){return encodeURIComponent(a).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function b(a,u){function m(e,l,i){if(!(typeof document>"u")){i=y({},u,i),typeof i.expires=="number"&&(i.expires=new Date(Date.now()+i.expires*864e5)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var f="";for(var o in i)i[o]&&(f+="; "+o,i[o]!==!0&&(f+="="+i[o].split(";")[0]));return document.cookie=e+"="+a.write(l,e)+f}}function d(e){if(!(typeof document>"u"||arguments.length&&!e)){for(var l=document.cookie?document.cookie.split("; "):[],i={},f=0;f<l.length;f++){var o=l[f].split("="),v=o.slice(1).join("=");try{var r=decodeURIComponent(o[0]);if(i[r]=a.read(v,r),e===r)break}catch{}}return e?i[e]:i}}return Object.create({set:m,get:d,remove:function(e,l){m(e,"",y({},l,{expires:-1}))},withAttributes:function(e){return b(this.converter,y({},this.attributes,e))},withConverter:function(e){return b(y({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(u)},converter:{value:Object.freeze(a)}})}var It=b(St,{path:"/"});const Et=()=>{const[a,u]=h.useState(""),m=()=>{const o=Math.random().toString(36).slice(2,8).toUpperCase();u(o)},d=(o,v)=>o===a?!0:(v({captcha:""},!1),m(),!1),e=document.createElement("canvas");e.style.margin="0",e.style.padding="0",e.width=100,e.height=22;const l=e.getContext("2d");l.font="bold 15px Arial",l.fillStyle="blue",l.fillText(a,21,16);const i=e.toDataURL();return h.useEffect(()=>{m()},[]),{catptchaTextField:o=>c("div",{children:c(E,{name:"captcha",placeholder:"Enter captcha",formik:o})}),captcha:a,dataUrl:i,verifyCaptcha:d,generateCaptcha:m}},kt=()=>{const a=ft(),{catptchaTextField:u,dataUrl:m,generateCaptcha:d,verifyCaptcha:e}=Et(),{notify:l,setisLoggedIn:i,setheartBeatCounter:f}=h.useContext(gt),[o,v]=h.useState(null),[r,N]=h.useState(),{api_login:rt,api_getPermission:nt}=wt(),[S,w]=h.useState(!1),dt=vt({email:pt().required("Enter email"),password:ct().required("Enter password"),captcha:ct().required("Enter captcha")}),g=xt({initialValues:{email:"",password:"",type:"mobile",captcha:""},onSubmit:async(n,{resetForm:t})=>{e(n==null?void 0:n.captcha,t)?ut():l("Invalid Captcha")},validationSchema:dt}),R=["TAX COLLECTOR","ULB TAX COLLECTOR","TEAM LEADER","JUNIOR ENGINEER","TAX DAROGA","DRIVER","SEPTIC TANKER DRIVER","ENFORCEMENT OFFICER","CONDUCTOR"],st=h.useMemo(()=>Array.isArray(o)&&o.some(n=>R.includes(n)),[o]);h.useEffect(()=>{var n,t,x;o!=null&&(st?(l("Login Successfull !!! ","success"),window.localStorage.setItem("menuList",JSON.stringify((n=r==null?void 0:r.userDetails)==null?void 0:n.menuPermission)),window.localStorage.setItem("userName",JSON.stringify((t=r==null?void 0:r.userDetails)==null?void 0:t.name)),window.localStorage.setItem("roles",JSON.stringify((x=r==null?void 0:r.userDetails)==null?void 0:x.role)),a("/dashboard")):l("You don't have permission of Tax Collector !!!","warn"))},[o]);const I=JSON.parse(window.localStorage.getItem("roles")),p=window.localStorage.getItem("token"),mt=h.useMemo(()=>Array.isArray(I)&&I.some(n=>R.includes(n)),[I,p]);h.useEffect(()=>{p!=""&&p!=null&&p!=null&&mt&&a("/dashboard")},[]);const ut=()=>{w(!0);let n={email:g.values.email,password:g.values.password,type:"mobile"};console.log("--1--before login send...",n),it.post(rt,n,ot()).then(function(t){var x,A,F,O,T,D,L,k,U,j,P,V,B,J,M,q,_,X,$,z,G,H,K,W,Y,Q,Z;console.log("login response => ",t),t.data.status==!0?(console.log("--2--login response...",t),window.localStorage.setItem("token",(A=(x=t==null?void 0:t.data)==null?void 0:x.data)==null?void 0:A.token),window.localStorage.setItem("isLoggedIn",!0),window.localStorage.setItem("userEmail",(T=(O=(F=t==null?void 0:t.data)==null?void 0:F.data)==null?void 0:O.userDetails)==null?void 0:T.email),window.localStorage.setItem("userName",(k=(L=(D=t==null?void 0:t.data)==null?void 0:D.data)==null?void 0:L.userDetails)==null?void 0:k.name),window.localStorage.setItem("userType",(P=(j=(U=t==null?void 0:t.data)==null?void 0:U.data)==null?void 0:j.userDetails)==null?void 0:P.user_type),window.localStorage.setItem("userMobile",(J=(B=(V=t==null?void 0:t.data)==null?void 0:V.data)==null?void 0:B.userDetails)==null?void 0:J.mobile),window.localStorage.setItem("ulbId",(_=(q=(M=t==null?void 0:t.data)==null?void 0:M.data)==null?void 0:q.userDetails)==null?void 0:_.ulb_id),window.localStorage.setItem("device","mobile"),window.localStorage.setItem("userUlbName",JSON.stringify((z=($=(X=t==null?void 0:t.data)==null?void 0:X.data)==null?void 0:$.userDetails)==null?void 0:z.ulbName)),It.set("accesstoken",(H=(G=t==null?void 0:t.data)==null?void 0:G.data)==null?void 0:H.token,{expires:7,secure:!0}),N((K=t==null?void 0:t.data)==null?void 0:K.data),v((Q=(Y=(W=t==null?void 0:t.data)==null?void 0:W.data)==null?void 0:Y.userDetails)==null?void 0:Q.role),f(s=>s+1),i(!0),it.post(nt,{moduleId:1},ot()).then(s=>{var tt,et,at;console.log("getPermission response => ",s),s.data.status==!0?window.localStorage.setItem("menuList",JSON.stringify((et=(tt=s==null?void 0:s.data)==null?void 0:tt.data)==null?void 0:et.permission)):(l((at=s==null?void 0:s.data)==null?void 0:at.message,"error"),g.setFieldValue("captcha",""),d(),w(!1))}).catch(s=>{console.log("getPermission error => ",s),l("Something went wrong !!! ","error"),g.setFieldValue("captcha",""),d(),w(!1)})):(w(!1),l((Z=t==null?void 0:t.data)==null?void 0:Z.message,"error"),g.setFieldValue("captcha",""),d(),w(!1))}).catch(function(t){w(!1),console.log("--2--login error...",t),l("Something went wrong !!! ","error"),g.setFieldValue("captcha",""),d(),w(!1)})};return c(lt,{children:C(yt,{formik:g,children:[c("div",{className:"mt-6 flex flex-col flex-wrap gap-2",children:c(E,{name:"email",label:"Email",formik:g})}),c("div",{className:"mt-4 flex flex-col flex-wrap gap-2",children:c(E,{type:"password",name:"password",label:"Password",formik:g})}),c("div",{className:"mt-6 flex flex-col flex-wrap gap-0",children:C("div",{className:"flex justify-between",children:[c("div",{className:"bg-gray-400 px-4 py-1 rounded-sm",children:c("img",{src:m,alt:"captcha"})}),c("div",{children:c("button",{type:"button",onClick:d,className:"text-[#5846BE] text-sm",children:"Reload Captcha"})})]})}),c("div",{className:"mt-2 flex flex-col flex-wrap gap-2",children:u(g)}),c("div",{className:"text-center mb-6 mt-4",children:S?c("div",{className:"flex justify-center",children:c(Ct,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"25",visible:!0})}):C(lt,{children:[c("div",{className:"mb-1",children:c(ht,{to:"/forget-password",className:"text-xs text-indigo-600",children:"Forgot Password ?"})}),C("button",{disabled:S,type:"submit",className:"px-4 py-1.5 bg-green-200 hover:bg-green-300 rounded-md shadow-md text-sm",children:[" ",S?"Please wait...":"Login"]})," "]})})]})})};export{kt as default};
