import{r,d as he,c as fe,a as ve,j as n,F as S,b as e}from"./index-5063306b.js";import{F as be,A as ye,t as Ne}from"./full.esm-3f97dac4.js";import{I as xe}from"./index.esm-a44adfc7.js";import $e from"./ForwardScreen-2fad210d.js";import _e from"./CommonLoader-75dae4cb.js";import{B as V,a as j,A as B}from"./axios-28c6f114.js";import{c as we,a as P,u as Ce}from"./index.esm-5e7901be.js";import{M as Se}from"./index-fbeed632.js";import{u as je}from"./useSetTitle-9b5032b2.js";import{j as He}from"./PowerupFunctions-13c4b560.js";import"./iconBase-0b91e11c.js";import"./Blocks-7633386f.js";import"./ProjectApiList-f293eba9.js";import"./BeatLoader-556eb540.js";function Ie(){let t=V;return{calculatePropertyTax:`${t}/api/property/calculatePropertyTax`,get_dashboard:`${t}/api/property/get-dashboard`,get_ConcessionInbox:`${t}/api/property/concession/inbox`,get_ConcessionOutbox:`${t}/api/property/concession/outbox`,get_ConcessionSpecial:`${t}/api/property/concession/special-inbox`,get_ConcessionDetailsById:`${t}/api/property/concession/details`,post_ConcessionEscalate:`${t}/api/property/concession/escalate`,post_ConcessionNextLevel:`${t}/api/property/concession/next-level`,post_ConcessionApprovalRejection:`${t}/api/property/concession/approvalrejection`,post_ConcessionBackToCitizen:`${t}/api/property/concession/backtocitizen`,post_ConcessionComment:`${t}/api/property/concession/comment-independent`,get_ConcessionDocumentsToUpload:`${t}/api/property/concession/doc-list`,get_ConcessionUploadedDocuments:`${t}/api/property/concession/get-uploaded-documents`,post_ConcessionDocumentUpload:`${t}/api/property/concession/upload-document`,get_ConcessionBtcList:`${t}/api/property/concession/btc-inbox`,get_ObjectionInbox:`${t}/api/property/objection/inbox`,get_ObjectionOutbox:`${t}/api/property/objection/outbox`,get_ObjectionSpecial:`${t}/api/property/objection/special-inbox`,get_ObjectionDetailsById:`${t}/api/property/objection/details`,post_ObjectionEscalate:`${t}/api/property/objection/post-escalate`,post_ObjectionNextLevel:`${t}/api/property/objection/next-level`,post_ObjectionApprovalRejection:`${t}/api/property/objection/approvalrejection`,post_ObjectionBackToCitizen:`${t}/api/property/objection/backtocitizen`,post_ObjectionBtcList:`${t}/api/property/objection/btc-inbox`,post_ObjectionComment:`${t}/api/property/objection/comment-independent`,get_ObjectionDocumentsToUpload:`${t}/api/property/objection/doc-list`,get_ObjectionUploadedDocuments:`${t}/api/property/objection/get-uploaded-documents`,post_ObjectionDocumentUpload:`${t}/api/property/objection/upload-document`,get_HarvestingInbox:`${t}/api/property/harvesting/inbox`,get_HarvestingOutbox:`${t}/api/property/harvesting/outbox`,get_HarvestingSpecial:`${t}/api/property/harvesting/special-inbox`,get_HarvestingDetailsById:`${t}/api/property/harvesting/static-details`,harvestingSiteVerification:`${t}/api/property/harvesting/site-verification`,post_HarvestingEscalate:`${t}/api/property/harvesting/escalate`,post_HarvestingNextLevel:`${t}/api/property/harvesting/next-level`,post_HarvestingApprovalRejection:`${t}/api/property/harvesting/approval-rejection`,post_HarvestingBackToCitizen:`${t}/api/property/harvesting/backtocitizen`,getHarvestingDocList:`${t}/api/property/harvesting-doc-id`,postHarvestingDoc:`${t}/api/property/harvesting-doc-upload`,postHarvestingStatus:`${t}/api/property/harvesting-doc-status`,get_HarvestingDocumentsToUpload:`${t}/api/property/harvesting/get-doc-list`,get_HarvestingUploadedDocuments:`${t}/api/property/harvesting/get-uploaded-documents`,post_HarvestingDocumentUpload:`${t}/api/property/harvesting/upload-document`,get_HarvestingBtcList:`${t}/api/property/harvesting/btc-inbox`,get_HarvestingBtcAction:`${t}/api/property/harvesting/backtocitizen`,get_HoldingDeactivationInbox:`${t}/api/property/inboxDeactivation`,get_HoldingDeactivationOutbox:`${t}/api/property/outboxDeactivation`,get_HoldingDeactivationSpecial:`${t}`,get_HoldingDeactivationDetailsById:`${t}/api/property/getDeactivationDtls`,post_HoldingDeactivationEscalate:`${t}/api/property/postEscalateDeactivation`,post_HoldingDeactivationNextLevel:`${t}/api/property/postNextDeactivation`,post_HoldingDeactivationApprovalRejection:`${t}/api/property/approve-reject-deactivation-request`,post_HoldingDeactivationIndependentComment:`${t}/api/property/commentIndependentPrpDeactivation`,get_HoldingDeactivationUploadedDocuments:`${t}/api/property/getDocumentsPrpDeactivation`,get_MasterData:`${t}/api/property/saf/master-saf`,post_SiteVerification:`${t}/api/property/saf/site-verification`,post_GeoTagging:`${t}/api/property/saf/geotagging`,post_DocVerify:`${t}/api/property/saf/verifydoc`,getSafDoc:`${t}/api/property/safDocumentUpload`,postSafDoc:`${t}/api/property/safDocumentUpload`,getDocumentList:`${t}/api/property/getSafUploadDocuments`,postSafVerify:`${t}/api/property/saf/doc-status`,api_getPropHoldingDetailsById:`${t}/api/property/saf/get-prop-byholding`,api_getTcComparisonData:`${t}/api/property/saf/verifications-comp`,api_PostHolidingDeactivation:`${t}/api/property/deactivationRequest`,api_getHoldingDeactivationDetails:`${t}/api/property/get-prop-dtl-for-deactivation`,api_postHoldingDeactivationApply:`${t}/api/property/deactivationRequest `,api_samReciept:`${t}/api/property/saf/memo-receipt`,getHarvestingData:`${t}/api/property/harvesting/get-tc-verifications`}}const We=()=>{const[t,l]=r.useState(!1),[s,H]=r.useState(),[N,I]=r.useState(null),[c,k]=r.useState(),[M,D]=r.useState(),[W,A]=r.useState(!0),[q,x]=r.useState(!1),[G,U]=r.useState(!1),[Y,$]=r.useState(""),[u,J]=r.useState();je("Water Harvesting Verification"),localStorage.getItem("roles");const{get_HarvestingDetailsById:K,harvestingSiteVerification:Q,getHarvestingData:X}=Ie(),{id:_}=he(),{notify:f,roleName:g}=r.useContext(fe),O=ve(),Z=we({harvestingImage:P().when([],{is:()=>g=="tc",then:()=>P().required("image required")})}),p=Ce({initialValues:{harvestingImage:""},onSubmit:a=>{console.log("submitting image => ",a),x(!0)},validationSchema:Z}),ee=()=>{if(g!="tc"&&g!="utc"){f("You don't have permission to verify !!!","error");return}l(!0);let a=new FormData;a.append("applicationId",_),G?a.append("harvestingImage",le(N,"HarvestingImage.jpg")):a.append("harvestingImage",M),W?a.append("verificationStatus",1):a.append("verificationStatus",0),a.append("longitude",c==null?void 0:c.longitude),a.append("latitude",c==null?void 0:c.latitude),j.post(Q,a,ye()).then(o=>{var i,d,m;$((i=o==null?void 0:o.data)==null?void 0:i.status),((d=o==null?void 0:o.data)==null?void 0:d.status)==!0&&(console.log("successfully submitted..."),l(!1),$("true")),((m=o==null?void 0:o.data)==null?void 0:m.status)==!1&&(console.log("error submitted..."),f("Something went wrong, please try after sometime !!!","error"),$("false"),x(!1),l(!1))}).catch(o=>{console.log("errrorr rwh => ",o),f("Something went wrong, please try after sometime !!!","error"),$("false"),x(!1),l(!1)})};r.useEffect(()=>{l(!0),j.post(K,{applicationId:_},B()).then(a=>{var o,i,d,m;((o=a==null?void 0:a.data)==null?void 0:o.status)==!0&&(console.log("success => ",a),H((i=a==null?void 0:a.data)==null?void 0:i.data),l(!1)),((d=a==null?void 0:a.data)==null?void 0:d.status)==!1&&(console.log("false rwh => ",a),H((m=a==null?void 0:a.data)==null?void 0:m.data),l(!1),O("/search/harvesting"),f("Please try again after sometime !!!","error"))}).catch(a=>{console.log("error rwh => ",a),l(!1),O("/search/harvesting"),f("Please try again after sometime !!!","error")})},[]);const te=async a=>{if(a.target.name=="harvestingImage"){U(!1);let o=a.target.files[0];if(!await ue(o))return;const d=await ge(o);console.log("1 Image geo location:",d),k(d),D(a.target.files[0]),I(URL.createObjectURL(a.target.files[0])),p.setFieldTouched("flongitude",c==null?void 0:c.longitude),p.setFieldValue("flatitude",c==null?void 0:c.latitude),console.log("--1-- name file on change..",o)}},ae=a=>{const o=a.target.name,i=a.target.value;o=="imageCheck"&&(S,i=="true"?(A(!0),p.setFieldValue("harvestingImgae","dddd")):A(!1))},[se,F]=r.useState(!1),[L,oe]=r.useState(""),[ne,ie]=r.useState(""),w=(a,o)=>{F(!0),a=="camera"&&pe(),E(null),oe(a),ie(o)},R=()=>F(!1),re=()=>{},ce=()=>{const a=document.createElement("a");a.href=v,U(!0),I(v),p.setFieldValue("harvestingImage",v),a.click(),R()};function le(a,o){const i=a.split(","),d=i[0].match(/:(.*?);/)[1],m=atob(i[1]);let C=m.length;const z=new Uint8Array(C);for(;C--;)z[C]=m.charCodeAt(C);return new File([z],o,{type:d})}const[ke,de]=r.useState(null);r.useState(0);const[v,E]=r.useState(),T=()=>{navigator.geolocation.getCurrentPosition(a=>{de(a),k(a==null?void 0:a.coords)},()=>{})},h=r.useRef(null),b=r.useRef(null),pe=async()=>{navigator.mediaDevices.getUserMedia({video:!0}).then(a=>{h.current.srcObject=a,h.current.onloadedmetadata=()=>{b.current.width=h.current.videoWidth,b.current.height=h.current.videoHeight,T()}}).catch(a=>{a.name==="NotAllowedError"?alert("Permission to access camera was not granted"):a.name==="NotFoundError"||a.name==="DevicesNotFoundError"?alert("No camera found"):a.name==="NotReadableError"||a.name==="TrackStartError"?alert("Could not start camera"):alert("Error accessing camera"),console.log("Error accessing camera:",a)})},me=()=>{b.current.getContext("2d").drawImage(h.current,0,0);const o=b.current.toDataURL("image/jpg");E(o)};async function ge(a,o){const i=await Ne.parse(a),{latitude:d,longitude:m}=i!=null&&i.latitude&&(i!=null&&i.longitude)?{latitude:i.latitude,longitude:i.longitude}:(alert("Image does not have location. Turn on location first and then take a picture to upload..."),p.setFieldValue("harvestingImage",""));return{latitude:d,longitude:m}}async function ue(a,o){return await He(a)?!0:(p.setFieldValue("harvestingImage",""),!1)}let y=V;return r.useEffect(()=>{g=="utc"&&l(!0),g=="utc"&&j.post(X,{applicationId:_},B()).then(a=>{var o;console.log("getting tc data => ",a),J((o=a==null?void 0:a.data)==null?void 0:o.data),l(!1)}).catch(a=>{console.log("error getting tc data => ",a),l(!1)})},[]),n(S,{children:[t&&e(_e,{}),e($e,{openScreen:q,id:_,navigation:()=>ee(),closePopUp:()=>x(!1),canSubmit:Y,type:"harvesting"}),n("div",{className:"w-full",children:[n("h1",{className:" text-center font-bold text-xl border-b-2 border-gray-700 mx-4",children:["Field Verification ",e("br",{}),"Rain Water Harvesting "]}),e("div",{className:"p-4 flex flex-col gap-y-4",children:n("div",{className:" bg-indigo-50 border-2 border-indigo-500 my-2 mx-1",children:[e("h1",{className:"text-center font-semibold bg-blue-700 text-white uppercase text-lg",children:e("span",{children:"Water Harvesting Declaration"})}),n("div",{className:"p-2",children:[n("div",{className:"grid grid-cols-12 text-sm pb-2",children:[e("span",{className:" col-span-6",children:"Application No."}),e("span",{className:"col-span-6 font-semibold",children:(s==null?void 0:s.applicationNo)==""?"N/A":s==null?void 0:s.applicationNo})]}),n("div",{className:"grid grid-cols-12 text-sm pb-2",children:[e("span",{className:" col-span-6 ",children:"Does Completion of Water Harvesting is done before 31-03-2017?"}),e("span",{className:"col-span-6 font-semibold",children:s!=null&&s.completionBefore2017?"Yes":"No"})]}),n("div",{className:"grid grid-cols-12 text-sm pb-2",children:[e("span",{className:" col-span-6 ",children:"Holding No."}),e("span",{className:"col-span-6 font-semibold",children:(s==null?void 0:s.holdingNo)==""?"N/A":s==null?void 0:s.holdingNo})]}),n("div",{className:"grid grid-cols-12 text-sm pb-2",children:[e("span",{className:" col-span-6 ",children:"Name"}),e("span",{className:"col-span-6 font-semibold",children:(s==null?void 0:s.applicantName)==""?"N/A":s==null?void 0:s.applicantName})]}),n("div",{className:"grid grid-cols-12 text-sm pb-2",children:[e("span",{className:" col-span-6 ",children:"Guardian Name"}),e("span",{className:"col-span-6 font-semibold",children:(s==null?void 0:s.guardianName)==""?"N/A":s==null?void 0:s.guardianName})]}),n("div",{className:"grid grid-cols-12 text-sm pb-2",children:[e("span",{className:" col-span-6 ",children:"Ward No."}),e("span",{className:"col-span-6 font-semibold",children:(s==null?void 0:s.wardNo)==""?"N/A":s==null?void 0:s.wardNo})]}),n("div",{className:"grid grid-cols-12 text-sm pb-2",children:[e("span",{className:" col-span-6 ",children:"Address"}),e("span",{className:"col-span-6 font-semibold",children:(s==null?void 0:s.propertyAddress)==""?"N/A":s==null?void 0:s.propertyAddress})]}),n("div",{className:"grid grid-cols-12 text-sm pb-2",children:[e("span",{className:" col-span-6 ",children:"Mobile No."}),e("span",{className:"col-span-6 font-semibold",children:(s==null?void 0:s.mobileNo)==""?"N/A":s==null?void 0:s.mobileNo})]}),n("div",{className:"grid grid-cols-12 text-sm pb-2",children:[e("span",{className:" col-span-6 ",children:"Date of Completion of Water Harvesting Structure"}),e("span",{className:"col-span-6 font-semibold",children:(s==null?void 0:s.dateOfCompletion)==""?"N/A":s==null?void 0:s.dateOfCompletion})]}),n("form",{className:"grid grid-cols-12 text-sm pb-2 border-2 border-indigo-400 rounded-md mt-4",onChange:p.handleChange,onSubmit:p.handleSubmit,children:[e("span",{className:" col-span-12 font-semibold bg-indigo-500 text-white uppercase px-2 py-1 text-md",children:"Water Harvesting Image"}),e("span",{className:"col-span-12 my-2 px-2",children:n("div",{className:"grid grid-cols-12 text-sm pb-2 items-center",children:[e("span",{className:"col-span-4 font-semibold",children:"Self Assessed : "}),e("span",{className:"col-span-8 text-center flex justify-center",children:e("img",{src:`${y}/${s==null?void 0:s.harvestingImage}`,alt:"Harvesting Image",srcset:"",className:"w-32 cursor-pointer rounded-md shadow-md",onClick:()=>w("image",`${y}/${s==null?void 0:s.harvestingImage}`)})})]})}),g=="utc"&&e("span",{className:"col-span-12 my-2 px-2",children:n("div",{className:"grid grid-cols-12 text-sm pb-2 items-center",children:[e("span",{className:"col-span-4 font-semibold",children:"Agency TC : "}),e("span",{className:"col-span-8 text-center flex justify-center",children:e("img",{src:`${y}/${u==null?void 0:u.doc_path}`,alt:"Harvesting Image",srcset:"",className:"w-32 cursor-pointer rounded-md shadow-md",onClick:()=>w("image",`${y}/${u==null?void 0:u.doc_path}`)})})]})}),e("div",{className:"col-span-12 px-2",children:n("div",{className:"grid grid-cols-12 text-sm pb-2",children:[e("span",{className:"col-span-5 font-semibold",children:"Check :"}),n("span",{className:"col-span-7 flex gap-2",onClick:ae,children:[n("span",{className:"flex gap-1",children:[e("input",{type:"radio",name:"imageCheck",required:!0,id:"check1",value:!0}),e("label",{htmlFor:"check 1",children:"Correct"})]}),n("span",{className:"flex gap-1",children:[e("input",{type:"radio",name:"imageCheck",required:!0,id:"check2",value:!1}),e("label",{htmlFor:"check 2",children:"Incorrect"})]})]})]})}),N!=null&&e("span",{className:"col-span-12 my-2 px-2",children:n("div",{className:"grid grid-cols-12 text-sm pb-2 items-center",children:[e("span",{className:"col-span-4 font-semibold",children:"Preview : "}),e("span",{className:"col-span-8 text-center flex justify-center",children:e("img",{src:N??`${y}/${s==null?void 0:s.harvestingImage}`,alt:"Harvesting Image",srcset:"",className:"w-32 cursor-pointer rounded-md shadow-md",onClick:()=>w("image")})})]})}),e("div",{className:"col-span-12 px-2",children:g=="tc"&&n("div",{className:"grid grid-cols-12 text-sm pb-2",children:[n("span",{className:"col-span-12 grid grid-cols-12 mb-2",children:[e("span",{className:"col-span-4 text-sm flex items-center font-semibold",children:"Upload :"}),e("span",{className:"col-span-5 text-sm",children:e("input",{onChange:a=>te(a),type:"file",name:"harvestingImage",id:"",accept:".jpg, .jpeg",className:" bg-white px-2 py-1 w-full rounded-sm shadow-sm border-[1px] border-gray-400"})}),e("span",{className:"text-red-500 text-xs col-span-2 flex justify-center items-center",children:"OR"}),n("span",{className:"col-span-1 text-sm flex items-center justify-end",children:[e("abbr",{title:"Click to capture image",onClick:()=>w("camera",""),className:"cursor-pointer",children:e("span",{className:"text-xl",children:e(be,{})})})," "]})]}),e("span",{className:"col-span-12 text-center mb-2",children:p.touched.harvestingImage&&p.errors.harvestingImage&&e(S,{children:e("span",{className:"text-red-600 text-xs",children:p.errors.harvestingImage})})}),n("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center font-semibold",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:c==null?void 0:c.latitude})})]}),n("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center font-semibold",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:c==null?void 0:c.longitude})})]})]})}),e("span",{className:" col-span-12 font-semibold text-center my-4 px-2",children:e("button",{type:"submit",className:"px-4 py-1.5 mr-4 text-sm text-white rounded-sm shadow-md bg-green-500 hover:bg-green-600 focus:bg-green-600",children:"Forward"})})]})]})]})})]}),e(Se,{isOpen:se,onAfterOpen:re,className:"z-20 h-screen w-screen backdrop-blur-sm flex flex-row justify-center items-center overflow-auto",contentLabel:"Example Modal",children:n("div",{className:" relative rounded-lg shadow-xl border-2 border-gray-50 px-0 animate__animated animate__zoomIn animate__faster",style:{width:"95vw",height:"80vh"},children:[e("div",{className:"absolute top-2 z-40 bg-red-200 hover:bg-red-300 right-2 rounded-full p-2 cursor-pointer",onClick:R,children:e(xe,{fontSize:10})}),L=="image"&&e("div",{className:"w-full h-full flex items-center justify-center",children:e("img",{src:ne,alt:"",srcset:""})}),L=="camera"&&n("div",{className:"mt-6 w-full",children:[e("video",{ref:h,autoPlay:!0,className:""}),e("canvas",{ref:b,style:{display:"none"}}),e("div",{className:"w-full text-center my-4",children:e("button",{onClick:()=>(me(),T()),className:"text-sm px-4 py-1 bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 text-white rounded-md shadow-md",children:"Capture"})}),v&&n(S,{children:[e("img",{src:v,alt:"Captured Image"}),e("div",{className:"w-full text-center my-4",children:e("button",{onClick:()=>ce(),className:"text-sm px-4 py-1 bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 text-white rounded-md shadow-md",children:"Save"})})]})]})]})})]})};export{We as default};
