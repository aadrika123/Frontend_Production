import{d as ta,r,e as ea,j as t,F as la,b as s,l as ia,c as B,A as X,P as oa}from"./index-a95eb77b.js";import{u as ra}from"./formik.esm-4d3d9d33.js";import{c as sa,b as da,a as ma}from"./index.esm-299ea5ab.js";/* empty css                */import{R as ca}from"./Hourglass-888952ed.js";const ha=()=>{const g=ta(),{notify:c,setisLoggedIn:$,setheartBeatCounter:z}=r.useContext(ea),[d,G]=r.useState(null),[i,H]=r.useState(),{api_login:V,api_getPermission:W}=oa(),[Y,w]=r.useState(!1),K=sa({email:da().required("Enter email"),password:ma().required("Enter password")}),e=ra({initialValues:{email:"",password:""},onSubmit:l=>{aa()},validationSchema:K}),f=["TAX COLLECTOR","ULB TAX COLLECTOR","TEAM LEADER","JUNIOR ENGINEER","TAX DAROGA"],Q=r.useMemo(()=>Array.isArray(d)&&d.some(l=>f.includes(l)),[d]);r.useEffect(()=>{var l,a,m;d!=null&&(Q?(c("Login Successfull !!! ","success"),window.localStorage.setItem("menuList",JSON.stringify((l=i==null?void 0:i.userDetails)==null?void 0:l.menuPermission)),window.localStorage.setItem("userName",JSON.stringify((a=i==null?void 0:i.userDetails)==null?void 0:a.name)),window.localStorage.setItem("roles",JSON.stringify((m=i==null?void 0:i.userDetails)==null?void 0:m.role)),g("/dashboard")):c("You don't have permission of Tax Collector !!!","warn"))},[d]);const u=JSON.parse(window.localStorage.getItem("roles")),n=window.localStorage.getItem("token"),Z=r.useMemo(()=>Array.isArray(u)&&u.some(l=>f.includes(l)),[u,n]);r.useEffect(()=>{n!=""&&n!=null&&n!=null&&Z&&g("/dashboard")},[]);const aa=()=>{let l={email:e.values.email,password:e.values.password,type:"mobile"};console.log("--1--before login send...",l),B.post(V,l,X()).then(function(a){var m,h,x,b,N,S,y,I,v,E,A,L,p,D,O,R,k,C,T,_,j,J,P,F,M;console.log("login response => ",a),a.data.status==!0?(console.log("--2--login response...",a),window.localStorage.setItem("token",(h=(m=a==null?void 0:a.data)==null?void 0:m.data)==null?void 0:h.token),window.localStorage.setItem("isLoggedIn",!0),window.localStorage.setItem("userEmail",(N=(b=(x=a==null?void 0:a.data)==null?void 0:x.data)==null?void 0:b.userDetails)==null?void 0:N.email),window.localStorage.setItem("userName",(I=(y=(S=a==null?void 0:a.data)==null?void 0:S.data)==null?void 0:y.userDetails)==null?void 0:I.name),window.localStorage.setItem("userType",(A=(E=(v=a==null?void 0:a.data)==null?void 0:v.data)==null?void 0:E.userDetails)==null?void 0:A.user_type),window.localStorage.setItem("userMobile",(D=(p=(L=a==null?void 0:a.data)==null?void 0:L.data)==null?void 0:p.userDetails)==null?void 0:D.mobile),window.localStorage.setItem("ulbId",(k=(R=(O=a==null?void 0:a.data)==null?void 0:O.data)==null?void 0:R.userDetails)==null?void 0:k.ulb_id),window.localStorage.setItem("device","mobile"),window.localStorage.setItem("userUlbName",JSON.stringify((_=(T=(C=a==null?void 0:a.data)==null?void 0:C.data)==null?void 0:T.userDetails)==null?void 0:_.ulbName)),H((j=a==null?void 0:a.data)==null?void 0:j.data),G((F=(P=(J=a==null?void 0:a.data)==null?void 0:J.data)==null?void 0:P.userDetails)==null?void 0:F.role),z(o=>o+1),$(!0),B.post(W,{moduleId:1},X()).then(o=>{var U,q;console.log("getPermission response => ",o),o.data.status==!0&&window.localStorage.setItem("menuList",JSON.stringify((q=(U=o==null?void 0:o.data)==null?void 0:U.data)==null?void 0:q.permission))}).catch(o=>{console.log("getPermission error => ",o)})):(w(!1),c((M=a==null?void 0:a.data)==null?void 0:M.message,"error"))}).catch(function(a){w(!1),console.log("--2--login error...",a),c("Something went wrong !!! ","error")})};return t(la,{children:t("div",{className:" h-screen bg-zinc-100 flex flex-row flex-wrap justify-center items-center",children:s("form",{onChange:e.handleChange,onSubmit:e.handleSubmit,className:"flex flex-col gap-2 w-max h-max shadow-lg rounded-md px-10 py-4 bg-white text-zinc-700 animate__animated animate__fadeInDown",children:[s("div",{className:"flex flex-row flex-wrap gap-2 items-center justify-center",children:[t("img",{src:ia,alt:"",className:"w-16"}),s("div",{className:"text-xl uppercase tracking-wide font-semibold text-center",children:["Urban Development & ",t("br",{})," Housing Department"]})]}),t("hr",{}),s("div",{className:"mt-6 flex flex-col flex-wrap gap-2",children:[t("label",{htmlFor:"email",className:"text-sm",children:"Email :"}),t("input",{type:"email",name:"email",id:"email",className:" rounded-md bg-transparent border-t-[1px] border-l-[1px] shadow-md bg-indigo-50 focus:bg-white px-4 py-2 text-sm focus:outline-indigo-600",placeholder:"Enter email"}),e.errors.email&&e.touched.email&&t("span",{className:"text-red-600 text-xs",children:e.errors.email})]}),s("div",{className:"mt-4 flex flex-col flex-wrap gap-2",children:[t("label",{htmlFor:"password",className:"text-sm",children:"Password :"}),t("input",{type:"password",name:"password",id:"password",className:" rounded-md bg-transparent border-t-[1px] border-l-[1px] shadow-md bg-indigo-50 focus:bg-white px-4 py-2 text-sm focus:outline-indigo-600",placeholder:"Enter password"}),e.errors.password&&e.touched.password&&t("span",{className:"text-red-600 text-xs",children:e.errors.password})]}),t("div",{className:"text-center mb-6 mt-4",children:Y?t("div",{className:"flex justify-center",children:t(ca,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"25",visible:!0})}):s("button",{type:"submit",className:"px-4 py-1.5 bg-green-200 hover:bg-green-300 rounded-md shadow-md text-sm",children:[" ","Login"," "]})})]})})})};export{ha as default};
