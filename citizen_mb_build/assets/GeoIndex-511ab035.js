import{R as $,_ as de,c as Je,r as n,a as Ke,k as Qe,A as j,h as G,d as Xe,e as M,g as Ze,j as s,F as h,b as e,M as ie,P as De,G as et}from"./index-678ed88b.js";import{F as q,A as tt,t as at}from"./full.esm-bf2f2a3b.js";import{I as re}from"./index.esm-dfc1b8f0.js";import{u as oe}from"./useSetTitle-557ecee6.js";/* empty css                */import"./iconBase-b22b1151.js";const B="/assets/photo-506bbc5b.png",st=$.lazy(()=>de(()=>import("./CommonLoader-e10153bd.js"),["assets/CommonLoader-e10153bd.js","assets/index-678ed88b.js","assets/index-73831e11.css","assets/BeatLoader-dda4ef82.js"])),lt=$.lazy(()=>de(()=>import("./ForwardScreen-d7561451.js"),["assets/ForwardScreen-d7561451.js","assets/index-678ed88b.js","assets/index-73831e11.css","assets/index.esm-dfc1b8f0.js","assets/iconBase-b22b1151.js","assets/Blocks-aaf54b05.js"])),pt=()=>{const{notify:v,roleName:N}=$.useContext(Je),[i,H]=n.useState(),[F,me]=n.useState(null),W=Ke(),[ge,C]=n.useState(""),[pe,ue]=n.useState(),[L,Y]=n.useState(null),[r,J]=n.useState(),[fe,K]=n.useState(!1),[he,xe]=n.useState(),[k,Q]=n.useState(null),[o,X]=n.useState(),[be,Z]=n.useState(!1),[Ne,we]=n.useState(),[U,D]=n.useState(null),[d,ee]=n.useState(),[ye,te]=n.useState(!1),[w,Ie]=n.useState(0),[nt,ve]=n.useState(!1),[Se,y]=n.useState(!1),[_e,z]=n.useState(""),[ae,p]=n.useState(!1),{getTcData:Fe,api_getStaticSafDetails:Ce,api_getgbSafDetails:je,post_safGeoTagging:Le,post_gbSafGeoTagging:ke}=De(),{id:x,type:g,isBack:se}=Qe();g=="saf"&&oe("SAF Geo-Tagging"),g=="gbSaf"&&oe("GB SAF Geo-Tagging"),n.useEffect(()=>{setTimeout(()=>{p(!1)},1e4),p(!0),N=="utc"&&Re(),g=="saf"?ze():Ue()},[N,g,x]);const Ue=()=>{j.post(je,{applicationId:x},G()).then(t=>{var a;console.log("getting application data => ",t),H((a=t==null?void 0:t.data)==null?void 0:a.data)}).catch(t=>{console.log("getting application data error => ",t)}).finally(()=>p(!1))},ze=()=>{j.post(Ce,{applicationId:x},G()).then(t=>{var a;console.log("getting application data => ",t),N=="tc"&&p(!1),H((a=t==null?void 0:t.data)==null?void 0:a.data)}).catch(t=>{console.log("getting application data error => ",t),N=="tc"&&p(!1)})},Re=()=>{j.post(Fe,{safId:x},G()).then(t=>{var a,l,m,f;((a=t==null?void 0:t.data)==null?void 0:a.status)==!0&&(console.log("getting tc data => ",t),me((m=(l=t==null?void 0:t.data)==null?void 0:l.data)==null?void 0:m.geoTagging),p(!1)),((f=t==null?void 0:t.data)==null?void 0:f.status)==!1&&(p(!1),W("/search/property"),v("Please try again after sometime !!!","error"))}).catch(t=>{console.log("error getting tc data => ",t),W("/search/property"),v("Something went wrong !!!","error"),p(!1)})},Te=Xe({frontImage:M().required("required to upload"),leftImage:M().required("required to upload"),rightImage:M().required("required to upload")}),c=Ze({initialValues:{frontImage:"",leftImage:"",rightImage:""},onSubmit:t=>{console.log("submitting images => ",t),y(!0),z("forward")},validationSchema:Te}),Ae=()=>{p(!0);let t;g=="saf"&&(t=Le),g=="gbSaf"&&(t=ke);let a=new FormData;a.append("safId",x),a.append("directionType[2]","Front"),fe?a.append("imagePath[2]",R(L,"FrontImage.jpg")):a.append("imagePath[2]",pe),a.append("longitude[2]",r==null?void 0:r.longitude),a.append("latitude[2]",r==null?void 0:r.latitude),a.append("directionType[1]","Right"),be?a.append("imagePath[1]",R(k,"RightImage.jpg")):a.append("imagePath[1]",he),a.append("longitude[1]",o==null?void 0:o.longitude),a.append("latitude[1]",o==null?void 0:o.latitude),a.append("directionType[0]","Left"),ye?a.append("imagePath[0]",R(U,"LeftImage.jpg")):a.append("imagePath[0]",Ne),a.append("longitude[0]",d==null?void 0:d.longitude),a.append("latitude[0]",d==null?void 0:d.latitude),j.post(t,a,tt()).then(l=>{var m,f,b,_;C((m=l==null?void 0:l.data)==null?void 0:m.status),((f=l==null?void 0:l.data)==null?void 0:f.status)==!0&&(console.log("success images",l),v("Geo-Tagged Successfully","success"),(i==null?void 0:i.payment_status)==0?window.location.replace(`/property/viewDemand/${x}`):(ve(!0),C("true"))),((b=l==null?void 0:l.data)==null?void 0:b.status)==!1&&(console.log("error images",l),v((_=l==null?void 0:l.data)==null?void 0:_.message,"error"),alert(l==null?void 0:l.data),C("false"),y(!1))}).catch(l=>{console.log("error images => ",l),v("Server Error","error"),alert(l),C("false"),y(!1)}).finally(()=>p(!1))};function R(t,a){const l=t.split(","),m=l[0].match(/:(.*?);/)[1],f=atob(l[1]);let b=f.length;const _=new Uint8Array(b);for(;b--;)_[b]=f.charCodeAt(b);return new File([_],a,{type:m})}const[ct,Pe]=n.useState(null);n.useState(0);const Oe=()=>{navigator.geolocation.getCurrentPosition(t=>{Pe(t),w==1&&J(t==null?void 0:t.coords),w==3&&ee(t==null?void 0:t.coords),w==2&&X(t==null?void 0:t.coords)},()=>{})},I=n.useRef(null),S=n.useRef(null),[u,T]=n.useState(null);n.useEffect(()=>{Oe()});const Ee=async t=>{navigator.mediaDevices.getUserMedia({video:!0}).then(a=>{I.current.srcObject=a,I.current.onloadedmetadata=()=>{S.current.width=I.current.videoWidth,S.current.height=I.current.videoHeight}}).catch(a=>{a.name==="NotAllowedError"?alert("Permission to access camera was not granted"):a.name==="NotFoundError"||a.name==="DevicesNotFoundError"?alert("No camera found"):a.name==="NotReadableError"||a.name==="TrackStartError"?alert("Could not start camera"):alert("Error accessing camera"),console.log("Error accessing camera:",a)})},Ve=()=>{S.current.getContext("2d").drawImage(I.current,0,0);const a=S.current.toDataURL("image/jpg");T(a),console.log("image data captured => ",a)};async function A(t,a){const l=await at.parse(t),{latitude:m,longitude:f}=l!=null&&l.latitude&&(l!=null&&l.longitude)?{latitude:l.latitude,longitude:l.longitude}:(alert("Image does not have location. Turn on location first and then take a picture to upload..."),le(a));return{latitude:m,longitude:f}}const le=t=>{t==1&&c.setFieldValue("frontImage",""),t==2&&c.setFieldValue("rightImage",""),t==3&&c.setFieldValue("leftImage","")};async function P(t,a){return await et(t)?!0:(le(a),!1)}const O=async t=>{if(t.target.name=="frontImage"){K(!1);let a=t.target.files[0];if(console.log("image => ",t.target.files[0]),!await P(a,1))return;const m=await A(a,1);console.log("1 Image geo location:",m),J(m),ue(t.target.files[0]),Y(URL.createObjectURL(t.target.files[0])),c.setFieldValue("flongitude",r==null?void 0:r.longitude),c.setFieldValue("flatitude",r==null?void 0:r.latitude),console.log("--1-- name file on change..",a)}if(t.target.name=="rightImage"){Z(!1);let a=t.target.files[0];if(!await P(a,2))return;const m=await A(a,2);console.log("2 Image geo location:",m),X(m),xe(t.target.files[0]),Q(URL.createObjectURL(t.target.files[0])),c.setFieldValue("rlongitude",o==null?void 0:o.longitude),c.setFieldValue("rlatitude",o==null?void 0:o.latitude),console.log("--2-- name file on change..",a)}if(t.target.name=="leftImage"){te(!1);let a=t.target.files[0];if(!await P(a,3))return;const m=await A(a,3);console.log("3 Image geo location:",m),ee(m),we(t.target.files[0]),D(URL.createObjectURL(t.target.files[0])),c.setFieldValue("llongitude",d==null?void 0:d.longitude),c.setFieldValue("llatitude",d==null?void 0:d.latitude),console.log("--3-- name file on change..",a)}},[Ge,ne]=n.useState(!1),[Me,ce]=n.useState(!1),E=t=>{ne(!0),Ee(),T(null),Ie(t)},qe=t=>{ce(!0),T(t)},V=()=>{ne(!1),ce(!1)},Be=()=>{},$e=()=>{},He=()=>{const t=document.createElement("a");t.href=u,w==1&&(K(!0),Y(u),c.setFieldValue("frontImage",u)),w==2&&(Z(!0),Q(u),c.setFieldValue("rightImage",u)),w==3&&(te(!0),D(u),c.setFieldValue("leftImage",u)),t.click(),V()},We=()=>{y(!0),z("forward")},Ye=()=>{y(!0),z("backward")};return s(h,{children:[ae&&e(st,{}),e(lt,{roleName:N,action:_e,openScreen:Se,id:x,navigation:()=>Ae(),closePopUp:()=>y(!1),canSubmit:ge,type:g}),s("div",{className:"w-full",children:[s("h1",{className:" text-center font-bold text-xl border-b-2 border-gray-700 mx-4",children:["Field Verification ",e("br",{}),"Geo-Tagging "]}),s("div",{className:"p-4 flex flex-col gap-y-4",children:[s("div",{className:"w-full items-center justify-center px-4 shadow-sm flex md:flex-row flex-col flex-wrap gap-2 md:justify-evenly bg-indigo-50",children:[s("span",{className:"grid grid-cols-12 w-full text-sm gap-2 my-1",children:[e("span",{className:"col-span-6",children:"Your Application No.:"})," ",e("span",{className:"font-semibold text-base col-span-6",children:i==null?void 0:i.saf_no})]}),s("span",{className:"grid grid-cols-12 w-full text-sm  gap-2 my-1",children:[e("span",{className:"col-span-6",children:"Application Type:"})," ",e("span",{className:"font-semibold text-base col-span-6",children:i==null?void 0:i.assessment_type})]}),s("span",{className:"grid grid-cols-12 w-full text-sm  gap-1",children:[s("span",{className:"col-span-6",children:[g=="saf"&&"Property",g=="gbSaf"&&"Govt. Building Usage"," Type:"]})," ",s("span",{className:"font-semibold text-base col-span-6",children:[g=="saf"&&(i==null?void 0:i.property_type),g=="gbSaf"&&(i==null?void 0:i.building_type)]})]}),s("span",{className:"grid grid-cols-12 w-full text-sm  gap-2 my-1",children:[e("span",{className:"col-span-6",children:"Apply Date:"})," ",e("span",{className:"font-semibold text-base col-span-6",children:i==null?void 0:i.application_date})]})]}),N=="tc"?e(h,{children:!ae&&s("form",{className:"border-2 border-blue-700 bg-blue-50 mb-4",onChange:c.handleChange,onSubmit:c.handleSubmit,children:[e("h1",{className:"text-center font-semibold bg-blue-700 text-white uppercase text-lg",children:"Upload Image"}),(se=="true"||se==!0)&&e("span",{className:"text-red-500 text-xs text-center pl-4 font-semibold pt-2",children:"Backwarded for Geo-Tagging"}),s("div",{className:"bg-indigo-50 border-2 border-indigo-500 my-2 mx-1",children:[e("div",{className:"text-white bg-indigo-500 px-2 font-semibold",children:"Front Image"}),e("div",{className:"px-2 py-2",children:s("div",{className:"grid grid-cols-12 text-sm pb-2 px-2",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",children:e("img",{src:L??B,alt:"Front Image",srcset:"",className:"w-32"})}),s("span",{className:"col-span-12 grid grid-cols-12 mb-2",children:[e("span",{className:"col-span-8 text-sm flex items-center",children:"Capture Image :"}),e("span",{className:"col-span-5 text-sm",children:e("input",{type:"file",onChange:O,name:"frontImage",id:"",accept:".jpg, .jpeg",className:"bg-white px-2 py-1 w-full rounded-sm shadow-sm border-[1px] border-gray-400"})}),e("span",{className:"text-red-500 text-xs col-span-2 flex justify-center items-center",children:"OR"}),s("span",{className:"col-span-1 text-sm flex items-center justify-end",children:[e("abbr",{title:"Click to capture image",onClick:()=>E(1),className:"cursor-pointer",children:e("span",{className:"text-xl",children:e(q,{fontSize:"large"})})})," "]})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:r==null?void 0:r.latitude})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:r==null?void 0:r.longitude})})]}),e("span",{className:"col-span-12 mt-2 text-center",children:c.touched.frontImage&&c.errors.frontImage&&e(h,{children:e("span",{className:"text-red-600 text-xs",children:c.errors.frontImage})})})]})})]}),s("div",{className:"bg-indigo-50 border-2 border-indigo-500 my-2 mx-1",children:[e("div",{className:"text-white bg-indigo-500 px-2 font-semibold",children:"Right Image"}),e("div",{className:"px-2 py-2",children:s("div",{className:"grid grid-cols-12 text-sm pb-2 px-4",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",children:e("img",{src:k??B,alt:"Front Image",srcset:"",className:"w-32"})}),s("span",{className:"col-span-12 grid grid-cols-12 mb-2",children:[e("span",{className:"col-span-8 text-sm flex items-center",children:"Capture Image :"}),e("span",{className:"col-span-5 text-sm",children:e("input",{type:"file",onChange:O,name:"rightImage",id:"",accept:".jpg, .jpeg",className:"bg-white px-2 py-1 w-full rounded-sm shadow-sm border-[1px] border-gray-400"})}),e("span",{className:"text-red-500 text-xs col-span-2 flex justify-center items-center",children:"OR"}),s("span",{className:"col-span-1 text-sm flex items-center justify-end",children:[e("abbr",{title:"Click to capture image",onClick:()=>E(2),className:"cursor-pointer",children:e("span",{className:"text-xl",children:e(q,{fontSize:"large"})})})," "]})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:o==null?void 0:o.latitude})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:o==null?void 0:o.longitude})})]}),e("span",{className:"col-span-12 mt-2 text-center",children:c.touched.rightImage&&c.errors.rightImage&&e(h,{children:e("span",{className:"text-red-600 text-xs",children:c.errors.rightImage})})})]})})]}),s("div",{className:"bg-indigo-50 border-2 border-indigo-500 my-2 mx-1",children:[e("div",{className:"text-white bg-indigo-500 px-2 font-semibold",children:"Left Image"}),e("div",{className:"px-2 py-2",children:s("div",{className:"grid grid-cols-12 text-sm pb-2 px-4",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",children:e("img",{src:U??B,alt:"Front Image",srcset:"",className:"w-32"})}),s("span",{className:"col-span-12 grid grid-cols-12 mb-2",children:[e("span",{className:"col-span-8 text-sm flex items-center",children:"Capture Image :"}),e("span",{className:"col-span-5 text-sm",children:e("input",{type:"file",onChange:O,name:"leftImage",id:"",accept:".jpg, .jpeg",className:"bg-white px-2 py-1 w-full rounded-sm shadow-sm border-[1px] border-gray-400"})}),e("span",{className:"text-red-500 text-xs col-span-2 flex justify-center items-center",children:"OR"}),s("span",{className:"col-span-1 text-sm flex items-center justify-end",children:[e("abbr",{title:"Click to capture image",onClick:()=>E(3),className:"cursor-pointer",children:e("span",{className:"text-xl",children:e(q,{fontSize:"large"})})})," "]})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:d==null?void 0:d.latitude})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:d==null?void 0:d.longitude})})]}),e("span",{className:"col-span-12 mt-2 text-center",children:c.touched.leftImage&&c.errors.leftImage&&e(h,{children:e("span",{className:"text-red-600 text-xs",children:c.errors.leftImage})})})]})})]}),e("div",{className:"w-full flex justify-center m-2",children:e("button",{type:"submit",className:"px-4 py-1.5 mr-4 text-sm text-white rounded-sm shadow-md bg-green-500 hover:bg-green-600 focus:bg-green-600",children:(i==null?void 0:i.payment_status)==0?"Submit & Pay":"Forward"})})]})}):e(h,{children:e("div",{className:"w-full",children:s("div",{className:"border-2 border-blue-700 bg-blue-50 mb-4",children:[e("h1",{className:"text-center font-semibold bg-blue-700 text-white uppercase text-lg",children:"Images"}),Array.isArray(F)&&(F==null?void 0:F.map(t=>e(h,{children:s("div",{className:"bg-indigo-50 border-2 border-indigo-500 my-2 mx-1",children:[s("div",{className:"text-white bg-indigo-500 px-2 font-semibold capitalize",children:[t==null?void 0:t.direction_type," Image"]}),e("div",{className:"px-2 py-2",children:s("div",{className:"grid grid-cols-12 text-sm pb-2 px-2",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",onClick:()=>qe(t==null?void 0:t.image_path),children:e("img",{src:`${t==null?void 0:t.image_path}`,alt:t==null?void 0:t.direction_type,srcset:"",className:"w-32"})}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:t==null?void 0:t.latitude})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:t==null?void 0:t.longitude})})]})]})})]})}))),s("div",{className:"w-full flex items-center justify-between m-2",children:[e("button",{onClick:()=>Ye(),className:"px-4 py-1.5 mr-4 text-sm text-white rounded-sm shadow-md bg-red-500 hover:bg-red-600 focus:bg-red-600",children:"Backward"}),e("button",{onClick:()=>We(),className:"px-4 py-1.5 mr-4 text-sm text-white rounded-sm shadow-md bg-green-500 hover:bg-green-600 focus:bg-green-600",children:"Forward"})]})]})})})]})]}),e(ie,{isOpen:Ge,onAfterOpen:Be,className:"z-50 h-screen w-screen backdrop-blur-sm flex flex-row justify-center items-center overflow-auto",contentLabel:"Example Modal",children:s("div",{class:" animate__animated animate__zoomIn animate__faster rounded-lg md:ml-24 shadow-lg relative bg-gray-50 px-4 py-4 w-[90vw] mt-10 z-50 border-t-2 border-l-2 border-white overflow-auto",children:[e("div",{className:"absolute top-2 z-10 bg-red-200 hover:bg-red-300 right-2 rounded-full p-2 cursor-pointer",onClick:V,children:e(re,{fontSize:10})}),s("div",{className:"mt-6 w-full",children:[e("video",{ref:I,autoPlay:!0,className:""}),e("canvas",{ref:S,style:{display:"none"}}),e("div",{className:"w-full text-center my-4",children:e("button",{onClick:Ve,className:"text-sm px-4 py-1 bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 text-white rounded-md shadow-md",children:"Capture"})}),u&&s(h,{children:[e("img",{src:u,alt:"Captured Image"}),e("div",{className:"w-full text-center my-4",children:e("button",{onClick:He,className:"text-sm px-4 py-1 bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 text-white rounded-md shadow-md",children:"Save"})})]})]})]})}),e(ie,{isOpen:Me,onAfterOpen:$e,className:"z-20 h-screen w-screen backdrop-blur-sm flex flex-row justify-center items-center overflow-auto",contentLabel:"Example Modal",children:s("div",{className:" animate__animated animate__zoomIn animate__faster relative rounded-lg shadow-xl border-2 border-gray-50 px-0",style:{width:"95vw",height:"80vh"},children:[e("div",{className:"absolute top-2 z-40 bg-red-200 hover:bg-red-300 right-2 rounded-full p-2 cursor-pointer",onClick:V,children:e(re,{fontSize:10})}),e("div",{className:"w-full h-[77vh] overflow-auto flex flex-wrap items-center justify-center",children:e("img",{src:u,alt:"",srcset:""})})]})})]})};export{pt as default};
