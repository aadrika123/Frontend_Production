import{d as Q,r,e as Z,j as t,F as ee,b as s,l as te,c as M,A as q,P as ae}from"./index-ecdac0ad.js";import{u as le}from"./formik.esm-8bbe0021.js";import{c as ie,b as oe,a as re}from"./index.esm-8b2ed50e.js";/* empty css                */import{R as se}from"./Hourglass-dbf5f692.js";const ge=()=>{const g=Q(),{notify:c,setisLoggedIn:B,setheartBeatCounter:U}=r.useContext(Z),[d,X]=r.useState(null),[i,$]=r.useState(),{api_login:z,api_getPermission:G}=ae(),[H,w]=r.useState(!1),V=ie({email:oe().required("Enter email"),password:re().required("Enter password")}),a=le({initialValues:{email:"",password:""},onSubmit:l=>{K()},validationSchema:V}),f=["TAX COLLECTOR","ULB TAX COLLECTOR","TEAM LEADER","JUNIOR ENGINEER","TAX DAROGA"],W=r.useMemo(()=>Array.isArray(d)&&d.some(l=>f.includes(l)),[d]);r.useEffect(()=>{var l,e,m;d!=null&&(W?(c("Login Successfull !!! ","success"),window.localStorage.setItem("menuList",JSON.stringify((l=i==null?void 0:i.userDetails)==null?void 0:l.menuPermission)),window.localStorage.setItem("userName",JSON.stringify((e=i==null?void 0:i.userDetails)==null?void 0:e.name)),window.localStorage.setItem("roles",JSON.stringify((m=i==null?void 0:i.userDetails)==null?void 0:m.role)),g("/dashboard")):c("You don't have permission of Tax Collector !!!","warn"))},[d]);const u=JSON.parse(window.localStorage.getItem("roles")),n=window.localStorage.getItem("token"),Y=r.useMemo(()=>Array.isArray(u)&&u.some(l=>f.includes(l)),[u,n]);r.useEffect(()=>{n!=""&&n!=null&&n!=null&&Y&&g("/dashboard")},[]);const K=()=>{let l={email:a.values.email,password:a.values.password,type:"mobile"};console.log("--1--before login send...",l),M.post(z,l,q()).then(function(e){var m,h,x,b,S,N,y,I,v,p,E,A,L,D,O,R,k,C,T,_,j,P;console.log("login response => ",e),e.data.status==!0?(console.log("--2--login response...",e),window.localStorage.setItem("token",(h=(m=e==null?void 0:e.data)==null?void 0:m.data)==null?void 0:h.token),window.localStorage.setItem("isLoggedIn",!0),window.localStorage.setItem("userEmail",(S=(b=(x=e==null?void 0:e.data)==null?void 0:x.data)==null?void 0:b.userDetails)==null?void 0:S.email),window.localStorage.setItem("userName",(I=(y=(N=e==null?void 0:e.data)==null?void 0:N.data)==null?void 0:y.userDetails)==null?void 0:I.name),window.localStorage.setItem("userType",(E=(p=(v=e==null?void 0:e.data)==null?void 0:v.data)==null?void 0:p.userDetails)==null?void 0:E.user_type),window.localStorage.setItem("userMobile",(D=(L=(A=e==null?void 0:e.data)==null?void 0:A.data)==null?void 0:L.userDetails)==null?void 0:D.mobile),window.localStorage.setItem("ulbId",(k=(R=(O=e==null?void 0:e.data)==null?void 0:O.data)==null?void 0:R.userDetails)==null?void 0:k.ulb_id),window.localStorage.setItem("device","mobile"),$((C=e==null?void 0:e.data)==null?void 0:C.data),X((j=(_=(T=e==null?void 0:e.data)==null?void 0:T.data)==null?void 0:_.userDetails)==null?void 0:j.role),U(o=>o+1),B(!0),M.post(G,{moduleId:1},q()).then(o=>{var J,F;console.log("getPermission response => ",o),o.data.status==!0&&window.localStorage.setItem("menuList",JSON.stringify((F=(J=o==null?void 0:o.data)==null?void 0:J.data)==null?void 0:F.permission))}).catch(o=>{console.log("getPermission error => ",o)})):(w(!1),c((P=e==null?void 0:e.data)==null?void 0:P.message,"error"))}).catch(function(e){w(!1),console.log("--2--login error...",e),c("Something went wrong !!! ","error")})};return t(ee,{children:t("div",{className:" h-screen bg-zinc-100 flex flex-row flex-wrap justify-center items-center",children:s("form",{onChange:a.handleChange,onSubmit:a.handleSubmit,className:"flex flex-col gap-2 w-max h-max shadow-lg rounded-md px-10 py-4 bg-white text-zinc-700 animate__animated animate__fadeInDown",children:[s("div",{className:"flex flex-row flex-wrap gap-2 items-center justify-center",children:[t("img",{src:te,alt:"",className:"w-16"}),s("div",{className:"text-xl uppercase tracking-wide font-semibold text-center",children:["Urban Development & ",t("br",{})," Housing Department"]})]}),t("hr",{}),s("div",{className:"mt-6 flex flex-col flex-wrap gap-2",children:[t("label",{htmlFor:"email",className:"text-sm",children:"Email :"}),t("input",{type:"email",name:"email",id:"email",className:" rounded-md bg-transparent border-t-[1px] border-l-[1px] shadow-md bg-indigo-50 focus:bg-white px-4 py-2 text-sm focus:outline-indigo-600",placeholder:"Enter email"}),a.errors.email&&a.touched.email&&t("span",{className:"text-red-600 text-xs",children:a.errors.email})]}),s("div",{className:"mt-4 flex flex-col flex-wrap gap-2",children:[t("label",{htmlFor:"password",className:"text-sm",children:"Password :"}),t("input",{type:"password",name:"password",id:"password",className:" rounded-md bg-transparent border-t-[1px] border-l-[1px] shadow-md bg-indigo-50 focus:bg-white px-4 py-2 text-sm focus:outline-indigo-600",placeholder:"Enter password"}),a.errors.password&&a.touched.password&&t("span",{className:"text-red-600 text-xs",children:a.errors.password})]}),t("div",{className:"text-center mb-6 mt-4",children:H?t("div",{className:"flex justify-center",children:t(se,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"25",visible:!0})}):s("button",{type:"submit",className:"px-4 py-1.5 bg-green-200 hover:bg-green-300 rounded-md shadow-md text-sm",children:[" ","Login"," "]})})]})})})};export{ge as default};
