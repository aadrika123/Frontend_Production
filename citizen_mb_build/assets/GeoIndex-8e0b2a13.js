import{R as A,_ as D,c as Ce,r as n,d as Ue,a as Le,j as l,F as y,b as e}from"./index-5063306b.js";import{c as _e,a as P,u as Re}from"./index.esm-5e7901be.js";import{F as k,A as Pe,t as ke}from"./full.esm-3f97dac4.js";import{P as Ve}from"./ProjectApiList-f293eba9.js";import{a as X,A as Ae}from"./axios-28c6f114.js";import{M as ze}from"./index-fbeed632.js";import{I as Ee}from"./index.esm-a44adfc7.js";import{u as Z}from"./useSetTitle-9b5032b2.js";import{j as Te}from"./PowerupFunctions-13c4b560.js";import"./iconBase-0b91e11c.js";const V="/assets/photo-506bbc5b.png",Oe=A.lazy(()=>D(()=>import("./CommonLoader-75dae4cb.js"),["assets/CommonLoader-75dae4cb.js","assets/index-5063306b.js","assets/index-7fa08c41.css","assets/BeatLoader-556eb540.js"])),Ge=A.lazy(()=>D(()=>import("./ForwardScreen-2fad210d.js"),["assets/ForwardScreen-2fad210d.js","assets/index-5063306b.js","assets/index-7fa08c41.css","assets/axios-28c6f114.js","assets/index.esm-a44adfc7.js","assets/iconBase-0b91e11c.js","assets/Blocks-7633386f.js","assets/index.esm-5e7901be.js","assets/index-fbeed632.js","assets/ProjectApiList-f293eba9.js"])),De=()=>{A.useContext(Ce);const[d,ee]=n.useState(),{api_getgbSafDetails:te,post_safGeoTagging:ae,post_gbSafGeoTagging:se}=Ve(),{id:S,type:g}=Ue();g=="saf"&&Z("SAF Geo-Tagging"),g=="gbSaf"&&Z("GB SAF Geo-Tagging"),n.useEffect(()=>{setTimeout(()=>{b(!1)},1e4),b(!0),le()},[]);const le=()=>{X.post(te,{applicationId:S},Ae()).then(t=>{var a;console.log("getting application data => ",t),ee((a=t==null?void 0:t.data)==null?void 0:a.data)}).catch(t=>{console.log("getting application data error => ",t)}).finally(()=>b(!1))};Le();const[ne,w]=n.useState(""),[ce,oe]=n.useState(),[v,z]=n.useState(null),[o,E]=n.useState(),[ie,T]=n.useState(!1),[re,de]=n.useState(),[F,O]=n.useState(null),[i,G]=n.useState(),[me,M]=n.useState(!1),[ge,pe]=n.useState(),[j,q]=n.useState(null),[r,H]=n.useState(),[ue,B]=n.useState(!1),[h,fe]=n.useState(0),[Me,he]=n.useState(!1),[xe,I]=n.useState(!1),[$,b]=n.useState(!1),be=_e({frontImage:P().required("required to upload"),leftImage:P().required("required to upload"),rightImage:P().required("required to upload")}),c=Re({initialValues:{frontImage:"",leftImage:"",rightImage:""},onSubmit:t=>{console.log("submitting images => ",t),I(!0)},validationSchema:be}),Ne=()=>{b(!0);let t;g=="saf"&&(t=ae),g=="gbSaf"&&(t=se);let a=new FormData;a.append("safId",S),a.append("directionType[2]","Front"),ie?a.append("imagePath[2]",C(v,"FrontImage.jpg")):a.append("imagePath[2]",ce),a.append("longitude[2]",o==null?void 0:o.longitude),a.append("latitude[2]",o==null?void 0:o.latitude),a.append("directionType[1]","Right"),me?a.append("imagePath[1]",C(F,"RightImage.jpg")):a.append("imagePath[1]",re),a.append("longitude[1]",i==null?void 0:i.longitude),a.append("latitude[1]",i==null?void 0:i.latitude),a.append("directionType[0]","Left"),ue?a.append("imagePath[0]",C(j,"LeftImage.jpg")):a.append("imagePath[0]",ge),a.append("longitude[0]",r==null?void 0:r.longitude),a.append("latitude[0]",r==null?void 0:r.latitude),X.post(t,a,Pe()).then(s=>{var m,u,f;w((m=s==null?void 0:s.data)==null?void 0:m.status),((u=s==null?void 0:s.data)==null?void 0:u.status)==!0&&(console.log("success images",s),he(!0),w("true")),((f=s==null?void 0:s.data)==null?void 0:f.status)==!1&&(console.log("error images",s),alert(s==null?void 0:s.data),w("false"),I(!1))}).catch(s=>{console.log("error images => ",s),alert(s),w("false"),I(!1)}).finally(()=>b(!1))};function C(t,a){const s=t.split(","),m=s[0].match(/:(.*?);/)[1],u=atob(s[1]);let f=u.length;const Q=new Uint8Array(f);for(;f--;)Q[f]=u.charCodeAt(f);return new File([Q],a,{type:m})}const[qe,ye]=n.useState(null);n.useState(0);const we=()=>{navigator.geolocation.getCurrentPosition(t=>{ye(t),h==1&&E(t==null?void 0:t.coords),h==3&&H(t==null?void 0:t.coords),h==2&&G(t==null?void 0:t.coords)},()=>{})},x=n.useRef(null),N=n.useRef(null),[p,W]=n.useState(null);n.useEffect(()=>{we()});const Ie=async t=>{navigator.mediaDevices.getUserMedia({video:!0}).then(a=>{x.current.srcObject=a,x.current.onloadedmetadata=()=>{N.current.width=x.current.videoWidth,N.current.height=x.current.videoHeight}}).catch(a=>{a.name==="NotAllowedError"?alert("Permission to access camera was not granted"):a.name==="NotFoundError"||a.name==="DevicesNotFoundError"?alert("No camera found"):a.name==="NotReadableError"||a.name==="TrackStartError"?alert("Could not start camera"):alert("Error accessing camera"),console.log("Error accessing camera:",a)})},Se=()=>{N.current.getContext("2d").drawImage(x.current,0,0);const a=N.current.toDataURL("image/jpg");W(a),console.log("image data captured => ",a)};async function U(t,a){const s=await ke.parse(t),{latitude:m,longitude:u}=s!=null&&s.latitude&&(s!=null&&s.longitude)?{latitude:s.latitude,longitude:s.longitude}:(alert("Image does not have location. Turn on location first and then take a picture to upload..."),Y(a));return{latitude:m,longitude:u}}const Y=t=>{t==1&&c.setFieldValue("frontImage",""),t==2&&c.setFieldValue("rightImage",""),t==3&&c.setFieldValue("leftImage","")};async function L(t,a){return await Te(t)?!0:(Y(a),!1)}const _=async t=>{if(t.target.name=="frontImage"){T(!1);let a=t.target.files[0];if(console.log("image => ",t.target.files[0]),!await L(a,1))return;const m=await U(a,1);console.log("1 Image geo location:",m),E(m),oe(t.target.files[0]),z(URL.createObjectURL(t.target.files[0])),c.setFieldValue("flongitude",o==null?void 0:o.longitude),c.setFieldValue("flatitude",o==null?void 0:o.latitude),console.log("--1-- name file on change..",a)}if(t.target.name=="rightImage"){M(!1);let a=t.target.files[0];if(!await L(a,2))return;const m=await U(a,2);console.log("2 Image geo location:",m),G(m),de(t.target.files[0]),O(URL.createObjectURL(t.target.files[0])),c.setFieldValue("rlongitude",i==null?void 0:i.longitude),c.setFieldValue("rlatitude",i==null?void 0:i.latitude),console.log("--2-- name file on change..",a)}if(t.target.name=="leftImage"){B(!1);let a=t.target.files[0];if(!await L(a,3))return;const m=await U(a,3);console.log("3 Image geo location:",m),H(m),pe(t.target.files[0]),q(URL.createObjectURL(t.target.files[0])),c.setFieldValue("llongitude",r==null?void 0:r.longitude),c.setFieldValue("llatitude",r==null?void 0:r.latitude),console.log("--3-- name file on change..",a)}},[ve,J]=n.useState(!1),R=t=>{J(!0),Ie(),W(null),fe(t)},K=()=>J(!1),Fe=()=>{},je=()=>{const t=document.createElement("a");t.href=p,h==1&&(T(!0),z(p),c.setFieldValue("frontImage",p)),h==2&&(M(!0),O(p),c.setFieldValue("rightImage",p)),h==3&&(B(!0),q(p),c.setFieldValue("leftImage",p)),t.click(),K()};return l(y,{children:[$&&e(Oe,{}),e(Ge,{openScreen:xe,id:S,navigation:()=>Ne(),closePopUp:()=>I(!1),canSubmit:ne,type:g}),l("div",{className:"w-full",children:[l("h1",{className:" text-center font-bold text-xl border-b-2 border-gray-700 mx-4",children:["Field Verification ",e("br",{}),"Geo-Tagging "]}),l("div",{className:"p-4 flex flex-col gap-y-4",children:[l("div",{className:"w-full items-center justify-center px-4 shadow-sm flex md:flex-row flex-col flex-wrap gap-2 md:justify-evenly bg-indigo-50",children:[l("span",{className:"grid grid-cols-12 w-full text-sm gap-2 my-1",children:[e("span",{className:"col-span-6",children:"Your Application No.:"})," ",e("span",{className:"font-semibold text-base col-span-6",children:d==null?void 0:d.saf_no})]}),l("span",{className:"grid grid-cols-12 w-full text-sm  gap-2 my-1",children:[e("span",{className:"col-span-6",children:"Application Type:"})," ",e("span",{className:"font-semibold text-base col-span-6",children:d==null?void 0:d.assessment_type})]}),l("span",{className:"grid grid-cols-12 w-full text-sm  gap-1",children:[l("span",{className:"col-span-6",children:[g=="saf"&&"Property",g=="gbSaf"&&"Govt. Building Usage"," Type:"]})," ",l("span",{className:"font-semibold text-base col-span-6",children:[g=="saf"&&(d==null?void 0:d.property_type),g=="gbSaf"&&(d==null?void 0:d.building_type)]})]}),l("span",{className:"grid grid-cols-12 w-full text-sm  gap-2 my-1",children:[e("span",{className:"col-span-6",children:"Apply Date:"})," ",e("span",{className:"font-semibold text-base col-span-6",children:d==null?void 0:d.application_date})]})]}),!$&&l("form",{className:"border-2 border-blue-700 bg-blue-50 mb-4",onChange:c.handleChange,onSubmit:c.handleSubmit,children:[e("h1",{className:"text-center font-semibold bg-blue-700 text-white uppercase text-lg",children:"Upload Image"}),l("div",{className:"bg-indigo-50 border-2 border-indigo-500 my-2 mx-1",children:[e("div",{className:"text-white bg-indigo-500 px-2 font-semibold",children:"Front Image"}),e("div",{className:"px-2 py-2",children:l("div",{className:"grid grid-cols-12 text-sm pb-2 px-2",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",children:e("img",{src:v??V,alt:"Front Image",srcset:"",className:"w-32"})}),l("span",{className:"col-span-12 grid grid-cols-12 mb-2",children:[e("span",{className:"col-span-4 text-sm flex items-center",children:"Upload Image :"}),e("span",{className:"col-span-5 text-sm",children:e("input",{type:"file",onChange:_,name:"frontImage",id:"",accept:".jpg, .jpeg",className:"bg-white px-2 py-1 w-full rounded-sm shadow-sm border-[1px] border-gray-400"})}),e("span",{className:"text-red-500 text-xs col-span-2 flex justify-center items-center",children:"OR"}),l("span",{className:"col-span-1 text-sm flex items-center justify-end",children:[e("abbr",{title:"Click to capture image",onClick:()=>R(1),className:"cursor-pointer",children:e("span",{className:"text-xl",children:e(k,{})})})," "]})]}),l("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:o==null?void 0:o.latitude})})]}),l("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:o==null?void 0:o.longitude})})]}),e("span",{className:"col-span-12 mt-2 text-center",children:c.touched.frontImage&&c.errors.frontImage&&e(y,{children:e("span",{className:"text-red-600 text-xs",children:c.errors.frontImage})})})]})})]}),l("div",{className:"bg-indigo-50 border-2 border-indigo-500 my-2 mx-1",children:[e("div",{className:"text-white bg-indigo-500 px-2 font-semibold",children:"Right Image"}),e("div",{className:"px-2 py-2",children:l("div",{className:"grid grid-cols-12 text-sm pb-2 px-4",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",children:e("img",{src:F??V,alt:"Front Image",srcset:"",className:"w-32"})}),l("span",{className:"col-span-12 grid grid-cols-12 mb-2",children:[e("span",{className:"col-span-4 text-sm flex items-center",children:"Upload Image :"}),e("span",{className:"col-span-5 text-sm",children:e("input",{type:"file",onChange:_,name:"rightImage",id:"",accept:".jpg, .jpeg",className:"bg-white px-2 py-1 w-full rounded-sm shadow-sm border-[1px] border-gray-400"})}),e("span",{className:"text-red-500 text-xs col-span-2 flex justify-center items-center",children:"OR"}),l("span",{className:"col-span-1 text-sm flex items-center justify-end",children:[e("abbr",{title:"Click to capture image",onClick:()=>R(2),className:"cursor-pointer",children:e("span",{className:"text-xl",children:e(k,{})})})," "]})]}),l("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:i==null?void 0:i.latitude})})]}),l("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:i==null?void 0:i.longitude})})]}),e("span",{className:"col-span-12 mt-2 text-center",children:c.touched.rightImage&&c.errors.rightImage&&e(y,{children:e("span",{className:"text-red-600 text-xs",children:c.errors.rightImage})})})]})})]}),l("div",{className:"bg-indigo-50 border-2 border-indigo-500 my-2 mx-1",children:[e("div",{className:"text-white bg-indigo-500 px-2 font-semibold",children:"Left Image"}),e("div",{className:"px-2 py-2",children:l("div",{className:"grid grid-cols-12 text-sm pb-2 px-4",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",children:e("img",{src:j??V,alt:"Front Image",srcset:"",className:"w-32"})}),l("span",{className:"col-span-12 grid grid-cols-12 mb-2",children:[e("span",{className:"col-span-4 text-sm flex items-center",children:"Upload Image :"}),e("span",{className:"col-span-5 text-sm",children:e("input",{type:"file",onChange:_,name:"leftImage",id:"",accept:".jpg, .jpeg",className:"bg-white px-2 py-1 w-full rounded-sm shadow-sm border-[1px] border-gray-400"})}),e("span",{className:"text-red-500 text-xs col-span-2 flex justify-center items-center",children:"OR"}),l("span",{className:"col-span-1 text-sm flex items-center justify-end",children:[e("abbr",{title:"Click to capture image",onClick:()=>R(3),className:"cursor-pointer",children:e("span",{className:"text-xl",children:e(k,{})})})," "]})]}),l("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:r==null?void 0:r.latitude})})]}),l("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:r==null?void 0:r.longitude})})]}),e("span",{className:"col-span-12 mt-2 text-center",children:c.touched.leftImage&&c.errors.leftImage&&e(y,{children:e("span",{className:"text-red-600 text-xs",children:c.errors.leftImage})})})]})})]}),e("div",{className:"w-full flex justify-center m-2",children:e("button",{type:"submit",className:"px-4 py-1.5 mr-4 text-sm text-white rounded-sm shadow-md bg-green-500 hover:bg-green-600 focus:bg-green-600",children:"Forward"})})]})]})]}),e(ze,{isOpen:ve,onAfterOpen:Fe,className:"z-20 h-screen w-screen backdrop-blur-sm flex flex-row justify-center items-center overflow-auto",contentLabel:"Example Modal",children:l("div",{class:" animate__animated animate__zoomIn animate__faster rounded-lg md:ml-24 shadow-lg relative bg-gray-50 px-6 py-4 w-[90vw] z-50 border-t-2 border-l-2 border-white overflow-auto",children:[e("div",{className:"absolute top-2 z-10 bg-red-200 hover:bg-red-300 right-2 rounded-full p-2 cursor-pointer",onClick:K,children:e(Ee,{fontSize:10})}),l("div",{className:"mt-6 w-full",children:[e("video",{ref:x,autoPlay:!0,className:""}),e("canvas",{ref:N,style:{display:"none"}}),e("div",{className:"w-full text-center my-4",children:e("button",{onClick:Se,className:"text-sm px-4 py-1 bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 text-white rounded-md shadow-md",children:"Capture"})}),p&&l(y,{children:[e("img",{src:p,alt:"Captured Image"}),e("div",{className:"w-full text-center my-4",children:e("button",{onClick:je,className:"text-sm px-4 py-1 bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 text-white rounded-md shadow-md",children:"Save"})})]})]})]})})]})};export{De as default};
