import{R as k,_ as V,c as ye,r as l,k as we,A as G,h as ve,a as Ie,d as Se,e as j,g as Ce,j as t,F as N,b as e,M as _e,P as Fe}from"./index-5dd83843.js";import{F as U,A as Pe}from"./full.esm-03d55ca0.js";import{I as je}from"./index.esm-3c749978.js";import{u as O}from"./useSetTitle-bd1e8a49.js";import"./iconBase-5d35abdc.js";const A="/assets/photo-506bbc5b.png",Ue=k.lazy(()=>V(()=>import("./CommonLoader-6f64ecd7.js"),["assets/CommonLoader-6f64ecd7.js","assets/index-5dd83843.js","assets/index-6998d192.css","assets/BeatLoader-cbb66acb.js"])),Ae=k.lazy(()=>V(()=>import("./ForwardScreen-2b4117c3.js"),["assets/ForwardScreen-2b4117c3.js","assets/index-5dd83843.js","assets/index-6998d192.css","assets/index.esm-3c749978.js","assets/iconBase-5d35abdc.js","assets/Blocks-e60bdca8.js"])),qe=()=>{k.useContext(ye);const[r,M]=l.useState(),{api_getgbSafDetails:q,post_safGeoTagging:H,post_gbSafGeoTagging:$}=Fe(),{id:y,type:m}=we();m=="saf"&&O("SAF Geo-Tagging"),m=="gbSaf"&&O("GB SAF Geo-Tagging"),l.useEffect(()=>{setTimeout(()=>{f(!1)},1e4),f(!0),B()},[]);const B=()=>{G.post(q,{applicationId:y},ve()).then(s=>{var a;console.log("getting application data => ",s),M((a=s==null?void 0:s.data)==null?void 0:a.data)}).catch(s=>{console.log("getting application data error => ",s)}).finally(()=>f(!1))};Ie();const[W,w]=l.useState(""),[Y,ke]=l.useState(),[S,J]=l.useState(null),[o,K]=l.useState(),[Q,X]=l.useState(!1),[Z,Le]=l.useState(),[C,D]=l.useState(null),[i,ee]=l.useState(),[ae,te]=l.useState(!1),[se,Ee]=l.useState(),[_,le]=l.useState(null),[d,ne]=l.useState(),[re,ce]=l.useState(!1),[u,oe]=l.useState(0),[Te,ie]=l.useState(!1),[de,v]=l.useState(!1),[L,f]=l.useState(!1),me=Se({frontImage:j().required("required to upload"),leftImage:j().required("required to upload"),rightImage:j().required("required to upload")}),c=Ce({initialValues:{frontImage:"",leftImage:"",rightImage:""},onSubmit:s=>{console.log("submitting images => ",s),v(!0)},validationSchema:me}),ge=()=>{f(!0);let s;m=="saf"&&(s=H),m=="gbSaf"&&(s=$);let a=new FormData;a.append("safId",y),a.append("directionType[2]","Front"),Q?a.append("imagePath[2]",F(S,"FrontImage.jpg")):a.append("imagePath[2]",Y),a.append("longitude[2]",o==null?void 0:o.longitude),a.append("latitude[2]",o==null?void 0:o.latitude),a.append("directionType[1]","Right"),ae?a.append("imagePath[1]",F(C,"RightImage.jpg")):a.append("imagePath[1]",Z),a.append("longitude[1]",i==null?void 0:i.longitude),a.append("latitude[1]",i==null?void 0:i.latitude),a.append("directionType[0]","Left"),re?a.append("imagePath[0]",F(_,"LeftImage.jpg")):a.append("imagePath[0]",se),a.append("longitude[0]",d==null?void 0:d.longitude),a.append("latitude[0]",d==null?void 0:d.latitude),G.post(s,a,Pe()).then(n=>{var I,b,p;w((I=n==null?void 0:n.data)==null?void 0:I.status),((b=n==null?void 0:n.data)==null?void 0:b.status)==!0&&(console.log("success images",n),ie(!0),w("true")),((p=n==null?void 0:n.data)==null?void 0:p.status)==!1&&(console.log("error images",n),alert(n==null?void 0:n.data),w("false"),v(!1))}).catch(n=>{console.log("error images => ",n),alert(n),w("false"),v(!1)}).finally(()=>f(!1))};function F(s,a){const n=s.split(","),I=n[0].match(/:(.*?);/)[1],b=atob(n[1]);let p=b.length;const z=new Uint8Array(p);for(;p--;)z[p]=b.charCodeAt(p);return new File([z],a,{type:I})}const[Re,pe]=l.useState(null);l.useState(0);const ue=()=>{navigator.geolocation.getCurrentPosition(s=>{pe(s),u==1&&K(s==null?void 0:s.coords),u==3&&ne(s==null?void 0:s.coords),u==2&&ee(s==null?void 0:s.coords)},()=>{})},h=l.useRef(null),x=l.useRef(null),[g,E]=l.useState(null);l.useEffect(()=>{ue()});const he=async s=>{navigator.mediaDevices.getUserMedia({video:!0}).then(a=>{h.current.srcObject=a,h.current.onloadedmetadata=()=>{x.current.width=h.current.videoWidth,x.current.height=h.current.videoHeight}}).catch(a=>{a.name==="NotAllowedError"?alert("Permission to access camera was not granted"):a.name==="NotFoundError"||a.name==="DevicesNotFoundError"?alert("No camera found"):a.name==="NotReadableError"||a.name==="TrackStartError"?alert("Could not start camera"):alert("Error accessing camera"),console.log("Error accessing camera:",a)})},fe=()=>{x.current.getContext("2d").drawImage(h.current,0,0);const a=x.current.toDataURL("image/jpg");E(a),console.log("image data captured => ",a)},[xe,T]=l.useState(!1),P=s=>{T(!0),he(),E(null),oe(s)},R=()=>T(!1),be=()=>{},Ne=()=>{const s=document.createElement("a");s.href=g,u==1&&(X(!0),J(g),c.setFieldValue("frontImage",g)),u==2&&(te(!0),D(g),c.setFieldValue("rightImage",g)),u==3&&(ce(!0),le(g),c.setFieldValue("leftImage",g)),s.click(),R()};return t(N,{children:[L&&e(Ue,{}),e(Ae,{openScreen:de,id:y,navigation:()=>ge(),closePopUp:()=>v(!1),canSubmit:W,type:m}),t("div",{className:"w-full",children:[t("h1",{className:" text-center font-bold text-xl border-b-2 border-gray-700 mx-4",children:["Field Verification ",e("br",{}),"Geo-Tagging "]}),t("div",{className:"p-4 flex flex-col gap-y-4",children:[t("div",{className:"w-full items-center justify-center px-4 shadow-sm flex md:flex-row flex-col flex-wrap gap-2 md:justify-evenly bg-indigo-50",children:[t("span",{className:"grid grid-cols-12 w-full text-sm gap-2 my-1",children:[e("span",{className:"col-span-6",children:"Your Application No.:"})," ",e("span",{className:"font-semibold text-base col-span-6",children:r==null?void 0:r.saf_no})]}),t("span",{className:"grid grid-cols-12 w-full text-sm  gap-2 my-1",children:[e("span",{className:"col-span-6",children:"Application Type:"})," ",e("span",{className:"font-semibold text-base col-span-6",children:r==null?void 0:r.assessment_type})]}),t("span",{className:"grid grid-cols-12 w-full text-sm  gap-1",children:[t("span",{className:"col-span-6",children:[m=="saf"&&"Property",m=="gbSaf"&&"Govt. Building Usage"," Type:"]})," ",t("span",{className:"font-semibold text-base col-span-6",children:[m=="saf"&&(r==null?void 0:r.property_type),m=="gbSaf"&&(r==null?void 0:r.building_type)]})]}),t("span",{className:"grid grid-cols-12 w-full text-sm  gap-2 my-1",children:[e("span",{className:"col-span-6",children:"Apply Date:"})," ",e("span",{className:"font-semibold text-base col-span-6",children:r==null?void 0:r.application_date})]})]}),!L&&t("form",{className:"border-2 border-blue-700 bg-blue-50 mb-4",onChange:c.handleChange,onSubmit:c.handleSubmit,children:[e("h1",{className:"text-center font-semibold bg-blue-700 text-white uppercase text-lg",children:"Upload Image"}),t("div",{className:"bg-indigo-50 border-2 border-indigo-500 my-2 mx-1",children:[e("div",{className:"text-white bg-indigo-500 px-2 font-semibold",children:"Front Image"}),e("div",{className:"px-2 py-2",children:t("div",{className:"grid grid-cols-12 text-sm pb-2 px-2",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",children:e("img",{src:S??A,alt:"Front Image",srcset:"",className:"w-32"})}),t("span",{className:"col-span-12 grid grid-cols-12 mb-2",children:[e("span",{className:"col-span-8 text-sm flex items-center",children:"Capture Image :"}),t("span",{className:"col-span-1 text-sm flex items-center justify-end",children:[e("abbr",{title:"Click to capture image",onClick:()=>P(1),className:"cursor-pointer",children:e("span",{className:"text-xl",children:e(U,{fontSize:"large"})})})," "]})]}),t("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:o==null?void 0:o.latitude})})]}),t("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:o==null?void 0:o.longitude})})]}),e("span",{className:"col-span-12 mt-2 text-center",children:c.touched.frontImage&&c.errors.frontImage&&e(N,{children:e("span",{className:"text-red-600 text-xs",children:c.errors.frontImage})})})]})})]}),t("div",{className:"bg-indigo-50 border-2 border-indigo-500 my-2 mx-1",children:[e("div",{className:"text-white bg-indigo-500 px-2 font-semibold",children:"Right Image"}),e("div",{className:"px-2 py-2",children:t("div",{className:"grid grid-cols-12 text-sm pb-2 px-4",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",children:e("img",{src:C??A,alt:"Front Image",srcset:"",className:"w-32"})}),t("span",{className:"col-span-12 grid grid-cols-12 mb-2",children:[e("span",{className:"col-span-8 text-sm flex items-center",children:"Capture Image :"}),t("span",{className:"col-span-1 text-sm flex items-center justify-end",children:[e("abbr",{title:"Click to capture image",onClick:()=>P(2),className:"cursor-pointer",children:e("span",{className:"text-xl",children:e(U,{fontSize:"large"})})})," "]})]}),t("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:i==null?void 0:i.latitude})})]}),t("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:i==null?void 0:i.longitude})})]}),e("span",{className:"col-span-12 mt-2 text-center",children:c.touched.rightImage&&c.errors.rightImage&&e(N,{children:e("span",{className:"text-red-600 text-xs",children:c.errors.rightImage})})})]})})]}),t("div",{className:"bg-indigo-50 border-2 border-indigo-500 my-2 mx-1",children:[e("div",{className:"text-white bg-indigo-500 px-2 font-semibold",children:"Left Image"}),e("div",{className:"px-2 py-2",children:t("div",{className:"grid grid-cols-12 text-sm pb-2 px-4",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",children:e("img",{src:_??A,alt:"Front Image",srcset:"",className:"w-32"})}),t("span",{className:"col-span-12 grid grid-cols-12 mb-2",children:[e("span",{className:"col-span-8 text-sm flex items-center",children:"Capture Image :"}),t("span",{className:"col-span-1 text-sm flex items-center justify-end",children:[e("abbr",{title:"Click to capture image",onClick:()=>P(3),className:"cursor-pointer",children:e("span",{className:"text-xl",children:e(U,{fontSize:"large"})})})," "]})]}),t("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:d==null?void 0:d.latitude})})]}),t("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:d==null?void 0:d.longitude})})]}),e("span",{className:"col-span-12 mt-2 text-center",children:c.touched.leftImage&&c.errors.leftImage&&e(N,{children:e("span",{className:"text-red-600 text-xs",children:c.errors.leftImage})})})]})})]}),e("div",{className:"w-full flex justify-center m-2",children:(r==null?void 0:r.payment_status)==0?e("button",{type:"submit",onClick:()=>window.location.replace(`/property/viewDemand/${y}`),className:"px-4 py-1.5 mr-4 text-sm text-white rounded-sm shadow-md bg-green-500 hover:bg-green-600 focus:bg-green-600",children:"Submit & Pay"}):e("button",{type:"submit",className:"px-4 py-1.5 mr-4 text-sm text-white rounded-sm shadow-md bg-green-500 hover:bg-green-600 focus:bg-green-600",children:"Forward"})})]})]})]}),e(_e,{isOpen:xe,onAfterOpen:be,className:"z-50 h-screen w-screen backdrop-blur-sm flex flex-row justify-center items-center overflow-auto",contentLabel:"Example Modal",children:t("div",{class:" animate__animated animate__zoomIn animate__faster rounded-lg md:ml-24 shadow-lg relative bg-gray-50 px-4 py-4 w-[90vw] mt-10 z-50 border-t-2 border-l-2 border-white overflow-auto",children:[e("div",{className:"absolute top-2 z-10 bg-red-200 hover:bg-red-300 right-2 rounded-full p-2 cursor-pointer",onClick:R,children:e(je,{fontSize:10})}),t("div",{className:"mt-6 w-full",children:[e("video",{ref:h,autoPlay:!0,className:""}),e("canvas",{ref:x,style:{display:"none"}}),e("div",{className:"w-full text-center my-4",children:e("button",{onClick:fe,className:"text-sm px-4 py-1 bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 text-white rounded-md shadow-md",children:"Capture"})}),g&&t(N,{children:[e("img",{src:g,alt:"Captured Image"}),e("div",{className:"w-full text-center my-4",children:e("button",{onClick:Ne,className:"text-sm px-4 py-1 bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 text-white rounded-md shadow-md",children:"Save"})})]})]})]})})]})};export{qe as default};
