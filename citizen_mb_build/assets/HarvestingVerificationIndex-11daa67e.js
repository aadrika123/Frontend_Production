import{r,d as ge,c as ue,a as he,j as s,F as S,b as t}from"./index-50af0c5b.js";import{F as fe}from"./ForwardScreen-1cba791b.js";import{I as ve}from"./index.esm-b95e5b93.js";import be from"./CommonLoader-22f35f4d.js";import{B as P,a as j,A as R}from"./axios-28c6f114.js";import{F as ye,A as xe}from"./index.esm-0466a344.js";import{c as Ne,a as E,u as $e}from"./index.esm-e872aa0c.js";import{M as _e}from"./index-81e1c63f.js";import{u as Ce}from"./useSetTitle-f43300ee.js";import"./Blocks-4d6e09a6.js";import"./ProjectApiList-f293eba9.js";import"./iconBase-f0bbafc9.js";import"./BeatLoader-d4b7f08d.js";function we(){let e=P;return{calculatePropertyTax:`${e}/api/property/calculatePropertyTax`,get_dashboard:`${e}/api/property/get-dashboard`,get_ConcessionInbox:`${e}/api/property/concession/inbox`,get_ConcessionOutbox:`${e}/api/property/concession/outbox`,get_ConcessionSpecial:`${e}/api/property/concession/special-inbox`,get_ConcessionDetailsById:`${e}/api/property/concession/details`,post_ConcessionEscalate:`${e}/api/property/concession/escalate`,post_ConcessionNextLevel:`${e}/api/property/concession/next-level`,post_ConcessionApprovalRejection:`${e}/api/property/concession/approvalrejection`,post_ConcessionBackToCitizen:`${e}/api/property/concession/backtocitizen`,post_ConcessionComment:`${e}/api/property/concession/comment-independent`,get_ConcessionDocumentsToUpload:`${e}/api/property/concession/doc-list`,get_ConcessionUploadedDocuments:`${e}/api/property/concession/get-uploaded-documents`,post_ConcessionDocumentUpload:`${e}/api/property/concession/upload-document`,get_ConcessionBtcList:`${e}/api/property/concession/btc-inbox`,get_ObjectionInbox:`${e}/api/property/objection/inbox`,get_ObjectionOutbox:`${e}/api/property/objection/outbox`,get_ObjectionSpecial:`${e}/api/property/objection/special-inbox`,get_ObjectionDetailsById:`${e}/api/property/objection/details`,post_ObjectionEscalate:`${e}/api/property/objection/post-escalate`,post_ObjectionNextLevel:`${e}/api/property/objection/next-level`,post_ObjectionApprovalRejection:`${e}/api/property/objection/approvalrejection`,post_ObjectionBackToCitizen:`${e}/api/property/objection/backtocitizen`,post_ObjectionBtcList:`${e}/api/property/objection/btc-inbox`,post_ObjectionComment:`${e}/api/property/objection/comment-independent`,get_ObjectionDocumentsToUpload:`${e}/api/property/objection/doc-list`,get_ObjectionUploadedDocuments:`${e}/api/property/objection/get-uploaded-documents`,post_ObjectionDocumentUpload:`${e}/api/property/objection/upload-document`,get_HarvestingInbox:`${e}/api/property/harvesting/inbox`,get_HarvestingOutbox:`${e}/api/property/harvesting/outbox`,get_HarvestingSpecial:`${e}/api/property/harvesting/special-inbox`,get_HarvestingDetailsById:`${e}/api/property/harvesting/static-details`,harvestingSiteVerification:`${e}/api/property/harvesting/site-verification`,post_HarvestingEscalate:`${e}/api/property/harvesting/escalate`,post_HarvestingNextLevel:`${e}/api/property/harvesting/next-level`,post_HarvestingApprovalRejection:`${e}/api/property/harvesting/approval-rejection`,post_HarvestingBackToCitizen:`${e}/api/property/harvesting/backtocitizen`,getHarvestingDocList:`${e}/api/property/harvesting-doc-id`,postHarvestingDoc:`${e}/api/property/harvesting-doc-upload`,postHarvestingStatus:`${e}/api/property/harvesting-doc-status`,get_HarvestingDocumentsToUpload:`${e}/api/property/harvesting/get-doc-list`,get_HarvestingUploadedDocuments:`${e}/api/property/harvesting/get-uploaded-documents`,post_HarvestingDocumentUpload:`${e}/api/property/harvesting/upload-document`,get_HarvestingBtcList:`${e}/api/property/harvesting/btc-inbox`,get_HarvestingBtcAction:`${e}/api/property/harvesting/backtocitizen`,get_HoldingDeactivationInbox:`${e}/api/property/inboxDeactivation`,get_HoldingDeactivationOutbox:`${e}/api/property/outboxDeactivation`,get_HoldingDeactivationSpecial:`${e}`,get_HoldingDeactivationDetailsById:`${e}/api/property/getDeactivationDtls`,post_HoldingDeactivationEscalate:`${e}/api/property/postEscalateDeactivation`,post_HoldingDeactivationNextLevel:`${e}/api/property/postNextDeactivation`,post_HoldingDeactivationApprovalRejection:`${e}/api/property/approve-reject-deactivation-request`,post_HoldingDeactivationIndependentComment:`${e}/api/property/commentIndependentPrpDeactivation`,get_HoldingDeactivationUploadedDocuments:`${e}/api/property/getDocumentsPrpDeactivation`,get_MasterData:`${e}/api/property/saf/master-saf`,post_SiteVerification:`${e}/api/property/saf/site-verification`,post_GeoTagging:`${e}/api/property/saf/geotagging`,post_DocVerify:`${e}/api/property/saf/verifydoc`,getSafDoc:`${e}/api/property/safDocumentUpload`,postSafDoc:`${e}/api/property/safDocumentUpload`,getDocumentList:`${e}/api/property/getSafUploadDocuments`,postSafVerify:`${e}/api/property/saf/doc-status`,api_getPropHoldingDetailsById:`${e}/api/property/saf/get-prop-byholding`,api_getTcComparisonData:`${e}/api/property/saf/verifications-comp`,api_PostHolidingDeactivation:`${e}/api/property/deactivationRequest`,api_getHoldingDeactivationDetails:`${e}/api/property/get-prop-dtl-for-deactivation`,api_postHoldingDeactivationApply:`${e}/api/property/deactivationRequest `,api_samReciept:`${e}/api/property/saf/memo-receipt`,getHarvestingData:`${e}/api/property/harvesting/get-tc-verifications`}}const Ee=()=>{const[e,i]=r.useState(!1),[o,I]=r.useState(),[b,H]=r.useState(null),[m,V]=r.useState(),[z,M]=r.useState(),[W,k]=r.useState(!0),[q,y]=r.useState(!1),[G,U]=r.useState(!1),[Y,x]=r.useState(""),[g,J]=r.useState();Ce("Water Harvesting Verification"),localStorage.getItem("roles");const{get_HarvestingDetailsById:K,harvestingSiteVerification:Q,getHarvestingData:X}=we(),{id:N}=ge(),{notify:h,roleName:$}=r.useContext(ue),A=he(),Z=Ne({harvestingImage:E().when([],{is:()=>localStorage.getItem("roles")!='["ULB Tax Collector"]',then:()=>E().required("image required")})}),l=$e({initialValues:{harvestingImage:""},onSubmit:a=>{console.log("submitting image => ",a),y(!0)},validationSchema:Z}),ee=()=>{if($!="tc"&&$!="utc"){h("You don't have permission to verify !!!","error");return}i(!0);let a=new FormData;a.append("applicationId",N),G?a.append("harvestingImage",le(b,"HarvestingImage.jpg")):a.append("harvestingImage",z),W?a.append("verificationStatus",1):a.append("verificationStatus",0),j.post(Q,a,xe()).then(n=>{var c,d,p;x((c=n==null?void 0:n.data)==null?void 0:c.status),((d=n==null?void 0:n.data)==null?void 0:d.status)==!0&&(console.log("successfully submitted..."),i(!1),x("true")),((p=n==null?void 0:n.data)==null?void 0:p.status)==!1&&(console.log("error submitted..."),h("Something went wrong, please try after sometime !!!","error"),x("false"),y(!1),i(!1))}).catch(n=>{console.log("errrorr rwh => ",n),h("Something went wrong, please try after sometime !!!","error"),x("false"),y(!1),i(!1)})};r.useEffect(()=>{i(!0),j.post(K,{applicationId:N},R()).then(a=>{var n,c,d,p;((n=a==null?void 0:a.data)==null?void 0:n.status)==!0&&(console.log("success => ",a),I((c=a==null?void 0:a.data)==null?void 0:c.data),i(!1)),((d=a==null?void 0:a.data)==null?void 0:d.status)==!1&&(console.log("false rwh => ",a),I((p=a==null?void 0:a.data)==null?void 0:p.data),i(!1),A("/search/harvesting"),h("Please try again after sometime !!!","error"))}).catch(a=>{console.log("error rwh => ",a),i(!1),A("/search/harvesting"),h("Please try again after sometime !!!","error")})},[]);const te=async a=>{if(a.target.name=="harvestingImage"){U(!1);let n=a.target.files[0];M(a.target.files[0]),H(URL.createObjectURL(a.target.files[0])),l.setFieldTouched("flongitude",m==null?void 0:m.longitude),l.setFieldValue("flatitude",m==null?void 0:m.latitude),console.log("--1-- name file on change..",n)}},ae=a=>{const n=a.target.name,c=a.target.value;n=="imageCheck"&&(S,c=="true"?(k(!0),l.setFieldValue("harvestingImgae","dddd")):k(!1))},[oe,O]=r.useState(!1),[L,se]=r.useState(""),[ne,re]=r.useState(""),_=(a,n)=>{O(!0),a=="camera"&&de(),F(null),se(a),re(n)},D=()=>O(!1),ie=()=>{},ce=()=>{const a=document.createElement("a");a.href=f,U(!0),H(f),l.setFieldValue("harvestingImage",f),a.click(),D()};function le(a,n){const c=a.split(","),d=c[0].match(/:(.*?);/)[1],p=atob(c[1]);let w=p.length;const T=new Uint8Array(w);for(;w--;)T[w]=p.charCodeAt(w);return new File([T],n,{type:d})}const[Se,pe]=r.useState(null);r.useState(0);const[f,F]=r.useState(),B=()=>{navigator.geolocation.getCurrentPosition(a=>{pe(a),V(a==null?void 0:a.coords)},()=>{})},u=r.useRef(null),v=r.useRef(null),de=async()=>{navigator.mediaDevices.getUserMedia({video:!0}).then(a=>{u.current.srcObject=a,u.current.onloadedmetadata=()=>{v.current.width=u.current.videoWidth,v.current.height=u.current.videoHeight,B()}}).catch(a=>{a.name==="NotAllowedError"?alert("Permission to access camera was not granted"):a.name==="NotFoundError"||a.name==="DevicesNotFoundError"?alert("No camera found"):a.name==="NotReadableError"||a.name==="TrackStartError"?alert("Could not start camera"):alert("Error accessing camera"),console.log("Error accessing camera:",a)})},me=()=>{v.current.getContext("2d").drawImage(u.current,0,0);const n=v.current.toDataURL("image/jpg");F(n)};let C=P;return r.useEffect(()=>{$=="utc"&&i(!0),$=="utc"&&j.post(X,{applicationId:N},R()).then(a=>{var n;console.log("getting tc data => ",a),J((n=a==null?void 0:a.data)==null?void 0:n.data),i(!1)}).catch(a=>{console.log("error getting tc data => ",a),i(!1)})},[]),s(S,{children:[e&&t(be,{}),t(fe,{openScreen:q,id:N,navigation:()=>ee(),closePopUp:()=>y(!1),canSubmit:Y,type:"harvesting"}),s("div",{className:"w-full",children:[s("h1",{className:" text-center font-bold text-xl border-b-2 border-gray-700 mx-4",children:["Field Verification ",t("br",{}),"Rain Water Harvesting "]}),t("div",{className:"p-4 flex flex-col gap-y-4",children:s("div",{className:" bg-indigo-50 border-2 border-indigo-500 my-2 mx-1",children:[t("h1",{className:"text-center font-semibold bg-blue-700 text-white uppercase text-lg",children:t("span",{children:"Water Harvesting Declaration"})}),s("div",{className:"p-2",children:[s("div",{className:"grid grid-cols-12 text-sm pb-2",children:[t("span",{className:" col-span-6",children:"Application No."}),t("span",{className:"col-span-6 font-semibold",children:(o==null?void 0:o.applicationNo)==""?"N/A":o==null?void 0:o.applicationNo})]}),s("div",{className:"grid grid-cols-12 text-sm pb-2",children:[t("span",{className:" col-span-6 ",children:"Does Completion of Water Harvesting is done before 31-03-2017?"}),t("span",{className:"col-span-6 font-semibold",children:o!=null&&o.completionBefore2017?"Yes":"No"})]}),s("div",{className:"grid grid-cols-12 text-sm pb-2",children:[t("span",{className:" col-span-6 ",children:"Holding No."}),t("span",{className:"col-span-6 font-semibold",children:(o==null?void 0:o.holdingNo)==""?"N/A":o==null?void 0:o.holdingNo})]}),s("div",{className:"grid grid-cols-12 text-sm pb-2",children:[t("span",{className:" col-span-6 ",children:"Name"}),t("span",{className:"col-span-6 font-semibold",children:(o==null?void 0:o.applicantName)==""?"N/A":o==null?void 0:o.applicantName})]}),s("div",{className:"grid grid-cols-12 text-sm pb-2",children:[t("span",{className:" col-span-6 ",children:"Guardian Name"}),t("span",{className:"col-span-6 font-semibold",children:(o==null?void 0:o.guardianName)==""?"N/A":o==null?void 0:o.guardianName})]}),s("div",{className:"grid grid-cols-12 text-sm pb-2",children:[t("span",{className:" col-span-6 ",children:"Ward No."}),t("span",{className:"col-span-6 font-semibold",children:(o==null?void 0:o.wardNo)==""?"N/A":o==null?void 0:o.wardNo})]}),s("div",{className:"grid grid-cols-12 text-sm pb-2",children:[t("span",{className:" col-span-6 ",children:"Address"}),t("span",{className:"col-span-6 font-semibold",children:(o==null?void 0:o.propertyAddress)==""?"N/A":o==null?void 0:o.propertyAddress})]}),s("div",{className:"grid grid-cols-12 text-sm pb-2",children:[t("span",{className:" col-span-6 ",children:"Mobile No."}),t("span",{className:"col-span-6 font-semibold",children:(o==null?void 0:o.mobileNo)==""?"N/A":o==null?void 0:o.mobileNo})]}),s("div",{className:"grid grid-cols-12 text-sm pb-2",children:[t("span",{className:" col-span-6 ",children:"Date of Completion of Water Harvesting Structure"}),t("span",{className:"col-span-6 font-semibold",children:(o==null?void 0:o.dateOfCompletion)==""?"N/A":o==null?void 0:o.dateOfCompletion})]}),s("form",{className:"grid grid-cols-12 text-sm pb-2 border-2 border-indigo-400 rounded-md mt-4",onChange:l.handleChange,onSubmit:l.handleSubmit,children:[t("span",{className:" col-span-12 font-semibold bg-indigo-500 text-white uppercase px-2 py-1 text-md",children:"Water Harvesting Image"}),t("span",{className:"col-span-12 my-2 px-2",children:s("div",{className:"grid grid-cols-12 text-sm pb-2 items-center",children:[t("span",{className:"col-span-4 font-semibold",children:"Self Assessed : "}),t("span",{className:"col-span-8 text-center flex justify-center",children:t("img",{src:`${C}/${o==null?void 0:o.harvestingImage}`,alt:"Harvesting Image",srcset:"",className:"w-32 cursor-pointer rounded-md shadow-md",onClick:()=>_("image",`${C}/${o==null?void 0:o.harvestingImage}`)})})]})}),localStorage.getItem("roles")=='["ULB Tax Collector"]'&&t("span",{className:"col-span-12 my-2 px-2",children:s("div",{className:"grid grid-cols-12 text-sm pb-2 items-center",children:[t("span",{className:"col-span-4 font-semibold",children:"Agency TC : "}),t("span",{className:"col-span-8 text-center flex justify-center",children:t("img",{src:`${C}/${g==null?void 0:g.doc_path}`,alt:"Harvesting Image",srcset:"",className:"w-32 cursor-pointer rounded-md shadow-md",onClick:()=>_("image",`${C}/${g==null?void 0:g.doc_path}`)})})]})}),t("div",{className:"col-span-12 px-2",children:s("div",{className:"grid grid-cols-12 text-sm pb-2",children:[t("span",{className:"col-span-5 font-semibold",children:"Check :"}),s("span",{className:"col-span-7 flex gap-2",onClick:ae,children:[s("span",{className:"flex gap-1",children:[t("input",{type:"radio",name:"imageCheck",required:!0,id:"check1",value:!0}),t("label",{htmlFor:"check 1",children:"Correct"})]}),s("span",{className:"flex gap-1",children:[t("input",{type:"radio",name:"imageCheck",required:!0,id:"check2",value:!1}),t("label",{htmlFor:"check 2",children:"Incorrect"})]})]})]})}),b!=null&&t("span",{className:"col-span-12 my-2 px-2",children:s("div",{className:"grid grid-cols-12 text-sm pb-2 items-center",children:[t("span",{className:"col-span-4 font-semibold",children:"Preview : "}),t("span",{className:"col-span-8 text-center flex justify-center",children:t("img",{src:b,alt:"Harvesting Image",srcset:"",className:"w-32 cursor-pointer rounded-md shadow-md",onClick:()=>_("image",b)})})]})}),t("div",{className:"col-span-12 px-2",children:localStorage.getItem("roles")!='["ULB Tax Collector"]'&&s("div",{className:"grid grid-cols-12 text-sm pb-2",children:[s("span",{className:"col-span-12 grid grid-cols-12 mb-2",children:[t("span",{className:"col-span-4 text-sm flex items-center font-semibold",children:"Upload :"}),t("span",{className:"col-span-5 text-sm",children:t("input",{onChange:a=>te(a),type:"file",name:"harvestingImage",id:"",accept:".jpg, .jpeg",className:" bg-white px-2 py-1 w-full rounded-sm shadow-sm border-[1px] border-gray-400"})}),t("span",{className:"text-red-500 text-xs col-span-2 flex justify-center items-center",children:"OR"}),s("span",{className:"col-span-1 text-sm flex items-center justify-end",children:[t("abbr",{title:"Click to capture image",onClick:()=>_("camera",""),className:"cursor-pointer",children:t("span",{className:"text-xl",children:t(ye,{})})})," "]})]}),t("span",{className:"col-span-12 text-center mb-2",children:l.touched.harvestingImage&&l.errors.harvestingImage&&t(S,{children:t("span",{className:"text-red-600 text-xs",children:l.errors.harvestingImage})})})]})}),t("span",{className:" col-span-12 font-semibold text-center my-4 px-2",children:t("button",{type:"submit",className:"px-4 py-1.5 mr-4 text-sm text-white rounded-sm shadow-md bg-green-500 hover:bg-green-600 focus:bg-green-600",children:"Forward"})})]})]})]})})]}),t(_e,{isOpen:oe,onAfterOpen:ie,className:"z-20 h-screen w-screen backdrop-blur-sm flex flex-row justify-center items-center overflow-auto",contentLabel:"Example Modal",children:s("div",{className:" relative rounded-lg shadow-xl border-2 border-gray-50 px-0 animate__animated animate__zoomIn animate__faster",style:{width:"95vw",height:"80vh"},children:[t("div",{className:"absolute top-2 z-40 bg-red-200 hover:bg-red-300 right-2 rounded-full p-2 cursor-pointer",onClick:D,children:t(ve,{fontSize:10})}),L=="image"&&t("div",{className:"w-full h-full flex items-center justify-center",children:t("img",{src:ne,alt:"",srcset:""})}),L=="camera"&&s("div",{className:"mt-6 w-full",children:[t("video",{ref:u,autoPlay:!0,className:""}),t("canvas",{ref:v,style:{display:"none"}}),t("div",{className:"w-full text-center my-4",children:t("button",{onClick:()=>(me(),B()),className:"text-sm px-4 py-1 bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 text-white rounded-md shadow-md",children:"Capture"})}),f&&s(S,{children:[t("img",{src:f,alt:"Captured Image"}),t("div",{className:"w-full text-center my-4",children:t("button",{onClick:()=>ce(),className:"text-sm px-4 py-1 bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 text-white rounded-md shadow-md",children:"Save"})})]})]})]})})]})};export{Ee as default};
