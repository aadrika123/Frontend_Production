import{d as Q,r as o,e as Z,j as t,F as aa,b as d,l as ta,c as M,A as q,P as ea}from"./index-929ad14c.js";import{u as la}from"./formik.esm-58d64b07.js";import{c as ia,b as oa,a as ra}from"./index.esm-e885f0b5.js";/* empty css                */import{R as da}from"./Hourglass-9b46b5b7.js";const ga=()=>{const g=Q(),{notify:c,setisLoggedIn:B,setheartBeatCounter:$}=o.useContext(Z),[s,z]=o.useState(null),[l,H]=o.useState(),{api_login:U,api_getPermission:V}=ea(),[X,w]=o.useState(!1),W=ia({email:oa().required("Enter email"),password:ra().required("Enter password")}),e=la({initialValues:{email:"",password:""},onSubmit:i=>{K()},validationSchema:W}),f=["TAX COLLECTOR","ULB TAX COLLECTOR","TEAM LEADER"],Y=o.useMemo(()=>Array.isArray(s)&&s.some(i=>f.includes(i)),[s]);o.useEffect(()=>{var i,a,m;s!=null&&(Y?(c("Login Successfull !!! ","success"),window.localStorage.setItem("menuList",JSON.stringify((i=l==null?void 0:l.userDetails)==null?void 0:i.menuPermission)),window.localStorage.setItem("userName",JSON.stringify((a=l==null?void 0:l.userDetails)==null?void 0:a.name)),window.localStorage.setItem("roles",JSON.stringify((m=l==null?void 0:l.userDetails)==null?void 0:m.role)),g("/dashboard")):c("You don't have permission of Tax Collector !!!","warn"))},[s]);const u=JSON.parse(window.localStorage.getItem("roles")),n=window.localStorage.getItem("token"),G=o.useMemo(()=>Array.isArray(u)&&u.some(i=>f.includes(i)),[u,n]);o.useEffect(()=>{n!=""&&n!=null&&n!=null&&G&&g("/dashboard")},[]);const K=()=>{let i={email:e.values.email,password:e.values.password,type:"mobile"};M.post(U,i,q()).then(function(a){var m,h,x,b,S,N,y,v,I,p,L,E,A,D,k,C,O,R,_,T,j,F;a.data.status==!0?(window.localStorage.setItem("token",(h=(m=a==null?void 0:a.data)==null?void 0:m.data)==null?void 0:h.token),window.localStorage.setItem("isLoggedIn",!0),window.localStorage.setItem("userEmail",(S=(b=(x=a==null?void 0:a.data)==null?void 0:x.data)==null?void 0:b.userDetails)==null?void 0:S.email),window.localStorage.setItem("userName",(v=(y=(N=a==null?void 0:a.data)==null?void 0:N.data)==null?void 0:y.userDetails)==null?void 0:v.name),window.localStorage.setItem("userType",(L=(p=(I=a==null?void 0:a.data)==null?void 0:I.data)==null?void 0:p.userDetails)==null?void 0:L.user_type),window.localStorage.setItem("userMobile",(D=(A=(E=a==null?void 0:a.data)==null?void 0:E.data)==null?void 0:A.userDetails)==null?void 0:D.mobile),window.localStorage.setItem("ulbId",(O=(C=(k=a==null?void 0:a.data)==null?void 0:k.data)==null?void 0:C.userDetails)==null?void 0:O.ulb_id),window.localStorage.setItem("device","mobile"),H((R=a==null?void 0:a.data)==null?void 0:R.data),z((j=(T=(_=a==null?void 0:a.data)==null?void 0:_.data)==null?void 0:T.userDetails)==null?void 0:j.role),$(r=>r+1),B(!0),M.post(V,{moduleId:1},q()).then(r=>{var J,P;r.data.status==!0&&window.localStorage.setItem("menuList",JSON.stringify((P=(J=r==null?void 0:r.data)==null?void 0:J.data)==null?void 0:P.permission))}).catch(r=>{})):(w(!1),c((F=a==null?void 0:a.data)==null?void 0:F.message,"error"))}).catch(function(a){w(!1),c("Something went wrong !!! ","error")})};return t(aa,{children:t("div",{className:" h-screen bg-zinc-100 flex flex-row flex-wrap justify-center items-center",children:d("form",{onChange:e.handleChange,onSubmit:e.handleSubmit,className:"flex flex-col gap-2 w-max h-max shadow-lg rounded-md px-10 py-4 bg-white text-zinc-700 animate__animated animate__fadeInDown",children:[d("div",{className:"flex flex-row flex-wrap gap-2 items-center",children:[t("img",{src:ta,alt:"",className:"w-16"}),d("div",{className:"text-xl uppercase tracking-wide font-semibold",children:["Urban Development & ",t("br",{})," Housing Department"]})]}),t("hr",{}),d("div",{className:"mt-6 flex flex-col flex-wrap gap-2",children:[t("label",{htmlFor:"email",className:"text-sm",children:"Email :"}),t("input",{type:"email",name:"email",id:"email",className:" rounded-md bg-transparent border-t-[1px] border-l-[1px] shadow-md bg-indigo-50 focus:bg-white px-4 py-2 text-sm focus:outline-indigo-600",placeholder:"Enter email"}),e.errors.email&&e.touched.email&&t("span",{className:"text-red-600 text-xs",children:e.errors.email})]}),d("div",{className:"mt-4 flex flex-col flex-wrap gap-2",children:[t("label",{htmlFor:"password",className:"text-sm",children:"Password :"}),t("input",{type:"password",name:"password",id:"password",className:" rounded-md bg-transparent border-t-[1px] border-l-[1px] shadow-md bg-indigo-50 focus:bg-white px-4 py-2 text-sm focus:outline-indigo-600",placeholder:"Enter password"}),e.errors.password&&e.touched.password&&t("span",{className:"text-red-600 text-xs",children:e.errors.password})]}),t("div",{className:"text-center mb-6 mt-4",children:X?t("div",{className:"flex justify-center",children:t(da,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"25",visible:!0})}):d("button",{type:"submit",className:"px-4 py-1.5 bg-green-200 hover:bg-green-300 rounded-md shadow-md text-sm",children:[" ","Login"," "]})})]})})})};export{ga as default};
