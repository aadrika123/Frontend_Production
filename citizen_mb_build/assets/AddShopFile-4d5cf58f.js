import{e as se,u as oe,r as _,R as A,j as r,F as N,b as n,Q as S}from"./index-d234e753.js";import{u as ue}from"./formik.esm-8135a30a.js";import{c as ae,a as w}from"./index.esm-ef23645b.js";import{T as ce}from"./ThemeStyle-994f51bc.js";import{R as g}from"./RentalApiList-91990935.js";import{F as pe,S as h,T as v,a as de}from"./LoadingButton-141ccc16.js";import{b as he,a as V,c as R}from"./useCustomQuery-6fc50d1c.js";import{u as be}from"./useCustomGeoLocation-5613db6b.js";import{r as me}from"./resizeImage-f1558408.js";import{O as fe}from"./OverLayLoader-dbcd3546.js";import{R as ge}from"./RotatingLoader-93a6f5da.js";import{u as ye}from"./useErrorFocusField-458425b6.js";import"./hoist-non-react-statics.cjs-736e71bf.js";import"./index.esm-7ee2a9f6.js";import"./ApiHeader2-b363f7b8.js";import"./Hourglass-8738f9c5.js";const k=[{isRequired:!0,isVisible:!0,name:"shopNo",label:"Shop no",type:"text",isDisabled:!0},{isRequired:!0,isVisible:!0,name:"circle",label:"Market",type:"select"},{isRequired:!0,isVisible:!0,name:"market",label:"Floor",type:"select"},{isRequired:!0,isVisible:!0,name:"location",label:"Location",type:"text"},{isRequired:!0,isVisible:!0,name:"building_name",label:"Building name",type:"text"},{isRequired:!0,isVisible:!0,name:"wardNo",label:"Ward no",type:"select"},{isRequired:!0,isVisible:!0,name:"allottee",label:"Allottee",type:"text",inputValidation:["removeDoubleSpace","string"]},{isRequired:!0,isVisible:!0,name:"address",label:"Address",type:"text",inputValidation:["removeDoubleSpace"]},{isRequired:!0,isVisible:!0,name:"rate",label:"Rate",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"arrear",label:"Arrear",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"lastPayDt",label:"Last payment date",type:"date"},{isRequired:!0,isVisible:!0,name:"lastPayAmt",label:"Last payment amount",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"allottedLength",label:"Allotted Length",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"allottedBreadth",label:"Allotted Breadth",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"allottedHeight",label:"Allotted Height",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"area",label:"Area",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"presentLength",label:"Present Length",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"presentBreadth",label:"Present Breadth",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"presentHeight",label:"Present Height",type:"text",inputValidation:["rupee"]},{isRequired:!0,isVisible:!0,name:"noOfFloors",label:"No. Of Floors",type:"text",inputValidation:["number"]},{isRequired:!0,isVisible:!0,name:"presentOccupier",label:"Present Occupier",type:"text",inputValidation:["removeDoubleSpace","string"]},{isRequired:!0,isVisible:!0,name:"tradeLicense",label:"Trade license no.",type:"text",inputValidation:["removeDoubleSpace"]},{isRequired:!0,isVisible:!0,name:"construction",label:"Construction",type:"select",options:q=>q.map(a=>r("option",{value:a==null?void 0:a.id,children:a==null?void 0:a.construction_type},a.id))},{isRequired:!0,isVisible:!0,name:"electricity",label:"Electricity",type:"select",options:[{value:1,label:"Yes"},{value:0,label:"No"}]},{isRequired:!1,isVisible:!1,name:"electricityNo",label:"Electricity no.",type:"text",inputValidation:["removeDoubleSpace"]},{isRequired:!0,isVisible:!0,name:"water",label:"Water",type:"select",options:[{value:1,label:"Yes"},{value:0,label:"No"}]},{isRequired:!1,isVisible:!1,name:"waterConsumerNo",label:"Water consumer no.",type:"text",inputValidation:["removeDoubleSpace"]},{isRequired:!0,isVisible:!0,name:"contactNo",label:"Contact no.",type:"text",inputValidation:["mobile","number"]},{isRequired:!0,isVisible:!0,name:"longitude",label:n("span",{children:["Longitude ",r("br",{}),r("small",{className:"text-blue-700",children:"(When you choose the photo1, it will be auto filled)"})]}),type:"text",placeholder:"Longitude"},{isRequired:!0,isVisible:!0,name:"latitude",label:n("span",{children:["Latitude ",r("br",{}),r("small",{className:"text-blue-700",children:"(When you choose the photo1, it will be auto filled)"})]}),type:"text",placeholder:"Latitude"},{isRequired:!0,isVisible:!0,name:"photo1Path",label:"Photo 1",type:"file"},{isRequired:!0,isVisible:!0,name:"photo2Path",label:"Photo 2",type:"file"},{isRequired:!0,isVisible:!0,name:"remarks",label:"Remarks",type:"textarea",inputValidation:["removeDoubleSpace"]}];function Oe(){var I,$,j;const[q]=se(),{AutoFocusErrorField:a}=ye(),x=q.get("id"),{titleStyle:Q}=ce(),{api_UlbCircleList:J,api_locationByCircleList:K,api_addShops:X,api_getConstructionType:Z}=g(),ee=oe(),{coords:b}=be(),[B,le]=_.useState(""),[C,re]=_.useState(""),O=he({}),L=(e,l)=>{S.dismiss(),l=="success"&&S.success(e),l=="error"&&S.error(e)},i=ue({initialValues:k.reduce((e,l)=>(e[l.name]="",e),{}),enableReinitialize:!0,onSubmit:async e=>{await ie(e)},validationSchema:ae().shape({electricityNo:w().when("electricity",{is:e=>e==1,then:()=>w().required("This field is required")}),waterConsumerNo:w().when("water",{is:e=>e==1,then:()=>w().required("This field is required")}),...k.reduce((e,l)=>(l.isRequired&&(e[l.name]=w().required("This field is required")),e),{})})}),F=V({api:J,options:{enabled:!0}});V({api:K,config:{circleId:i.values.circle},value:[i.values.circle],options:{enabled:!!i.values.circle}});const P=V({api:Z,options:{enabled:!0}}),m=V({api:(I=g())==null?void 0:I.getUlbByWard,config:{},options:{enabled:!0}}),p=R({api:`${g().shopById}?id=${x}`,options:{enabled:!!x}});R({api:g().circleApi,options:{enabled:!0}}),R({api:`${($=g())==null?void 0:$.marketApi}?location_id=${i.values.circle}`,options:{enabled:!!i.values.circle}});const f=R({api:g().assetsBuildingDropdown,options:{enabled:!0}});_.useEffect(()=>{var e;if((e=p==null?void 0:p.data)!=null&&e.data&&x){const l=p.data.data;i.setValues({...i.values,circle:l.asset_id||"",market:l.floor_id||"",floorName:(l==null?void 0:l.floorName)||"",assetName:(l==null?void 0:l.assetName)||"",wardNo:l.ward_no||"",location:l.location||"",building_name:(l==null?void 0:l.building_name)||"",ulbId:(l==null?void 0:l.ulb_id)||"",shopNo:(l==null?void 0:l.shop_no)||"",allottee:l.owner_name||"",address:l.address||"",rate:"",arrear:"",lastPayDt:"",lastPayAmt:"",allottedLength:l.length||"",allottedBreadth:l.breadth||"",allottedHeight:l.height||"",area:parseInt(l.length)*parseInt(l.breadth)||l.building_area||"",presentLength:"",presentBreadth:"",presentHeight:"",noOfFloors:l.no_of_floors||"",presentOccupier:l.name||"",tradeLicense:"",construction:"",electricity:"",electricityNo:"",water:"",waterConsumerNo:"",contactNo:"",longitude:"",latitude:"",photo1Path:"",photo2Path:"",remarks:""})}},[(j=p==null?void 0:p.data)==null?void 0:j.data,x]);const ie=async e=>{var d,u,y;let l,o;l=X,o={assetId:e==null?void 0:e.circle,assetName:e==null?void 0:e.assetName,floorName:e==null?void 0:e.floorName,floorId:e==null?void 0:e.market,allottee:e==null?void 0:e.allottee,ulbId:e==null?void 0:e.ulbId,wardNo:e==null?void 0:e.wardNo,marketName:e==null?void 0:e.building_name,circleName:e==null?void 0:e.location,shopNo:e==null?void 0:e.shopNo,address:e==null?void 0:e.address,rate:e==null?void 0:e.rate,arrear:e==null?void 0:e.arrear,lastPayDt:e==null?void 0:e.lastPayDt,lastPayAmt:e==null?void 0:e.lastPayAmt,allottedLength:e==null?void 0:e.allottedLength,allottedBreadth:e==null?void 0:e.allottedBreadth,allottedHeight:e==null?void 0:e.allottedHeight,area:e==null?void 0:e.area,presentLength:e==null?void 0:e.presentLength,presentBreadth:e==null?void 0:e.presentBreadth,presentHeight:e==null?void 0:e.presentHeight,noOfFloors:e==null?void 0:e.noOfFloors,presentOccupier:e==null?void 0:e.presentOccupier,tradeLicense:e==null?void 0:e.tradeLicense,construction:e==null?void 0:e.construction,electricity:e==null?void 0:e.electricity,electricityNo:e==null?void 0:e.electricityNo,water:e==null?void 0:e.water,waterConsumerNo:e==null?void 0:e.waterConsumerNo,contactNo:e==null?void 0:e.contactNo,longitude:e==null?void 0:e.longitude,latitude:e==null?void 0:e.latitude,photo1Path:e==null?void 0:e.photo1Path,photo2Path:e==null?void 0:e.photo2Path,remarks:e==null?void 0:e.remarks};try{const s=await O.mutateAsync({api:l,data:o});(d=s==null?void 0:s.data)!=null&&d.status?(L(((u=s==null?void 0:s.data)==null?void 0:u.message)||"Data saved successfully","success"),ee("/shopList")):L(((y=s==null?void 0:s.data)==null?void 0:y.message)||"Data not saved","error")}catch(s){L(s||"Data not saved","error")}},te=async(e,l)=>{const o=e.target.files[0],d=await me(o),u=new File([d],o==null?void 0:o.name,{type:o==null?void 0:o.type});l==="photo1Path"?(i.setFieldValue("photo1Path",u),i.setFieldValue("latitude",b==null?void 0:b.latitude),i.setFieldValue("longitude",b==null?void 0:b.longitude),le(URL.createObjectURL(u))):(i.setFieldValue("photo2Path",u),re(URL.createObjectURL(u)))};A.useEffect(()=>{i.values.electricity==0&&i.setFieldValue("electricityNo",""),i.values.water==0&&i.setFieldValue("waterConsumerNo","")},[i.values.electricity,i.values.water]),A.useEffect(()=>{i.values.allottedLength&&i.values.allottedBreadth&&i.setFieldValue("area",parseInt(i.values.allottedLength)*parseInt(i.values.allottedBreadth))},[i.values.allottedLength,i.values.allottedBreadth]);const{submitCount:T,errors:E,isSubmitting:H,isValid:ne}=i;return A.useEffect(()=>{a({submitCount:T,isSubmitting:H,errors:E,isValid:ne})},[E,T,H]),F!=null&&F.isLoading?r(N,{children:r(ge,{})}):n(N,{children:[O.isLoading&&r(fe,{}),r("div",{className:"bg-[#eff2f0] ",children:n("div",{className:" container mx-auto p-4",children:[n("div",{className:"grid grid-cols-1 md:grid-cols-12 lg:grid-cols-12 p-4 border-b",children:[n("div",{className:"col-span-6 flex space-x-3",children:[r("img",{src:"https://cdn-icons-png.flaticon.com/128/2981/2981313.png",className:"h-10 -mt-2"}),r("h1",{className:`${Q}`,children:"Add Shops"})]}),r("div",{className:"col-span-6 flex space-x-3 justify-end"})]}),r(pe,{formik:i,children:n("div",{className:"bg-[#fdfdfd]  rounded-2xl shadow-md p-2",children:[r("div",{className:"p-2",children:k.map((e,l)=>{var o,d,u,y,s,U,W,z,M,Y;if(e.name==="circle")return r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:n(h,{name:e.name,formik:i,label:e.label,selectedText:"assetName",children:[r("option",{selected:!0,children:"select"}),(d=(o=f==null?void 0:f.data)==null?void 0:o.data)==null?void 0:d.map(t=>r("option",{value:t==null?void 0:t.id,children:t==null?void 0:t.building_name},t.id))]})},l);if(e.name==="market")return r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:n(h,{name:e.name,formik:i,label:e.label,selectedText:"floorName",children:[r("option",{selected:!0,children:"select"}),(y=(u=f==null?void 0:f.data)==null?void 0:u.data)==null?void 0:y.map(t=>{var D,G;if((t==null?void 0:t.id)==((D=i==null?void 0:i.values)==null?void 0:D.circle))return(G=t==null?void 0:t.floor_data)==null?void 0:G.map(c=>r("option",{value:c==null?void 0:c.id,children:c==null?void 0:c.floor},c==null?void 0:c.id))})]})},l);if(e.name==="ulbId")return r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:n(h,{name:e.name,formik:i,label:e.label,children:[r("option",{selected:!0,children:"select"}),(U=(s=m==null?void 0:m.data)==null?void 0:s.data)==null?void 0:U.map(t=>r("option",{value:t==null?void 0:t.ward_name,children:t==null?void 0:t.ward_name},t.id))]})},l);if(e.name==="wardNo")return r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:n(h,{name:e.name,formik:i,label:e.label,children:[r("option",{selected:!0,children:"select"}),(z=(W=m==null?void 0:m.data)==null?void 0:W.data)==null?void 0:z.map(t=>r("option",{value:t==null?void 0:t.ward_name,children:t==null?void 0:t.ward_name},t.id))]})},l);if(e.name==="electricity")return n(N,{children:[r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:n(h,{name:e.name,formik:i,label:e.label,children:[r("option",{selected:!0,children:"select"}),e.options.map(t=>r("option",{value:t.value,children:t.label},t.value))]})},l),i.values.electricity==1&&r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:r(v,{name:"electricityNo",formik:i,label:" Electricity No"})},l)]});if(e.name==="water")return n(N,{children:[r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:n(h,{name:e.name,formik:i,label:e.label,children:[r("option",{selected:!0,children:"select"}),e.options.map(t=>r("option",{value:t.value,children:t.label},t.value))]})},l),i.values.water==1&&r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:r(v,{name:"waterConsumerNo",formik:i,label:" Consumer No"})},l)]});if(e.name==="construction")return r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:n(h,{name:e.name,formik:i,label:e.label,children:[r("option",{selected:!0,children:"select"}),(Y=(M=P==null?void 0:P.data)==null?void 0:M.data)==null?void 0:Y.map(t=>r("option",{value:t==null?void 0:t.id,children:t==null?void 0:t.construction_type},t.id))]})},l);if(e.type==="text"&&e.isVisible)return r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:r(v,{name:e.name,formik:i,label:e.label,inputValidation:e.inputValidation,placeholder:e.placeholder,disabled:e.name==="latitude"||e.name==="longitude"?!0:e==null?void 0:e.isDisabled})},l);if(e.type==="date")return r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:r(v,{name:e.name,formik:i,label:e.label,type:"date"})},l);if(e.type==="file")return n("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:[r(v,{name:e.name,label:e.label,type:"file",onChange:t=>te(t,e.name)}),r("p",{className:"text-red-600 text-xs",children:(i==null?void 0:i.touched[e.name])&&(i==null?void 0:i.errors[e.name])}),e.name==="photo1Path"&&B&&r("img",{src:B,className:"h-20"}),e.name==="photo2Path"&&C&&r("img",{src:C,className:"h-20"})]},l);if(e.type==="textarea")return r("div",{className:"form-group flex-shrink max-w-full px-0 w-full md:w-1/4 mb-4",children:r(de,{name:e.name,formik:i,label:e.label,inputValidation:e.inputValidation})},l)})}),r("div",{className:"pb-8",children:r("button",{type:"submit",className:"bg-[#6AB783] px-7 py-2 text-white font-semibold rounded leading-5 shadow-lg w-full",children:"Save"})})]})})]})})]})}export{Oe as default};
