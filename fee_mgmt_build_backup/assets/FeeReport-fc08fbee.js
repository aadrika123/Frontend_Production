import{a as z,r as B,j as r,R as K,b as u,A as P}from"./index-8fbc1d6c.js";import{c as R,a as j,u as V,F as W,b as Q}from"./index.esm-b7202724.js";import{C as T}from"./index-7867bf85.js";import{a as U}from"./index.esm-032884cc.js";import{S as a,L as Y}from"./LoadingButton-e9f65630.js";import"./TextField-bdd3bed4.js";import{F as G}from"./index.esm-93832602.js";import{P as J}from"./Page-080a86ca.js";import{B as O}from"./Breadcrumb-0ec2aeb5.js";import{u as y}from"./useQuery-1f01400e.js";const je=()=>{var f,b,v,F;const{api_class:A,api_fy:_,api_fee_report:H,api_month_active_all:C}=P,$=z(),[g,E]=B.useState(!1),k=(e,l,t,m)=>{$("/fee/fee-collection",{state:{fyId:e,classId:l,admissionNo:t,className:m}})},{data:h,isLoading:X,error:Z}=y({queryKey:["month"],queryFn:async()=>(await u.post(`${C}`,{})).data.data}),{data:p,isLoading:ee,error:re}=y({queryKey:["fy"],queryFn:async()=>(await u.post(`${_}`,{})).data.data}),{data:d,isLoading:se,error:le}=y({queryKey:["class"],queryFn:async()=>(await u.post(`${A}`,{})).data.data});console.log("queryFy",d),R({fyId:j().required("Required"),classId:j().required("Required"),monthId:j().required("Required")});const x=V({initialValues:{fyId:"",classId:"",monthId:""},onSubmit:async e=>{try{await M()}catch(l){console.log(l)}}}),{data:s,isLoading:ne,error:ce,refetch:M,isFetching:N}=y({queryKey:["feeReport"],queryFn:async()=>(await u.post(`${H}`,{fyId:x.values.fyId,classId:x.values.classId,monthId:x.values.monthId})).data.data,enabled:!1});return r.jsxs(J,{title:"Class Wise Fee Report",pageName:"Class Wise Fee Report",children:[r.jsx(O,{list:[{title:"Home",path:"/home"},{title:"Class Wise Fee Report",path:"#"}]}),r.jsxs("div",{className:"px-5 py-1 flex justify-end cursor-pointer",children:[r.jsx(U,{size:30,color:"green",onClick:()=>E(!g)}),g&&r.jsx(T,{data:s==null?void 0:s.flatMap(e=>e).map(e=>({...e})),target:"_blank"})]}),r.jsx("div",{className:"border p-6 mx-auto w-[97%]",children:r.jsx(W,{value:x,children:r.jsx(Q,{autoComplete:"off",onSubmit:x.handleSubmit,children:r.jsx("div",{className:"lg:px-52 mx-auto px-6 justify-center lg:ml-28",children:r.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4 content-center",children:[r.jsx("div",{children:r.jsx(a,{name:"fyId",label:"Financial Year",formik:x,isRequiredLabel:!0,size:"xs",children:p&&(p==null?void 0:p.map(e=>r.jsx("option",{value:e==null?void 0:e.id,children:e==null?void 0:e.financial_year})))})}),r.jsx("div",{children:r.jsx(a,{name:"classId",label:"Select Class",formik:x,isRequiredLabel:!0,size:"xs",children:d&&(d==null?void 0:d.map(e=>r.jsx("option",{value:e==null?void 0:e.id,children:e==null?void 0:e.class_name})))})}),r.jsx("div",{children:r.jsxs(a,{name:"monthId",label:"Month",formik:x,isRequiredLabel:!0,size:"xs",isBlankSelect:!0,children:[r.jsx("option",{value:"",children:"Select All"}),h&&(h==null?void 0:h.map((e,l)=>r.jsx("option",{value:e==null?void 0:e.id,children:e==null?void 0:e.month_name},l)))]})}),r.jsx("div",{children:r.jsx("div",{className:"mt-7",children:r.jsxs(Y,{color:"primary",type:"submit",className:"rounded-lg",isLoading:N,size:"xs",children:[" ","Search"," "]})})})]})})})})}),r.jsx("div",{className:"w-[24rem] lg:w-full overflow-x-auto px-6 mx-auto py-3",children:N?r.jsx("div",{role:"status",className:"animate-pulse",children:Array(10).fill("").map((e,l)=>r.jsxs(K.Fragment,{children:[r.jsx("div",{className:"h-8 bg-gray-200 rounded-xxl dark:bg-gray-700 w-full mb-4"}),r.jsx("span",{className:"sr-only",children:"Loading..."})]},l))}):r.jsx(r.Fragment,{children:s&&(s==null?void 0:s.length)>0?r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"text-md ",children:r.jsxs("tr",{className:"text-white bg-[#0F766E]",children:[r.jsx("th",{scope:"col",className:" py-5  text-center ",children:"Sl No."}),r.jsx("th",{scope:"col",className:" py-5  text-center ",children:"Month Name"}),r.jsx("th",{scope:"col",className:" py-5  text-center ",children:"Class"}),r.jsx("th",{scope:"col",className:" py-5  text-center",children:"Admission No"}),r.jsx("th",{scope:"col",className:" py-5  text-center",children:"Student Name"}),r.jsx("th",{scope:"col",className:" py-5  text-center",children:"Fee Head"}),r.jsx("th",{scope:"col",className:" py-5  text-center",children:"Amount"}),r.jsx("th",{scope:"col",className:" py-5  text-center",children:"Received Amount"}),r.jsx("th",{scope:"col",className:" py-5  text-center",children:"Due Amount"}),r.jsx("th",{scope:"col",className:" py-5  text-center",children:"Updated Date"}),r.jsx("th",{scope:"col",className:" py-5  text-center",children:"Action"})]})}),r.jsxs("tbody",{children:[(s==null?void 0:s.length)<=0&&r.jsx("tr",{children:r.jsx("td",{colSpan:"8",className:"text-center  text-gray-500",children:r.jsx("div",{className:"mt-6 text-xl font-semibold",children:"No data found..."})})}),(s==null?void 0:s.length)>0&&((f=s==null?void 0:s.flatMap(e=>e))==null?void 0:f.map((e,l)=>{var t,m,o,D,q,I,L,S,w;return r.jsxs("tr",{className:` ${((m=(t=e==null?void 0:e.feeDtl)==null?void 0:t.map(n=>n==null?void 0:n.dueAmount))==null?void 0:m.reduce((n,c)=>n+c,0))>0?"bg-red-100":l%2===0?"bg-white":"bg-slate-100"} `,children:[r.jsx("td",{className:" py-5  text-center border border-gray-400 ",children:l+1}),r.jsx("td",{className:" py-5  text-center border border-gray-400",children:e==null?void 0:e.monthName}),r.jsx("td",{className:" py-5  text-center border border-gray-400",children:e==null?void 0:e.class}),r.jsx("td",{className:" py-5  text-center border border-gray-400",children:(o=e==null?void 0:e.studentDtl)==null?void 0:o.admission_no}),r.jsx("td",{className:" py-5  text-center border border-gray-400",children:(D=e==null?void 0:e.studentDtl)==null?void 0:D.full_name}),r.jsx("td",{className:" py-5  text-center border border-gray-400",children:(q=e==null?void 0:e.feeDtl)==null?void 0:q.map(n=>{var c,i;return r.jsx("div",{className:`${n.feeHeadName===((i=e==null?void 0:e.feeDtl[((c=e==null?void 0:e.feeDtl)==null?void 0:c.length)-1])==null?void 0:i.feeHeadName)?"":"border-b py-2"} `,children:n.feeHeadName})})}),r.jsx("td",{className:" py-5  text-center border border-gray-400",children:(I=e==null?void 0:e.feeDtl)==null?void 0:I.map(n=>{var c,i;return r.jsx("div",{className:`${n.feeHeadName===((i=e==null?void 0:e.feeDtl[((c=e==null?void 0:e.feeDtl)==null?void 0:c.length)-1])==null?void 0:i.feeHeadName)?"":"border-b py-2 border-gray-400"} `,children:n.amount})})}),r.jsx("td",{className:" py-5  text-center border border-gray-400",children:(L=e==null?void 0:e.feeDtl)==null?void 0:L.map(n=>{var c,i;return r.jsx("div",{className:`${n.feeHeadName===((i=e==null?void 0:e.feeDtl[((c=e==null?void 0:e.feeDtl)==null?void 0:c.length)-1])==null?void 0:i.feeHeadName)?"":"border-b py-2 border-gray-400"} `,children:n.receivedAmount})})}),r.jsx("td",{className:" py-5  text-center border border-gray-400",children:(S=e==null?void 0:e.feeDtl)==null?void 0:S.map(n=>{var c,i;return r.jsx("div",{className:`${n.feeHeadName===((i=e==null?void 0:e.feeDtl[((c=e==null?void 0:e.feeDtl)==null?void 0:c.length)-1])==null?void 0:i.feeHeadName)?"":"border-b py-2 border-gray-400"} `,children:n.dueAmount})})}),r.jsx("td",{className:" py-5  text-center border border-gray-400",children:(w=e==null?void 0:e.feeDtl)==null?void 0:w.map(n=>{var c,i;return r.jsx("div",{className:`${n.feeHeadName===((i=e==null?void 0:e.feeDtl[((c=e==null?void 0:e.feeDtl)==null?void 0:c.length)-1])==null?void 0:i.feeHeadName)?"":"border-b py-2 border-gray-400"} `,children:n==null?void 0:n.dt})})}),r.jsx("td",{className:" py-5  text-center border border-gray-400",children:r.jsx("div",{className:"flex justify-center",children:r.jsx(G,{color:"green",size:20,onClick:()=>{k(e==null?void 0:e.fyId,e==null?void 0:e.classId,e==null?void 0:e.admissionNo,e==null?void 0:e.class)}})})})]},l)})),(s==null?void 0:s.length)>0&&r.jsxs("tr",{className:" border border-gray-400 hover:bg-slate-100 bg-slate-200",children:[r.jsx("td",{colSpan:"6",className:" py-5  text-center font-semibold border border-gray-400",children:"Total"}),r.jsx("td",{className:" py-5  text-center font-semibold border border-gray-400",children:(b=s==null?void 0:s.flatMap(e=>e))==null?void 0:b.reduce((e,l)=>{var t;return e+((t=l==null?void 0:l.feeDtl)==null?void 0:t.reduce((m,o)=>m+(o==null?void 0:o.amount),0))},0)}),r.jsx("td",{className:"py-5  text-center font-semibold border border-gray-400",children:(v=s==null?void 0:s.flatMap(e=>e))==null?void 0:v.reduce((e,l)=>{var t;return e+((t=l==null?void 0:l.feeDtl)==null?void 0:t.reduce((m,o)=>m+(o==null?void 0:o.receivedAmount),0))},0)}),r.jsx("td",{scope:"col",colSpan:"3",className:" py-5 text-start font-semibold border border-gray-400",children:r.jsx("div",{className:"ml-14",children:(F=s==null?void 0:s.flatMap(e=>e))==null?void 0:F.reduce((e,l)=>{var t;return e+((t=l==null?void 0:l.feeDtl)==null?void 0:t.reduce((m,o)=>m+(o==null?void 0:o.dueAmount),0))},0)})}),r.jsx("td",{}),r.jsx("td",{})]})]})]}):r.jsx("div",{className:"flex justify-center items-center",children:r.jsx("h1",{className:"text-xl text-gray-400",children:"No Data Found"})})})})]})};export{je as default};
