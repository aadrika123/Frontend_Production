import{j as e,U as G,W as Q,V as z,a0 as W,A as S,a1 as J,a2 as K,a3 as X,a4 as Y,a5 as Z,r as h,a as ee,u as se,x as ae,i as le,n as U,b as re,o as ie,O as te,P as ne,S as ce,Q as oe,F as de,z as H,T as m,R as pe,G as L,y as me,H as ue,I as v,B as xe,e as he,f as j,m as je,_ as c,w as f}from"./index-ycav3uq8.js";import{X as fe}from"./x-QKiA1jZg.js";import{P as ge}from"./index-D0RnYuU5.js";import"./badge-B9sB6hih.js";import"./index-BuQYzNhN.js";import"./circle-check-big-BSyZMyFI.js";function be({sendTo:t,setSendTo:o,open:g,onOpenChange:d,onSubmit:u,userDetailsList:p}){return e.jsx(G,{open:g,onOpenChange:d,children:e.jsxs(Q,{className:"sm:max-w-md",children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(W,{children:"Send To"}),e.jsx(S,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>d(!1),children:e.jsx(fe,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Send To"}),e.jsxs(J,{value:t,onValueChange:a=>o(a),children:[e.jsx(K,{children:e.jsx(X,{placeholder:"SELECT..."})}),e.jsx(Y,{children:p==null?void 0:p.map(a=>e.jsx(Z,{value:a==null?void 0:a._id,children:a==null?void 0:a.fullName}))})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(S,{className:"bg-[#7C3AED] hover:bg-[#6D28D9]",onClick:()=>u(),children:"Send"})})]})]})})}const Ne=he().shape({title:j().required("Title is Required"),department:j().required("Department is Required"),priority:j().required("Priority is Required"),description:j().required("Description is Required")});function ye(){var w,T,I,k,C,R,A,P,E,_,B;const[t,o]=h.useState(!1),[g,d]=h.useState(!1),[u,p]=h.useState(""),{user:a}=ee(),V=se({}),M=ae({}),D=le(),F=new URLSearchParams(je().search),x=F.get("refNo"),b=F.get("page"),{data:l}=U({api:`${f.getFileById}/${x}`,key:"getFileDetails",options:{enabled:!!x}}),N=U({api:`${f.getUsersDetails}`,key:"edakDraft",options:{enabled:!0}}),i=re({resolver:ie(Ne),defaultValues:((w=l==null?void 0:l.data)==null?void 0:w.fileData)||{ulbId:(a==null?void 0:a.roleId)===te||(a==null?void 0:a.roleId)===ne||(a==null?void 0:a.roleId)===ce||(a==null?void 0:a.roleId)===oe?"":a==null?void 0:a.userUlbId,createdBy:a==null?void 0:a._id}});h.useEffect(()=>{var s,n;b==="edit"&&((s=l==null?void 0:l.data)!=null&&s.fileData)&&i.reset((n=l==null?void 0:l.data)==null?void 0:n.fileData)},[(T=l==null?void 0:l.data)==null?void 0:T.fileData,i,b]);const y=async(s,n)=>{var q,$;if(!t){if(o(!0),!(s!=null&&s.uploadedDocument)){c.error("Please select File Document First"),o(!1);return}try{const r=new FormData;r.append("createdBy",s==null?void 0:s.createdBy),r.append("receivedFrom",s==null?void 0:s.createdBy),r.append("sendTo",u),r.append("title",s==null?void 0:s.title),r.append("description",s==null?void 0:s.description),r.append("priority",s==null?void 0:s.priority),r.append("department",s==null?void 0:s.department),r.append("document",s==null?void 0:s.uploadedDocument),r.append("ulbId",s==null?void 0:s.ulbId),n?r.append("draft","true"):r.append("draft","false"),b=="edit"?(q=(await M.mutateAsync({api:`${f.editFilesById}/${x}`,data:r})).data)!=null&&q.success?(c.success("File Created Successfully!"),D(`/e-dak/dashboard/file-workflow-details?refNo=${x}&page=draft`)):c.error("File Not Created!"):($=(await V.mutateAsync({api:f.createFile,data:r})).data)!=null&&$.success?(c.success("File Created Successfully!"),D("/e-dak/dashboard/list-workflow")):c.error("File Not Created!")}catch(r){console.log(r),c.error("Error while creating File")}finally{o(!1)}}};return e.jsx(de,{methods:i,onSubmit:i.handleSubmit(y),children:e.jsxs("div",{className:"grid grid-cols-4 gap-x-2 gap-y-4 rounded-md border bg-background p-10 shadow",children:[e.jsx("h1",{className:"text-xl font-bold uppercase text-blue-800",children:"Basic Info"}),e.jsx(H,{className:"col-span-4"}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"category",children:"Title"}),e.jsx(pe,{name:"title",inputValidation:["string"],placeholder:""})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"category",children:"Department"}),e.jsx(L,{className:"cursor-pointer bg-background",name:"department",data:[{value:"water",label:"Water"},{value:"trade",label:"Trade"},{value:"procuremnet",label:"Procurement"}]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"priority",children:"Priority"}),e.jsx(L,{className:"cursor-pointer bg-background",name:"priority",data:[{value:"important",label:"Important"},{value:"normal",label:"Normal"}]})]}),e.jsx("div",{className:"col-span-4"}),e.jsx("h1",{className:"text-xl font-bold uppercase text-blue-800",children:"File Info"}),e.jsx(H,{className:"col-span-4"}),e.jsx("div",{className:"col-span-4"}),e.jsxs("div",{className:"col-span-3",children:[e.jsxs(m,{htmlFor:"remark",children:[e.jsx("span",{className:"text-red-500",children:"*"}),"Description"]}),e.jsx(me,{className:"h-20 w-full rounded-md border bg-background p-4",name:"description",inputValidation:["removeSpecialCharacterExceptSpaceAndDot"],placeholder:"write description"})]}),e.jsx("div",{className:"col-span-4"}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs(m,{children:[" ",e.jsx("span",{className:"text-red-500",children:"*"}),"Scanned File Document"," ",e.jsx("span",{className:"text-xs text-gray-500",children:"(acceptable formats are jpg, jpeg,png, pdf)"})]}),e.jsx(ue,{className:"cursor-pointer",accept:"image/jpeg,image/jpg,image/png,application/pdf",name:"uploadedDocument",placeholder:"Select document"})]}),e.jsxs("div",{className:"col-span-1 mt-1",children:[(((I=i.watch("uploadedDocument"))==null?void 0:I.type)=="image/png"||((k=i.watch("uploadedDocument"))==null?void 0:k.type)=="image/jpg"||((C=i.watch("uploadedDocument"))==null?void 0:C.type)=="image/jpeg")&&e.jsx(v,{className:"w-28",src:URL.createObjectURL(i.watch("uploadedDocument"))}),((R=i.watch("uploadedDocument"))==null?void 0:R.type)=="application/pdf"&&e.jsx(v,{className:"w-16 cursor-pointer hover:scale-105",src:"/images/pdf.png"})]}),((A=l==null?void 0:l.data)==null?void 0:A.fileData)&&e.jsxs("div",{className:"",children:[e.jsx(v,{className:"w-28",src:(E=(P=l==null?void 0:l.data)==null?void 0:P.fileData)==null?void 0:E.document}),e.jsx("h1",{className:"text-xs",children:"Previous Uploaded Document"})]}),e.jsx("div",{className:"col-span-4"}),e.jsx("div",{children:e.jsx(be,{open:g,onOpenChange:d,setSendTo:p,sendTo:u,onSubmit:i.handleSubmit(y),userDetailsList:(B=(_=N==null?void 0:N.data)==null?void 0:_.data)==null?void 0:B.docs})}),e.jsxs("div",{className:"col-span-4",children:[e.jsx(S,{onClick:s=>{s.preventDefault(),d(!0)},disabled:t,className:"float-left w-auto rounded-xl px-10",children:"Send"}),e.jsx(xe,{isLoading:t,onClick:s=>{s.preventDefault(),i.handleSubmit(n=>y(n,!0))()},disabled:t,className:"float-left mx-10 w-auto rounded-xl px-10",children:"Draft"})]})]})})}function ke(){return e.jsx(ge,{title:"Files",subTitle:"Creation of File Form",children:e.jsx("div",{className:"",children:e.jsx(ye,{})})})}export{ke as default};
