import{u as de,y as le,p as V,r as n,e as ne,o as ce,j as e,D as oe,F as ie,H as ae,R as ue,A as te,B as he,f as me,h as T,n as re,i as S,_ as v,k as xe,E as G,q as fe,s as je,t as pe,v as Ne,w as be,G as ge}from"./index-BRnLakpB.js";import{P as Se}from"./index-Bj9W1lOi.js";import{T as ve,a as Ie,b as se,c as b,d as ye,e as g}from"./table-DX_ipx9P.js";import{g as we}from"./services-KQnp_8oA.js";import{P as Pe}from"./index-Dq_TpNNj.js";import{S as ke}from"./index-DWmEqRZi.js";import{q as $e}from"./switch-DBWYH6I_.js";import"./badge-DsXNu46Z.js";import"./index-YSq32AOx.js";import"./circle-check-big-Ck6Q2ipy.js";import"./pagination-Di-b090E.js";const Me=me().shape({ulbId:T().notRequired(),moduleId:T().notRequired(),workFlowName:T().required("workFlow Name is required"),parentId:T().notRequired(),levelSerial:T().notRequired()});function Ae({open:c,setOpen:m,title:w,id:x,edit:I,setEdit:k,refetch:z}){var Y,C,L,q,E,R,U,B;const _=de({}),$=le({}),H=new URLSearchParams(re().search);let o=H.get("parentId"),M=H.get("levelSerial");const s=V({api:`${S.getWorkFlowById}?id=${x}`,key:"getWorkFlowById",options:{enabled:I}}),[Z,P]=n.useState(),[Q,A]=n.useState(),f=ne({resolver:ce(Me)}),K=async l=>{var i,u,a,y,j,p,N,F;let h=parseInt(M);try{if(I&&l){const r=await $.mutateAsync({api:`${S.updateWorkFlow}/${x}`,data:{ulbId:l.ulbId,moduleId:l.moduleId,workFlowName:l.workFlowName,parentId:(u=(i=s==null?void 0:s.data)==null?void 0:i.data)==null?void 0:u.parentId,levelSerial:(y=(a=s==null?void 0:s.data)==null?void 0:a.data)==null?void 0:y.levelSerial}});(j=r.data)!=null&&j.success?v.success((p=r==null?void 0:r.data)==null?void 0:p.message):v.error("Workflow not updated successfully")}else{const r=await _.mutateAsync({api:S.createWorkFlow,data:{ulbId:l.ulbId,moduleId:l.moduleId,workFlowName:l.workFlowName,parentId:o,levelSerial:h}});(N=r.data)!=null&&N.success?v.success((F=r==null?void 0:r.data)==null?void 0:F.message):v.error("Workflow not created successfully"),f.reset({ulbId:"",moduleId:"",workFlowName:"",parentId:"",levelSerial:""})}m(!1),k(!1),z()}catch(r){console.log(r)}};n.useEffect(()=>{var l,h,i,u,a;I&&(s!=null&&s.data)?f.reset({ulbId:(l=s==null?void 0:s.data)==null?void 0:l.data.ulbId,moduleId:(h=s==null?void 0:s.data)==null?void 0:h.data.moduleId,workFlowName:(i=s==null?void 0:s.data)==null?void 0:i.data.workFlowName,parentId:(u=s==null?void 0:s.data.data)==null?void 0:u.parentId,levelSerial:(a=s==null?void 0:s.data.data)==null?void 0:a.levelSerial}):f.reset({ulbId:"",moduleId:"",workFlowName:"",parentId:o??"",levelSerial:M??""})},[I,s==null?void 0:s.data]);const O=async()=>{var h,i,u;const l=await _.mutateAsync({api:S.checkWfModulePermission,data:{workflowId:o=="null"?Number(o):o,ulbId:o=="null"?Number(o):o}});(h=l.data)!=null&&h.success&&(P((i=l.data)==null?void 0:i.canSelectModule),A((u=l.data)==null?void 0:u.canSelectUlb))};n.useEffect(()=>{c===!0&&O()},[c]);const t=V({api:`${(Y=S)==null?void 0:Y.getAllModule}?page=1&limit=10000`,key:"getAllModuleList",options:{enabled:!0}}),X=V({api:`${(C=S)==null?void 0:C.getAllUlb}?page=1&limit=10000`,key:"getAllUlb",options:{enabled:!0}});return e.jsx(oe,{open:c,setOpen:m,title:w,setEdit:k,edit:I,isLoading:s==null?void 0:s.isFetching,children:e.jsx(ie,{methods:f,onSubmit:f.handleSubmit(K),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[Q==!0&&e.jsxs("div",{children:["Select ULB Name",e.jsx(ae,{name:"ulbId",data:((E=(q=(L=X.data)==null?void 0:L.data)==null?void 0:q.docs)==null?void 0:E.map(l=>({value:l._id,label:l.ulbName})))??[]})]}),Z==!0&&e.jsxs("div",{children:["Select Module Name",e.jsx(ae,{name:"moduleId",data:((B=(U=(R=t.data)==null?void 0:R.data)==null?void 0:U.docs)==null?void 0:B.map(l=>({value:l._id,label:l.moduleName})))??[]})]}),e.jsx("div",{children:e.jsx(ue,{name:"workFlowName",placeholder:"Enter your WorkFlow Name"})}),e.jsx(te,{}),e.jsx("div",{children:e.jsx(he,{isLoading:f.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function Ce(c){var C,L,q,E,R,U,B,l,h,i,u;const[m,w]=n.useState(1),[x,I]=n.useState(50),[k,z]=n.useState(""),[_,$]=n.useState(!1),[J,H]=n.useState(""),[o,M]=n.useState(!1),s=le({}),P=new URLSearchParams(re().search),Q=xe(),A=P.get("parentId"),f=P.get("levelSerial"),K=P.get("parentName"),O=P.get("moduleName"),t=V({api:`${S.getAllWorkFlow}?page=${m}&limit=${x}&q=${k}&parentId=${A}&levelSerial=${f}`,key:"getAllWorkFlow",value:[m,x,A],options:{enabled:!0}}),X=a=>{M(!0),$(!0),H(a)},Y=async a=>{var y,j,p,N,F,r,W,D,ee;try{const d=await s.mutateAsync({api:`${(y=S)==null?void 0:y.updateWorkFlowStatus}/${a}`,data:{id:J}});(j=d==null?void 0:d.data)!=null&&j.success?(t.refetch(),((N=(p=d==null?void 0:d.data)==null?void 0:p.data)==null?void 0:N.status)==1&&v.success((F=d.data)==null?void 0:F.message),((W=(r=d==null?void 0:d.data)==null?void 0:r.data)==null?void 0:W.status)==0&&v.error((D=d.data)==null?void 0:D.message)):v.error((ee=d.data)==null?void 0:ee.message)}catch(d){v.error(we(d))}};return n.useEffect(()=>{c==null||c.settitle(K),c==null||c.setSubtitle(O)},[A]),e.jsxs("main",{className:"grid items-start",children:[e.jsx(Ae,{open:_,setOpen:$,title:o?"Edit Workflow":"Add Workflow",id:J,edit:o,setEdit:M,refetch:t.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(ke,{search:k,setPage:w,setSearch:z,refetch:t.refetch,isFetching:t.isLoading})}),e.jsx("div",{children:e.jsx(G,{className:"flex items-center gap-2",onClick:()=>{$(!0)},children:"Add New"})})]}),e.jsxs(fe,{children:[e.jsx(je,{className:"px-7",children:e.jsxs(pe,{children:["Work Flow Role List (",(L=(C=t.data)==null?void 0:C.data)==null?void 0:L.totalDocs,")"]})}),e.jsx(Ne,{children:t.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(be,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(ve,{children:[e.jsx(Ie,{children:e.jsxs(se,{children:[e.jsx(b,{className:"",children:"#"}),e.jsx(b,{className:"",children:"Work Flow Name"}),e.jsx(b,{className:"",children:"Ulb Name"}),e.jsx(b,{className:"",children:"Module Name"}),e.jsx(b,{className:"",children:"Level Serial"}),e.jsx(b,{className:"",children:"Created at"}),e.jsx(b,{className:"",children:"Status"}),e.jsx(b,{children:"Action"})]})}),e.jsx(ye,{children:(R=(E=(q=t==null?void 0:t.data)==null?void 0:q.data)==null?void 0:E.docs)==null?void 0:R.map((a,y)=>{var j,p;return e.jsxs(se,{children:[e.jsx(g,{children:y+1}),e.jsx(g,{children:a==null?void 0:a.workFlowName}),e.jsx(g,{children:(j=a==null?void 0:a.ulb)==null?void 0:j.ulbName}),e.jsx(g,{children:(p=a==null?void 0:a.module)==null?void 0:p.moduleName}),e.jsx(g,{children:a==null?void 0:a.levelSerial}),e.jsx(g,{children:ge(a.createdAt).format("DD-MM-YYYY")}),e.jsx(g,{children:e.jsxs($e,{checked:(a==null?void 0:a.status)==1,onChange:()=>Y(a._id),className:`${a!=null&&a.status?"bg-primary":"bg-gray-200"} relative inline-flex h-6 w-11 items-center rounded-full`,children:[e.jsx("span",{className:"sr-only",children:"Enable notifications"}),e.jsx("span",{className:`${a!=null&&a.status?"translate-x-6":"translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white`})]})}),e.jsxs(g,{className:"space-x-2",children:[e.jsx(G,{variant:"secondary",onClick:()=>X(a._id),children:"Edit"}),e.jsx(G,{variant:"secondary",onClick:()=>{Q(`/grievance/dashboard/members-details?parentId=${a==null?void 0:a._id}`)},children:"Members"}),e.jsx(G,{className:"bg-primary md:ml-5",onClick:()=>{var N;Q(`/grievance/dashboard/workflow-master?parentId=${a==null?void 0:a._id}&levelSerial=${(a==null?void 0:a.levelSerial)+1}&parentName=${a.workFlowName}&moduleName=${(N=a==null?void 0:a.module)==null?void 0:N.moduleName}`)},children:"View"})]})]},a._id)})})]}),e.jsx(te,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(Pe,{page:m,perPage:x,totalPage:(B=(U=t==null?void 0:t.data)==null?void 0:U.data)==null?void 0:B.totalDocs,hasNextPage:(h=(l=t==null?void 0:t.data)==null?void 0:l.data)==null?void 0:h.hasNextPage,hasPrevPage:(u=(i=t==null?void 0:t.data)==null?void 0:i.data)==null?void 0:u.hasPrevPage,setPage:w,setPerPage:I})})]})})]})]})]})}function Ye(){const[c,m]=n.useState("Workflow Master List"),[w,x]=n.useState("");return e.jsx(Se,{title:c||"Workflow Master List",subTitle:w||"Manage all the work Flow here",children:e.jsx("div",{className:"",children:e.jsx(Ce,{settitle:m,setSubtitle:x})})})}export{Ye as default};
