import{u as ee,y as Z,p as M,d as ae,e as se,o as le,r as f,j as e,F as re,R as q,H as z,P as O,Q,a5 as k,a6 as de,J as oe,z as te,B as ie,f as ne,h as x,K as ce,i as h,_ as g,E as W,q as ue,s as pe,t as me,v as xe,w as he,I as ge,G as je,A as fe}from"./index-BRnLakpB.js";import{P as be}from"./index-Bj9W1lOi.js";import{T as Ne,a as Ie,b as X,c,d as ye,e as u}from"./table-DX_ipx9P.js";import{D as ve}from"./index-BvSiGDgj.js";import{g as Ue}from"./services-KQnp_8oA.js";import{P as we}from"./index-Dq_TpNNj.js";import{S as Se}from"./index-DWmEqRZi.js";import{q as Ae}from"./switch-DBWYH6I_.js";import"./badge-DsXNu46Z.js";import"./index-YSq32AOx.js";import"./circle-check-big-Ck6Q2ipy.js";import"./pagination-Di-b090E.js";const Pe=ne().shape({fullName:x().required("Full Name is required"),mobile:x().required().min(10).max(10).label("Mobile"),email:x().required("Email is required"),password:x().required("Password is required"),roleId:x().required("Role is required"),ulbId:x(),address:x(),imageUrl:ce().nullable(),moduleId:x()});function $e({open:B,setOpen:j,title:R,id:p,edit:i,setEdit:b,refetch:_}){var I,y,v,U,w,S,A,P,$,E;const L=ee({}),N=Z({}),{data:d,isFetching:H}=M({api:`${h.getUserById}/${p}`,key:"getUserById",options:{enabled:i}}),{user:s}=ae(),n=se({defaultValues:{fullName:"",mobile:"",email:"",password:"",roleId:"",address:""},resolver:le(Pe)}),l=async a=>{var m,D,F,C;const r=new FormData;(s==null?void 0:s.roleId)===k&&r.append("ulbId",s==null?void 0:s.userUlbId),((s==null?void 0:s.roleId)===Q||(s==null?void 0:s.roleId)===O)&&(a==null?void 0:a.roleId)===k&&r.append("ulbId",a==null?void 0:a.ulbId),r.append("fullName",a.fullName),r.append("mobile",a.mobile),r.append("roleId",a.roleId),r.append("moduleId",String(a.moduleId)),r.append("address",String(a==null?void 0:a.address)),r.append("imageUrl",a.imageUrl);try{if(i&&a){const o=await N.mutateAsync({api:`${h.updateUser}/${p}`,data:r});(m=o.data)!=null&&m.success?g.success((D=o==null?void 0:o.data)==null?void 0:D.message):g.error("User not updated successfully")}else{r.append("email",a.email),r.append("password",a.password);const o=await L.mutateAsync({api:h.createUser,data:r});(F=o.data)!=null&&F.success?g.success((C=o==null?void 0:o.data)==null?void 0:C.message):g.error("User not created successfully"),n.reset({fullName:"",mobile:"",email:"",password:"",roleId:"",address:""})}j(!1),b(!1),_()}catch(o){console.log(o)}};f.useEffect(()=>{i&&d?n.reset({fullName:d.userDetails.fullName,mobile:d.userDetails.mobile,email:d.userDetails.email,password:d.userDetails.password,roleId:d.userDetails.roleId,ulbId:d.userDetails.ulbId,address:d.userDetails.address,imageUrl:d.userDetails.imageUrl,moduleId:d.userDetails.moduleId}):n.reset({fullName:"",mobile:"",email:"",password:"",roleId:"",address:""})},[i,d]);const V=M({api:`${(I=h)==null?void 0:I.getAllRoleByPermission}?page=1&limit=10000`,key:"getAllRoleByPermission",options:{enabled:!0}}),Y=M({api:`${h.getAllUlb}?page=1&limit=1000`,key:"getAllUlb",options:{enabled:!0}}),T=M({api:`${h.getAllModule}?page=1&limit=1000`,key:"getAllModule",options:{enabled:!0}});return e.jsx(ve,{open:B,setOpen:j,title:R,setEdit:b,edit:i,isLoading:H,children:e.jsxs(re,{methods:n,onSubmit:n.handleSubmit(l),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-4",children:[e.jsx("div",{children:e.jsx(q,{name:"fullName",placeholder:"Enter your Full Name ",inputValidation:["CapitalFirstLetter","removeDoubleSpace","string"]})}),e.jsx("div",{children:e.jsx(q,{name:"mobile",placeholder:"Enter your Mobile no.",inputValidation:["mobile","number"]})}),e.jsx("div",{children:e.jsx(q,{name:"email",placeholder:"Enter your Email",inputValidation:["removeSpace"]})}),!i&&e.jsx("div",{children:e.jsx(q,{name:"password",placeholder:"Enter your Password"})}),e.jsx("div",{children:e.jsx(z,{name:"roleId",data:((U=(v=(y=V.data)==null?void 0:y.data)==null?void 0:v.docs)==null?void 0:U.map(a=>({value:a._id,label:a.roleName})))??[],disabled:i})}),((s==null?void 0:s.roleId)===O||(s==null?void 0:s.roleId)===Q)&&n.watch("roleId")===k&&e.jsx("div",{children:e.jsx(z,{name:"ulbId",data:((A=(S=(w=Y.data)==null?void 0:w.data)==null?void 0:S.docs)==null?void 0:A.map(a=>({value:a._id,label:a.ulbName})))??[],disabled:i})}),(s==null?void 0:s.roleId)===k&&n.watch("roleId")===de&&e.jsx("div",{children:e.jsx(z,{name:"moduleId",data:((E=($=(P=T.data)==null?void 0:P.data)==null?void 0:$.docs)==null?void 0:E.map(a=>({value:a._id,label:a.moduleName})))??[],disabled:i})}),e.jsx("div",{children:e.jsx(oe,{name:"imageUrl",placeholder:"Upload your Images"})}),e.jsx("div",{children:e.jsx(te,{name:"address",placeholder:"Enter your Address",inputValidation:["removeDoubleSpace","UppercaseAfterSpace"]})}),e.jsx("div",{})]}),e.jsx("div",{className:"mt-5 justify-center items-center flex",children:e.jsx(ie,{isLoading:n.formState.isSubmitting,type:"submit",className:"h-11 w-full md:w-1/2 rounded-xl",children:"Submit"})})]})})}function Ee(){var T,I,y,v,U,w,S,A,P,$,E;const B=Z({}),[j,R]=f.useState(1),[p,i]=f.useState(10),[b,_]=f.useState(""),[L,N]=f.useState(!1),[d,H]=f.useState(""),[s,n]=f.useState(!1),l=M({api:`${h.getAllUser}?page=${j}&limit=${p}&q=${b}`,key:"getAllUserData",value:[j,p],options:{enabled:!0}}),V=a=>{n(!0),N(!0),H(a)},Y=async a=>{var r,m,D,F,C,o,G,J,K;try{const t=await B.mutateAsync({api:`${(r=h)==null?void 0:r.updateUserStatus}/${a}`,data:{id:d}});(m=t==null?void 0:t.data)!=null&&m.success?(l.refetch(),((F=(D=t==null?void 0:t.data)==null?void 0:D.data)==null?void 0:F.status)==1&&g.success((C=t.data)==null?void 0:C.message),((G=(o=t==null?void 0:t.data)==null?void 0:o.data)==null?void 0:G.status)==0&&g.error((J=t.data)==null?void 0:J.message)):g.error((K=t.data)==null?void 0:K.message)}catch(t){g.error(Ue(t))}};return e.jsxs("main",{className:"grid items-start",children:[e.jsx($e,{open:L,setOpen:N,title:s?"Edit User":"Add User",id:d,edit:s,setEdit:n,refetch:l.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(Se,{search:b,setPage:R,setSearch:_,refetch:l.refetch,isFetching:l.isLoading})}),e.jsx("div",{children:e.jsx(W,{className:"flex items-center gap-2",onClick:()=>N(!0),children:"Add New"})})]}),e.jsxs(ue,{children:[e.jsx(pe,{className:"px-7",children:e.jsxs(me,{children:["Users List (",(I=(T=l.data)==null?void 0:T.data)==null?void 0:I.totalDocs,")"]})}),e.jsx(xe,{children:l.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(he,{})}):e.jsxs("div",{children:[e.jsxs(Ne,{className:"",children:[e.jsx(Ie,{children:e.jsxs(X,{children:[e.jsx(c,{className:"",children:"#"}),e.jsx(c,{className:"",children:"Images"}),e.jsx(c,{className:"",children:"Users Name"}),e.jsx(c,{className:"",children:"Mobile"}),e.jsx(c,{className:"",children:"Email"}),e.jsx(c,{className:"",children:"Role"}),e.jsx(c,{className:"",children:"ULB"}),e.jsx(c,{className:"",children:"Created at"}),e.jsx(c,{className:"",children:"Status"}),e.jsx(c,{children:"Action"})]})}),e.jsx(ye,{children:(U=(v=(y=l==null?void 0:l.data)==null?void 0:y.data)==null?void 0:v.docs)==null?void 0:U.map((a,r)=>{var m;return e.jsxs(X,{children:[e.jsx(u,{children:j*p-p+r+1}),e.jsx(u,{style:{margin:5,width:"50px",height:"50px",backgroundSize:"cover",backgroundPosition:"center",borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center",padding:0},children:e.jsx(ge,{src:a==null?void 0:a.fullImgUrl,alt:a==null?void 0:a.imageUrl,className:"h-12 w-12 rounded-full"})}),e.jsx(u,{children:a==null?void 0:a.fullName}),e.jsx(u,{children:a==null?void 0:a.mobile}),e.jsx(u,{children:(m=a==null?void 0:a.email)==null?void 0:m.replace("@","[at]").replace(/\./g,"[dot]")}),e.jsx(u,{children:a==null?void 0:a.role}),e.jsx(u,{children:a==null?void 0:a.ulb}),e.jsx(u,{children:je(a==null?void 0:a.createdAt).format("DD-MM-YYYY")}),e.jsx(u,{children:e.jsxs(Ae,{checked:(a==null?void 0:a.status)==1,onChange:()=>Y(a==null?void 0:a._id),className:`${a!=null&&a.status?"bg-primary":"bg-gray-200"} relative inline-flex items-center h-6 rounded-full w-11`,children:[e.jsx("span",{className:"sr-only",children:"Enable notifications"}),e.jsx("span",{className:`${a!=null&&a.status?"translate-x-6":"translate-x-1"} inline-block w-4 h-4 transform bg-white rounded-full`})]})}),e.jsx(u,{children:e.jsx(W,{className:"bg-primary",onClick:()=>V(a._id),children:"Edit"})})]},a._id)})})]}),e.jsx(fe,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(we,{page:j,perPage:p,totalPage:(S=(w=l==null?void 0:l.data)==null?void 0:w.data)==null?void 0:S.totalDocs,hasNextPage:(P=(A=l==null?void 0:l.data)==null?void 0:A.data)==null?void 0:P.hasNextPage,hasPrevPage:(E=($=l==null?void 0:l.data)==null?void 0:$.data)==null?void 0:E.hasPrevPage,setPage:R,setPerPage:i})})]})})]})]})]})}function Ve(){return e.jsx(be,{title:"Users List",subTitle:"Manage all the Users List here",children:e.jsx("div",{className:"",children:e.jsx(Ee,{})})})}export{Ve as default};
